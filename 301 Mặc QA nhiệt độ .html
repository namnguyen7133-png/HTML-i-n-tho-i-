<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>T√¨m ki·∫øm v√† ph√¢n t√≠ch t·ª´ trong vƒÉn b·∫£n</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 30px;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
            font-size: 28px;
            font-weight: 700;
        }
        
        label {
            display: block;
            margin-top: 20px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 18px;
        }
        
        textarea, input, select {
            width: 100%;
            margin-top: 8px;
            padding: 14px;
            font-size: 18px;
            border: 2px solid #ddd;
            border-radius: 6px;
            transition: border 0.3s;
            background-color: #fff;
        }
        
        textarea:focus, input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        textarea {
            height: 180px;
            resize: vertical;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }
        
        button {
            padding: 14px 28px;
            font-size: 18px;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s;
            min-height: 60px;
        }
        
        #searchBtn {
            background-color: #3498db;
            color: white;
            flex-grow: 1;
        }
        
        #searchBtn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        #clearBtn {
            background-color: #e74c3c;
            color: white;
        }
        
        #clearBtn:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }
        
        #highlightBtn {
            background-color: #27ae60;
            color: white;
            flex-grow: 1;
        }
        
        #highlightBtn:hover {
            background-color: #219653;
            transform: translateY(-2px);
        }
        
        #calculateBtn {
            background-color: #9b59b6;
            color: white;
            width: 100%;
            margin-top: 10px;
        }
        
        #calculateBtn:hover {
            background-color: #8e44ad;
            transform: translateY(-2px);
        }
        
        #result {
            margin-top: 30px;
            padding: 25px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #f8f9fa;
            min-height: 100px;
            font-size: 17px;
        }
        
        .result-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px dashed #ddd;
        }
        
        .result-section:last-child {
            border-bottom: none;
        }
        
        .section-title {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .highlight {
            background-color: #ffeb3b;
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: 700;
            font-size: 18px;
        }
        
        .found-item {
            padding: 12px;
            margin: 8px 0;
            background-color: white;
            border-left: 5px solid #3498db;
            border-radius: 6px;
            font-size: 17px;
        }
        
        .word-count {
            display: inline-block;
            background-color: #3498db;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 16px;
            margin-left: 10px;
            font-weight: 600;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            background-color: #2c3e50;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            text-align: center;
            margin: 5px 10px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
        }
        
        .stat-label {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .no-results {
            color: #7f8c8d;
            font-style: italic;
            text-align: center;
            padding: 25px;
            font-size: 18px;
        }
        
        .priority-high {
            border-left-color: #e74c3c !important;
            background-color: #ffeaea;
        }
        
        .priority-medium {
            border-left-color: #f39c12 !important;
            background-color: #fff8e1;
        }
        
        .priority-low {
            border-left-color: #27ae60 !important;
            background-color: #e8f6ef;
        }
        
        .person-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            background-color: #f9f9f9;
            font-size: 16px;
        }
        
        .person-item {
            padding: 12px;
            margin: 8px 0;
            border-left: 4px solid #3498db;
            background-color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .person-item:hover {
            background-color: #f0f8ff;
            transform: translateX(5px);
        }
        
        .selected-person {
            background-color: #e3f2fd !important;
            border-left-color: #e74c3c !important;
            border-left-width: 6px !important;
        }
        
        .calculation-result {
            background-color: #e8f6ef;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 6px solid #27ae60;
            font-size: 17px;
        }
        
        .two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        .info-text {
            font-size: 15px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
        
        .output-box {
            background-color: #f8f9fa;
            padding: 20px;
            border: 2px solid #3498db;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @media (max-width: 900px) {
            .two-columns {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .stats {
                flex-direction: column;
                align-items: center;
            }
            
            .stat-item {
                margin: 10px 0;
            }
            
            body {
                margin: 15px;
            }
            
            .container {
                padding: 20px;
            }
        }
        
        .large-text {
            font-size: 18px !important;
        }
        
        .clear-font {
            font-weight: 500;
            letter-spacing: 0.3px;
        }
        
        .last-letters-display {
            background-color: #e1f5fe;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #0288d1;
        }
        
        .letter-box {
            display: inline-block;
            background-color: #0288d1;
            color: white;
            padding: 8px 15px;
            margin: 0 5px;
            border-radius: 6px;
            font-size: 24px;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>T√¨m ki·∫øm v√† ph√¢n t√≠ch t·ª´ trong vƒÉn b·∫£n</h2>
    
    <div class="two-columns">
        <div>
            <label>Danh s√°ch ng∆∞·ªùi (t·ª± ƒë·ªông ch·ªçn ng∆∞·ªùi theo ng√†y hi·ªán t·∫°i)</label>
            <div class="info-text">Nh·∫•n v√†o t√™n ng∆∞·ªùi ƒë·ªÉ ch·ªçn t·ª± ƒë·ªông</div>
            <div class="person-list" id="personList">
                <!-- Danh s√°ch s·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JavaScript -->
            </div>
            
            <label>√î 1: Nh·∫≠p ng√†y hi·ªán t·∫°i (DD/MM/YYYY)</label>
            <input type="text" id="currentDateInput" placeholder="DD/MM/YYYY" value="">
            <div class="info-text">ƒê·ªÉ tr·ªëng ƒë·ªÉ s·ª≠ d·ª•ng ng√†y h√¥m nay</div>
            <button id="calculateBtn" onclick="calculateAndSelectPerson()">T√≠nh to√°n v√† ch·ªçn ng∆∞·ªùi</button>
            
            <div id="calculationResult" class="calculation-result"></div>
        </div>
        
        <div>
            <label>√î 2: Nh·∫≠p vƒÉn b·∫£n (copy t·ª´ ·∫£nh, email, t√†i li·ªáu...)</label>
            <textarea id="textInput" placeholder="V√≠ d·ª•: C√¥ng ty ABC ƒëang t√¨m ki·∫øm nh√¢n vi√™n kinh doanh t·∫°i H√† N·ªôi v√† TP.HCM. ∆Øu ti√™n ·ª©ng vi√™n c√≥ kinh nghi·ªám t·ª´ 2 nƒÉm tr·ªü l√™n." class="large-text clear-font"></textarea>
            <div id="textStats" class="info-text"></div>
            
            <label>√î 3: Nh·∫≠p t·ª´/c·ª•m t·ª´ mu·ªën t√¨m (t·ª± ƒë·ªông ƒëi·ªÅn t√™n ng∆∞·ªùi ƒë∆∞·ª£c ch·ªçn)</label>
            <input type="text" id="searchInput" placeholder="T√™n ng∆∞·ªùi s·∫Ω t·ª± ƒë·ªông ƒëi·ªÅn v√†o ƒë√¢y" class="large-text clear-font">
            <div class="info-text">T√™n ng∆∞·ªùi s·∫Ω t·ª± ƒë·ªông ƒëi·ªÅn khi b·∫°n ch·ªçn t·ª´ danh s√°ch</div>
            
            <div class="last-letters-display">
                <div class="section-title">Ch·ªØ c√°i cu·ªëi c√πng c·ªßa m·ªói t·ª´ trong t√™n:</div>
                <div id="lastLettersContainer"></div>
            </div>
            
            <div class="output-box" id="outputBox">
                K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y
            </div>
            
            <div class="button-group">
                <button id="searchBtn" onclick="analyzeText()">T√¨m ki·∫øm</button>
                <button id="highlightBtn" onclick="highlightText()">ƒê√°nh d·∫•u trong vƒÉn b·∫£n</button>
                <button id="clearBtn" onclick="clearSearch()">Xo√° k·∫øt qu·∫£</button>
            </div>
        </div>
    </div>
    
    <div id="result"></div>
</div>

<script>
// Danh s√°ch ng∆∞·ªùi v·ªõi t√™n ƒë·∫ßy ƒë·ªß d·∫•u
const personList = [
    { id: 1, name: "NGUY·ªÑN KH·∫ÆC NƒÇNG", birthDate: "04/06/1944" },
    { id: 2, name: "T√î TH·ªä H√Ä", birthDate: "29/08/1948" },
    { id: 3, name: "NGUY·ªÑN MINH NAM", birthDate: "03/03/1971" },
    { id: 4, name: "TH√ÇN TH·ªä KIM ANH", birthDate: "23/09/1981" },
    { id: 5, name: "NGUY·ªÑN T√î NG√ÇN AN", birthDate: "28/09/2014" },
    { id: 6, name: "NGUY·ªÑN T√î MINH CH√ÇU", birthDate: "25/07/2016" },
    { id: 7, name: "NGUY·ªÑN T√î B√çCH NG·ªåC", birthDate: "05/02/2020" },
    { id: 8, name: "NGUY·ªÑN TH·ªä MINH H·∫∞NG", birthDate: "07/01/1974" },
    { id: 9, name: "NG√î QU√ù C∆Ø·ªúNG", birthDate: "23/05/1973" },
    { id: 10, name: "NG√î GIA B√ÅCH", birthDate: "12/10/2000" },
    { id: 11, name: "NG√î GIA LINH", birthDate: "05/04/2005" },
    { id: 12, name: "NGUY·ªÑN TH·ªä MINH PH∆Ø∆†NG", birthDate: "06/11/1978" },
    { id: 13, name: "HO√ÄNG ANH D≈®NG", birthDate: "21/09/1978" },
    { id: 14, name: "HO√ÄNG H·∫¢I VINH", birthDate: "03/06/2010" },
    { id: 15, name: "HO√ÄNG THI√äN B·∫†CH ANH", birthDate: "14/11/2015" },
    { id: 16, name: "T√î KIM HU·ªÜ", birthDate: "09/08/1960" },
    { id: 17, name: "NGUY·ªÑN TU·∫§N ANH", birthDate: "23/10/1983" },
    { id: 18, name: "NGUY·ªÑN TH·∫æ ANH", birthDate: "24/03/2001" },
    { id: 19, name: "NG√î TH·ªä MAI", birthDate: "12/12/1948" },
    { id: 20, name: "T√î VI·ªÜT H∆ØNG", birthDate: "17/06/1996" },
    { id: 21, name: "T√î TH·ªä H·ªíNG", birthDate: "10/10/1964" },
    { id: 22, name: "V≈® VƒÇN HI·ªÜP", birthDate: "24/04/1974" },
    { id: 23, name: "NGUY·ªÑN TH·ªä CHI", birthDate: "08/02/1946" },
    { id: 24, name: "NGUY·ªÑN T·∫§N B·∫ÆC", birthDate: "30/11/1957" },
    { id: 25, name: "NGUY·ªÑN TH·ªä T√ÇM", birthDate: "08/08/1954" }
];

let selectedPersonIndex = -1;

// H√†m ƒë·ªÉ hi·ªÉn th·ªã danh s√°ch ng∆∞·ªùi
function displayPersonList() {
    const personListDiv = document.getElementById("personList");
    personListDiv.innerHTML = '';
    
    personList.forEach((person, index) => {
        const personDiv = document.createElement("div");
        personDiv.className = "person-item";
        personDiv.id = `person-${index}`;
        personDiv.innerHTML = `
            <strong style="font-size: 18px;">${person.id}. ${person.name}</strong>
            <div style="font-size: 16px; color: #666;">Ng√†y sinh: ${person.birthDate}</div>
        `;
        
        personDiv.addEventListener("click", () => {
            selectPerson(index);
        });
        
        personListDiv.appendChild(personDiv);
    });
}

// H√†m l·∫•y ch·ªØ c√°i cu·ªëi c√πng c·ªßa m·ªói t·ª´ trong t√™n
function getLastLettersOfName(fullName) {
    // T√°ch t√™n th√†nh c√°c t·ª´
    const words = fullName.split(' ');
    // L·ªçc b·ªè c√°c t·ª´ tr·ªëng
    const nonEmptyWords = words.filter(word => word.trim().length > 0);
    // L·∫•y ch·ªØ c√°i cu·ªëi c√πng c·ªßa m·ªói t·ª´
    const lastLetters = nonEmptyWords.map(word => {
        // L·∫•y k√Ω t·ª± cu·ªëi c√πng
        const lastChar = word.charAt(word.length - 1);
        return lastChar;
    });
    
    return lastLetters;
}

// H√†m hi·ªÉn th·ªã ch·ªØ c√°i cu·ªëi c√πng
function displayLastLetters(fullName) {
    const lastLetters = getLastLettersOfName(fullName);
    const container = document.getElementById("lastLettersContainer");
    
    let html = '<div style="margin: 10px 0;">';
    
    // Hi·ªÉn th·ªã gi·∫£i th√≠ch
    html += `<div style="margin-bottom: 10px; font-size: 16px;">T√™n: <strong>${fullName}</strong></div>`;
    html += '<div style="margin-bottom: 10px;">Ch·ªØ c√°i cu·ªëi c√πng c·ªßa m·ªói t·ª´:</div>';
    
    // Hi·ªÉn th·ªã t·ª´ng ch·ªØ c√°i trong box
    lastLetters.forEach((letter, index) => {
        html += `<span class="letter-box">${letter}</span>`;
    });
    
    // Hi·ªÉn th·ªã k·∫øt qu·∫£ g·ªôp
    if (lastLetters.length > 0) {
        const combinedLetters = lastLetters.join('');
        html += `<div style="margin-top: 15px; font-size: 18px; font-weight: bold;">K·∫øt qu·∫£: <span style="color: #e74c3c;">${combinedLetters}</span></div>`;
        
        // C·∫≠p nh·∫≠t √¥ output box
        document.getElementById("outputBox").innerHTML = `K·∫øt qu·∫£: <span style="font-size: 36px; color: #e74c3c;">${combinedLetters}</span>`;
    }
    
    html += '</div>';
    container.innerHTML = html;
}

// H√†m ƒë·ªÉ ch·ªçn ng∆∞·ªùi t·ª´ danh s√°ch
function selectPerson(index) {
    // B·ªè ch·ªçn ng∆∞·ªùi c≈©
    if (selectedPersonIndex >= 0) {
        const oldPersonDiv = document.getElementById(`person-${selectedPersonIndex}`);
        oldPersonDiv.classList.remove("selected-person");
    }
    
    // Ch·ªçn ng∆∞·ªùi m·ªõi
    selectedPersonIndex = index;
    const newPersonDiv = document.getElementById(`person-${index}`);
    newPersonDiv.classList.add("selected-person");
    
    // L·∫•y t√™n ng∆∞·ªùi ƒë·∫ßy ƒë·ªß
    const personName = personList[index].name;
    
    // ƒêi·ªÅn t√™n v√†o √¥ t√¨m ki·∫øm (c√≥ th·ªÉ chu·∫©n h√≥a ho·∫∑c kh√¥ng)
    document.getElementById("searchInput").value = personName;
    
    // Hi·ªÉn th·ªã ch·ªØ c√°i cu·ªëi c√πng
    displayLastLetters(personName);
    
    // Cu·ªôn ƒë·∫øn ng∆∞·ªùi ƒë∆∞·ª£c ch·ªçn
    newPersonDiv.scrollIntoView({ behavior: "smooth", block: "nearest" });
}

// H√†m chu·∫©n h√≥a vƒÉn b·∫£n: vi·∫øt th∆∞·ªùng v√† b·ªè d·∫•u
function normalizeText(text) {
    return text
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .replace(/ƒë/g, "d")
        .replace(/ƒê/g, "d");
}

// H√†m t√≠nh to√°n v√† ch·ªçn ng∆∞·ªùi theo ng√†y hi·ªán t·∫°i
function calculateAndSelectPerson() {
    const dateInput = document.getElementById("currentDateInput").value.trim();
    let currentDate;
    
    // N·∫øu kh√¥ng nh·∫≠p ng√†y, s·ª≠ d·ª•ng ng√†y hi·ªán t·∫°i
    if (!dateInput) {
        currentDate = new Date();
    } else {
        // Ph√¢n t√≠ch ng√†y nh·∫≠p v√†o
        const parts = dateInput.split('/');
        if (parts.length !== 3) {
            alert("Vui l√≤ng nh·∫≠p ng√†y theo ƒë·ªãnh d·∫°ng DD/MM/YYYY");
            return;
        }
        
        const day = parseInt(parts[0]);
        const month = parseInt(parts[1]) - 1; // Th√°ng b·∫Øt ƒë·∫ßu t·ª´ 0
        const year = parseInt(parts[2]);
        
        if (isNaN(day) || isNaN(month) || isNaN(year)) {
            alert("Ng√†y th√°ng nƒÉm kh√¥ng h·ª£p l·ªá");
            return;
        }
        
        currentDate = new Date(year, month, day);
        if (isNaN(currentDate.getTime())) {
            alert("Ng√†y th√°ng nƒÉm kh√¥ng h·ª£p l·ªá");
            return;
        }
    }
    
    // T√≠nh s·ªë ng√†y t·ª´ 1/1/1900 ƒë·∫øn ng√†y hi·ªán t·∫°i
    const baseDate = new Date(1900, 0, 1); // 1/1/1900
    const timeDiff = currentDate.getTime() - baseDate.getTime();
    const daysDiff = Math.floor(timeDiff / (1000 * 3600 * 24));
    
    // T√≠nh s·ªë d∆∞ khi chia cho t·ªïng s·ªë ng∆∞·ªùi
    const totalPeople = personList.length;
    let remainder = daysDiff % totalPeople;
    
    // N·∫øu s·ªë d∆∞ l√† 0, l·∫•y ƒë√∫ng s·ªë chia (t·ªïng s·ªë ng∆∞·ªùi)
    if (remainder === 0) {
        remainder = totalPeople;
    }
    
    // Ch·ªçn ng∆∞·ªùi (index b·∫Øt ƒë·∫ßu t·ª´ 0)
    const selectedIndex = remainder - 1;
    
    // Hi·ªÉn th·ªã k·∫øt qu·∫£ t√≠nh to√°n
    const calculationResultDiv = document.getElementById("calculationResult");
    calculationResultDiv.innerHTML = `
        <strong style="font-size: 18px;">K·∫øt qu·∫£ t√≠nh to√°n:</strong><br><br>
        - Ng√†y hi·ªán t·∫°i: ${formatDate(currentDate)}<br>
        - S·ªë ng√†y t·ª´ 1/1/1900: ${daysDiff} ng√†y<br>
        - T·ªïng s·ªë ng∆∞·ªùi trong danh s√°ch: ${totalPeople}<br>
        - Ph√©p t√≠nh: ${daysDiff} % ${totalPeople} = ${remainder}<br>
        - <strong style="font-size: 18px; color: #e74c3c;">Ng∆∞·ªùi ƒë∆∞·ª£c ch·ªçn: ${remainder}. ${personList[selectedIndex].name}</strong>
    `;
    
    // Ch·ªçn ng∆∞·ªùi trong danh s√°ch
    selectPerson(selectedIndex);
}

// H√†m ƒë·ªãnh d·∫°ng ng√†y
function formatDate(date) {
    const day = String(date.getDate()).padStart(2, '0');
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const year = date.getFullYear();
    return `${day}/${month}/${year}`;
}

// Kh·ªüi t·∫°o ng√†y hi·ªán t·∫°i trong √¥ nh·∫≠p
function initializeCurrentDate() {
    const today = new Date();
    const formattedDate = formatDate(today);
    document.getElementById("currentDateInput").value = formattedDate;
    
    // T√≠nh to√°n v√† ch·ªçn ng∆∞·ªùi t·ª± ƒë·ªông khi trang ƒë∆∞·ª£c t·∫£i
    calculateAndSelectPerson();
}

// C√°c h√†m t√¨m ki·∫øm v√† ph√¢n t√≠ch vƒÉn b·∫£n
function analyzeText() {
    const text = document.getElementById("textInput").value;
    const search = document.getElementById("searchInput").value.trim();
    const resultDiv = document.getElementById("result");
    
    if (!text) {
        resultDiv.innerHTML = '<div class="no-results">Vui l√≤ng nh·∫≠p vƒÉn b·∫£n c·∫ßn t√¨m ki·∫øm.</div>';
        return;
    }
    
    if (!search) {
        resultDiv.innerHTML = '<div class="no-results">Vui l√≤ng nh·∫≠p t·ª´/c·ª•m t·ª´ c·∫ßn t√¨m.</div>';
        return;
    }
    
    // Chu·∫©n h√≥a t·ª´ t√¨m ki·∫øm
    const normalizedSearch = normalizeText(search);
    const searchTerms = normalizedSearch.split(/[,;\s]+/).filter(term => term.length > 0);
    const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
    const words = text.split(/\s+/).filter(w => w.length > 0);
    
    let resultHTML = '';
    let totalMatches = 0;
    let exactPhraseMatches = [];
    let allTermsMatches = [];
    let partialMatches = [];
    
    // T√¨m ki·∫øm c·ª•m t·ª´ ch√≠nh x√°c (to√†n b·ªô c·ª•m t·ª´ t√¨m ki·∫øm)
    const exactPhrase = search.trim();
    if (exactPhrase.length > 0) {
        // T√¨m c·∫£ phi√™n b·∫£n c√≥ d·∫•u v√† kh√¥ng d·∫•u
        const exactRegex = new RegExp(`\\b${escapeRegExp(exactPhrase)}\\b`, 'gi');
        const exactMatches = text.match(exactRegex);
        
        if (exactMatches) {
            exactPhraseMatches = exactMatches;
            totalMatches += exactMatches.length;
        }
        
        // T√¨m phi√™n b·∫£n ƒë√£ chu·∫©n h√≥a
        const normalizedExactPhrase = normalizeText(exactPhrase);
        const normalizedTextForSearch = normalizeText(text);
        const normalizedExactRegex = new RegExp(`\\b${escapeRegExp(normalizedExactPhrase)}\\b`, 'gi');
        const normalizedExactMatches = normalizedTextForSearch.match(normalizedExactRegex);
        
        if (normalizedExactMatches && normalizedExactMatches.length > exactPhraseMatches.length) {
            totalMatches += (normalizedExactMatches.length - exactPhraseMatches.length);
            exactPhraseMatches = [...new Set([...exactPhraseMatches, ...normalizedExactMatches])];
        }
    }
    
    // T√¨m ki·∫øm c√°c t·ª´ trong c√πng m·ªôt c√¢u (∆∞u ti√™n cao)
    for (let i = 0; i < sentences.length; i++) {
        const sentence = sentences[i].trim();
        const normalizedSentence = normalizeText(sentence);
        let sentenceHasAllTerms = true;
        
        // Ki·ªÉm tra xem c√¢u c√≥ ch·ª©a t·∫•t c·∫£ c√°c t·ª´ t√¨m ki·∫øm kh√¥ng
        for (let term of searchTerms) {
            const termRegex = new RegExp(`\\b${escapeRegExp(term)}\\b`, 'i');
            if (!termRegex.test(normalizedSentence)) {
                sentenceHasAllTerms = false;
                break;
            }
        }
        
        if (sentenceHasAllTerms && searchTerms.length > 1) {
            allTermsMatches.push({
                sentence: sentence,
                normalizedSentence: normalizedSentence,
                index: i + 1
            });
            totalMatches++;
        }
    }
    
    // T√¨m ki·∫øm t·ª´ng t·ª´ ri√™ng l·∫ª (∆∞u ti√™n th·∫•p)
    for (let term of searchTerms) {
        if (term.length === 0) continue;
        
        const normalizedTextForSearch = normalizeText(text);
        const termRegex = new RegExp(`\\b${escapeRegExp(term)}\\b`, 'gi');
        const termMatches = normalizedTextForSearch.match(termRegex);
        
        if (termMatches) {
            partialMatches.push({
                term: term,
                count: termMatches.length,
                matches: termMatches
            });
            totalMatches += termMatches.length;
        }
    }
    
    // X√¢y d·ª±ng k·∫øt qu·∫£ HTML
    resultHTML += '<div class="stats">';
    resultHTML += `<div class="stat-item"><div class="stat-value">${totalMatches}</div><div class="stat-label">T·ªïng k·∫øt qu·∫£</div></div>`;
    resultHTML += `<div class="stat-item"><div class="stat-value">${exactPhraseMatches.length}</div><div class="stat-label">C·ª•m ch√≠nh x√°c</div></div>`;
    resultHTML += `<div class="stat-item"><div class="stat-value">${allTermsMatches.length}</div><div class="stat-label">C√¢u c√≥ ƒë·ªß t·ª´</div></div>`;
    resultHTML += `<div class="stat-item"><div class="stat-value">${searchTerms.length}</div><div class="stat-label">T·ª´ c·∫ßn t√¨m</div></div>`;
    resultHTML += '</div>';
    
    // Hi·ªÉn th·ªã k·∫øt qu·∫£ c·ª•m t·ª´ ch√≠nh x√°c
    if (exactPhraseMatches.length > 0) {
        resultHTML += '<div class="result-section">';
        resultHTML += '<div class="section-title">üéØ T√¨m th·∫•y c·ª•m t·ª´ ch√≠nh x√°c:</div>';
        resultHTML += `<div class="found-item priority-high">"<span class="highlight">${exactPhrase}</span>" xu·∫•t hi·ªán <span class="word-count">${exactPhraseMatches.length} l·∫ßn</span></div>`;
        
        // Hi·ªÉn th·ªã c√°c ng·ªØ c·∫£nh
        const contextRegex = new RegExp(`([^.!?]*?\\b${escapeRegExp(exactPhrase)}\\b[^.!?]*[.!?])`, 'gi');
        const contexts = text.match(contextRegex) || [];
        
        contexts.slice(0, 5).forEach(context => {
            const highlightedContext = context.replace(
                new RegExp(`(${escapeRegExp(exactPhrase)})`, 'gi'), 
                '<span class="highlight">$1</span>'
            );
            resultHTML += `<div class="found-item priority-medium">${highlightedContext}</div>`;
        });
        
        if (contexts.length > 5) {
            resultHTML += `<div class="found-item">... v√† ${contexts.length - 5} ng·ªØ c·∫£nh kh√°c</div>`;
        }
        
        resultHTML += '</div>';
    }
    
    // Hi·ªÉn th·ªã k·∫øt qu·∫£ c√¢u c√≥ ƒë·∫ßy ƒë·ªß c√°c t·ª´ t√¨m ki·∫øm
    if (allTermsMatches.length > 0) {
        resultHTML += '<div class="result-section">';
        resultHTML += `<div class="section-title">‚úÖ T√¨m th·∫•y ${allTermsMatches.length} c√¢u ch·ª©a ƒë·∫ßy ƒë·ªß c√°c t·ª´: "${searchTerms.join(', ')}"</div>`;
        
        allTermsMatches.forEach(match => {
            let highlightedSentence = match.sentence;
            // ƒê√°nh d·∫•u t·ª´ng t·ª´ trong c√¢u
            searchTerms.forEach(term => {
                const termRegex = new RegExp(`\\b(${escapeRegExp(term)})\\b`, 'gi');
                // T√¨m t·ª´ trong c√¢u ƒë√£ chu·∫©n h√≥a ƒë·ªÉ bi·∫øt v·ªã tr√≠
                const normalizedSentence = match.normalizedSentence;
                const termMatch = normalizedSentence.match(termRegex);
                if (termMatch) {
                    // ƒê√°nh d·∫•u trong c√¢u g·ªëc
                    const wordsInSentence = match.sentence.split(/\s+/);
                    for (let i = 0; i < wordsInSentence.length; i++) {
                        const normalizedWord = normalizeText(wordsInSentence[i]);
                        if (normalizedWord === term.toLowerCase()) {
                            wordsInSentence[i] = `<span class="highlight">${wordsInSentence[i]}</span>`;
                        }
                    }
                    highlightedSentence = wordsInSentence.join(' ');
                }
            });
            resultHTML += `<div class="found-item priority-high">C√¢u ${match.index}: ${highlightedSentence}</div>`;
        });
        
        resultHTML += '</div>';
    }
    
    // Hi·ªÉn th·ªã k·∫øt qu·∫£ t·ª´ng t·ª´ ri√™ng l·∫ª
    if (partialMatches.length > 0 && (exactPhraseMatches.length === 0 || searchTerms.length > 1)) {
        resultHTML += '<div class="result-section">';
        resultHTML += '<div class="section-title">üìä K·∫øt qu·∫£ t√¨m ki·∫øm t·ª´ng t·ª´ ri√™ng l·∫ª:</div>';
        
        partialMatches.forEach(match => {
            resultHTML += `<div class="found-item priority-low">T·ª´ "<span class="highlight">${match.term}</span>" xu·∫•t hi·ªán <span class="word-count">${match.count} l·∫ßn</span></div>`;
        });
        
        resultHTML += '</div>';
    }
    
    // Th√¥ng b√°o n·∫øu kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£
    if (exactPhraseMatches.length === 0 && allTermsMatches.length === 0 && partialMatches.length === 0) {
        resultHTML += '<div class="no-results">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p v·ªõi t·ª´ t√¨m ki·∫øm.</div>';
    }
    
    resultDiv.innerHTML = resultHTML;
}

function highlightText() {
    const text = document.getElementById("textInput").value;
    const search = document.getElementById("searchInput").value.trim();
    
    if (!text || !search) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß vƒÉn b·∫£n v√† t·ª´ t√¨m ki·∫øm.");
        return;
    }
    
    const searchTerms = search.split(/[,;\s]+/).filter(term => term.length > 0);
    let highlightedText = text;
    
    // ƒê√°nh d·∫•u c·ª•m t·ª´ ch√≠nh x√°c tr∆∞·ªõc
    const exactPhrase = search.trim();
    if (exactPhrase.length > 0) {
        const exactRegex = new RegExp(`\\b(${escapeRegExp(exactPhrase)})\\b`, 'gi');
        highlightedText = highlightedText.replace(exactRegex, '<mark style="background-color: #ffeb3b; font-weight: bold; padding: 2px 4px; border-radius: 3px;">$1</mark>');
    }
    
    // ƒê√°nh d·∫•u c√°c t·ª´ ri√™ng l·∫ª (n·∫øu kh√¥ng c√≥ c·ª•m t·ª´ ch√≠nh x√°c)
    if (exactPhrase.length === 0 || searchTerms.length > 1) {
        searchTerms.forEach(term => {
            if (term.length === 0) return;
            // T√¨m v√† ƒë√°nh d·∫•u c·∫£ phi√™n b·∫£n c√≥ d·∫•u v√† kh√¥ng d·∫•u
            const words = text.split(/\s+/);
            words.forEach(word => {
                const normalizedWord = normalizeText(word);
                if (normalizedWord.includes(term) || term.includes(normalizedWord)) {
                    const wordRegex = new RegExp(`\\b${escapeRegExp(word)}\\b`, 'g');
                    highlightedText = highlightedText.replace(wordRegex, `<mark style="background-color: #a8e6cf; padding: 2px 4px; border-radius: 3px; font-weight: bold;">${word}</mark>`);
                }
            });
        });
    }
    
    // Hi·ªÉn th·ªã vƒÉn b·∫£n ƒë√£ ƒë√°nh d·∫•u trong m·ªôt c·ª≠a s·ªï m·ªõi
    const newWindow = window.open();
    newWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>VƒÉn b·∫£n ƒë√£ ƒë√°nh d·∫•u</title>
            <style>
                body { 
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
                    margin: 30px; 
                    line-height: 1.8; 
                    font-size: 18px;
                    color: #333;
                    background-color: #f5f7fa;
                }
                .header { 
                    background-color: #2c3e50; 
                    color: white; 
                    padding: 25px; 
                    margin-bottom: 25px; 
                    border-radius: 8px;
                }
                .content { 
                    padding: 25px; 
                    background-color: white; 
                    border-radius: 8px; 
                    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                    line-height: 1.8;
                    font-size: 18px;
                }
                mark { 
                    border-radius: 4px; 
                    padding: 3px 6px;
                    font-weight: 600;
                }
                h2 {
                    font-size: 24px;
                    margin-bottom: 10px;
                }
                p {
                    font-size: 17px;
                    margin: 8px 0;
                }
            </style>
        </head>
        <body>
            <div class="header">
                <h2>VƒÉn b·∫£n ƒë√£ ƒë√°nh d·∫•u t·ª´ t√¨m ki·∫øm: "${search}"</h2>
                <p>T·ª´ ƒë∆∞·ª£c ƒë√°nh d·∫•u m√†u v√†ng: c·ª•m t·ª´ ch√≠nh x√°c | T·ª´ ƒë∆∞·ª£c ƒë√°nh d·∫•u m√†u xanh: t·ª´ ri√™ng l·∫ª</p>
                <p>Ng∆∞·ªùi t√¨m ki·∫øm: ${selectedPersonIndex >= 0 ? personList[selectedPersonIndex].name : "Ch∆∞a ch·ªçn"}</p>
                <p>Ch·ªØ c√°i cu·ªëi c√πng: ${selectedPersonIndex >= 0 ? getLastLettersOfName(personList[selectedPersonIndex].name).join('') : ""}</p>
                <p>Ng√†y: ${new Date().toLocaleDateString('vi-VN')}</p>
            </div>
            <div class="content">${highlightedText}</div>
        </body>
        </html>
    `);
    newWindow.document.close();
}

function clearSearch() {
    if (selectedPersonIndex >= 0) {
        document.getElementById("searchInput").value = personList[selectedPersonIndex].name;
        displayLastLetters(personList[selectedPersonIndex].name);
    } else {
        document.getElementById("searchInput").value = "";
        document.getElementById("lastLettersContainer").innerHTML = "";
        document.getElementById("outputBox").innerHTML = "K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y";
    }
    document.getElementById("result").innerHTML = "";
}

// H√†m h·ªó tr·ª£: escape k√Ω t·ª± ƒë·∫∑c bi·ªát trong regex
function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

// Th√™m s·ª± ki·ªán Enter ƒë·ªÉ t√¨m ki·∫øm
document.getElementById("searchInput").addEventListener("keyup", function(event) {
    if (event.key === "Enter") {
        analyzeText();
    }
});

// Th√™m s·ª± ki·ªán cho textarea
document.getElementById("textInput").addEventListener("input", function() {
    const charCount = this.value.length;
    const wordCount = this.value.split(/\s+/).filter(w => w.length > 0).length;
    
    // Hi·ªÉn th·ªã th·ªëng k√™
    document.getElementById("textStats").textContent = `K√Ω t·ª±: ${charCount} | T·ª´: ${wordCount}`;
});

// Kh·ªüi t·∫°o khi trang ƒë∆∞·ª£c t·∫£i
window.onload = function() {
    displayPersonList();
    initializeCurrentDate();
};
</script>

</body>
</html>