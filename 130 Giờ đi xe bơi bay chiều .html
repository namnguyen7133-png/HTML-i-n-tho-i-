<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√≠nh to√°n Ng√†y Sinh - Xem Ng√†y</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .input-section {
            flex: 1;
            min-width: 300px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .result-section {
            flex: 2;
            min-width: 300px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1, h2, h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        
        h1 {
            text-align: center;
            color: #2980b9;
            margin-bottom: 30px;
            border-bottom: 2px solid #2980b9;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #34495e;
        }
        
        select, input[type="date"], input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        select:focus, input[type="date"]:focus, input[type="text"]:focus {
            border-color: #3498db;
            outline: none;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .result-box {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .special-number {
            display: inline-block;
            padding: 5px 10px;
            margin: 3px;
            background-color: #e74c3c;
            color: white;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
            padding: 10px;
            margin: 10px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .emergency {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { background-color: #f8d7da; }
            50% { background-color: #f5c6cb; }
            100% { background-color: #f8d7da; }
        }
        
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        th {
            background-color: #3498db;
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .highlight {
            background-color: #ffeaa7 !important;
            font-weight: bold;
        }
        
        .critical {
            background-color: #ffcccc !important;
            font-weight: bold;
        }
        
        .time-column {
            min-width: 80px;
        }
        
        .number-column {
            min-width: 100px;
        }
        
        .hidden {
            display: none;
        }
        
        .toggle-btn {
            background-color: #95a5a6;
            width: auto;
            padding: 8px 16px;
            font-size: 14px;
            margin: 5px 0;
        }
        
        .toggle-btn:hover {
            background-color: #7f8c8d;
        }
        
        .health-alert {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
            padding: 12px;
            margin: 10px 0;
            border-radius: 0 5px 5px 0;
            font-weight: bold;
        }
        
        .food-alert {
            background-color: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
            padding: 12px;
            margin: 10px 0;
            border-radius: 0 5px 5px 0;
            font-weight: bold;
        }
        
        .medicine-alert {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
            padding: 12px;
            margin: 10px 0;
            border-radius: 0 5px 5px 0;
            font-weight: bold;
        }
        
        .heart-alert {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
            font-weight: bold;
            animation: heartbeat 1s infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .danger-list {
            background-color: #f8d7da;
            border: 2px solid #dc3545;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .danger-item {
            background-color: #ffe6e6;
            border-left: 4px solid #e74c3c;
            margin: 8px 0;
            padding: 10px;
            border-radius: 0 5px 5px 0;
        }
        
        .danger-time {
            display: inline-block;
            background-color: #e74c3c;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .danger-person {
            font-weight: bold;
            color: #c0392b;
        }
        
        .danger-number {
            display: inline-block;
            background-color: #8b0000;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .input-section, .result-section {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <h1>T√çNH TO√ÅN CH√äNH L·ªÜCH NG√ÄY V√Ä D·ª∞ B√ÅO S·ª®C KH·ªéE</h1>
    
    <div class="container">
        <div class="input-section">
            <h2>NH·∫¨P TH√îNG TIN</h2>
            
            <div class="form-group">
                <label for="personSelect">1. Ch·ªçn ho·∫∑c nh·∫≠p t√™n:</label>
                <select id="personSelect" onchange="updateBirthdateFromSelect()">
                    <option value="">-- Ch·ªçn ng∆∞·ªùi --</option>
                    <option value="NGUYENKHACNANG,04/06/1944">1. NGUYEN KHAC NANG</option>
                    <option value="TOTHIHA,29/08/1948">2. TO THI HA</option>
                    <option value="NGUYENMINHNAM,03/03/1971">3. NGUYEN MINH NAM</option>
                    <option value="THANTHIKIMANH,23/09/1981">4. THAN THI KIM ANH</option>
                    <option value="NGUYENTONGANAN,28/09/2014">5. NGUYEN TONG AN AN</option>
                    <option value="NGUYENTOMINHCHAU,25/07/2016">6. NGUYEN TO MINH CHAU</option>
                    <option value="NGUYENTOBICHNGOC,05/02/2020">7. NGUYEN TO BICH NGOC</option>
                    <option value="NGUYENTHIMINHHANG,07/01/1974">8. NGUYEN THI MINH HANG</option>
                    <option value="NGOQUYCUONG,23/05/1973">9. NGO QUY CUONG</option>
                    <option value="NGOGIABACH,12/10/2000">10. NGO GIA BACH</option>
                    <option value="NGOGIALINH,05/04/2005">11. NGO GIA LINH</option>
                    <option value="NGUYENTHIMINHPHUONG,06/11/1978">12. NGUYEN THI MINH PHUONG</option>
                    <option value="HOANGANHDUNG,21/09/1978">13. HOANG ANH DUNG</option>
                    <option value="HOANGHAIVINH,03/06/2010">14. HOANG HAI VINH</option>
                    <option value="HOANGTHIENBACHANH,14/11/2015">15. HOANG THIEN BACH ANH</option>
                    <option value="TOKIMHUE,09/08/1960">16. T√î KIM HU·ªÜ</option>
                    <option value="NGUYENTUANANH,23/10/1983">17. NGUY·ªÑN TU·∫§N ANH</option>
                    <option value="NGUYENTHEANH,24/03/2001">18. NGUY·ªÑN TH·∫æ ANH</option>
                    <option value="NGOTHIMAI,12/12/1948">19. NG√î TH·ªä MAI</option>
                    <option value="TOVIETHUNG,17/06/1996">20. T√î VI·ªÜT H∆ØNG</option>
                    <option value="TOTHIHONG,10/10/1964">21. T√î TH·ªä H·ªíNG</option>
                    <option value="VUVANHIEP,24/04/1974">22. V≈® VƒÇN HI·ªÜP</option>
                    <option value="NGUYENTHICHI,08/02/1946">23. NGUY·ªÑN TH·ªä CHI</option>
                    <option value="NGUYENTANBAC,30/11/1957">24. NGUY·ªÑN T·∫§N B·∫ÆC</option>
                    <option value="NGUYENTHITAM,08/08/1954">25. NGUY·ªÑN TH·ªä T√ÇM</option>
                </select>
                <input type="text" id="personName" placeholder="Ho·∫∑c nh·∫≠p t√™n t√πy √Ω" style="margin-top: 10px;">
            </div>
            
            <div class="form-group">
                <label for="birthdate">2. Ng√†y th√°ng nƒÉm sinh:</label>
                <input type="date" id="birthdate">
            </div>
            
            <div class="form-group">
                <label for="targetDate">3. Ng√†y th√°ng nƒÉm mu·ªën xem:</label>
                <input type="date" id="targetDate">
            </div>
            
            <button onclick="calculateForSinglePerson()">T√çNH CHO 1 NG∆Ø·ªúI</button>
            <button onclick="calculateForAll()">T√çNH CHO T·∫§T C·∫¢ NG∆Ø·ªúI</button>
            
            <div class="warning">
                <strong>L∆∞u √Ω:</strong> Nh·ªØng s·ªë ƒë·∫∑c bi·ªát t√¨m ƒë∆∞·ª£c l√† c·ªôt 2 b·∫£ng n√™n g·∫Øn k√®m v·ªõi gi·ªù trong c·ªôt 1, b·∫£ng 1 ƒë·ªÉ bi·∫øt m√† tr√°nh r·ªßi ro, t·∫°i n·∫°n. 307 l√† (t·ª•t huy·∫øt √°p), c√°c s·ªë kh√°c l√† b·ªánh n·∫∑ng.
            </div>
        </div>
        
        <div class="result-section">
            <h2>K·∫æT QU·∫¢</h2>
            
            <div id="singleResult" class="hidden">
                <h3>K·∫øt qu·∫£ cho 1 ng∆∞·ªùi</h3>
                <div id="singlePersonInfo" class="result-box"></div>
                
                <h4>Ph·∫ßn 2: T√≠nh to√°n ch√™nh l·ªách</h4>
                <div id="singleDifference" class="result-box"></div>
                
                <button class="toggle-btn" onclick="toggleSection('singleCalc1')">Hi·ªán/·∫®n Ph√©p t√≠nh 1</button>
                <div id="singleCalc1" class="hidden">
                    <h4>Ph√©p t√≠nh 1: Chia l·∫•y ph·∫ßn nguy√™n</h4>
                    <div id="singleCalculation1" class="result-box"></div>
                </div>
                
                <button class="toggle-btn" onclick="toggleSection('singleCalc2')">Hi·ªán/·∫®n Ph√©p t√≠nh 2</button>
                <div id="singleCalc2" class="hidden">
                    <h4>Ph√©p t√≠nh 2: Chia l·∫•y ph·∫ßn d∆∞</h4>
                    <div id="singleCalculation2" class="result-box"></div>
                </div>
                
                <button class="toggle-btn" onclick="toggleSection('singleCalc3')">Hi·ªán/·∫®n Ph√©p t√≠nh 3</button>
                <div id="singleCalc3" class="hidden">
                    <h4>Ph√©p t√≠nh 3: Chia k·∫øt qu·∫£ ch·∫µn c·ªßa Ph√©p t√≠nh 1</h4>
                    <div id="singleCalculation3" class="result-box"></div>
                </div>
                
                <h4>T√¨m s·ªë ƒë·∫∑c bi·ªát trong Ph√©p t√≠nh 3</h4>
                <div id="singleSpecial3" class="result-box"></div>
                
                <h4>T√¨m s·ªë ƒë·∫∑c bi·ªát trong Ph√©p t√≠nh 2</h4>
                <div id="singleSpecial2" class="result-box"></div>
                
                <h4>C·∫£nh b√°o s·ª©c kh·ªèe v√† khuy·∫øn ngh·ªã</h4>
                <div id="singleHealthAlerts"></div>
                
                <h4>K·∫øt qu·∫£ nguy hi·ªÉm (g·∫Øn v·ªõi gi·ªù v√† s·ªë th·ª© t·ª±)</h4>
                <div id="singleDangerDetails"></div>
                
                <h4>C·∫£nh b√°o th·ªùi gian c·∫ßn tr√°nh</h4>
                <div id="singleWarning" class="result-box warning"></div>
                
                <div id="singleEmergency" class="emergency hidden">
                    <h4>‚ö†Ô∏è C·∫¢NH B√ÅO ƒê·∫∂C BI·ªÜT ‚ö†Ô∏è</h4>
                    <p id="emergencyMessage"></p>
                </div>
            </div>
            
            <div id="allResult" class="hidden">
                <h3>K·∫øt qu·∫£ cho t·∫•t c·∫£ ng∆∞·ªùi</h3>
                
                <button class="toggle-btn" onclick="toggleSection('allTable')">Hi·ªán/·∫®n B·∫£ng ch√™nh l·ªách</button>
                
                <div id="allTable" class="hidden">
                    <div class="table-container">
                        <table id="allResultsTable">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>T√™n</th>
                                    <th>Ng√†y sinh</th>
                                    <th>Ch√™nh l·ªách (ng√†y)</th>
                                    <th>S·ªë ƒë·∫∑c bi·ªát Ph√©p t√≠nh 3</th>
                                    <th>S·ªë ƒë·∫∑c bi·ªát Ph√©p t√≠nh 2</th>
                                    <th>C·∫£nh b√°o s·ª©c kh·ªèe</th>
                                </tr>
                            </thead>
                            <tbody id="allResultsBody">
                                <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <h4>T·ªïng h·ª£p s·ªë ƒë·∫∑c bi·ªát t√¨m ƒë∆∞·ª£c</h4>
                <div id="allSpecial3" class="result-box"></div>
                <div id="allSpecial2" class="result-box"></div>
                
                <h4>T·ªïng h·ª£p c·∫£nh b√°o s·ª©c kh·ªèe cho t·∫•t c·∫£</h4>
                <div id="allHealthAlerts"></div>
                
                <h4>K·∫øt qu·∫£ nguy hi·ªÉm chi ti·∫øt (g·∫Øn v·ªõi gi·ªù, s·ªë th·ª© t·ª± v√† t√™n ng∆∞·ªùi)</h4>
                <div id="allDangerDetails" class="danger-list"></div>
                
                <h4>C·∫£nh b√°o th·ªùi gian c·∫ßn tr√°nh cho t·∫•t c·∫£</h4>
                <div id="allWarning" class="result-box warning"></div>
                
                <div id="allEmergency" class="heart-alert hidden">
                    <h4>‚ö†Ô∏è C·∫¢NH B√ÅO ƒê·∫∂C BI·ªÜT CHO T·∫§T C·∫¢ ‚ö†Ô∏è</h4>
                    <p id="allEmergencyMessage"></p>
                </div>
            </div>
            
            <div id="timeTableSection" class="hidden">
                <h3>B·∫£ng 1: Gi·ªù v√† S·ªë th·ª© t·ª±</h3>
                <button class="toggle-btn" onclick="toggleSection('timeTableContainer')">Hi·ªán/·∫®n B·∫£ng gi·ªù</button>
                <div id="timeTableContainer" class="hidden">
                    <div class="table-container">
                        <table id="timeTable">
                            <thead>
                                <tr>
                                    <th class="time-column">Gi·ªù</th>
                                    <th class="number-column">S·ªë th·ª© t·ª±</th>
                                </tr>
                            </thead>
                            <tbody id="timeTableBody">
                                <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // T·∫°o b·∫£ng gi·ªù t·ª´ 18:01 ƒë·∫øn 23:00 v·ªõi s·ªë th·ª© t·ª± m·ªõi
        const timeTable = [];
        let number = 1081;
        
        for (let hour = 18; hour <= 23; hour++) {
            // X√°c ƒë·ªãnh ph√∫t b·∫Øt ƒë·∫ßu v√† k·∫øt th√∫c cho m·ªói gi·ªù
            let startMinute = (hour === 18) ? 1 : 0;
            let endMinute = (hour === 23) ? 0 : 59;
            
            for (let minute = startMinute; minute <= endMinute; minute++) {
                const timeStr = `${hour}:${minute.toString().padStart(2, '0')}`;
                timeTable.push({ time: timeStr, number: number });
                number++;
                
                // D·ª´ng ·ªü 23:00
                if (hour === 23 && minute === 0) break;
            }
        }
        
        // C√°c s·ªë ƒë·∫∑c bi·ªát c·∫ßn t√¨m trong Ph√©p t√≠nh 2
        const specialNumbers2 = [
            307, 111, 222, 333, 444, 555, 666, 777, 888, 999,
            159, 195, 168, 186, 267, 276, 249, 294, 285, 258,
            357, 375, 384, 348, 438, 483, 429, 492, 528, 582,
            537, 573, 519, 591, 627, 672, 618, 681, 726, 762,
            735, 753, 825, 852, 816, 861, 843, 834, 915, 951,
            924, 942
        ];
        
        // C√°c s·ªë ƒë·∫∑c bi·ªát c·∫ßn t√¨m trong Ph√©p t√≠nh 3
        const specialNumbers3 = [14, 41, 27, 72];
        
        // S·ªë ƒë·∫∑c bi·ªát nguy hi·ªÉm nh·∫•t (ƒëau tim)
        const emergencyNumbers = [307, 14, 41, 27, 72];
        
        // S·ªë ƒë·∫∑c bi·ªát c·∫ßn mua thu·ªëc
        const medicineNumbers = [111, 222, 333, 444, 555, 666, 777, 888, 999];
        
        // S·ªë ƒë·∫∑c bi·ªát c·∫ßn ch√∫ √Ω ƒÉn u·ªëng
        const foodNumbers = [159, 195, 168, 186, 267, 276, 249, 294, 285, 258];
        
        // S·ªë ƒë·∫∑c bi·ªát c·∫ßn ch√∫ √Ω s·ª©c kh·ªèe t·ªïng qu√°t
        const healthNumbers = [357, 375, 384, 348, 438, 483, 429, 492, 528, 582];
        
        // Hi·ªÉn th·ªã b·∫£ng gi·ªù
        function displayTimeTable() {
            const tableBody = document.getElementById('timeTableBody');
            tableBody.innerHTML = '';
            
            timeTable.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="time-column">${item.time}</td>
                    <td class="number-column">${item.number}</td>
                `;
                tableBody.appendChild(row);
            });
            
            document.getElementById('timeTableSection').classList.remove('hidden');
        }
        
        // C·∫≠p nh·∫≠t ng√†y sinh khi ch·ªçn ng∆∞·ªùi t·ª´ danh s√°ch
        function updateBirthdateFromSelect() {
            const select = document.getElementById('personSelect');
            const birthdateInput = document.getElementById('birthdate');
            
            if (select.value) {
                const [name, dateStr] = select.value.split(',');
                const [day, month, year] = dateStr.split('/');
                const formattedDate = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
                birthdateInput.value = formattedDate;
                document.getElementById('personName').value = name;
            }
        }
        
        // ƒê·ªãnh d·∫°ng ng√†y th√°ng
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }
        
        // T√≠nh ch√™nh l·ªách ng√†y
        function calculateDateDifference(date1, date2) {
            const d1 = new Date(date1);
            const d2 = new Date(date2);
            const diffTime = Math.abs(d2 - d1);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }
        
        // Ki·ªÉm tra v√† t·∫°o th√¥ng b√°o s·ª©c kh·ªèe
        function generateHealthAlerts(specialNumbers, specialResultsData) {
            let alerts = [];
            let emergencyFound = false;
            let dangerDetails = [];
            
            // Ki·ªÉm tra s·ªë ƒëau tim
            specialNumbers.forEach((num, index) => {
                if (emergencyNumbers.includes(num)) {
                    emergencyFound = true;
                    
                    let timeInfo = "";
                    let numberInfo = "";
                    
                    if (specialResultsData && specialResultsData[index]) {
                        timeInfo = specialResultsData[index].time;
                        numberInfo = specialResultsData[index].number;
                    }
                    
                    dangerDetails.push({
                        type: 'heart',
                        number: num,
                        time: timeInfo,
                        stt: numberInfo,
                        message: num === 307 ? 'T·ª§T HUY·∫æT √ÅP' : 'ƒêAU TIM'
                    });
                }
            });
            
            // Ki·ªÉm tra s·ªë c·∫ßn mua thu·ªëc
            const medicineNums = specialNumbers.filter(num => medicineNumbers.includes(num));
            if (medicineNums.length > 0) {
                alerts.push({
                    type: 'medicine',
                    message: `üíä MUA THU·ªêC ·ªû HI·ªÜU THU·ªêC: C·∫ßn chu·∫©n b·ªã thu·ªëc cho c√°c s·ªë ${medicineNums.join(', ')}`,
                    numbers: medicineNums
                });
            }
            
            // Ki·ªÉm tra s·ªë c·∫ßn ch√∫ √Ω ƒÉn u·ªëng
            const foodNums = specialNumbers.filter(num => foodNumbers.includes(num));
            if (foodNums.length > 0) {
                alerts.push({
                    type: 'food',
                    message: `ü•ó CH√ö √ù ƒÇN U·ªêNG: C·∫ßn ƒÉn u·ªëng ƒëi·ªÅu ƒë·ªô, tr√°nh th·ª©c ƒÉn nhi·ªÅu d·∫ßu m·ª° cho c√°c s·ªë ${foodNums.join(', ')}`,
                    numbers: foodNums
                });
            }
            
            // Ki·ªÉm tra s·ªë c·∫ßn ch√∫ √Ω s·ª©c kh·ªèe t·ªïng qu√°t
            const healthNums = specialNumbers.filter(num => healthNumbers.includes(num));
            if (healthNums.length > 0) {
                alerts.push({
                    type: 'health',
                    message: `üè• CH√ö √ù S·ª®C KH·ªéE: C·∫ßn ki·ªÉm tra s·ª©c kh·ªèe ƒë·ªãnh k·ª≥ cho c√°c s·ªë ${healthNums.join(', ')}`,
                    numbers: healthNums
                });
            }
            
            return { alerts, emergencyFound, dangerDetails };
        }
        
        // T√≠nh to√°n cho 1 ng∆∞·ªùi
        function calculateForSinglePerson() {
            const birthdate = document.getElementById('birthdate').value;
            const targetDate = document.getElementById('targetDate').value;
            const personName = document.getElementById('personName').value || document.getElementById('personSelect').options[document.getElementById('personSelect').selectedIndex].text;
            
            if (!birthdate || !targetDate) {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß ng√†y th√°ng nƒÉm sinh v√† ng√†y mu·ªën xem!');
                return;
            }
            
            // Hi·ªÉn th·ªã b·∫£ng gi·ªù n·∫øu ch∆∞a hi·ªÉn th·ªã
            displayTimeTable();
            
            // Hi·ªÉn th·ªã k·∫øt qu·∫£ cho 1 ng∆∞·ªùi
            document.getElementById('singleResult').classList.remove('hidden');
            document.getElementById('allResult').classList.add('hidden');
            document.getElementById('singleEmergency').classList.add('hidden');
            
            const diffDays = calculateDateDifference(birthdate, targetDate);
            
            // Hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi
            document.getElementById('singlePersonInfo').innerHTML = `
                <strong>T√™n:</strong> ${personName}<br>
                <strong>Ng√†y sinh:</strong> ${formatDate(birthdate)}<br>
                <strong>Ng√†y xem:</strong> ${formatDate(targetDate)}
            `;
            
            // Hi·ªÉn th·ªã ch√™nh l·ªách
            document.getElementById('singleDifference').innerHTML = `
                <strong>Ch√™nh l·ªách:</strong> ${diffDays} ng√†y<br>
                (T·ª´ ${formatDate(birthdate)} ƒë·∫øn ${formatDate(targetDate)})
            `;
            
            // Ph√©p t√≠nh 1: Chia l·∫•y ph·∫ßn nguy√™n
            let calc1Results = [];
            let calc1HTML = '<table><tr><th>Gi·ªù</th><th>S·ªë th·ª© t·ª±</th><th>K·∫øt qu·∫£ (ph·∫ßn nguy√™n)</th></tr>';
            
            timeTable.forEach(item => {
                const result = Math.floor(diffDays / item.number);
                calc1Results.push({ time: item.time, number: item.number, result: result });
                calc1HTML += `<tr><td>${item.time}</td><td>${item.number}</td><td>${result}</td></tr>`;
            });
            
            calc1HTML += '</table>';
            document.getElementById('singleCalculation1').innerHTML = calc1HTML;
            
            // Ph√©p t√≠nh 2: Chia l·∫•y ph·∫ßn d∆∞
            let calc2Results = [];
            let special2Results = [];
            let calc2HTML = '<table><tr><th>Gi·ªù</th><th>S·ªë th·ª© t·ª±</th><th>K·∫øt qu·∫£ (ph·∫ßn d∆∞)</th></tr>';
            
            timeTable.forEach(item => {
                const result = diffDays % item.number;
                calc2Results.push({ time: item.time, number: item.number, result: result });
                
                let rowClass = '';
                if (specialNumbers2.includes(result)) {
                    rowClass = 'class="highlight"';
                    special2Results.push({ time: item.time, number: item.number, result: result });
                }
                
                calc2HTML += `<tr ${rowClass}><td>${item.time}</td><td>${item.number}</td><td>${result}</td></tr>`;
            });
            
            calc2HTML += '</table>';
            document.getElementById('singleCalculation2').innerHTML = calc2HTML;
            
            // Ph√©p t√≠nh 3: Chia k·∫øt qu·∫£ ch·∫µn c·ªßa Ph√©p t√≠nh 1
            let calc3Results = [];
            let special3Results = [];
            let calc3HTML = '<table><tr><th>Gi·ªù</th><th>S·ªë th·ª© t·ª±</th><th>K·∫øt qu·∫£ Ph√©p t√≠nh 1</th><th>K·∫øt qu·∫£ Ph√©p t√≠nh 3</th></tr>';
            
            timeTable.forEach((item, index) => {
                const calc1Result = calc1Results[index].result;
                const result = Math.floor(calc1Result / item.number);
                calc3Results.push({ time: item.time, number: item.number, calc1Result: calc1Result, result: result });
                
                let rowClass = '';
                if (specialNumbers3.includes(result)) {
                    rowClass = 'class="highlight"';
                    special3Results.push({ time: item.time, number: item.number, calc1Result: calc1Result, result: result });
                }
                
                calc3HTML += `<tr ${rowClass}><td>${item.time}</td><td>${item.number}</td><td>${calc1Result}</td><td>${result}</td></tr>`;
            });
            
            calc3HTML += '</table>';
            document.getElementById('singleCalculation3').innerHTML = calc3HTML;
            
            // Hi·ªÉn th·ªã s·ªë ƒë·∫∑c bi·ªát trong Ph√©p t√≠nh 3
            let special3HTML = '';
            if (special3Results.length > 0) {
                special3HTML = `<p><strong>T√¨m th·∫•y ${special3Results.length} s·ªë ƒë·∫∑c bi·ªát trong Ph√©p t√≠nh 3:</strong></p><ul>`;
                special3Results.forEach(item => {
                    special3HTML += `<li>Gi·ªù ${item.time} (s·ªë ${item.number}): k·∫øt qu·∫£ ${item.result}</li>`;
                });
                special3HTML += '</ul>';
            } else {
                special3HTML = '<p>Kh√¥ng t√¨m th·∫•y s·ªë ƒë·∫∑c bi·ªát (14, 41, 27, 72) trong Ph√©p t√≠nh 3.</p>';
            }
            document.getElementById('singleSpecial3').innerHTML = special3HTML;
            
            // Hi·ªÉn th·ªã s·ªë ƒë·∫∑c bi·ªát trong Ph√©p t√≠nh 2
            let special2HTML = '';
            if (special2Results.length > 0) {
                special2HTML = `<p><strong>T√¨m th·∫•y ${special2Results.length} s·ªë ƒë·∫∑c bi·ªát trong Ph√©p t√≠nh 2:</strong></p><ul>`;
                special2Results.forEach(item => {
                    special2HTML += `<li>Gi·ªù ${item.time} (s·ªë ${item.number}): k·∫øt qu·∫£ ${item.result}</li>`;
                });
                special2HTML += '</ul>';
            } else {
                special2HTML = '<p>Kh√¥ng t√¨m th·∫•y s·ªë ƒë·∫∑c bi·ªát trong Ph√©p t√≠nh 2.</p>';
            }
            document.getElementById('singleSpecial2').innerHTML = special2HTML;
            
            // T·∫°o c·∫£nh b√°o s·ª©c kh·ªèe
            const healthAlertsDiv = document.getElementById('singleHealthAlerts');
            healthAlertsDiv.innerHTML = '';
            
            // T·ªïng h·ª£p t·∫•t c·∫£ s·ªë ƒë·∫∑c bi·ªát
            const allSpecialNumbers = [
                ...special2Results.map(r => r.result),
                ...special3Results.map(r => r.result)
            ];
            
            const allSpecialResultsData = [
                ...special2Results,
                ...special3Results
            ];
            
            const { alerts, emergencyFound, dangerDetails } = generateHealthAlerts(
                allSpecialNumbers, 
                allSpecialResultsData
            );
            
            // Hi·ªÉn th·ªã c·∫£nh b√°o
            if (alerts.length > 0) {
                alerts.forEach(alert => {
                    const alertDiv = document.createElement('div');
                    if (alert.type === 'medicine') {
                        alertDiv.className = 'medicine-alert';
                    } else if (alert.type === 'food') {
                        alertDiv.className = 'food-alert';
                    } else if (alert.type === 'health') {
                        alertDiv.className = 'health-alert';
                    } else {
                        alertDiv.className = 'emergency';
                    }
                    alertDiv.innerHTML = alert.message;
                    healthAlertsDiv.appendChild(alertDiv);
                });
            } else {
                healthAlertsDiv.innerHTML = '<div class="health-alert">‚úÖ Kh√¥ng c√≥ c·∫£nh b√°o s·ª©c kh·ªèe ƒë·∫∑c bi·ªát</div>';
            }
            
            // Hi·ªÉn th·ªã chi ti·∫øt k·∫øt qu·∫£ nguy hi·ªÉm
            const dangerDetailsDiv = document.getElementById('singleDangerDetails');
            dangerDetailsDiv.innerHTML = '';
            
            if (dangerDetails.length > 0) {
                dangerDetailsDiv.innerHTML = '<div class="danger-list"><h4>Chi ti·∫øt c√°c s·ªë nguy hi·ªÉm:</h4>';
                
                dangerDetails.forEach(detail => {
                    if (detail.time && detail.stt) {
                        const dangerItem = document.createElement('div');
                        dangerItem.className = 'danger-item';
                        dangerItem.innerHTML = `
                            <span class="danger-time">${detail.time}</span>
                            <span class="danger-person">${personName}</span>
                            <span class="danger-number">S·ªë ${detail.number} (${detail.message})</span>
                            <br><small>S·ªë th·ª© t·ª±: ${detail.stt}</small>
                        `;
                        dangerDetailsDiv.appendChild(dangerItem);
                    }
                });
                
                dangerDetailsDiv.innerHTML += '</div>';
            } else {
                dangerDetailsDiv.innerHTML = '<div class="health-alert">‚úÖ Kh√¥ng c√≥ s·ªë nguy hi·ªÉm ƒë·∫∑c bi·ªát</div>';
            }
            
            // Hi·ªÉn th·ªã c·∫£nh b√°o th·ªùi gian c·∫ßn tr√°nh
            let warningHTML = '';
            if (special2Results.length > 0 || special3Results.length > 0) {
                warningHTML = '<h4>Th·ªùi gian c·∫ßn ƒë·∫∑c bi·ªát ch√∫ √Ω:</h4>';
                
                if (special3Results.length > 0) {
                    warningHTML += '<p><strong>S·ªë ƒë·∫∑c bi·ªát t·ª´ Ph√©p t√≠nh 3 (14, 41, 27, 72):</strong></p><ul>';
                    special3Results.forEach(item => {
                        warningHTML += `<li>Gi·ªù ${item.time} (s·ªë ${item.number}): k·∫øt qu·∫£ ${item.result}</li>`;
                    });
                    warningHTML += '</ul>';
                }
                
                if (special2Results.length > 0) {
                    warningHTML += '<p><strong>S·ªë ƒë·∫∑c bi·ªát t·ª´ Ph√©p t√≠nh 2:</strong></p><ul>';
                    special2Results.forEach(item => {
                        const warningText = item.result === 307 ? ' - T·ª§T HUY·∫æT √ÅP' : ' - B·ªÜNH N·∫∂NG';
                        warningHTML += `<li>Gi·ªù ${item.time} (s·ªë ${item.number}): k·∫øt qu·∫£ ${item.result}${warningText}</li>`;
                    });
                    warningHTML += '</ul>';
                }
            } else {
                warningHTML = '<p>Kh√¥ng c√≥ th·ªùi gian n√†o c·∫ßn ƒë·∫∑c bi·ªát ch√∫ √Ω.</p>';
            }
            document.getElementById('singleWarning').innerHTML = warningHTML;
            
            // Hi·ªÉn th·ªã c·∫£nh b√°o ƒë·∫∑c bi·ªát n·∫øu t√¨m th·∫•y s·ªë nguy hi·ªÉm
            if (emergencyFound) {
                document.getElementById('singleEmergency').classList.remove('hidden');
                let emergencyHTML = `<p><strong>‚ö†Ô∏è PH√ÅT HI·ªÜN D·∫§U HI·ªÜU NGUY HI·ªÇM S·ª®C KH·ªéE ‚ö†Ô∏è</strong></p>`;
                emergencyHTML += `<p>C√°c th·ªùi ƒëi·ªÉm sau ƒë√¢y c·∫ßn ƒê·∫∂C BI·ªÜT CH√ö √ù:</p><ul>`;
                
                // L·ªçc c√°c th·ªùi ƒëi·ªÉm nguy hi·ªÉm
                const emergencyTimes = [];
                special2Results.forEach(item => {
                    if (emergencyNumbers.includes(item.result)) {
                        emergencyTimes.push(`Gi·ªù ${item.time} (s·ªë ${item.number}): k·∫øt qu·∫£ ${item.result} - ${item.result === 307 ? 'T·ª§T HUY·∫æT √ÅP' : 'ƒêAU TIM'}`);
                    }
                });
                
                special3Results.forEach(item => {
                    if (emergencyNumbers.includes(item.result)) {
                        emergencyTimes.push(`Gi·ªù ${item.time} (s·ªë ${item.number}): k·∫øt qu·∫£ ${item.result} - ƒêAU TIM`);
                    }
                });
                
                emergencyTimes.forEach(msg => {
                    emergencyHTML += `<li>${msg}</li>`;
                });
                
                emergencyHTML += `</ul>`;
                emergencyHTML += `<p><strong>KH·∫®N C·∫§P:</strong> C·∫ßn thu·ªëc gi·∫£i ho·∫∑c mua thu·ªëc ·ªü hi·ªáu thu·ªëc ngay!</p>`;
                emergencyHTML += `<p>Tr√°nh c√°c ho·∫°t ƒë·ªông m·∫°nh, gi·ªØ b√¨nh tƒ©nh, v√† t√¨m s·ª± gi√∫p ƒë·ª° y t·∫ø ngay l·∫≠p t·ª©c.</p>`;
                document.getElementById('emergencyMessage').innerHTML = emergencyHTML;
            }
        }
        
        // T√≠nh to√°n cho t·∫•t c·∫£ ng∆∞·ªùi
        function calculateForAll() {
            const targetDate = document.getElementById('targetDate').value;
            
            if (!targetDate) {
                alert('Vui l√≤ng nh·∫≠p ng√†y th√°ng nƒÉm mu·ªën xem!');
                return;
            }
            
            // Hi·ªÉn th·ªã b·∫£ng gi·ªù n·∫øu ch∆∞a hi·ªÉn th·ªã
            displayTimeTable();
            
            // Hi·ªÉn th·ªã k·∫øt qu·∫£ cho t·∫•t c·∫£ ng∆∞·ªùi
            document.getElementById('singleResult').classList.add('hidden');
            document.getElementById('allResult').classList.remove('hidden');
            document.getElementById('allEmergency').classList.add('hidden');
            
            // Danh s√°ch ng∆∞·ªùi (l·∫•y t·ª´ select)
            const people = [];
            const selectOptions = document.getElementById('personSelect').options;
            
            for (let i = 1; i < selectOptions.length; i++) {
                const [name, dateStr] = selectOptions[i].value.split(',');
                const [day, month, year] = dateStr.split('/');
                const birthdate = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
                const displayName = selectOptions[i].text.substring(3); // B·ªè "X. " ·ªü ƒë·∫ßu
                
                people.push({
                    id: i,
                    name: name,
                    displayName: displayName,
                    birthdate: birthdate
                });
            }
            
            // T√≠nh to√°n cho t·ª´ng ng∆∞·ªùi
            const allSpecial3 = [];
            const allSpecial2 = [];
            const allHealthAlerts = [];
            const allDangerDetails = [];
            const tableBody = document.getElementById('allResultsBody');
            tableBody.innerHTML = '';
            
            people.forEach(person => {
                const diffDays = calculateDateDifference(person.birthdate, targetDate);
                
                // T√¨m s·ªë ƒë·∫∑c bi·ªát trong Ph√©p t√≠nh 3
                let personSpecial3 = [];
                timeTable.forEach(item => {
                    const calc1Result = Math.floor(diffDays / item.number);
                    const calc3Result = Math.floor(calc1Result / item.number);
                    
                    if (specialNumbers3.includes(calc3Result)) {
                        personSpecial3.push({
                            time: item.time,
                            number: item.number,
                            result: calc3Result
                        });
                        
                        // Th√™m v√†o danh s√°ch t·ªïng h·ª£p
                        const existingIndex = allSpecial3.findIndex(s => s.time === item.time && s.number === item.number && s.result === calc3Result);
                        if (existingIndex === -1) {
                            allSpecial3.push({
                                time: item.time,
                                number: item.number,
                                result: calc3Result,
                                people: [person.name]
                            });
                        } else {
                            if (!allSpecial3[existingIndex].people.includes(person.name)) {
                                allSpecial3[existingIndex].people.push(person.name);
                            }
                        }
                        
                        // Th√™m v√†o danh s√°ch nguy hi·ªÉm n·∫øu l√† s·ªë nguy hi·ªÉm
                        if (emergencyNumbers.includes(calc3Result)) {
                            allDangerDetails.push({
                                person: person.name,
                                time: item.time,
                                number: item.number,
                                result: calc3Result,
                                type: 'Ph√©p t√≠nh 3',
                                message: 'ƒêAU TIM'
                            });
                        }
                    }
                });
                
                // T√¨m s·ªë ƒë·∫∑c bi·ªát trong Ph√©p t√≠nh 2
                let personSpecial2 = [];
                timeTable.forEach(item => {
                    const calc2Result = diffDays % item.number;
                    
                    if (specialNumbers2.includes(calc2Result)) {
                        personSpecial2.push({
                            time: item.time,
                            number: item.number,
                            result: calc2Result
                        });
                        
                        // Th√™m v√†o danh s√°ch t·ªïng h·ª£p
                        const existingIndex = allSpecial2.findIndex(s => s.time === item.time && s.number === item.number && s.result === calc2Result);
                        if (existingIndex === -1) {
                            allSpecial2.push({
                                time: item.time,
                                number: item.number,
                                result: calc2Result,
                                people: [person.name]
                            });
                        } else {
                            if (!allSpecial2[existingIndex].people.includes(person.name)) {
                                allSpecial2[existingIndex].people.push(person.name);
                            }
                        }
                        
                        // Th√™m v√†o danh s√°ch nguy hi·ªÉm n·∫øu l√† s·ªë nguy hi·ªÉm
                        if (emergencyNumbers.includes(calc2Result)) {
                            allDangerDetails.push({
                                person: person.name,
                                time: item.time,
                                number: item.number,
                                result: calc2Result,
                                type: 'Ph√©p t√≠nh 2',
                                message: calc2Result === 307 ? 'T·ª§T HUY·∫æT √ÅP' : 'ƒêAU TIM'
                            });
                        }
                    }
                });
                
                // T·∫°o c·∫£nh b√°o s·ª©c kh·ªèe cho ng∆∞·ªùi n√†y
                const personSpecialNumbers = [
                    ...personSpecial2.map(r => r.result),
                    ...personSpecial3.map(r => r.result)
                ];
                
                const personSpecialResultsData = [
                    ...personSpecial2,
                    ...personSpecial3
                ];
                
                const { alerts } = generateHealthAlerts(
                    personSpecialNumbers,
                    personSpecialResultsData
                );
                
                // L∆∞u c·∫£nh b√°o
                if (alerts.length > 0) {
                    alerts.forEach(alert => {
                        allHealthAlerts.push({
                            person: person.name,
                            alert: alert
                        });
                    });
                }
                
                // Th√™m v√†o b·∫£ng
                const row = document.createElement('tr');
                const healthWarning = alerts.length > 0 ? 'C√ì' : 'Kh√¥ng';
                row.innerHTML = `
                    <td>${person.id}</td>
                    <td>${person.displayName}</td>
                    <td>${formatDate(person.birthdate)}</td>
                    <td>${diffDays}</td>
                    <td>${personSpecial3.map(s => s.result).join(', ') || 'Kh√¥ng c√≥'}</td>
                    <td>${personSpecial2.map(s => s.result).join(', ') || 'Kh√¥ng c√≥'}</td>
                    <td>${healthWarning}</td>
                `;
                tableBody.appendChild(row);
            });
            
            // Hi·ªÉn th·ªã t·ªïng h·ª£p s·ªë ƒë·∫∑c bi·ªát Ph√©p t√≠nh 3
            let allSpecial3HTML = '';
            if (allSpecial3.length > 0) {
                allSpecial3HTML = '<p><strong>S·ªë ƒë·∫∑c bi·ªát t√¨m th·∫•y trong Ph√©p t√≠nh 3 (14, 41, 27, 72):</strong></p><ul>';
                allSpecial3.forEach(item => {
                    allSpecial3HTML += `<li>Gi·ªù ${item.time} (s·ªë ${item.number}): ${item.result} - ·∫¢nh h∆∞·ªüng ${item.people.length} ng∆∞·ªùi: ${item.people.join(', ')}</li>`;
                });
                allSpecial3HTML += '</ul>';
            } else {
                allSpecial3HTML = '<p>Kh√¥ng t√¨m th·∫•y s·ªë ƒë·∫∑c bi·ªát (14, 41, 27, 72) trong Ph√©p t√≠nh 3 c·ªßa b·∫•t k·ª≥ ai.</p>';
            }
            document.getElementById('allSpecial3').innerHTML = allSpecial3HTML;
            
            // Hi·ªÉn th·ªã t·ªïng h·ª£p s·ªë ƒë·∫∑c bi·ªát Ph√©p t√≠nh 2
            let allSpecial2HTML = '';
            if (allSpecial2.length > 0) {
                allSpecial2HTML = '<p><strong>S·ªë ƒë·∫∑c bi·ªát t√¨m th·∫•y trong Ph√©p t√≠nh 2:</strong></p><ul>';
                allSpecial2.forEach(item => {
                    const warningText = item.result === 307 ? ' (T·ª§T HUY·∫æT √ÅP)' : ' (B·ªÜNH N·∫∂NG)';
                    allSpecial2HTML += `<li>Gi·ªù ${item.time} (s·ªë ${item.number}): ${item.result}${warningText} - ·∫¢nh h∆∞·ªüng ${item.people.length} ng∆∞·ªùi: ${item.people.join(', ')}</li>`;
                });
                allSpecial2HTML += '</ul>';
            } else {
                allSpecial2HTML = '<p>Kh√¥ng t√¨m th·∫•y s·ªë ƒë·∫∑c bi·ªát trong Ph√©p t√≠nh 2 c·ªßa b·∫•t k·ª≥ ai.</p>';
            }
            document.getElementById('allSpecial2').innerHTML = allSpecial2HTML;
            
            // Hi·ªÉn th·ªã chi ti·∫øt k·∫øt qu·∫£ nguy hi·ªÉm
            const allDangerDetailsDiv = document.getElementById('allDangerDetails');
            allDangerDetailsDiv.innerHTML = '';
            
            if (allDangerDetails.length > 0) {
                allDangerDetailsDiv.innerHTML = '<h4>Chi ti·∫øt c√°c s·ªë nguy hi·ªÉm (g·∫Øn v·ªõi gi·ªù v√† t√™n ng∆∞·ªùi):</h4>';
                
                // Nh√≥m theo gi·ªù
                const groupedByTime = {};
                allDangerDetails.forEach(detail => {
                    const key = `${detail.time}_${detail.number}`;
                    if (!groupedByTime[key]) {
                        groupedByTime[key] = {
                            time: detail.time,
                            number: detail.number,
                            people: [detail.person],
                            results: [detail.result],
                            types: [detail.type],
                            messages: [detail.message]
                        };
                    } else {
                        if (!groupedByTime[key].people.includes(detail.person)) {
                            groupedByTime[key].people.push(detail.person);
                        }
                        if (!groupedByTime[key].results.includes(detail.result)) {
                            groupedByTime[key].results.push(detail.result);
                        }
                        if (!groupedByTime[key].types.includes(detail.type)) {
                            groupedByTime[key].types.push(detail.type);
                        }
                        if (!groupedByTime[key].messages.includes(detail.message)) {
                            groupedByTime[key].messages.push(detail.message);
                        }
                    }
                });
                
                // Hi·ªÉn th·ªã theo nh√≥m
                Object.values(groupedByTime).forEach(group => {
                    const dangerItem = document.createElement('div');
                    dangerItem.className = 'danger-item';
                    dangerItem.innerHTML = `
                        <span class="danger-time">${group.time}</span>
                        <span class="danger-number">S·ªë ${group.number}</span>
                        <br><strong>Ng∆∞·ªùi b·ªã ·∫£nh h∆∞·ªüng:</strong> ${group.people.join(', ')}
                        <br><strong>S·ªë nguy hi·ªÉm:</strong> ${group.results.join(', ')}
                        <br><strong>Lo·∫°i:</strong> ${group.types.join(', ')}
                        <br><strong>C·∫£nh b√°o:</strong> ${group.messages.join(', ')}
                    `;
                    allDangerDetailsDiv.appendChild(dangerItem);
                });
            } else {
                allDangerDetailsDiv.innerHTML = '<div class="health-alert">‚úÖ Kh√¥ng c√≥ s·ªë nguy hi·ªÉm ƒë·∫∑c bi·ªát cho t·∫•t c·∫£ m·ªçi ng∆∞·ªùi</div>';
            }
            
            // Hi·ªÉn th·ªã t·ªïng h·ª£p c·∫£nh b√°o s·ª©c kh·ªèe
            const allHealthAlertsDiv = document.getElementById('allHealthAlerts');
            allHealthAlertsDiv.innerHTML = '';
            
            if (allHealthAlerts.length > 0) {
                // Nh√≥m c·∫£nh b√°o theo lo·∫°i
                const groupedAlerts = {};
                
                allHealthAlerts.forEach(item => {
                    const alertType = item.alert.type;
                    if (!groupedAlerts[alertType]) {
                        groupedAlerts[alertType] = {
                            message: item.alert.message,
                            people: [item.person],
                            numbers: item.alert.numbers
                        };
                    } else {
                        if (!groupedAlerts[alertType].people.includes(item.person)) {
                            groupedAlerts[alertType].people.push(item.person);
                        }
                        // K·∫øt h·ª£p c√°c s·ªë
                        item.alert.numbers.forEach(num => {
                            if (!groupedAlerts[alertType].numbers.includes(num)) {
                                groupedAlerts[alertType].numbers.push(num);
                            }
                        });
                    }
                });
                
                // Hi·ªÉn th·ªã t·ª´ng lo·∫°i c·∫£nh b√°o
                Object.keys(groupedAlerts).forEach(alertType => {
                    const alert = groupedAlerts[alertType];
                    const alertDiv = document.createElement('div');
                    
                    if (alertType === 'medicine') {
                        alertDiv.className = 'medicine-alert';
                    } else if (alertType === 'food') {
                        alertDiv.className = 'food-alert';
                    } else if (alertType === 'health') {
                        alertDiv.className = 'health-alert';
                    } else {
                        alertDiv.className = 'emergency';
                    }
                    
                    alertDiv.innerHTML = `
                        <strong>${alert.message}</strong><br>
                        <small>·∫¢nh h∆∞·ªüng ƒë·∫øn: ${alert.people.join(', ')}</small>
                    `;
                    allHealthAlertsDiv.appendChild(alertDiv);
                });
                
                // Th√™m c·∫£nh b√°o ƒë·∫∑c bi·ªát n·∫øu c√≥ s·ªë ƒëau tim
                const emergencyPeople = allDangerDetails.filter(d => d.message === 'ƒêAU TIM' || d.message === 'T·ª§T HUY·∫æT √ÅP')
                                                        .map(d => d.person);
                const uniqueEmergencyPeople = [...new Set(emergencyPeople)];
                
                if (uniqueEmergencyPeople.length > 0) {
                    document.getElementById('allEmergency').classList.remove('hidden');
                    let emergencyHTML = `<p><strong>‚ö†Ô∏è PH√ÅT HI·ªÜN D·∫§U HI·ªÜU NGUY HI·ªÇM CHO ${uniqueEmergencyPeople.length} NG∆Ø·ªúI ‚ö†Ô∏è</strong></p>`;
                    emergencyHTML += `<p>Nh·ªØng ng∆∞·ªùi b·ªã ·∫£nh h∆∞·ªüng: ${uniqueEmergencyPeople.join(', ')}</p>`;
                    emergencyHTML += `<p>Xem chi ti·∫øt trong ph·∫ßn "K·∫øt qu·∫£ nguy hi·ªÉm chi ti·∫øt" ·ªü tr√™n</p>`;
                    emergencyHTML += `<p><strong>KH·∫®N C·∫§P:</strong> C·∫ßn thu·ªëc gi·∫£i ho·∫∑c mua thu·ªëc ·ªü hi·ªáu thu·ªëc ngay!</p>`;
                    emergencyHTML += `<p>Nh·ªØng ng∆∞·ªùi tr√™n c·∫ßn tr√°nh c√°c ho·∫°t ƒë·ªông m·∫°nh, gi·ªØ b√¨nh tƒ©nh, v√† chu·∫©n b·ªã s·∫µn thu·ªëc h·ªó tr·ª£ tim m·∫°ch.</p>`;
                    document.getElementById('allEmergencyMessage').innerHTML = emergencyHTML;
                }
            } else {
                allHealthAlertsDiv.innerHTML = '<div class="health-alert">‚úÖ Kh√¥ng c√≥ c·∫£nh b√°o s·ª©c kh·ªèe ƒë·∫∑c bi·ªát cho t·∫•t c·∫£ m·ªçi ng∆∞·ªùi</div>';
            }
            
            // Hi·ªÉn th·ªã c·∫£nh b√°o t·ªïng h·ª£p
            let allWarningHTML = '';
            if (allSpecial2.length > 0 || allSpecial3.length > 0) {
                allWarningHTML = '<h4>TH·ªúI GIAN C·∫¶N ƒê·∫∂C BI·ªÜT CH√ö √ù CHO T·∫§T C·∫¢ M·ªåI NG∆Ø·ªúI:</h4>';
                
                if (allSpecial3.length > 0) {
                    allWarningHTML += '<p><strong>Th·ªùi gian c√≥ s·ªë ƒë·∫∑c bi·ªát t·ª´ Ph√©p t√≠nh 3 (14, 41, 27, 72):</strong></p><ul>';
                    allSpecial3.forEach(item => {
                        allWarningHTML += `<li>Gi·ªù ${item.time} (s·ªë ${item.number}): ·∫£nh h∆∞·ªüng ƒë·∫øn ${item.people.length} ng∆∞·ªùi</li>`;
                    });
                    allWarningHTML += '</ul>';
                }
                
                if (allSpecial2.length > 0) {
                    allWarningHTML += '<p><strong>Th·ªùi gian c√≥ s·ªë ƒë·∫∑c bi·ªát t·ª´ Ph√©p t√≠nh 2:</strong></p><ul>';
                    allSpecial2.forEach(item => {
                        const warningText = item.result === 307 ? ' - T·ª§T HUY·∫æT √ÅP' : ' - B·ªÜNH N·∫∂NG';
                        allWarningHTML += `<li>Gi·ªù ${item.time} (s·ªë ${item.number})${warningText}: ·∫£nh h∆∞·ªüng ƒë·∫øn ${item.people.length} ng∆∞·ªùi</li>`;
                    });
                    allWarningHTML += '</ul>';
                }
            } else {
                allWarningHTML = '<p>Kh√¥ng c√≥ th·ªùi gian n√†o c·∫ßn ƒë·∫∑c bi·ªát ch√∫ √Ω cho t·∫•t c·∫£ m·ªçi ng∆∞·ªùi.</p>';
            }
            document.getElementById('allWarning').innerHTML = allWarningHTML;
        }
        
        // Hi·ªán/·∫©n c√°c ph·∫ßn
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            section.classList.toggle('hidden');
        }
        
        // Thi·∫øt l·∫≠p ng√†y m·∫∑c ƒë·ªãnh
        window.onload = function() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            document.getElementById('targetDate').value = todayStr;
            
            // Thi·∫øt l·∫≠p ng√†y sinh m·∫∑c ƒë·ªãnh cho ng∆∞·ªùi ƒë·∫ßu ti√™n
            const birthdate = new Date();
            birthdate.setFullYear(birthdate.getFullYear() - 30);
            const birthdateStr = birthdate.toISOString().split('T')[0];
            document.getElementById('birthdate').value = birthdateStr;
            
            // Hi·ªÉn th·ªã b·∫£ng gi·ªù
            displayTimeTable();
        };
    </script>
</body>
</html>