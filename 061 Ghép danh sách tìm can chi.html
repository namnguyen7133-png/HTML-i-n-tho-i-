<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Tra Cứu Ngày Can Chi và Ghép Phần Tử</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, button, textarea {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 16px;
            width: 100%;
            box-sizing: border-box;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .result {
            margin-top: 30px;
            padding: 20px;
            background-color: #ecf0f1;
            border-radius: 5px;
            display: none;
        }
        .result h2 {
            margin-top: 0;
            color: #2c3e50;
        }
        .date-result {
            font-size: 24px;
            font-weight: bold;
            color: #e74c3c;
            text-align: center;
            margin: 20px 0;
        }
        .explanation {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .step {
            margin-bottom: 10px;
        }
        .highlight {
            background-color: #fffacd;
            padding: 2px 5px;
            border-radius: 3px;
        }
        .past-date {
            color: #e74c3c;
            font-weight: bold;
        }
        .future-date {
            color: #27ae60;
            font-weight: bold;
        }
        .current-date {
            color: #3498db;
            font-weight: bold;
        }
        .date-info {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        .date-box {
            flex: 1;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            margin: 0 5px;
            text-align: center;
        }
        .instructions {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .elements-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .element-item {
            background-color: #e0f7fa;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
        }
        .element-item.selected {
            background-color: #4caf50;
            color: white;
            font-weight: bold;
        }
        .calculation {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        .rule-example {
            background-color: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 14px;
        }
        .combined-result {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin: 20px 0;
            font-size: 20px;
        }
        .section-title {
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 30px;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Game Tra Cứu Ngày Can Chi và Ghép Phần Tử</h1>
        
        <h2 class="section-title">1. Chọn Can Chi</h2>
        <div class="input-group">
            <label for="can">Chọn Can:</label>
            <select id="can">
                <option value="Giáp">Giáp</option>
                <option value="Ất">Ất</option>
                <option value="Bính">Bính</option>
                <option value="Đinh">Đinh</option>
                <option value="Mậu">Mậu</option>
                <option value="Kỷ">Kỷ</option>
                <option value="Canh">Canh</option>
                <option value="Tân">Tân</option>
                <option value="Nhâm">Nhâm</option>
                <option value="Quý">Quý</option>
            </select>
        </div>
        
        <div class="input-group">
            <label for="chi">Chọn Chi:</label>
            <select id="chi">
                <option value="Tý">Tý</option>
                <option value="Sửu">Sửu</option>
                <option value="Dần">Dần</option>
                <option value="Mão">Mão</option>
                <option value="Thìn">Thìn</option>
                <option value="Tỵ">Tỵ</option>
                <option value="Ngọ">Ngọ</option>
                <option value="Mùi">Mùi</option>
                <option value="Thân">Thân</option>
                <option value="Dậu">Dậu</option>
                <option value="Tuất">Tuất</option>
                <option value="Hợi">Hợi</option>
            </select>
        </div>
        
        <h2 class="section-title">2. Nhập Phần Tử Ghép</h2>
        <div class="input-group">
            <label for="elements">Nhập các phần tử muốn ghép (mỗi phần tử trên một dòng, tối đa 100 phần tử):</label>
            <textarea id="elements" rows="6" placeholder="Ví dụ:
A
B
C
D
E
Kim
Mộc
Thủy
Hỏa
Thổ">A
B
C</textarea>
            <div class="instructions">Nhập các phần tử (tối thiểu 1 phần tử, tối đa 100 phần tử). Hệ thống sẽ tính: số dư % số phần tử = 0 → phần tử cuối, = 1 → phần tử đầu, = 2 → phần tử thứ 2, v.v.</div>
        </div>
        
        <button id="find">Tìm Ngày Can Chi và Ghép Phần Tử</button>
        
        <div class="result" id="result">
            <h2>Kết Quả</h2>
            
            <div class="combined-result" id="combinedResult"></div>
            
            <div class="date-info">
                <div class="date-box">
                    <h3>Ngày gần nhất</h3>
                    <div id="nearestDate"></div>
                    <div id="nearestStatus"></div>
                    <div id="nearestElement" style="margin-top: 10px;"></div>
                </div>
                <div class="date-box">
                    <h3>Ngày tiếp theo</h3>
                    <div id="nextDate"></div>
                    <div id="nextStatus"></div>
                    <div id="nextElement" style="margin-top: 10px;"></div>
                </div>
            </div>
            
            <div class="calculation">
                <h3>Cách tính Can Chi:</h3>
                <div class="step">1. Mốc tính: Ngày 1/1/1900 là <span class="highlight">Giáp Tuất</span></div>
                <div class="step">2. Mỗi chu kỳ Can Chi là 60 ngày</div>
                <div class="step">3. Số ngày từ mốc đến ngày cần xem: <span class="highlight" id="daysCount"></span> ngày</div>
                <div class="step">4. Chia số ngày cho 60: <span class="highlight" id="divisionResult"></span></div>
                <div class="step">5. Số dư để tra bảng Can Chi: <span class="highlight" id="remainderResult"></span></div>
                <div class="step">6. Kết quả Can Chi: <span class="highlight" id="canChiStep"></span></div>
            </div>
            
            <div class="calculation">
                <h3>Cách tính Ghép Phần Tử:</h3>
                <div class="step">- Lấy số dư <span id="remainderValue"></span> chia cho số phần tử (<span id="elementCount"></span>)</div>
                <div class="step">- Kết quả: <span id="elementCalculation"></span></div>
                <div class="step">- Quy tắc: 
                    <ul>
                        <li>Nếu số dư = 0 → lấy phần tử cuối cùng (thứ <span id="lastElementIndex"></span>)</li>
                        <li>Nếu số dư = 1 → lấy phần tử đầu tiên (thứ 1)</li>
                        <li>Nếu số dư = 2 → lấy phần tử thứ 2</li>
                        <li>Nếu số dư = 3 → lấy phần tử thứ 3</li>
                        <li>...</li>
                    </ul>
                </div>
                <div class="step">- Kết quả ghép phần tử: <span class="highlight" id="elementStep"></span></div>
                
                <div class="rule-example">
                    <strong>Ví dụ:</strong><br>
                    - Với 3 phần tử: số dư % 3 = 0 → phần tử 3, = 1 → phần tử 1, = 2 → phần tử 2<br>
                    - Với 5 phần tử: số dư % 5 = 0 → phần tử 5, = 1 → phần tử 1, = 2 → phần tử 2, = 3 → phần tử 3, = 4 → phần tử 4
                </div>
            </div>
            
            <div class="step" style="margin-top: 15px;">
                <strong>Danh sách phần tử (<span id="totalElements"></span> phần tử):</strong>
                <div class="elements-list" id="elementsList"></div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('find').addEventListener('click', function() {
            const selectedCan = document.getElementById('can').value;
            const selectedChi = document.getElementById('chi').value;
            const selectedCanChi = selectedCan + " " + selectedChi;
            const elementsInput = document.getElementById('elements').value;
            
            // Xử lý danh sách phần tử
            const elements = elementsInput.split('\n')
                .map(el => el.trim())
                .filter(el => el.length > 0);
            
            if (elements.length === 0) {
                alert('Vui lòng nhập ít nhất một phần tử');
                return;
            }
            
            if (elements.length > 100) {
                alert('Vui lòng nhập tối đa 100 phần tử');
                return;
            }
            
            // Bảng Can Chi
            const canChiList = [
                "Giáp Tý", "Ất Sửu", "Bính Dần", "Đinh Mão", "Mậu Thìn", "Kỷ Tỵ", 
                "Canh Ngọ", "Tân Mùi", "Nhâm Thân", "Quý Dậu", "Giáp Tuất", "Ất Hợi",
                "Bính Tý", "Đinh Sửu", "Mậu Dần", "Kỷ Mão", "Canh Thìn", "Tân Tỵ", 
                "Nhâm Ngọ", "Quý Mùi", "Giáp Thân", "Ất Dậu", "Bính Tuất", "Đinh Hợi",
                "Mậu Tý", "Kỷ Sửu", "Canh Dần", "Tân Mão", "Nhâm Thìn", "Quý Tỵ", 
                "Giáp Ngọ", "Ất Mùi", "Bính Thân", "Đinh Dậu", "Mậu Tuất", "Kỷ Hợi",
                "Canh Tý", "Tân Sửu", "Nhâm Dần", "Quý Mão", "Giáp Thìn", "Ất Tỵ", 
                "Bính Ngọ", "Đinh Mùi", "Mậu Thân", "Kỷ Dậu", "Canh Tuất", "Tân Hợi",
                "Nhâm Tý", "Quý Sửu", "Giáp Dần", "Ất Mão", "Bính Thìn", "Đinh Tỵ", 
                "Mậu Ngọ", "Kỷ Mùi", "Canh Thân", "Tân Dậu", "Nhâm Tuất", "Quý Hợi"
            ];
            
            // Tìm vị trí của Can Chi được chọn
            const canChiIndex = canChiList.indexOf(selectedCanChi);
            
            if (canChiIndex === -1) {
                alert('Can Chi không hợp lệ!');
                return;
            }
            
            // Ngày mốc: 1/1/1900 là Giáp Tuất (vị trí 10 trong mảng)
            const baseDate = new Date(1900, 0, 1);
            const baseCanChiIndex = 10; // Giáp Tuất
            
            // Tính số ngày chênh lệch từ mốc đến Can Chi được chọn
            let daysDiff = canChiIndex - baseCanChiIndex;
            if (daysDiff < 0) {
                daysDiff += 60;
            }
            
            // Ngày hiện tại
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Tìm ngày gần nhất có Can Chi này
            const nearestDate = new Date(baseDate);
            nearestDate.setDate(nearestDate.getDate() + daysDiff);
            
            // Điều chỉnh để tìm ngày gần nhất (có thể trong quá khứ hoặc tương lai)
            while (nearestDate < today) {
                nearestDate.setDate(nearestDate.getDate() + 60);
            }
            
            // Ngày tiếp theo (sau ngày gần nhất 60 ngày)
            const nextDate = new Date(nearestDate);
            nextDate.setDate(nextDate.getDate() + 60);
            
            // Tính số ngày từ mốc đến các ngày tìm được
            const nearestDaysDiff = Math.floor((nearestDate.getTime() - baseDate.getTime()) / (1000 * 3600 * 24));
            const nextDaysDiff = Math.floor((nextDate.getTime() - baseDate.getTime()) / (1000 * 3600 * 24));
            
            // Tính Can Chi cho các ngày (để kiểm tra)
            const nearestRemainder = (nearestDaysDiff % 60) + 1;
            const nextRemainder = (nextDaysDiff % 60) + 1;
            
            // Tính phần tử theo quy tắc
            const calculateElement = (remainder, elements) => {
                const elementRemainder = remainder % elements.length;
                let elementIndex;
                let element;
                
                if (elementRemainder === 0) {
                    elementIndex = elements.length - 1; // Phần tử cuối cùng
                    element = elements[elementIndex];
                } else {
                    elementIndex = elementRemainder - 1; // Phần tử thứ (số dư)
                    element = elements[elementIndex];
                }
                
                return { element, elementIndex, elementRemainder };
            };
            
            const nearestElementData = calculateElement(nearestRemainder, elements);
            const nextElementData = calculateElement(nextRemainder, elements);
            
            // Định dạng ngày
            const formatDate = (date) => {
                return date.toLocaleDateString('vi-VN', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            };
            
            // Xác định trạng thái ngày
            const getDateStatus = (date) => {
                if (date.getTime() === today.getTime()) {
                    return '<span class="current-date">Hôm nay</span>';
                } else if (date < today) {
                    return '<span class="past-date">Đã qua</span>';
                } else {
                    return '<span class="future-date">Sắp tới</span>';
                }
            };
            
            // Hiển thị kết quả
            document.getElementById('combinedResult').textContent = `${selectedCanChi} ${nearestElementData.element}`;
            document.getElementById('nearestDate').textContent = formatDate(nearestDate);
            document.getElementById('nearestStatus').innerHTML = getDateStatus(nearestDate);
            document.getElementById('nearestElement').innerHTML = `Phần tử: <strong>${nearestElementData.element}</strong>`;
            
            document.getElementById('nextDate').textContent = formatDate(nextDate);
            document.getElementById('nextStatus').innerHTML = getDateStatus(nextDate);
            document.getElementById('nextElement').innerHTML = `Phần tử: <strong>${nextElementData.element}</strong>`;
            
            // Hiển thị cách tính
            document.getElementById('daysCount').textContent = nearestDaysDiff;
            document.getElementById('divisionResult').textContent = `${nearestDaysDiff} / 60 = ${Math.floor(nearestDaysDiff / 60)} dư ${nearestDaysDiff % 60}`;
            document.getElementById('remainderResult').textContent = nearestRemainder;
            document.getElementById('canChiStep').textContent = selectedCanChi;
            
            document.getElementById('remainderValue').textContent = nearestRemainder;
            document.getElementById('elementCount').textContent = elements.length;
            document.getElementById('elementCalculation').textContent = `${nearestRemainder} % ${elements.length} = ${nearestElementData.elementRemainder}`;
            document.getElementById('lastElementIndex').textContent = elements.length;
            document.getElementById('elementStep').textContent = `${nearestElementData.element} (phần tử thứ ${nearestElementData.elementIndex + 1})`;
            document.getElementById('totalElements').textContent = elements.length;
            
            // Hiển thị danh sách phần tử với phần tử được chọn
            const elementsList = document.getElementById('elementsList');
            elementsList.innerHTML = '';
            elements.forEach((el, index) => {
                const elementItem = document.createElement('div');
                elementItem.className = 'element-item';
                if (index === nearestElementData.elementIndex) {
                    elementItem.classList.add('selected');
                }
                elementItem.textContent = `${index + 1}: ${el}`;
                elementsList.appendChild(elementItem);
            });
            
            document.getElementById('result').style.display = 'block';
        });
        
        // Thiết lập giá trị mặc định là Canh Tuất
        document.getElementById('can').value = 'Canh';
        document.getElementById('chi').value = 'Tuất';
    </script>
</body>
</html>