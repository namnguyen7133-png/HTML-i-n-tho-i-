<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tính toán Ngày Sinh - An Toàn Thời Gian & Theo dõi Triệu chứng</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        .header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 16px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #e1e8ed;
        }
        
        .card h2 {
            color: #2980b9;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ecf0f1;
            font-size: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #34495e;
        }
        
        select, input[type="date"], input[type="text"], textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #2980b9, #1f639e);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn-calculate-all {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .btn-calculate-all:hover {
            background: linear-gradient(135deg, #27ae60, #219653);
        }
        
        .btn-symptoms {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .btn-symptoms:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
        }
        
        .btn-permute {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }
        
        .btn-permute:hover {
            background: linear-gradient(135deg, #8e44ad, #7d3c98);
        }
        
        .results-section {
            grid-column: 1 / -1;
            margin-top: 20px;
        }
        
        .results-container {
            display: none;
            margin-top: 20px;
        }
        
        .results-container.active {
            display: block;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            background: #f8f9fa;
            border: 1px solid transparent;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 6px 6px 0 0;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.3s;
            margin-bottom: 5px;
        }
        
        .tab.active {
            background: white;
            color: #3498db;
            border-color: #ddd #ddd white #ddd;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 0 6px 6px 6px;
            border: 1px solid #ddd;
            border-top: none;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .result-item {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
            margin-bottom: 8px;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .person-name {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .day-diff {
            color: #e74c3c;
            font-weight: 600;
            font-size: 18px;
        }
        
        .calculation-result {
            margin-top: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 14px;
            display: none;
        }
        
        .show-calculation {
            display: block !important;
        }
        
        .special-numbers {
            margin-top: 10px;
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .danger-number {
            color: #e74c3c;
            font-weight: 700;
        }
        
        .warning-number {
            color: #e67e22;
            font-weight: 700;
        }
        
        .critical-number {
            color: #8e44ad;
            font-weight: 700;
        }
        
        .time-info {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 5px;
        }
        
        .danger-item {
            background: #ffeaea;
            border-left: 4px solid #e74c3c;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 4px 4px 0;
        }
        
        .warning-item {
            background: #fff4e6;
            border-left: 4px solid #e67e22;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 4px 4px 0;
        }
        
        .critical-item {
            background: #f4e6ff;
            border-left: 4px solid #8e44ad;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 4px 4px 0;
        }
        
        .info-note {
            background: #e8f4fc;
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 14px;
            color: #2c3e50;
            border-left: 4px solid #3498db;
        }
        
        .hidden {
            display: none;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 12px;
        }
        
        th {
            background-color: #f2f6fa;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .summary {
            margin-top: 20px;
            padding: 15px;
            background: #e8f6f3;
            border-radius: 6px;
            border-left: 4px solid #1abc9c;
        }
        
        .summary h3 {
            color: #16a085;
            margin-bottom: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .valid-hour {
            background-color: #e8f6f3;
            font-weight: bold;
        }
        
        .toggle-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .toggle-btn:hover {
            background: #7f8c8d;
        }
        
        .symptom-item {
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 4px 4px 0;
        }
        
        .symptom-date {
            color: #7f8c8d;
            font-size: 12px;
        }
        
        .symptom-severity-high {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .symptom-severity-medium {
            color: #e67e22;
            font-weight: bold;
        }
        
        .symptom-severity-low {
            color: #f39c12;
            font-weight: bold;
        }
        
        .symptom-analysis {
            background: #fef9e7;
            border: 1px solid #f7dc6f;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .time-interval-warning {
            background: #fff3e0;
            border: 2px solid #ff9800;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .interval-30min {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }
        
        .interval-1hour {
            background: #ffe0b2;
            border-left: 4px solid #f57c00;
        }
        
        .interval-1hour30 {
            background: #ffcc80;
            border-left: 4px solid #ef6c00;
        }
        
        .interval-2hour {
            background: #ffb74d;
            border-left: 4px solid #e65100;
        }
        
        .interval-3hour {
            background: #ffa726;
            border-left: 4px solid #bf360c;
        }
        
        .interval-4hour {
            background: #ff9800;
            border-left: 4px solid #d84315;
            color: white;
        }
        
        .interval-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .permutation-item {
            background: #f0f8ff;
            border: 1px solid #87ceeb;
            border-radius: 6px;
            padding: 10px;
            margin: 5px 0;
        }
        
        .permutation-group {
            background: #f9f0ff;
            border: 1px solid #dda0dd;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .heart-attack-hour {
            background: #ffebee;
            border: 2px solid #e74c3c;
            border-radius: 6px;
            padding: 10px;
            margin: 5px 0;
            font-weight: bold;
        }
        
        .hour-converter {
            background: #e8f5e9;
            border: 1px solid #81c784;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .hour-converter input {
            width: 100px;
            padding: 8px;
            margin-right: 10px;
            border: 1px solid #81c784;
            border-radius: 4px;
        }
        
        .hour-converter button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .hour-converter button:hover {
            background: #388e3c;
        }
        
        .all-hours-table {
            font-size: 11px;
        }
        
        .all-hours-table td {
            padding: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TÍNH TOÁN AN TOÀN THỜI GIAN & THEO DÕI TRIỆU CHỨNG</h1>
            <p>Kiểm tra các mốc thời gian quan trọng và theo dõi triệu chứng sức khỏe</p>
        </div>
        
        <div class="card">
            <h2>PHẦN 1: TÍNH CHO MỘT NGƯỜI</h2>
            <div class="form-group">
                <label for="personSelect">1. Chọn người:</label>
                <select id="personSelect" onchange="updateBirthDate()">
                    <option value="">-- Chọn một người --</option>
                    <option value="NGUYENKHACNANG|04/06/1944">1. NGUYENKHACNANG (04/06/1944)</option>
                    <option value="TOTHIHA|29/08/1948">2. TOTHIHA (29/08/1948)</option>
                    <option value="NGUYENMINHNAM|03/03/1971">3. NGUYENMINHNAM (03/03/1971)</option>
                    <option value="BAHA|13/03/1971">4. BA HA (13/03/1971)</option>
                    <option value="THANTHIKIMANH|23/09/1981">5. THANTHIKIMANH (23/09/1981)</option>
                    <option value="NGUYENTONGANAN|28/09/2014">6. NGUYENTONGANAN (28/09/2014)</option>
                    <option value="NGUYENTOMINHCHAU|25/07/2016">7. NGUYENTOMINHCHAU (25/07/2016)</option>
                    <option value="NGUYENTOBICHNGOC|05/02/2020">8. NGUYENTOBICHNGOC (05/02/2020)</option>
                    <option value="NGUYENTHIMINHHANG|07/01/1974">9. NGUYENTHIMINHHANG (07/01/1974)</option>
                    <option value="NGOQUYCUONG|23/05/1973">10. NGOQUYCUONG (23/05/1973)</option>
                    <option value="NGOGIABACH|12/10/2000">11. NGOGIABACH (12/10/2000)</option>
                    <option value="NGOGIALINH|05/04/2005">12. NGOGIALINH (05/04/2005)</option>
                    <option value="NGUYENTHIMINHPHUONG|06/11/1978">13. NGUYENTHIMINHPHUONG (06/11/1978)</option>
                    <option value="HOANGANHDUNG|21/09/1978">14. HOANGANHDUNG (21/09/1978)</option>
                    <option value="HOANGHAIVINH|03/06/2010">15. HOANGHAIVINH (03/06/2010)</option>
                    <option value="HOANGTHIENBACHANH|14/11/2015">16. HOANGTHIENBACHANH (14/11/2015)</option>
                    <option value="TOKIMHUE|09/08/1960">17. TÔ KIM HUỆ (09/08/1960)</option>
                    <option value="NGUYENTUANANH|23/10/1983">18. NGUYỄN TUẤN ANH (23/10/1983)</option>
                    <option value="NGUYENTHEANH|24/03/2001">19. NGUYỄN THẾ ANH (24/03/2001)</option>
                    <option value="NGOTHIMAI|12/12/1948">20. NGÔ THỊ MAI (12/12/1948)</option>
                    <option value="TOVIETHUNG|17/06/1996">21. TÔ VIỆT HƯNG (17/06/1996)</option>
                    <option value="TOTHIHONG|10/10/1964">22. TÔ THỊ HỒNG (10/10/1964)</option>
                    <option value="VUVANHIEP|24/04/1974">23. VŨ VĂN HIỆP (24/04/1974)</option>
                    <option value="NGUYENTHICHI|08/02/1946">24. NGUYỄN THỊ CHI (08/02/1946)</option>
                    <option value="NGUYENTANBAC|30/11/1957">25. NGUYỄN TẤN BẮC (30/11/1957)</option>
                    <option value="NGUYENTHITAM|08/08/1954">26. NGUYỄN THỊ TÂM (08/08/1954)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="birthDate">2. Ngày tháng năm sinh:</label>
                <input type="text" id="birthDate" placeholder="DD/MM/YYYY" value="">
            </div>
            
            <div class="form-group">
                <label for="targetDate">3. Ngày tháng năm muốn xem:</label>
                <input type="date" id="targetDate" value="">
            </div>
            
            <button class="btn" onclick="calculateForOne()">TÍNH TOÁN CHO 1 NGƯỜI</button>
            <button class="toggle-btn" onclick="toggleCalculations()">Hiện/Ẩn chi tiết tính toán</button>
            <button class="btn btn-permute" onclick="showPermutations()">XEM HOÁN VỊ SỐ ĐẶC BIỆT</button>
        </div>
        
        <div class="card">
            <h2>PHẦN 2: TÍNH CHO TẤT CẢ NGƯỜI</h2>
            <p style="margin-bottom: 15px; color: #7f8c8d;">Tính toán cho tất cả 26 người trong danh sách</p>
            
            <div class="form-group">
                <label for="allTargetDate">Ngày tháng năm muốn xem:</label>
                <input type="date" id="allTargetDate" value="">
            </div>
            
            <button class="btn btn-calculate-all" onclick="calculateForAll()">TÍNH TOÁN CHO TẤT CẢ</button>
            
            <div class="loading" id="loadingAll">
                <div class="spinner"></div>
                <p>Đang tính toán cho 26 người...</p>
            </div>
            
            <div class="hour-converter">
                <h3>CHUYỂN ĐỔI GIỜ ↔ SỐ THỨ TỰ</h3>
                <p>Nhập giờ (HH:MM): <input type="text" id="hourInput" placeholder="12:03" maxlength="5">
                <button onclick="convertHourToNumber()">Chuyển đổi</button></p>
                <div id="hourConversionResult"></div>
            </div>
        </div>
        
        <div class="results-section">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('single')">KẾT QUẢ 1 NGƯỜI</div>
                <div class="tab" onclick="switchTab('all')">KẾT QUẢ TẤT CẢ</div>
                <div class="tab" onclick="switchTab('intervals')">KHOẢNG CÁCH THỜI GIAN</div>
                <div class="tab" onclick="switchTab('permutations')">HOÁN VỊ ĐẶC BIỆT</div>
                <div class="tab" onclick="switchTab('allhours')">BẢNG GIỜ 24H</div>
                <div class="tab" onclick="switchTab('newhours')">BẢNG GIỜ MỚI (0:00-5:00)</div>
            </div>
            
            <div class="tab-content active" id="singleResult">
                <!-- Kết quả phần 1 sẽ được hiển thị ở đây -->
            </div>
            
            <div class="tab-content" id="allResult">
                <!-- Kết quả phần 2 sẽ được hiển thị ở đây -->
            </div>
            
            <div class="tab-content" id="intervalsResult">
                <!-- Khoảng cách thời gian sẽ được hiển thị ở đây -->
            </div>
            
            <div class="tab-content" id="permutationsResult">
                <!-- Hoán vị số đặc biệt sẽ được hiển thị ở đây -->
            </div>
            
            <div class="tab-content" id="allhoursResult">
                <!-- Bảng giờ 24h sẽ được hiển thị ở đây -->
            </div>
            
            <div class="tab-content" id="newhoursResult">
                <!-- Bảng giờ mới (0:00-5:00) sẽ được hiển thị ở đây -->
            </div>
        </div>
        
        <div class="card">
            <h2>BẢNG GIỜ VÀ SỐ THỨ TỰ MỚI (0:00 đến 5:00)</h2>
            <div class="table-container">
                <table id="newTimeTable">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Giờ</th>
                            <th>STT</th>
                            <th>Giờ</th>
                            <th>STT</th>
                            <th>Giờ</th>
                        </tr>
                    </thead>
                    <tbody id="newTimeTableBody">
                        <!-- Bảng giờ mới sẽ được tạo động bằng JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="info-note">
        <strong>Lưu ý:</strong> 
        1. Các số đặc biệt tìm được nên gắn kèm với giờ trong bảng 1 để biết mà tránh rủi ro, tai nạn. 
        2. Số 307 là (tụt huyết áp), các số khác là bệnh nặng.
        3. Dữ liệu triệu chứng được tích hợp từ hồ sơ sức khỏe thực tế.
        4. Khoảng cách thời gian giữa các số đặc biệt: 30 phút, 1 giờ, 1 giờ 30, 2 giờ, 3 giờ, 4 giờ.
        5. Giờ đau tim (heart attack hours): 1:23, 12:03, 2:13, 2:31, 3:12, 3:21, v.v.
    </div>
    
    <div class="footer">
        <p>© 2023 - Tính toán An toàn Thời gian & Theo dõi Triệu chứng | Dữ liệu chỉ mang tính chất tham khảo</p>
    </div>

    <script>
        // ========== BẢNG GIỜ MỚI (0:00 đến 5:00) ==========
        const newTimeTableData = [
            {time: "0:00", stt: 0},
            {time: "0:01", stt: 1},
            {time: "0:02", stt: 2},
            {time: "0:03", stt: 3},
            {time: "0:04", stt: 4},
            {time: "0:05", stt: 5},
            {time: "0:06", stt: 6},
            {time: "0:07", stt: 7},
            {time: "0:08", stt: 8},
            {time: "0:09", stt: 9},
            {time: "0:10", stt: 10},
            {time: "0:11", stt: 11},
            {time: "0:12", stt: 12},
            {time: "0:13", stt: 13},
            {time: "0:14", stt: 14},
            {time: "0:15", stt: 15},
            {time: "0:16", stt: 16},
            {time: "0:17", stt: 17},
            {time: "0:18", stt: 18},
            {time: "0:19", stt: 19},
            {time: "0:20", stt: 20},
            {time: "0:21", stt: 21},
            {time: "0:22", stt: 22},
            {time: "0:23", stt: 23},
            {time: "0:24", stt: 24},
            {time: "0:25", stt: 25},
            {time: "0:26", stt: 26},
            {time: "0:27", stt: 27},
            {time: "0:28", stt: 28},
            {time: "0:29", stt: 29},
            {time: "0:30", stt: 30},
            {time: "0:31", stt: 31},
            {time: "0:32", stt: 32},
            {time: "0:33", stt: 33},
            {time: "0:34", stt: 34},
            {time: "0:35", stt: 35},
            {time: "0:36", stt: 36},
            {time: "0:37", stt: 37},
            {time: "0:38", stt: 38},
            {time: "0:39", stt: 39},
            {time: "0:40", stt: 40},
            {time: "0:41", stt: 41},
            {time: "0:42", stt: 42},
            {time: "0:43", stt: 43},
            {time: "0:44", stt: 44},
            {time: "0:45", stt: 45},
            {time: "0:46", stt: 46},
            {time: "0:47", stt: 47},
            {time: "0:48", stt: 48},
            {time: "0:49", stt: 49},
            {time: "0:50", stt: 50},
            {time: "0:51", stt: 51},
            {time: "0:52", stt: 52},
            {time: "0:53", stt: 53},
            {time: "0:54", stt: 54},
            {time: "0:55", stt: 55},
            {time: "0:56", stt: 56},
            {time: "0:57", stt: 57},
            {time: "0:58", stt: 58},
            {time: "0:59", stt: 59},
            {time: "1:00", stt: 60},
            {time: "1:01", stt: 61},
            {time: "1:02", stt: 62},
            {time: "1:03", stt: 63},
            {time: "1:04", stt: 64},
            {time: "1:05", stt: 65},
            {time: "1:06", stt: 66},
            {time: "1:07", stt: 67},
            {time: "1:08", stt: 68},
            {time: "1:09", stt: 69},
            {time: "1:10", stt: 70},
            {time: "1:11", stt: 71},
            {time: "1:12", stt: 72},
            {time: "1:13", stt: 73},
            {time: "1:14", stt: 74},
            {time: "1:15", stt: 75},
            {time: "1:16", stt: 76},
            {time: "1:17", stt: 77},
            {time: "1:18", stt: 78},
            {time: "1:19", stt: 79},
            {time: "1:20", stt: 80},
            {time: "1:21", stt: 81},
            {time: "1:22", stt: 82},
            {time: "1:23", stt: 83},
            {time: "1:24", stt: 84},
            {time: "1:25", stt: 85},
            {time: "1:26", stt: 86},
            {time: "1:27", stt: 87},
            {time: "1:28", stt: 88},
            {time: "1:29", stt: 89},
            {time: "1:30", stt: 90},
            {time: "1:31", stt: 91},
            {time: "1:32", stt: 92},
            {time: "1:33", stt: 93},
            {time: "1:34", stt: 94},
            {time: "1:35", stt: 95},
            {time: "1:36", stt: 96},
            {time: "1:37", stt: 97},
            {time: "1:38", stt: 98},
            {time: "1:39", stt: 99},
            {time: "1:40", stt: 100},
            {time: "1:41", stt: 101},
            {time: "1:42", stt: 102},
            {time: "1:43", stt: 103},
            {time: "1:44", stt: 104},
            {time: "1:45", stt: 105},
            {time: "1:46", stt: 106},
            {time: "1:47", stt: 107},
            {time: "1:48", stt: 108},
            {time: "1:49", stt: 109},
            {time: "1:50", stt: 110},
            {time: "1:51", stt: 111},
            {time: "1:52", stt: 112},
            {time: "1:53", stt: 113},
            {time: "1:54", stt: 114},
            {time: "1:55", stt: 115},
            {time: "1:56", stt: 116},
            {time: "1:57", stt: 117},
            {time: "1:58", stt: 118},
            {time: "1:59", stt: 119},
            {time: "2:00", stt: 120},
            {time: "2:01", stt: 121},
            {time: "2:02", stt: 122},
            {time: "2:03", stt: 123},
            {time: "2:04", stt: 124},
            {time: "2:05", stt: 125},
            {time: "2:06", stt: 126},
            {time: "2:07", stt: 127},
            {time: "2:08", stt: 128},
            {time: "2:09", stt: 129},
            {time: "2:10", stt: 130},
            {time: "2:11", stt: 131},
            {time: "2:12", stt: 132},
            {time: "2:13", stt: 133},
            {time: "2:14", stt: 134},
            {time: "2:15", stt: 135},
            {time: "2:16", stt: 136},
            {time: "2:17", stt: 137},
            {time: "2:18", stt: 138},
            {time: "2:19", stt: 139},
            {time: "2:20", stt: 140},
            {time: "2:21", stt: 141},
            {time: "2:22", stt: 142},
            {time: "2:23", stt: 143},
            {time: "2:24", stt: 144},
            {time: "2:25", stt: 145},
            {time: "2:26", stt: 146},
            {time: "2:27", stt: 147},
            {time: "2:28", stt: 148},
            {time: "2:29", stt: 149},
            {time: "2:30", stt: 150},
            {time: "2:31", stt: 151},
            {time: "2:32", stt: 152},
            {time: "2:33", stt: 153},
            {time: "2:34", stt: 154},
            {time: "2:35", stt: 155},
            {time: "2:36", stt: 156},
            {time: "2:37", stt: 157},
            {time: "2:38", stt: 158},
            {time: "2:39", stt: 159},
            {time: "2:40", stt: 160},
            {time: "2:41", stt: 161},
            {time: "2:42", stt: 162},
            {time: "2:43", stt: 163},
            {time: "2:44", stt: 164},
            {time: "2:45", stt: 165},
            {time: "2:46", stt: 166},
            {time: "2:47", stt: 167},
            {time: "2:48", stt: 168},
            {time: "2:49", stt: 169},
            {time: "2:50", stt: 170},
            {time: "2:51", stt: 171},
            {time: "2:52", stt: 172},
            {time: "2:53", stt: 173},
            {time: "2:54", stt: 174},
            {time: "2:55", stt: 175},
            {time: "2:56", stt: 176},
            {time: "2:57", stt: 177},
            {time: "2:58", stt: 178},
            {time: "2:59", stt: 179},
            {time: "3:00", stt: 180},
            {time: "3:01", stt: 181},
            {time: "3:02", stt: 182},
            {time: "3:03", stt: 183},
            {time: "3:04", stt: 184},
            {time: "3:05", stt: 185},
            {time: "3:06", stt: 186},
            {time: "3:07", stt: 187},
            {time: "3:08", stt: 188},
            {time: "3:09", stt: 189},
            {time: "3:10", stt: 190},
            {time: "3:11", stt: 191},
            {time: "3:12", stt: 192},
            {time: "3:13", stt: 193},
            {time: "3:14", stt: 194},
            {time: "3:15", stt: 195},
            {time: "3:16", stt: 196},
            {time: "3:17", stt: 197},
            {time: "3:18", stt: 198},
            {time: "3:19", stt: 199},
            {time: "3:20", stt: 200},
            {time: "3:21", stt: 201},
            {time: "3:22", stt: 202},
            {time: "3:23", stt: 203},
            {time: "3:24", stt: 204},
            {time: "3:25", stt: 205},
            {time: "3:26", stt: 206},
            {time: "3:27", stt: 207},
            {time: "3:28", stt: 208},
            {time: "3:29", stt: 209},
            {time: "3:30", stt: 210},
            {time: "3:31", stt: 211},
            {time: "3:32", stt: 212},
            {time: "3:33", stt: 213},
            {time: "3:34", stt: 214},
            {time: "3:35", stt: 215},
            {time: "3:36", stt: 216},
            {time: "3:37", stt: 217},
            {time: "3:38", stt: 218},
            {time: "3:39", stt: 219},
            {time: "3:40", stt: 220},
            {time: "3:41", stt: 221},
            {time: "3:42", stt: 222},
            {time: "3:43", stt: 223},
            {time: "3:44", stt: 224},
            {time: "3:45", stt: 225},
            {time: "3:46", stt: 226},
            {time: "3:47", stt: 227},
            {time: "3:48", stt: 228},
            {time: "3:49", stt: 229},
            {time: "3:50", stt: 230},
            {time: "3:51", stt: 231},
            {time: "3:52", stt: 232},
            {time: "3:53", stt: 233},
            {time: "3:54", stt: 234},
            {time: "3:55", stt: 235},
            {time: "3:56", stt: 236},
            {time: "3:57", stt: 237},
            {time: "3:58", stt: 238},
            {time: "3:59", stt: 239},
            {time: "4:00", stt: 240},
            {time: "4:01", stt: 241},
            {time: "4:02", stt: 242},
            {time: "4:03", stt: 243},
            {time: "4:04", stt: 244},
            {time: "4:05", stt: 245},
            {time: "4:06", stt: 246},
            {time: "4:07", stt: 247},
            {time: "4:08", stt: 248},
            {time: "4:09", stt: 249},
            {time: "4:10", stt: 250},
            {time: "4:11", stt: 251},
            {time: "4:12", stt: 252},
            {time: "4:13", stt: 253},
            {time: "4:14", stt: 254},
            {time: "4:15", stt: 255},
            {time: "4:16", stt: 256},
            {time: "4:17", stt: 257},
            {time: "4:18", stt: 258},
            {time: "4:19", stt: 259},
            {time: "4:20", stt: 260},
            {time: "4:21", stt: 261},
            {time: "4:22", stt: 262},
            {time: "4:23", stt: 263},
            {time: "4:24", stt: 264},
            {time: "4:25", stt: 265},
            {time: "4:26", stt: 266},
            {time: "4:27", stt: 267},
            {time: "4:28", stt: 268},
            {time: "4:29", stt: 269},
            {time: "4:30", stt: 270},
            {time: "4:31", stt: 271},
            {time: "4:32", stt: 272},
            {time: "4:33", stt: 273},
            {time: "4:34", stt: 274},
            {time: "4:35", stt: 275},
            {time: "4:36", stt: 276},
            {time: "4:37", stt: 277},
            {time: "4:38", stt: 278},
            {time: "4:39", stt: 279},
            {time: "4:40", stt: 280},
            {time: "4:41", stt: 281},
            {time: "4:42", stt: 282},
            {time: "4:43", stt: 283},
            {time: "4:44", stt: 284},
            {time: "4:45", stt: 285},
            {time: "4:46", stt: 286},
            {time: "4:47", stt: 287},
            {time: "4:48", stt: 288},
            {time: "4:49", stt: 289},
            {time: "4:50", stt: 290},
            {time: "4:51", stt: 291},
            {time: "4:52", stt: 292},
            {time: "4:53", stt: 293},
            {time: "4:54", stt: 294},
            {time: "4:55", stt: 295},
            {time: "4:56", stt: 296},
            {time: "4:57", stt: 297},
            {time: "4:58", stt: 298},
            {time: "4:59", stt: 299},
            {time: "5:00", stt: 300}
        ];
        
        // ========== HIỂN THỊ BẢNG GIỜ MỚI ==========
        function initNewTimeTable() {
            const newTimeTableBody = document.getElementById('newTimeTableBody');
            if (!newTimeTableBody) return;
            
            // Xóa nội dung cũ
            newTimeTableBody.innerHTML = '';
            
            let newRow;
            
            // Hiển thị bảng giờ mới (0:00 đến 5:00) - 3 cột mỗi hàng
            for(let i = 0; i < newTimeTableData.length; i++) {
                if (i % 3 === 0) {
                    newRow = document.createElement('tr');
                    newTimeTableBody.appendChild(newRow);
                }
                
                const item = newTimeTableData[i];
                const cell1 = document.createElement('td');
                cell1.textContent = item.stt;
                cell1.style.fontWeight = 'bold';
                
                const cell2 = document.createElement('td');
                cell2.textContent = item.time;
                
                newRow.appendChild(cell1);
                newRow.appendChild(cell2);
            }
            
            // Nếu hàng cuối chưa đủ 3 cột, thêm ô trống
            const remainingCells = newTimeTableData.length % 3;
            if (remainingCells > 0 && newRow) {
                for (let i = remainingCells; i < 3; i++) {
                    const emptyCell1 = document.createElement('td');
                    const emptyCell2 = document.createElement('td');
                    emptyCell1.innerHTML = '&nbsp;';
                    emptyCell2.innerHTML = '&nbsp;';
                    newRow.appendChild(emptyCell1);
                    newRow.appendChild(emptyCell2);
                }
            }
        }
        
        // ========== HÀM HIỂN THỊ BẢNG GIỜ MỚI ==========
        function showNewHoursTable() {
            let html = '<h3>BẢNG GIỜ MỚI (0:00 đến 5:00)</h3>';
            html += '<p>Tổng cộng: ' + newTimeTableData.length + ' mốc thời gian (từ 0:00 đến 5:00)</p>';
            
            html += '<div class="table-container">';
            html += '<table class="all-hours-table">';
            html += '<thead><tr><th>STT</th><th>Giờ</th><th>STT</th><th>Giờ</th><th>STT</th><th>Giờ</th></tr></thead><tbody>';
            
            // Hiển thị bảng giờ mới theo từng hàng 3 cột
            for(let i = 0; i < newTimeTableData.length; i += 3) {
                html += '<tr>';
                
                for(let j = i; j < i + 3 && j < newTimeTableData.length; j++) {
                    const item = newTimeTableData[j];
                    html += `<td><strong>${item.stt}</strong></td><td>${item.time}</td>`;
                }
                
                // Thêm ô trống nếu hàng chưa đủ 3
                const remaining = 3 - Math.min(3, newTimeTableData.length - i);
                for(let k = 0; k < remaining; k++) {
                    html += '<td></td><td></td>';
                }
                
                html += '</tr>';
            }
            
            html += '</tbody></table></div>';
            
            // Thống kê các giờ đặc biệt trong bảng mới
            const specialHoursInNewTable = newTimeTableData.filter(item => {
                // Kiểm tra các số đặc biệt quan trọng trong khoảng 0:00-5:00
                if ([111, 222].includes(item.stt)) return true; // Số lặp
                if ([123, 234].includes(item.stt)) return true; // Dãy liên tiếp (đau tim)
                if ([0, 60, 120, 180, 240, 300].includes(item.stt)) return true; // Mốc quan trọng
                if (item.stt === 111) return true; // 1:51 (STT 111) - Số lặp nguy hiểm
                if (item.stt === 222) return true; // 3:42 (STT 222) - Số lặp nguy hiểm
                if (item.stt === 0) return true; // 0:00 (STT 0) - Mốc bắt đầu
                if (item.stt === 300) return true; // 5:00 (STT 300) - Mốc kết thúc
                
                // Kiểm tra giờ đặc biệt 1:23 (STT 83) - Đau tim
                const timeParts = item.time.split(':');
                const hour = parseInt(timeParts[0]);
                const minute = parseInt(timeParts[1]);
                if (hour === 1 && minute === 23) return true;
                if (hour === 2 && minute === 13) return true; // 2:13 (STT 133)
                if (hour === 3 && minute === 7) return true; // 3:07 (STT 187) - Tụt huyết áp
                
                return false;
            });
            
            if (specialHoursInNewTable.length > 0) {
                html += `<div class="danger-item">
                    <h4>GIỜ ĐẶC BIỆT TRONG BẢNG MỚI:</h4>`;
                specialHoursInNewTable.forEach(item => {
                    let warningType = "BỆNH NẶNG";
                    if ([111, 222].includes(item.stt)) {
                        warningType = "SỐ LẶP NGUY HIỂM";
                    } else if ([123, 234].includes(item.stt)) {
                        warningType = "ĐAU TIM (DÃY LIÊN TIẾP)";
                    } else if ([0, 60, 120, 180, 240, 300].includes(item.stt)) {
                        warningType = "MỐC THỜI GIAN QUAN TRỌNG";
                    } else if (item.time === "1:23") {
                        warningType = "GIỜ ĐAU TIM QUAN TRỌNG";
                    } else if (item.time === "2:13") {
                        warningType = "GIỜ ĐAU TIM QUAN TRỌNG";
                    } else if (item.time === "3:07") {
                        warningType = "TỤT HUYẾT ÁP (307)";
                    }
                    
                    html += `<div class="heart-attack-hour">${item.time} (STT: ${item.stt}) - ${warningType}</div>`;
                });
                html += `</div>`;
            }
            
            // Thống kê
            html += `<div class="summary">
                <h3>THỐNG KÊ BẢNG GIỜ MỚI</h3>
                <p>Tổng số mốc thời gian: ${newTimeTableData.length}</p>
                <p>Phạm vi: ${newTimeTableData[0].time} đến ${newTimeTableData[newTimeTableData.length-1].time}</p>
                <p>Số thứ tự: ${newTimeTableData[0].stt} đến ${newTimeTableData[newTimeTableData.length-1].stt}</p>
                <p>Số giờ đặc biệt tìm thấy: ${specialHoursInNewTable.length}</p>
                <p><strong>Lưu ý quan trọng:</strong> Bảng này chứa các giờ đặc biệt quan trọng như 1:23 (đau tim), 1:51 (111), 2:13 (đau tim), 3:07 (tụt huyết áp), 3:42 (222), 5:00 (300)</p>
            </div>`;
            
            document.getElementById('newhoursResult').innerHTML = html;
        }
        
        // ========== HÀM CHUYỂN ĐỔI GIỜ SANG SỐ ==========
        function convertHourToNumber() {
            const hourInput = document.getElementById('hourInput').value.trim();
            const resultDiv = document.getElementById('hourConversionResult');
            
            if (!hourInput.match(/^\d{1,2}:\d{2}$/)) {
                resultDiv.innerHTML = '<div class="warning-item">Định dạng giờ không hợp lệ. Vui lòng nhập HH:MM hoặc H:MM</div>';
                return;
            }
            
            const parts = hourInput.split(':');
            const hour = parseInt(parts[0]);
            const minute = parseInt(parts[1]);
            
            if (hour < 0 || hour > 23 || minute < 0 || minute > 59) {
                resultDiv.innerHTML = '<div class="warning-item">Giờ không hợp lệ. Giờ: 0-23, Phút: 0-59</div>';
                return;
            }
            
            const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
            
            // Tìm trong bảng giờ mới
            let foundInNewTable = newTimeTableData.find(item => {
                const itemTimeParts = item.time.split(':');
                const itemHour = parseInt(itemTimeParts[0]);
                const itemMinute = parseInt(itemTimeParts[1]);
                return itemHour === hour && itemMinute === minute;
            });
            
            let html = `<div class="summary">
                <h3>KẾT QUẢ CHUYỂN ĐỔI</h3>
                <p>Giờ: <strong>${time}</strong></p>`;
            
            if (foundInNewTable) {
                html += `<p>Số thứ tự trong bảng mới: <strong>${foundInNewTable.stt}</strong></p>`;
            } else {
                // Tính toán số thứ tự dựa trên công thức
                let number = hour * 60 + minute; // Tính STT cơ bản
                
                // Điều chỉnh cho bảng mới nếu nằm trong khoảng 0:00-5:00
                if (hour >= 0 && hour <= 5) {
                    // Tính toán lại dựa trên bảng mới: 0:00 = 0, 0:01 = 1, ...
                    number = hour * 60 + minute;
                }
                
                html += `<p>Số thứ tự (tính toán): <strong>${number}</strong></p>`;
            }
            
            // Kiểm tra nếu là giờ đặc biệt
            const isSpecialHour = checkIfSpecialHour(hour, minute);
            if (isSpecialHour.isSpecial) {
                html += `<div class="danger-item">
                    <h4>⚠️ GIỜ ĐẶC BIỆT ⚠️</h4>
                    <p><strong>${isSpecialHour.type}</strong></p>`;
                
                if (isSpecialHour.numbers && isSpecialHour.numbers.length > 0) {
                    html += `<p>Số tương ứng: ${isSpecialHour.numbers.join(', ')}</p>`;
                }
                
                html += `</div>`;
            }
            
            html += `</div>`;
            
            resultDiv.innerHTML = html;
        }
        
        // Hàm kiểm tra giờ đặc biệt
        function checkIfSpecialHour(hour, minute) {
            const result = { isSpecial: false, type: "", numbers: [] };
            
            // Tính STT
            const sttNumber = hour * 60 + minute;
            
            // Kiểm tra trong bảng mới trước
            const foundInNewTable = newTimeTableData.find(item => {
                const itemTimeParts = item.time.split(':');
                return parseInt(itemTimeParts[0]) === hour && parseInt(itemTimeParts[1]) === minute;
            });
            
            let sttInNewTable = sttNumber;
            if (foundInNewTable) {
                sttInNewTable = foundInNewTable.stt;
            }
            
            // Kiểm tra các loại số đặc biệt trong khoảng 0:00-5:00
            if (sttInNewTable === 111) {
                result.isSpecial = true;
                result.type = "SỐ LẶP NGUY HIỂM (111) - 1:51";
                result.numbers.push(111);
            } else if (sttInNewTable === 222) {
                result.isSpecial = true;
                result.type = "SỐ LẶP NGUY HIỂM (222) - 3:42";
                result.numbers.push(222);
            } else if (sttInNewTable === 0) {
                result.isSpecial = true;
                result.type = "MỐC THỜI GIAN QUAN TRỌNG (0:00)";
                result.numbers.push(0);
            } else if (sttInNewTable === 60) {
                result.isSpecial = true;
                result.type = "MỐC THỜI GIAN QUAN TRỌNG (1:00)";
                result.numbers.push(60);
            } else if (sttInNewTable === 120) {
                result.isSpecial = true;
                result.type = "MỐC THỜI GIAN QUAN TRỌNG (2:00)";
                result.numbers.push(120);
            } else if (sttInNewTable === 180) {
                result.isSpecial = true;
                result.type = "MỐC THỜI GIAN QUAN TRỌNG (3:00)";
                result.numbers.push(180);
            } else if (sttInNewTable === 240) {
                result.isSpecial = true;
                result.type = "MỐC THỜI GIAN QUAN TRỌNG (4:00)";
                result.numbers.push(240);
            } else if (sttInNewTable === 300) {
                result.isSpecial = true;
                result.type = "MỐC THỜI GIAN QUAN TRỌNG (5:00)";
                result.numbers.push(300);
            } else if ([123, 234].includes(sttInNewTable)) {
                result.isSpecial = true;
                result.type = "DÃY LIÊN TIẾP (ĐAU TIM)";
                result.numbers.push(sttInNewTable);
            } else if (hour === 1 && minute === 23) {
                result.isSpecial = true;
                result.type = "GIỜ ĐAU TIM QUAN TRỌNG (1:23)";
                result.numbers.push(83); // STT của 1:23
            } else if (hour === 2 && minute === 13) {
                result.isSpecial = true;
                result.type = "GIỜ ĐAU TIM QUAN TRỌNG (2:13)";
                result.numbers.push(133); // STT của 2:13
            } else if (hour === 3 && minute === 7) {
                result.isSpecial = true;
                result.type = "TỤT HUYẾT ÁP (307) - 3:07";
                result.numbers.push(187); // STT của 3:07
            }
            
            return result;
        }
        
        // ========== DANH SÁCH SỐ ĐẶC BIỆT GỐC ==========
        const baseSpecialNumbers = [
            307, 111, 222, 333, 444, 555, 666, 777, 888, 999,
            159, 195, 168, 186, 267, 276, 249, 294, 285, 258,
            357, 375, 384, 348, 438, 483, 429, 492, 528, 582,
            537, 573, 519, 591, 627, 672, 618, 681, 726, 762,
            735, 753, 825, 852, 816, 861, 843, 834, 915, 951,
            924, 942
        ];
        
        // ========== SỐ ĐẶC BIỆT MỚI (DÃY LIÊN TIẾP) ==========
        const sequentialSpecialNumbers = [
            123, 234, 345, 456, 567, 678, 789, 891, 912,
            132, 243, 354, 465, 576, 687, 798, 819, 921,
            213, 324, 435, 546, 657, 768, 879, 918, 129
        ];
        
        // ========== DANH SÁCH SỐ ĐẶC BIỆT P3 ==========
        const specialNumbersP3 = [14, 41, 27, 72];
        
        // ========== HÀM TẠO HOÁN VỊ SỐ 3 CHỮ SỐ ==========
        function generatePermutations(number) {
            const numStr = number.toString().padStart(3, '0');
            const digits = numStr.split('');
            const permutations = new Set();
            
            // Tạo tất cả hoán vị của 3 chữ số
            for(let i = 0; i < 3; i++) {
                for(let j = 0; j < 3; j++) {
                    for(let k = 0; k < 3; k++) {
                        if (i !== j && i !== k && j !== k) {
                            const perm = digits[i] + digits[j] + digits[k];
                            permutations.add(parseInt(perm));
                        }
                    }
                }
            }
            
            return Array.from(permutations).sort((a, b) => a - b);
        }
        
        // ========== HÀM TẠO GIỜ TỪ SỐ 3 CHỮ SỐ ==========
        function generateHoursFromNumber(number) {
            const numStr = number.toString().padStart(3, '0');
            const hours = [];
            
            // Các cách biểu diễn giờ từ số 3 chữ số
            const hourFormats = [
                // HH:MM (2 chữ số đầu là giờ, 1 chữ số cuối là phút với số 0 ở đầu)
                numStr.substring(0, 2) + ':' + numStr.substring(2).padStart(2, '0'),
                // H:MM (1 chữ số đầu là giờ, 2 chữ số sau là phút)
                numStr.substring(0, 1) + ':' + numStr.substring(1).padStart(2, '0'),
                // HH:M (2 chữ số đầu là giờ, 1 chữ số cuối là phút)
                numStr.substring(0, 2) + ':' + numStr.substring(2, 3).padStart(2, '0'),
                // H:M (1 chữ số đầu là giờ, 1 chữ số giữa là phút với số 0 ở đầu)
                numStr.substring(0, 1) + ':' + numStr.substring(1, 2).padStart(2, '0') + numStr.substring(2, 3)
            ];
            
            // Lọc các giờ hợp lệ (giờ từ 0-23, phút từ 0-59)
            hourFormats.forEach(format => {
                const parts = format.split(':');
                const hour = parseInt(parts[0]);
                const minute = parseInt(parts[1]);
                
                if (hour >= 0 && hour <= 23 && minute >= 0 && minute <= 59) {
                    hours.push(format);
                }
            });
            
            return [...new Set(hours)]; // Loại bỏ trùng lặp
        }
        
        // ========== TẠO DANH SÁCH HOÁN VỊ CHO TẤT CẢ SỐ ĐẶC BIỆT ==========
        const allPermutations = {};
        const allSpecialHours = {};
        
        // Tạo hoán vị cho số đặc biệt gốc
        baseSpecialNumbers.forEach(num => {
            allPermutations[num] = generatePermutations(num);
            
            // Tạo giờ từ số gốc và các hoán vị
            const allHours = new Set();
            [num, ...allPermutations[num]].forEach(permNum => {
                const hours = generateHoursFromNumber(permNum);
                hours.forEach(hour => allHours.add(hour));
            });
            
            allSpecialHours[num] = Array.from(allHours).sort();
        });
        
        // Tạo hoán vị cho số đặc biệt mới (dãy liên tiếp)
        sequentialSpecialNumbers.forEach(num => {
            allPermutations[num] = generatePermutations(num);
            
            const allHours = new Set();
            [num, ...allPermutations[num]].forEach(permNum => {
                const hours = generateHoursFromNumber(permNum);
                hours.forEach(hour => allHours.add(hour));
            });
            
            allSpecialHours[num] = Array.from(allHours).sort();
        });
        
        // ========== DANH SÁCH TẤT CẢ SỐ ĐẶC BIỆT (GỐC + HOÁN VỊ) ==========
        const allSpecialNumbersSet = new Set();
        baseSpecialNumbers.forEach(num => {
            allSpecialNumbersSet.add(num);
            allPermutations[num].forEach(perm => allSpecialNumbersSet.add(perm));
        });
        sequentialSpecialNumbers.forEach(num => {
            allSpecialNumbersSet.add(num);
            allPermutations[num].forEach(perm => allSpecialNumbersSet.add(perm));
        });
        
        const allSpecialNumbers = Array.from(allSpecialNumbersSet).sort((a, b) => a - b);
        
        // ========== DANH SÁCH TẤT CẢ GIỜ ĐẶC BIỆT ==========
        const allSpecialHoursSet = new Set();
        Object.values(allSpecialHours).forEach(hourList => {
            hourList.forEach(hour => allSpecialHoursSet.add(hour));
        });
        
        const allSpecialHoursList = Array.from(allSpecialHoursSet).sort();
        
        // ========== HÀM CHUYỂN ĐỔI GIỜ SANG SỐ THỨ TỰ ==========
        function hourToNumber(hourStr) {
            const parts = hourStr.split(':');
            const hour = parseInt(parts[0]);
            const minute = parseInt(parts[1]);
            
            // Kiểm tra trong bảng giờ mới trước
            const foundInNewTable = newTimeTableData.find(item => {
                const itemParts = item.time.split(':');
                return parseInt(itemParts[0]) === hour && parseInt(itemParts[1]) === minute;
            });
            
            if (foundInNewTable) {
                return foundInNewTable.stt;
            }
            
            // Nếu không tìm thấy, tính toán như cũ
            if (hour >= 20 && hour <= 23) {
                // Buổi tối: 20:00 = 1200, 20:01 = 1201, ..., 23:59 = 1439
                return 1200 + (hour - 20) * 60 + minute;
            } else if (hour >= 0 && hour <= 19) {
                // Ban ngày và đêm: 00:00 = 0, 00:01 = 1, ..., 19:59 = 1199
                return hour * 60 + minute;
            }
            return 0;
        }
        
        // ========== HÀM CHUYỂN ĐỔI SỐ THỨ TỰ SANG GIỜ ==========
        function numberToHour(number) {
            // Kiểm tra trong bảng giờ mới trước
            const foundInNewTable = newTimeTableData.find(item => item.stt === number);
            if (foundInNewTable) {
                return foundInNewTable.time;
            }
            
            // Nếu không tìm thấy, tính toán như cũ
            if (number >= 1200 && number <= 1439) {
                // Buổi tối: 1200 = 20:00, 1201 = 20:01, ..., 1439 = 23:59
                const totalMinutes = number - 1200;
                const hour = Math.floor(totalMinutes / 60) + 20;
                const minute = totalMinutes % 60;
                return `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
            } else if (number >= 0 && number <= 1199) {
                // Ban ngày và đêm: 0 = 00:00, 1 = 00:01, ..., 1199 = 19:59
                const hour = Math.floor(number / 60);
                const minute = number % 60;
                return `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
            }
            return "00:00";
        }
        
        // ========== TẠO BẢNG GIỜ 24H ĐẦY ĐỦ ==========
        const all24Hours = [];
        for(let hour = 0; hour < 24; hour++) {
            for(let minute = 0; minute < 60; minute++) {
                const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                const number = hourToNumber(time);
                all24Hours.push({time, number});
            }
        }
        
        // ========== HIỂN THỊ HOÁN VỊ SỐ ĐẶC BIỆT ==========
        function showPermutations() {
            let html = '<h3>HOÁN VỊ TẤT CẢ SỐ ĐẶC BIỆT</h3>';
            
            // Nhóm số theo loại
            const numberGroups = {
                "TỤT HUYẾT ÁP (307)": [307],
                "SỐ LẶP NGUY HIỂM": [111, 222, 333, 444, 555, 666, 777, 888, 999],
                "DÃY LIÊN TIẾP (ĐAU TIM)": [123, 234, 345, 456, 567, 678, 789, 891, 912],
                "BỆNH NẶNG NHÓM 1": [159, 195, 168, 186],
                "BỆNH NẶNG NHÓM 2": [267, 276, 249, 294, 285, 258],
                "BỆNH NẶNG NHÓM 3": [357, 375, 384, 348, 438, 483],
                "BỆNH NẶNG NHÓM 4": [429, 492, 528, 582, 537, 573],
                "BỆNH NẶNG NHÓM 5": [519, 591, 627, 672, 618, 681],
                "BỆNH NẶNG NHÓM 6": [726, 762, 735, 753, 825, 852],
                "BỆNH NẶNG NHÓM 7": [816, 861, 843, 834, 915, 951, 924, 942]
            };
            
            Object.entries(numberGroups).forEach(([groupName, numbers]) => {
                html += `<div class="permutation-group">
                    <h4>${groupName}</h4>`;
                
                numbers.forEach(num => {
                    const perms = allPermutations[num] || generatePermutations(num);
                    const hours = allSpecialHours[num] || generateHoursFromNumber(num);
                    
                    html += `<div class="permutation-item">
                        <strong>Số ${num}:</strong> ${perms.join(', ')}
                        <br><strong>Giờ tương ứng:</strong> ${hours.join(', ')}
                    </div>`;
                });
                
                html += `</div>`;
            });
            
            // Thống kê
            html += `<div class="summary">
                <h3>THỐNG KÊ HOÁN VỊ</h3>
                <p>Tổng số đặc biệt gốc: ${baseSpecialNumbers.length + sequentialSpecialNumbers.length}</p>
                <p>Tổng số hoán vị: ${allSpecialNumbers.length}</p>
                <p>Tổng giờ đặc biệt: ${allSpecialHoursList.length}</p>
                <p><strong>Chú ý:</strong> Mỗi giờ đặc biệt có thể tương ứng với nhiều số đặc biệt khác nhau.</p>
            </div>`;
            
            document.getElementById('permutationsResult').innerHTML = html;
            switchTab('permutations');
        }
        
        // ========== HÀM HIỂN THỊ BẢNG GIỜ 24H ==========
        function showAllHoursTable() {
            let html = '<h3>BẢNG GIỜ 24H ĐẦY ĐỦ</h3>';
            html += '<p>Tổng cộng: 1440 phút (24 giờ × 60 phút)</p>';
            
            html += '<div class="table-container">';
            html += '<table class="all-hours-table">';
            html += '<thead><tr><th>Giờ</th><th>STT</th><th>Giờ</th><th>STT</th><th>Giờ</th><th>STT</th><th>Giờ</th><th>STT</th></tr></thead><tbody>';
            
            // Hiển thị theo từng khối 4 giờ
            for(let hour = 0; hour < 24; hour += 4) {
                html += '<tr>';
                for(let h = hour; h < hour + 4 && h < 24; h++) {
                    const time = `${h.toString().padStart(2, '0')}:00`;
                    const number = hourToNumber(time);
                    html += `<td>${time}</td><td><strong>${number}</strong></td>`;
                }
                html += '</tr>';
                
                // Hiển thị các phút quan trọng (0, 7, 30, 37, 44, 52, 59)
                const importantMinutes = [0, 7, 30, 37, 44, 52, 59];
                importantMinutes.forEach(minute => {
                    html += '<tr>';
                    for(let h = hour; h < hour + 4 && h < 24; h++) {
                        const time = `${h.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                        const number = hourToNumber(time);
                        const isSpecial = allSpecialHoursList.includes(time);
                        html += `<td${isSpecial ? ' style="background:#ffebee;font-weight:bold;"' : ''}>${time}</td>`;
                        html += `<td${isSpecial ? ' style="background:#ffebee;font-weight:bold;"' : ''}><strong>${number}</strong></td>`;
                    }
                    html += '</tr>';
                });
                
                html += '<tr><td colspan="8" style="border-bottom: 2px solid #ddd;"></td></tr>';
            }
            
            html += '</tbody></table></div>';
            
            // Danh sách giờ đặc biệt quan trọng
            const criticalHours = allSpecialHoursList.filter(hour => {
                const hourNum = parseInt(hour.split(':')[0]);
                const minuteNum = parseInt(hour.split(':')[1]);
                return (hourNum === 3 && minuteNum === 7) || (hourNum === 5 && minuteNum === 7); // 03:07 và 05:07 - tụt huyết áp
            });
            
            if (criticalHours.length > 0) {
                html += `<div class="danger-item">
                    <h4>GIỜ ĐẶC BIỆT QUAN TRỌNG NHẤT:</h4>`;
                criticalHours.forEach(hour => {
                    html += `<div class="heart-attack-hour">${hour} - TỤT HUYẾT ÁP (STT: ${hourToNumber(hour)})</div>`;
                });
                html += `</div>`;
            }
            
            document.getElementById('allhoursResult').innerHTML = html;
        }
        
        // ========== CẬP NHẬT DANH SÁCH SỐ ĐẶC BIỆT ĐỂ TÍNH TOÁN ==========
        // Sử dụng tất cả số đặc biệt (gốc + hoán vị) cho tính toán
        const specialNumbersP2 = allSpecialNumbers;
        
        // ========== CÁC HÀM CÒN LẠI GIỮ NGUYÊN ==========
        // Đặt ngày mặc định là hôm nay
        const today = new Date();
        const todayStr = today.toISOString().split('T')[0];
        document.getElementById('targetDate').value = todayStr;
        document.getElementById('allTargetDate').value = todayStr;
        
        // Danh sách người
        const people = [
            {name: "NGUYENKHACNANG", birthDate: "04/06/1944"},
            {name: "TOTHIHA", birthDate: "29/08/1948"},
            {name: "NGUYENMINHNAM", birthDate: "03/03/1971"},
            {name: "BAHA", birthDate: "13/03/1971", displayName: "BA HA"},
            {name: "THANTHIKIMANH", birthDate: "23/09/1981"},
            {name: "NGUYENTONGANAN", birthDate: "28/09/2014"},
            {name: "NGUYENTOMINHCHAU", birthDate: "25/07/2016"},
            {name: "NGUYENTOBICHNGOC", birthDate: "05/02/2020"},
            {name: "NGUYENTHIMINHHANG", birthDate: "07/01/1974"},
            {name: "NGOQUYCUONG", birthDate: "23/05/1973"},
            {name: "NGOGIABACH", birthDate: "12/10/2000"},
            {name: "NGOGIALINH", birthDate: "05/04/2005"},
            {name: "NGUYENTHIMINHPHUONG", birthDate: "06/11/1978"},
            {name: "HOANGANHDUNG", birthDate: "21/09/1978"},
            {name: "HOANGHAIVINH", birthDate: "03/06/2010"},
            {name: "HOANGTHIENBACHANH", birthDate: "14/11/2015"},
            {name: "TÔ KIM HUỆ", birthDate: "09/08/1960"},
            {name: "NGUYỄN TUẤN ANH", birthDate: "23/10/1983"},
            {name: "NGUYỄN THẾ ANH", birthDate: "24/03/2001"},
            {name: "NGÔ THỊ MAI", birthDate: "12/12/1948"},
            {name: "TÔ VIỆT HƯNG", birthDate: "17/06/1996"},
            {name: "TÔ THỊ HỒNG", birthDate: "10/10/1964"},
            {name: "VŨ VĂN HIỆP", birthDate: "24/04/1974"},
            {name: "NGUYỄN THỊ CHI", birthDate: "08/02/1946"},
            {name: "NGUYỄN TẤN BẮC", birthDate: "30/11/1957"},
            {name: "NGUYỄN THỊ TÂM", birthDate: "08/08/1954"}
        ];
        
        // Hàm chuyển đổi ngày từ DD/MM/YYYY sang đối tượng Date
        function parseDate(dateStr) {
            const parts = dateStr.split('/');
            return new Date(parts[2], parts[1] - 1, parts[0]);
        }
        
        // Hàm tính số ngày chênh lệch
        function calculateDayDiff(birthDateStr, targetDateStr) {
            const birthDate = parseDate(birthDateStr);
            const targetDate = new Date(targetDateStr);
            
            const diffTime = Math.abs(targetDate - birthDate);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            return diffDays;
        }
        
        // Hàm cập nhật ngày sinh khi chọn người
        function updateBirthDate() {
            const select = document.getElementById('personSelect');
            if (select.value) {
                const parts = select.value.split('|');
                document.getElementById('birthDate').value = parts[1];
            }
        }
        
        // Biến toàn cục để theo dõi trạng thái hiển thị chi tiết
        let showCalculations = false;
        
        // Hàm hiển thị/ẩn chi tiết tính toán
        function toggleCalculations() {
            showCalculations = !showCalculations;
            const calculations = document.querySelectorAll('.calculation-result');
            calculations.forEach(calc => {
                if (showCalculations) {
                    calc.classList.add('show-calculation');
                } else {
                    calc.classList.remove('show-calculation');
                }
            });
        }
        
        // Hàm tính toán cho 1 người
        function calculateForOne() {
            const personSelect = document.getElementById('personSelect');
            const birthDateInput = document.getElementById('birthDate');
            const targetDateInput = document.getElementById('targetDate');
            
            if (!personSelect.value) {
                alert('Vui lòng chọn một người!');
                return;
            }
            
            if (!birthDateInput.value) {
                alert('Vui lòng nhập ngày sinh!');
                return;
            }
            
            if (!targetDateInput.value) {
                alert('Vui lòng chọn ngày muốn xem!');
                return;
            }
            
            const parts = personSelect.value.split('|');
            const personName = parts[0];
            const birthDate = birthDateInput.value;
            const targetDate = targetDateInput.value;
            
            const dayDiff = calculateDayDiff(birthDate, targetDate);
            
            const resultsP1 = [];
            const resultsP2 = [];
            const resultsP3 = [];
            
            const specialFoundP2 = [];
            const specialFoundP3 = [];
            
            // Sử dụng newTimeTableData thay vì all24Hours
            newTimeTableData.forEach(item => {
                const stt = item.stt;
                
                // Phép tính 1: thương chẵn
                const quotient = Math.floor(dayDiff / stt);
                if (quotient % 2 === 0 && quotient > 0) {
                    resultsP1.push({stt: stt, quotient: quotient, time: item.time});
                    
                    // Phép tính 3: thương chẵn của P1 chia cho số thứ tự
                    const quotient2 = Math.floor(quotient / stt);
                    resultsP3.push({stt: stt, quotient: quotient, quotient2: quotient2, time: item.time});
                    
                    // Kiểm tra số đặc biệt trong P3
                    if (specialNumbersP3.includes(quotient2)) {
                        specialFoundP3.push({
                            number: quotient2,
                            stt: stt,
                            time: item.time,
                            originalQuotient: quotient
                        });
                    }
                }
                
                // Phép tính 2: số dư
                const remainder = dayDiff % stt;
                resultsP2.push({stt: stt, remainder: remainder, time: item.time});
                
                // Kiểm tra số đặc biệt trong P2 (sử dụng specialNumbersP2)
                if (specialNumbersP2.includes(remainder)) {
                    specialFoundP2.push({
                        number: remainder,
                        stt: stt,
                        time: item.time
                    });
                }
            });
            
            // Hiển thị kết quả
            displaySingleResult(personName, birthDate, targetDate, dayDiff, 
                              resultsP1, resultsP2, resultsP3,
                              specialFoundP2, specialFoundP3);
            
            // Hiển thị khoảng cách thời gian
            const intervals = calculateTimeIntervals([...specialFoundP2, ...specialFoundP3]);
            displayIntervalsResult(personName, intervals);
            
            switchTab('single');
        }
        
        // Hàm tính cho tất cả người (chưa triển khai đầy đủ)
        function calculateForAll() {
            const targetDateInput = document.getElementById('allTargetDate');
            
            if (!targetDateInput.value) {
                alert('Vui lòng chọn ngày muốn xem!');
                return;
            }
            
            const targetDate = targetDateInput.value;
            let html = '<h3>KẾT QUẢ TÍNH TOÁN CHO TẤT CẢ 26 NGƯỜI</h3>';
            html += `<p>Ngày xem: ${targetDate}</p>`;
            
            html += '<div class="summary">';
            html += '<p>Chức năng đang được phát triển. Hiện tại chỉ có thể tính toán cho từng người.</p>';
            html += '<p>Vui lòng sử dụng tính năng "TÍNH TOÁN CHO 1 NGƯỜI".</p>';
            html += '</div>';
            
            document.getElementById('allResult').innerHTML = html;
            switchTab('all');
        }
        
        // Hàm tính khoảng cách thời gian
        function calculateTimeIntervals(specialNumbers) {
            if (specialNumbers.length < 2) {
                return [];
            }
            
            specialNumbers.sort((a, b) => {
                return timeToMinutes(a.time) - timeToMinutes(b.time);
            });
            
            const intervals = [];
            const targetIntervals = [30, 60, 90, 120, 180, 240];
            
            for(let i = 0; i < specialNumbers.length; i++) {
                for(let j = i + 1; j < specialNumbers.length; j++) {
                    const time1 = timeToMinutes(specialNumbers[i].time);
                    const time2 = timeToMinutes(specialNumbers[j].time);
                    let interval = Math.abs(time2 - time1);
                    
                    if (interval > 720) {
                        interval = 1440 - interval;
                    }
                    
                    for(const target of targetIntervals) {
                        if (Math.abs(interval - target) <= 5) {
                            intervals.push({
                                time1: specialNumbers[i].time,
                                time2: specialNumbers[j].time,
                                number1: specialNumbers[i].number,
                                number2: specialNumbers[j].number,
                                interval: interval,
                                exactInterval: target
                            });
                            break;
                        }
                    }
                }
            }
            
            return intervals;
        }
        
        function timeToMinutes(timeStr) {
            const parts = timeStr.split(':');
            return parseInt(parts[0]) * 60 + parseInt(parts[1]);
        }
        
        function minutesToTimeString(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            
            if (hours === 0) {
                return `${mins} phút`;
            } else if (mins === 0) {
                return `${hours} giờ`;
            } else {
                return `${hours} giờ ${mins} phút`;
            }
        }
        
        function displayIntervalsResult(personName, intervals) {
            let html = `<h3>KHOẢNG CÁCH THỜI GIAN: ${personName}</h3>`;
            
            if (intervals.length === 0) {
                html += `<div class="summary">Không tìm thấy khoảng cách đặc biệt</div>`;
            } else {
                const intervalsByType = {30:[], 60:[], 90:[], 120:[], 180:[], 240:[]};
                intervals.forEach(interval => {
                    intervalsByType[interval.exactInterval].push(interval);
                });
                
                Object.entries(intervalsByType).forEach(([intervalType, intervalList]) => {
                    if (intervalList.length > 0) {
                        const minutes = parseInt(intervalType);
                        let intervalClass = "interval-30min";
                        if (minutes === 60) intervalClass = "interval-1hour";
                        else if (minutes === 90) intervalClass = "interval-1hour30";
                        else if (minutes === 120) intervalClass = "interval-2hour";
                        else if (minutes === 180) intervalClass = "interval-3hour";
                        else if (minutes === 240) intervalClass = "interval-4hour";
                        
                        html += `<div class="${intervalClass}">`;
                        html += `<h4>KHOẢNG CÁCH ${minutesToTimeString(minutes).toUpperCase()}:</h4>`;
                        intervalList.forEach(interval => {
                            html += `<div>${interval.time1} → ${interval.time2} (${minutesToTimeString(interval.interval)})</div>`;
                        });
                        html += `</div>`;
                    }
                });
            }
            
            document.getElementById('intervalsResult').innerHTML = html;
        }
        
        function displaySingleResult(personName, birthDate, targetDate, dayDiff, 
                                    resultsP1, resultsP2, resultsP3,
                                    specialP2, specialP3) {
            const resultDiv = document.getElementById('singleResult');
            
            let html = `
                <div class="result-item">
                    <div class="person-name">${personName}</div>
                    <div>Ngày sinh: ${birthDate}</div>
                    <div>Ngày xem: ${targetDate}</div>
                    <div class="day-diff">Số ngày chênh lệch: ${dayDiff.toLocaleString()}</div>
                </div>
            `;
            
            if (specialP2.length > 0) {
                html += `<div class="danger-item">
                    <strong>TÌM THẤY ${specialP2.length} SỐ ĐẶC BIỆT:</strong><br>`;
                
                specialP2.forEach(item => {
                    // Xác định loại số
                    let numberType = "BỆNH NẶNG";
                    let numberClass = "warning-number";
                    
                    if (item.number === 307) {
                        numberType = "TỤT HUYẾT ÁP";
                        numberClass = "danger-number";
                    } else if ([111, 222, 333, 444, 555, 666, 777, 888, 999].includes(item.number)) {
                        numberType = "SỐ LẶP NGUY HIỂM";
                        numberClass = "critical-number";
                    } else if ([123, 234, 345, 456, 567, 678, 789].includes(item.number)) {
                        numberType = "ĐAU TIM";
                        numberClass = "danger-number";
                    }
                    
                    // Tìm hoán vị của số này
                    const perms = allPermutations[item.number] || [];
                    const permHours = allSpecialHours[item.number] || [];
                    
                    html += `<div class="special-numbers">
                        <span class="${numberClass}">${item.number} (${numberType})</span>
                        tại ${item.time} (STT: ${item.stt})`;
                    
                    if (perms.length > 0) {
                        html += `<br>Hoán vị: ${perms.slice(0, 3).join(', ')}${perms.length > 3 ? '...' : ''}`;
                    }
                    
                    if (permHours.length > 0) {
                        html += `<br>Giờ tương ứng: ${permHours.slice(0, 3).join(', ')}${permHours.length > 3 ? '...' : ''}`;
                    }
                    
                    html += `</div>`;
                });
                
                html += `</div>`;
            }
            
            if (specialP2.length === 0 && specialP3.length === 0) {
                html += `<div class="summary">
                    <h3>KHÔNG TÌM THẤY SỐ ĐẶC BIỆT</h3>
                    <p>Không tìm thấy số đặc biệt nào trong các phép tính.</p>
                </div>`;
            } else {
                html += `<div class="summary">
                    <h3>TỔNG KẾT</h3>
                    <p>Tìm thấy ${specialP2.length} số đặc biệt trong Phép tính 2 (số dư).</p>
                </div>`;
            }
            
            resultDiv.innerHTML = html;
        }
        
        // Hàm chuyển tab
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            if (tabName === 'single') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('singleResult').classList.add('active');
            } else if (tabName === 'all') {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('allResult').classList.add('active');
            } else if (tabName === 'intervals') {
                document.querySelectorAll('.tab')[2].classList.add('active');
                document.getElementById('intervalsResult').classList.add('active');
            } else if (tabName === 'permutations') {
                document.querySelectorAll('.tab')[3].classList.add('active');
                document.getElementById('permutationsResult').classList.add('active');
            } else if (tabName === 'allhours') {
                showAllHoursTable();
                document.querySelectorAll('.tab')[4].classList.add('active');
                document.getElementById('allhoursResult').classList.add('active');
            } else if (tabName === 'newhours') {
                showNewHoursTable();
                document.querySelectorAll('.tab')[5].classList.add('active');
                document.getElementById('newhoursResult').classList.add('active');
            }
        }
        
        // Khởi tạo
        window.onload = function() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            document.getElementById('targetDate').value = todayStr;
            document.getElementById('allTargetDate').value = todayStr;
            
            // Khởi tạo bảng giờ mới
            initNewTimeTable();
        };
    </script>
</body>
</html>