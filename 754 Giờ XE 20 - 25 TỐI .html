<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tính toán Ngày Sinh - An Toàn Thời Gian & Theo dõi Triệu chứng</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        .header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 16px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #e1e8ed;
        }
        
        .card h2 {
            color: #2980b9;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ecf0f1;
            font-size: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #34495e;
        }
        
        select, input[type="date"], input[type="text"], textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #2980b9, #1f639e);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn-calculate-all {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .btn-calculate-all:hover {
            background: linear-gradient(135deg, #27ae60, #219653);
        }
        
        .btn-symptoms {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .btn-symptoms:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
        }
        
        .btn-permute {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }
        
        .btn-permute:hover {
            background: linear-gradient(135deg, #8e44ad, #7d3c98);
        }
        
        .results-section {
            grid-column: 1 / -1;
            margin-top: 20px;
        }
        
        .results-container {
            display: none;
            margin-top: 20px;
        }
        
        .results-container.active {
            display: block;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            background: #f8f9fa;
            border: 1px solid transparent;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 6px 6px 0 0;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.3s;
            margin-bottom: 5px;
        }
        
        .tab.active {
            background: white;
            color: #3498db;
            border-color: #ddd #ddd white #ddd;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 0 6px 6px 6px;
            border: 1px solid #ddd;
            border-top: none;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .result-item {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
            margin-bottom: 8px;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .person-name {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .day-diff {
            color: #e74c3c;
            font-weight: 600;
            font-size: 18px;
        }
        
        .calculation-result {
            margin-top: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 14px;
            display: none;
        }
        
        .show-calculation {
            display: block !important;
        }
        
        .special-numbers {
            margin-top: 10px;
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .danger-number {
            color: #e74c3c;
            font-weight: 700;
        }
        
        .warning-number {
            color: #e67e22;
            font-weight: 700;
        }
        
        .critical-number {
            color: #8e44ad;
            font-weight: 700;
        }
        
        .time-info {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 5px;
        }
        
        .danger-item {
            background: #ffeaea;
            border-left: 4px solid #e74c3c;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 4px 4px 0;
        }
        
        .warning-item {
            background: #fff4e6;
            border-left: 4px solid #e67e22;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 4px 4px 0;
        }
        
        .critical-item {
            background: #f4e6ff;
            border-left: 4px solid #8e44ad;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 4px 4px 0;
        }
        
        .info-note {
            background: #e8f4fc;
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 14px;
            color: #2c3e50;
            border-left: 4px solid #3498db;
        }
        
        .hidden {
            display: none;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 12px;
        }
        
        th {
            background-color: #f2f6fa;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .summary {
            margin-top: 20px;
            padding: 15px;
            background: #e8f6f3;
            border-radius: 6px;
            border-left: 4px solid #1abc9c;
        }
        
        .summary h3 {
            color: #16a085;
            margin-bottom: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .valid-hour {
            background-color: #e8f6f3;
            font-weight: bold;
        }
        
        .toggle-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .toggle-btn:hover {
            background: #7f8c8d;
        }
        
        .symptom-item {
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 4px 4px 0;
        }
        
        .symptom-date {
            color: #7f8c8d;
            font-size: 12px;
        }
        
        .symptom-severity-high {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .symptom-severity-medium {
            color: #e67e22;
            font-weight: bold;
        }
        
        .symptom-severity-low {
            color: #f39c12;
            font-weight: bold;
        }
        
        .symptom-analysis {
            background: #fef9e7;
            border: 1px solid #f7dc6f;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .time-interval-warning {
            background: #fff3e0;
            border: 2px solid #ff9800;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .interval-30min {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }
        
        .interval-1hour {
            background: #ffe0b2;
            border-left: 4px solid #f57c00;
        }
        
        .interval-1hour30 {
            background: #ffcc80;
            border-left: 4px solid #ef6c00;
        }
        
        .interval-2hour {
            background: #ffb74d;
            border-left: 4px solid #e65100;
        }
        
        .interval-3hour {
            background: #ffa726;
            border-left: 4px solid #bf360c;
        }
        
        .interval-4hour {
            background: #ff9800;
            border-left: 4px solid #d84315;
            color: white;
        }
        
        .interval-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .permutation-item {
            background: #f0f8ff;
            border: 1px solid #87ceeb;
            border-radius: 6px;
            padding: 10px;
            margin: 5px 0;
        }
        
        .permutation-group {
            background: #f9f0ff;
            border: 1px solid #dda0dd;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .heart-attack-hour {
            background: #ffebee;
            border: 2px solid #e74c3c;
            border-radius: 6px;
            padding: 10px;
            margin: 5px 0;
            font-weight: bold;
        }
        
        .hour-converter {
            background: #e8f5e9;
            border: 1px solid #81c784;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .hour-converter input {
            width: 100px;
            padding: 8px;
            margin-right: 10px;
            border: 1px solid #81c784;
            border-radius: 4px;
        }
        
        .hour-converter button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .hour-converter button:hover {
            background: #388e3c;
        }
        
        .all-hours-table {
            font-size: 11px;
        }
        
        .all-hours-table td {
            padding: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TÍNH TOÁN AN TOÀN THỜI GIAN & THEO DÕI TRIỆU CHỨNG</h1>
            <p>Kiểm tra các mốc thời gian quan trọng và theo dõi triệu chứng sức khỏe</p>
        </div>
        
        <div class="card">
            <h2>PHẦN 1: TÍNH CHO MỘT NGƯỜI</h2>
            <div class="form-group">
                <label for="personSelect">1. Chọn người:</label>
                <select id="personSelect" onchange="updateBirthDate(); updateSymptomHistory()">
                    <option value="">-- Chọn một người --</option>
                    <option value="NGUYENKHACNANG|04/06/1944">1. NGUYENKHACNANG (04/06/1944)</option>
                    <option value="TOTHIHA|29/08/1948">2. TOTHIHA (29/08/1948)</option>
                    <option value="NGUYENMINHNAM|03/03/1971">3. NGUYENMINHNAM (03/03/1971)</option>
                    <option value="BAHA|13/03/1971">4. BA HA (13/03/1971)</option>
                    <option value="THANTHIKIMANH|23/09/1981">5. THANTHIKIMANH (23/09/1981)</option>
                    <option value="NGUYENTONGANAN|28/09/2014">6. NGUYENTONGANAN (28/09/2014)</option>
                    <option value="NGUYENTOMINHCHAU|25/07/2016">7. NGUYENTOMINHCHAU (25/07/2016)</option>
                    <option value="NGUYENTOBICHNGOC|05/02/2020">8. NGUYENTOBICHNGOC (05/02/2020)</option>
                    <option value="NGUYENTHIMINHHANG|07/01/1974">9. NGUYENTHIMINHHANG (07/01/1974)</option>
                    <option value="NGOQUYCUONG|23/05/1973">10. NGOQUYCUONG (23/05/1973)</option>
                    <option value="NGOGIABACH|12/10/2000">11. NGOGIABACH (12/10/2000)</option>
                    <option value="NGOGIALINH|05/04/2005">12. NGOGIALINH (05/04/2005)</option>
                    <option value="NGUYENTHIMINHPHUONG|06/11/1978">13. NGUYENTHIMINHPHUONG (06/11/1978)</option>
                    <option value="HOANGANHDUNG|21/09/1978">14. HOANGANHDUNG (21/09/1978)</option>
                    <option value="HOANGHAIVINH|03/06/2010">15. HOANGHAIVINH (03/06/2010)</option>
                    <option value="HOANGTHIENBACHANH|14/11/2015">16. HOANGTHIENBACHANH (14/11/2015)</option>
                    <option value="TOKIMHUE|09/08/1960">17. TÔ KIM HUỆ (09/08/1960)</option>
                    <option value="NGUYENTUANANH|23/10/1983">18. NGUYỄN TUẤN ANH (23/10/1983)</option>
                    <option value="NGUYENTHEANH|24/03/2001">19. NGUYỄN THẾ ANH (24/03/2001)</option>
                    <option value="NGOTHIMAI|12/12/1948">20. NGÔ THỊ MAI (12/12/1948)</option>
                    <option value="TOVIETHUNG|17/06/1996">21. TÔ VIỆT HƯNG (17/06/1996)</option>
                    <option value="TOTHIHONG|10/10/1964">22. TÔ THỊ HỒNG (10/10/1964)</option>
                    <option value="VUVANHIEP|24/04/1974">23. VŨ VĂN HIỆP (24/04/1974)</option>
                    <option value="NGUYENTHICHI|08/02/1946">24. NGUYỄN THỊ CHI (08/02/1946)</option>
                    <option value="NGUYENTANBAC|30/11/1957">25. NGUYỄN TẤN BẮC (30/11/1957)</option>
                    <option value="NGUYENTHITAM|08/08/1954">26. NGUYỄN THỊ TÂM (08/08/1954)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="birthDate">2. Ngày tháng năm sinh:</label>
                <input type="text" id="birthDate" placeholder="DD/MM/YYYY" value="">
            </div>
            
            <div class="form-group">
                <label for="targetDate">3. Ngày tháng năm muốn xem:</label>
                <input type="date" id="targetDate" value="">
            </div>
            
            <button class="btn" onclick="calculateForOne()">TÍNH TOÁN CHO 1 NGƯỜI</button>
            <button class="toggle-btn" onclick="toggleCalculations()">Hiện/Ẩn chi tiết tính toán</button>
            <button class="btn btn-symptoms" onclick="showSymptomsForPerson()">XEM LỊCH SỬ TRIỆU CHỨNG</button>
            <button class="btn btn-permute" onclick="showPermutations()">XEM HOÁN VỊ SỐ ĐẶC BIỆT</button>
        </div>
        
        <div class="card">
            <h2>PHẦN 2: TÍNH CHO TẤT CẢ NGƯỜI</h2>
            <p style="margin-bottom: 15px; color: #7f8c8d;">Tính toán cho tất cả 26 người trong danh sách</p>
            
            <div class="form-group">
                <label for="allTargetDate">Ngày tháng năm muốn xem:</label>
                <input type="date" id="allTargetDate" value="">
            </div>
            
            <button class="btn btn-calculate-all" onclick="calculateForAll()">TÍNH TOÁN CHO TẤT CẢ</button>
            <button class="btn btn-symptoms" onclick="analyzeAllSymptoms()">PHÂN TÍCH TRIỆU CHỨNG TẤT CẢ</button>
            
            <div class="loading" id="loadingAll">
                <div class="spinner"></div>
                <p>Đang tính toán cho 26 người...</p>
            </div>
            
            <div class="hour-converter">
                <h3>CHUYỂN ĐỔI GIỜ ↔ SỐ THỨ TỰ</h3>
                <p>Nhập giờ (HH:MM): <input type="text" id="hourInput" placeholder="03:07" maxlength="5">
                <button onclick="convertHourToNumber()">Chuyển đổi</button></p>
                <div id="hourConversionResult"></div>
            </div>
        </div>
        
        <div class="results-section">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('single')">KẾT QUẢ 1 NGƯỜI</div>
                <div class="tab" onclick="switchTab('all')">KẾT QUẢ TẤT CẢ</div>
                <div class="tab" onclick="switchTab('symptoms')">LỊCH SỬ TRIỆU CHỨNG</div>
                <div class="tab" onclick="switchTab('analysis')">PHÂN TÍCH TRIỆU CHỨNG</div>
                <div class="tab" onclick="switchTab('intervals')">KHOẢNG CÁCH THỜI GIAN</div>
                <div class="tab" onclick="switchTab('permutations')">HOÁN VỊ ĐẶC BIỆT</div>
                <div class="tab" onclick="switchTab('allhours')">BẢNG GIỜ 24H</div>
            </div>
            
            <div class="tab-content active" id="singleResult">
                <!-- Kết quả phần 1 sẽ được hiển thị ở đây -->
            </div>
            
            <div class="tab-content" id="allResult">
                <!-- Kết quả phần 2 sẽ được hiển thị ở đây -->
            </div>
            
            <div class="tab-content" id="symptomsResult">
                <!-- Lịch sử triệu chứng sẽ được hiển thị ở đây -->
            </div>
            
            <div class="tab-content" id="analysisResult">
                <!-- Phân tích triệu chứng sẽ được hiển thị ở đây -->
            </div>
            
            <div class="tab-content" id="intervalsResult">
                <!-- Khoảng cách thời gian sẽ được hiển thị ở đây -->
            </div>
            
            <div class="tab-content" id="permutationsResult">
                <!-- Hoán vị số đặc biệt sẽ được hiển thị ở đây -->
            </div>
            
            <div class="tab-content" id="allhoursResult">
                <!-- Bảng giờ 24h sẽ được hiển thị ở đây -->
            </div>
        </div>
        
        <div class="card">
            <h2>BẢNG GIỜ VÀ SỐ THỨ TỰ (Buổi tối - Từ 20:00 đến 01:00)</h2>
            <div class="table-container">
                <table id="timeTable">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Giờ</th>
                            <th>STT</th>
                            <th>Giờ</th>
                            <th>STT</th>
                            <th>Giờ</th>
                        </tr>
                    </thead>
                    <tbody id="timeTableBody">
                        <!-- Bảng giờ sẽ được tạo động bằng JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="card">
            <h2>GIỜ HỢP LỆ ĐẶC BIỆT (MỞ RỘNG)</h2>
            <div class="table-container">
                <table id="validHoursTable">
                    <thead>
                        <tr>
                            <th>Giờ hợp lệ</th>
                            <th>Giờ hiển thị</th>
                            <th>Số thứ tự</th>
                            <th>Loại cảnh báo</th>
                            <th>Hoán vị</th>
                        </tr>
                    </thead>
                    <tbody id="validHoursBody">
                        <!-- Danh sách giờ hợp lệ sẽ được tạo động -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="info-note">
        <strong>Lưu ý:</strong> 
        1. Các số đặc biệt tìm được nên gắn kèm với giờ trong bảng 1 để biết mà tránh rủi ro, tai nạn. 
        2. Số 307 là (tụt huyết áp), các số khác là bệnh nặng.
        3. Dữ liệu triệu chứng được tích hợp từ hồ sơ sức khỏe thực tế.
        4. Khoảng cách thời gian giữa các số đặc biệt: 30 phút, 1 giờ, 1 giờ 30, 2 giờ, 3 giờ, 4 giờ.
        5. Giờ đau tim (heart attack hours): 1:23, 12:03, 2:13, 2:31, 3:12, 3:21, v.v.
    </div>
    
    <div class="footer">
        <p>© 2023 - Tính toán An toàn Thời gian & Theo dõi Triệu chứng | Dữ liệu chỉ mang tính chất tham khảo</p>
    </div>

    <script>
        // ========== DANH SÁCH SỐ ĐẶC BIỆT GỐC ==========
        const baseSpecialNumbers = [
            307, 111, 222, 333, 444, 555, 666, 777, 888, 999,
            159, 195, 168, 186, 267, 276, 249, 294, 285, 258,
            357, 375, 384, 348, 438, 483, 429, 492, 528, 582,
            537, 573, 519, 591, 627, 672, 618, 681, 726, 762,
            735, 753, 825, 852, 816, 861, 843, 834, 915, 951,
            924, 942
        ];
        
        // ========== SỐ ĐẶC BIỆT MỚI (DÃY LIÊN TIẾP) ==========
        const sequentialSpecialNumbers = [
            123, 234, 345, 456, 567, 678, 789, 891, 912,
            132, 243, 354, 465, 576, 687, 798, 819, 921,
            213, 324, 435, 546, 657, 768, 879, 918, 129
        ];
        
        // ========== DANH SÁCH SỐ ĐẶC BIỆT P3 ==========
        const specialNumbersP3 = [14, 41, 27, 72];
        
        // ========== HÀM TẠO HOÁN VỊ SỐ 3 CHỮ SỐ ==========
        function generatePermutations(number) {
            const numStr = number.toString().padStart(3, '0');
            const digits = numStr.split('');
            const permutations = new Set();
            
            // Tạo tất cả hoán vị của 3 chữ số
            for(let i = 0; i < 3; i++) {
                for(let j = 0; j < 3; j++) {
                    for(let k = 0; k < 3; k++) {
                        if (i !== j && i !== k && j !== k) {
                            const perm = digits[i] + digits[j] + digits[k];
                            permutations.add(parseInt(perm));
                        }
                    }
                }
            }
            
            return Array.from(permutations).sort((a, b) => a - b);
        }
        
        // ========== HÀM TẠO GIỜ TỪ SỐ 3 CHỮ SỐ ==========
        function generateHoursFromNumber(number) {
            const numStr = number.toString().padStart(3, '0');
            const hours = [];
            
            // Các cách biểu diễn giờ từ số 3 chữ số
            const hourFormats = [
                // HH:MM (2 chữ số đầu là giờ, 1 chữ số cuối là phút với số 0 ở đầu)
                numStr.substring(0, 2) + ':' + numStr.substring(2).padStart(2, '0'),
                // H:MM (1 chữ số đầu là giờ, 2 chữ số sau là phút)
                numStr.substring(0, 1) + ':' + numStr.substring(1).padStart(2, '0'),
                // HH:M (2 chữ số đầu là giờ, 1 chữ số cuối là phút)
                numStr.substring(0, 2) + ':' + numStr.substring(2, 3).padStart(2, '0'),
                // H:M (1 chữ số đầu là giờ, 1 chữ số giữa là phút với số 0 ở đầu)
                numStr.substring(0, 1) + ':' + numStr.substring(1, 2).padStart(2, '0') + numStr.substring(2, 3)
            ];
            
            // Lọc các giờ hợp lệ (giờ từ 0-23, phút từ 0-59)
            hourFormats.forEach(format => {
                const parts = format.split(':');
                const hour = parseInt(parts[0]);
                const minute = parseInt(parts[1]);
                
                if (hour >= 0 && hour <= 23 && minute >= 0 && minute <= 59) {
                    hours.push(format);
                }
            });
            
            return [...new Set(hours)]; // Loại bỏ trùng lặp
        }
        
        // ========== TẠO DANH SÁCH HOÁN VỊ CHO TẤT CẢ SỐ ĐẶC BIỆT ==========
        const allPermutations = {};
        const allSpecialHours = {};
        
        // Tạo hoán vị cho số đặc biệt gốc
        baseSpecialNumbers.forEach(num => {
            allPermutations[num] = generatePermutations(num);
            
            // Tạo giờ từ số gốc và các hoán vị
            const allHours = new Set();
            [num, ...allPermutations[num]].forEach(permNum => {
                const hours = generateHoursFromNumber(permNum);
                hours.forEach(hour => allHours.add(hour));
            });
            
            allSpecialHours[num] = Array.from(allHours).sort();
        });
        
        // Tạo hoán vị cho số đặc biệt mới (dãy liên tiếp)
        sequentialSpecialNumbers.forEach(num => {
            allPermutations[num] = generatePermutations(num);
            
            const allHours = new Set();
            [num, ...allPermutations[num]].forEach(permNum => {
                const hours = generateHoursFromNumber(permNum);
                hours.forEach(hour => allHours.add(hour));
            });
            
            allSpecialHours[num] = Array.from(allHours).sort();
        });
        
        // ========== DANH SÁCH TẤT CẢ SỐ ĐẶC BIỆT (GỐC + HOÁN VỊ) ==========
        const allSpecialNumbersSet = new Set();
        baseSpecialNumbers.forEach(num => {
            allSpecialNumbersSet.add(num);
            allPermutations[num].forEach(perm => allSpecialNumbersSet.add(perm));
        });
        sequentialSpecialNumbers.forEach(num => {
            allSpecialNumbersSet.add(num);
            allPermutations[num].forEach(perm => allSpecialNumbersSet.add(perm));
        });
        
        const allSpecialNumbers = Array.from(allSpecialNumbersSet).sort((a, b) => a - b);
        
        // ========== DANH SÁCH TẤT CẢ GIỜ ĐẶC BIỆT ==========
        const allSpecialHoursSet = new Set();
        Object.values(allSpecialHours).forEach(hourList => {
            hourList.forEach(hour => allSpecialHoursSet.add(hour));
        });
        
        const allSpecialHoursList = Array.from(allSpecialHoursSet).sort();
        
        // ========== HÀM CHUYỂN ĐỔI GIỜ SANG SỐ THỨ TỰ ==========
        function hourToNumber(hourStr) {
            const parts = hourStr.split(':');
            const hour = parseInt(parts[0]);
            const minute = parseInt(parts[1]);
            
            if (hour >= 20 && hour <= 23) {
                // Buổi tối: 20:00 = 1200, 20:01 = 1201, ..., 23:59 = 1439
                return 1200 + (hour - 20) * 60 + minute;
            } else if (hour >= 0 && hour <= 1) {
                // Đêm khuya: 00:00 = 0, 00:01 = 1, ..., 01:00 = 60
                return hour * 60 + minute;
            } else if (hour >= 2 && hour <= 19) {
                // Ban ngày: 02:00 = 120, 02:01 = 121, ..., 19:59 = 1199
                return hour * 60 + minute;
            }
            return 0;
        }
        
        // ========== HÀM CHUYỂN ĐỔI SỐ THỨ TỰ SANG GIỜ ==========
        function numberToHour(number) {
            if (number >= 1200 && number <= 1439) {
                // Buổi tối: 1200 = 20:00, 1201 = 20:01, ..., 1439 = 23:59
                const totalMinutes = number - 1200;
                const hour = Math.floor(totalMinutes / 60) + 20;
                const minute = totalMinutes % 60;
                return `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
            } else if (number >= 0 && number <= 1199) {
                // Ban ngày và đêm: 0 = 00:00, 1 = 00:01, ..., 1199 = 19:59
                const hour = Math.floor(number / 60);
                const minute = number % 60;
                return `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
            }
            return "00:00";
        }
        
        // ========== TẠO BẢNG GIỜ 24H ĐẦY ĐỦ ==========
        const all24Hours = [];
        for(let hour = 0; hour < 24; hour++) {
            for(let minute = 0; minute < 60; minute++) {
                const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                const number = hourToNumber(time);
                all24Hours.push({time, number});
            }
        }
        
        // ========== HIỂN THỊ BẢNG GIỜ BUỔI TỐI ==========
        const timeTableBody = document.getElementById('timeTableBody');
        let row;
        
        // Chỉ hiển thị 50 dòng đầu
        const eveningHours = all24Hours.filter(item => 
            parseInt(item.time.split(':')[0]) >= 20 || parseInt(item.time.split(':')[0]) <= 1
        ).slice(0, 50);
        
        for(let i = 0; i < eveningHours.length; i++) {
            if (i % 3 === 0) {
                row = document.createElement('tr');
                timeTableBody.appendChild(row);
            }
            
            const item = eveningHours[i];
            const cell1 = document.createElement('td');
            cell1.textContent = item.number;
            cell1.style.fontWeight = 'bold';
            
            const cell2 = document.createElement('td');
            cell2.textContent = item.time;
            
            row.appendChild(cell1);
            row.appendChild(cell2);
        }
        
        // ========== HIỂN THỊ BẢNG GIỜ HỢP LỆ ĐẶC BIỆT ==========
        const validHoursBody = document.getElementById('validHoursBody');
        
        // Nhóm giờ theo số gốc
        const hoursByBaseNumber = {};
        Object.keys(allSpecialHours).forEach(baseNum => {
            allSpecialHours[baseNum].forEach(hour => {
                if (!hoursByBaseNumber[hour]) {
                    hoursByBaseNumber[hour] = new Set();
                }
                hoursByBaseNumber[hour].add(parseInt(baseNum));
            });
        });
        
        // Hiển thị tất cả giờ đặc biệt
        Object.keys(hoursByBaseNumber).sort().forEach(hour => {
            const baseNumbers = Array.from(hoursByBaseNumber[hour]).sort((a, b) => a - b);
            const number = hourToNumber(hour);
            
            // Xác định loại cảnh báo
            let warningType = "Bệnh nặng";
            let warningClass = "warning-number";
            
            if (baseNumbers.some(num => num === 307)) {
                warningType = "TỤT HUYẾT ÁP";
                warningClass = "danger-number";
            } else if (baseNumbers.some(num => [111, 222, 333, 444, 555, 666, 777, 888, 999].includes(num))) {
                warningType = "Số lặp nguy hiểm";
                warningClass = "critical-number";
            } else if (baseNumbers.some(num => [123, 234, 345, 456, 567, 678, 789].includes(num))) {
                warningType = "Đau tim";
                warningClass = "danger-number";
            }
            
            // Tạo hoán vị giờ
            const hourParts = hour.split(':');
            const hourDigits = hourParts[0] + hourParts[1];
            const hourPermutations = generatePermutations(parseInt(hourDigits));
            const hourPerms = hourPermutations.slice(0, 3).map(p => numberToHour(p)).join(', ');
            
            const row = document.createElement('tr');
            row.className = 'valid-hour';
            row.innerHTML = `
                <td>${hour}</td>
                <td>${hour}</td>
                <td>${number}</td>
                <td class="${warningClass}">${warningType}</td>
                <td>${hourPerms}${hourPermutations.length > 3 ? '...' : ''}</td>
            `;
            
            validHoursBody.appendChild(row);
        });
        
        // ========== HÀM HIỂN THỊ HOÁN VỊ SỐ ĐẶC BIỆT ==========
        function showPermutations() {
            let html = '<h3>HOÁN VỊ TẤT CẢ SỐ ĐẶC BIỆT</h3>';
            
            // Nhóm số theo loại
            const numberGroups = {
                "TỤT HUYẾT ÁP (307)": [307],
                "SỐ LẶP NGUY HIỂM": [111, 222, 333, 444, 555, 666, 777, 888, 999],
                "DÃY LIÊN TIẾP (ĐAU TIM)": [123, 234, 345, 456, 567, 678, 789, 891, 912],
                "BỆNH NẶNG NHÓM 1": [159, 195, 168, 186],
                "BỆNH NẶNG NHÓM 2": [267, 276, 249, 294, 285, 258],
                "BỆNH NẶNG NHÓM 3": [357, 375, 384, 348, 438, 483],
                "BỆNH NẶNG NHÓM 4": [429, 492, 528, 582, 537, 573],
                "BỆNH NẶNG NHÓM 5": [519, 591, 627, 672, 618, 681],
                "BỆNH NẶNG NHÓM 6": [726, 762, 735, 753, 825, 852],
                "BỆNH NẶNG NHÓM 7": [816, 861, 843, 834, 915, 951, 924, 942]
            };
            
            Object.entries(numberGroups).forEach(([groupName, numbers]) => {
                html += `<div class="permutation-group">
                    <h4>${groupName}</h4>`;
                
                numbers.forEach(num => {
                    const perms = allPermutations[num] || generatePermutations(num);
                    const hours = allSpecialHours[num] || generateHoursFromNumber(num);
                    
                    html += `<div class="permutation-item">
                        <strong>Số ${num}:</strong> ${perms.join(', ')}
                        <br><strong>Giờ tương ứng:</strong> ${hours.join(', ')}
                    </div>`;
                });
                
                html += `</div>`;
            });
            
            // Thống kê
            html += `<div class="summary">
                <h3>THỐNG KÊ HOÁN VỊ</h3>
                <p>Tổng số đặc biệt gốc: ${baseSpecialNumbers.length + sequentialSpecialNumbers.length}</p>
                <p>Tổng số hoán vị: ${allSpecialNumbers.length}</p>
                <p>Tổng giờ đặc biệt: ${allSpecialHoursList.length}</p>
                <p><strong>Chú ý:</strong> Mỗi giờ đặc biệt có thể tương ứng với nhiều số đặc biệt khác nhau.</p>
            </div>`;
            
            document.getElementById('permutationsResult').innerHTML = html;
            switchTab('permutations');
        }
        
        // ========== HÀM HIỂN THỊ BẢNG GIỜ 24H ==========
        function showAllHoursTable() {
            let html = '<h3>BẢNG GIỜ 24H ĐẦY ĐỦ</h3>';
            html += '<p>Tổng cộng: 1440 phút (24 giờ × 60 phút)</p>';
            
            html += '<div class="table-container">';
            html += '<table class="all-hours-table">';
            html += '<thead><tr><th>Giờ</th><th>STT</th><th>Giờ</th><th>STT</th><th>Giờ</th><th>STT</th><th>Giờ</th><th>STT</th></tr></thead><tbody>';
            
            // Hiển thị theo từng khối 4 giờ
            for(let hour = 0; hour < 24; hour += 4) {
                html += '<tr>';
                for(let h = hour; h < hour + 4 && h < 24; h++) {
                    const time = `${h.toString().padStart(2, '0')}:00`;
                    const number = hourToNumber(time);
                    html += `<td>${time}</td><td><strong>${number}</strong></td>`;
                }
                html += '</tr>';
                
                // Hiển thị các phút quan trọng (0, 7, 30, 37, 44, 52, 59)
                const importantMinutes = [0, 7, 30, 37, 44, 52, 59];
                importantMinutes.forEach(minute => {
                    html += '<tr>';
                    for(let h = hour; h < hour + 4 && h < 24; h++) {
                        const time = `${h.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                        const number = hourToNumber(time);
                        const isSpecial = allSpecialHoursList.includes(time);
                        html += `<td${isSpecial ? ' style="background:#ffebee;font-weight:bold;"' : ''}>${time}</td>`;
                        html += `<td${isSpecial ? ' style="background:#ffebee;font-weight:bold;"' : ''}><strong>${number}</strong></td>`;
                    }
                    html += '</tr>';
                });
                
                html += '<tr><td colspan="8" style="border-bottom: 2px solid #ddd;"></td></tr>';
            }
            
            html += '</tbody></table></div>';
            
            // Danh sách giờ đặc biệt quan trọng
            const criticalHours = allSpecialHoursList.filter(hour => {
                const hourNum = parseInt(hour.split(':')[0]);
                const minuteNum = parseInt(hour.split(':')[1]);
                return hourNum === 3 && minuteNum === 7; // 03:07 - tụt huyết áp
            });
            
            if (criticalHours.length > 0) {
                html += `<div class="danger-item">
                    <h4>GIỜ ĐẶC BIỆT QUAN TRỌNG NHẤT:</h4>`;
                criticalHours.forEach(hour => {
                    html += `<div class="heart-attack-hour">${hour} - TỤT HUYẾT ÁP (STT: ${hourToNumber(hour)})</div>`;
                });
                html += `</div>`;
            }
            
            document.getElementById('allhoursResult').innerHTML = html;
        }
        
        // ========== HÀM CHUYỂN ĐỔI GIỜ SANG SỐ ==========
        function convertHourToNumber() {
            const hourInput = document.getElementById('hourInput').value.trim();
            const resultDiv = document.getElementById('hourConversionResult');
            
            if (!hourInput.match(/^\d{1,2}:\d{2}$/)) {
                resultDiv.innerHTML = '<div class="warning-item">Định dạng giờ không hợp lệ. Vui lòng nhập HH:MM hoặc H:MM</div>';
                return;
            }
            
            const parts = hourInput.split(':');
            const hour = parseInt(parts[0]);
            const minute = parseInt(parts[1]);
            
            if (hour < 0 || hour > 23 || minute < 0 || minute > 59) {
                resultDiv.innerHTML = '<div class="warning-item">Giờ không hợp lệ. Giờ: 0-23, Phút: 0-59</div>';
                return;
            }
            
            const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
            const number = hourToNumber(time);
            
            let html = `<div class="summary">
                <h3>KẾT QUẢ CHUYỂN ĐỔI</h3>
                <p>Giờ: <strong>${time}</strong></p>
                <p>Số thứ tự: <strong>${number}</strong></p>`;
            
            // Kiểm tra nếu là giờ đặc biệt
            if (allSpecialHoursList.includes(time)) {
                const baseNumbers = hoursByBaseNumber[time] ? Array.from(hoursByBaseNumber[time]) : [];
                html += `<div class="danger-item">
                    <h4>⚠️ GIỜ ĐẶC BIỆT ⚠️</h4>`;
                
                if (baseNumbers.some(num => num === 307)) {
                    html += `<p><strong>TỤT HUYẾT ÁP (307)</strong></p>`;
                } else if (baseNumbers.some(num => [123, 234, 345, 456, 567, 678, 789].includes(num))) {
                    html += `<p><strong>GIỜ ĐAU TIM</strong></p>`;
                } else {
                    html += `<p><strong>BỆNH NẶNG</strong></p>`;
                }
                
                if (baseNumbers.length > 0) {
                    html += `<p>Số tương ứng: ${baseNumbers.join(', ')}</p>`;
                }
                
                html += `</div>`;
            }
            
            // Hiển thị hoán vị của giờ này
            const hourDigits = time.replace(':', '');
            const hourPermutations = generatePermutations(parseInt(hourDigits));
            if (hourPermutations.length > 1) {
                html += `<div class="permutation-item">
                    <h4>HOÁN VỊ GIỜ:</h4>`;
                hourPermutations.forEach(perm => {
                    const permHour = numberToHour(perm);
                    html += `<div>${permHour} (STT: ${perm})</div>`;
                });
                html += `</div>`;
            }
            
            html += `</div>`;
            
            resultDiv.innerHTML = html;
        }
        
        // ========== CẬP NHẬT DANH SÁCH SỐ ĐẶC BIỆT ĐỂ TÍNH TOÁN ==========
        // Sử dụng tất cả số đặc biệt (gốc + hoán vị) cho tính toán
        const specialNumbersP2 = allSpecialNumbers;
        
        // ========== CÁC HÀM CÒN LẠI GIỮ NGUYÊN ==========
        // (Giữ nguyên các hàm calculateForOne, calculateForAll, displaySingleResult, etc.)
        // Tôi sẽ giữ nguyên phần còn lại của mã với các cập nhật trên
        
        // Đặt ngày mặc định là hôm nay
        const today = new Date();
        const todayStr = today.toISOString().split('T')[0];
        document.getElementById('targetDate').value = todayStr;
        document.getElementById('allTargetDate').value = todayStr;
        
        // Danh sách người
        const people = [
            {name: "NGUYENKHACNANG", birthDate: "04/06/1944"},
            {name: "TOTHIHA", birthDate: "29/08/1948"},
            {name: "NGUYENMINHNAM", birthDate: "03/03/1971"},
            {name: "BAHA", birthDate: "13/03/1971", displayName: "BA HA"},
            {name: "THANTHIKIMANH", birthDate: "23/09/1981"},
            {name: "NGUYENTONGANAN", birthDate: "28/09/2014"},
            {name: "NGUYENTOMINHCHAU", birthDate: "25/07/2016"},
            {name: "NGUYENTOBICHNGOC", birthDate: "05/02/2020"},
            {name: "NGUYENTHIMINHHANG", birthDate: "07/01/1974"},
            {name: "NGOQUYCUONG", birthDate: "23/05/1973"},
            {name: "NGOGIABACH", birthDate: "12/10/2000"},
            {name: "NGOGIALINH", birthDate: "05/04/2005"},
            {name: "NGUYENTHIMINHPHUONG", birthDate: "06/11/1978"},
            {name: "HOANGANHDUNG", birthDate: "21/09/1978"},
            {name: "HOANGHAIVINH", birthDate: "03/06/2010"},
            {name: "HOANGTHIENBACHANH", birthDate: "14/11/2015"},
            {name: "TÔ KIM HUỆ", birthDate: "09/08/1960"},
            {name: "NGUYỄN TUẤN ANH", birthDate: "23/10/1983"},
            {name: "NGUYỄN THẾ ANH", birthDate: "24/03/2001"},
            {name: "NGÔ THỊ MAI", birthDate: "12/12/1948"},
            {name: "TÔ VIỆT HƯNG", birthDate: "17/06/1996"},
            {name: "TÔ THỊ HỒNG", birthDate: "10/10/1964"},
            {name: "VŨ VĂN HIỆP", birthDate: "24/04/1974"},
            {name: "NGUYỄN THỊ CHI", birthDate: "08/02/1946"},
            {name: "NGUYỄN TẤN BẮC", birthDate: "30/11/1957"},
            {name: "NGUYỄN THỊ TÂM", birthDate: "08/08/1954"}
        ];
        
        // Hàm chuyển đổi ngày từ DD/MM/YYYY sang đối tượng Date
        function parseDate(dateStr) {
            const parts = dateStr.split('/');
            return new Date(parts[2], parts[1] - 1, parts[0]);
        }
        
        // Hàm tính số ngày chênh lệch
        function calculateDayDiff(birthDateStr, targetDateStr) {
            const birthDate = parseDate(birthDateStr);
            const targetDate = new Date(targetDateStr);
            
            const diffTime = Math.abs(targetDate - birthDate);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            return diffDays;
        }
        
        // Hàm cập nhật ngày sinh khi chọn người
        function updateBirthDate() {
            const select = document.getElementById('personSelect');
            if (select.value) {
                const parts = select.value.split('|');
                document.getElementById('birthDate').value = parts[1];
            }
        }
        
        // Biến toàn cục để theo dõi trạng thái hiển thị chi tiết
        let showCalculations = false;
        
        // Hàm hiển thị/ẩn chi tiết tính toán
        function toggleCalculations() {
            showCalculations = !showCalculations;
            const calculations = document.querySelectorAll('.calculation-result');
            calculations.forEach(calc => {
                if (showCalculations) {
                    calc.classList.add('show-calculation');
                } else {
                    calc.classList.remove('show-calculation');
                }
            });
        }
        
        // Hàm tính toán cho 1 người
        function calculateForOne() {
            const personSelect = document.getElementById('personSelect');
            const birthDateInput = document.getElementById('birthDate');
            const targetDateInput = document.getElementById('targetDate');
            
            if (!personSelect.value) {
                alert('Vui lòng chọn một người!');
                return;
            }
            
            if (!birthDateInput.value) {
                alert('Vui lòng nhập ngày sinh!');
                return;
            }
            
            if (!targetDateInput.value) {
                alert('Vui lòng chọn ngày muốn xem!');
                return;
            }
            
            const parts = personSelect.value.split('|');
            const personName = parts[0];
            const birthDate = birthDateInput.value;
            const targetDate = targetDateInput.value;
            
            const dayDiff = calculateDayDiff(birthDate, targetDate);
            
            const resultsP1 = [];
            const resultsP2 = [];
            const resultsP3 = [];
            
            const specialFoundP2 = [];
            const specialFoundP3 = [];
            
            // Sử dụng all24Hours thay vì timeTableData
            all24Hours.forEach(item => {
                const stt = item.number;
                
                // Phép tính 1: thương chẵn
                const quotient = Math.floor(dayDiff / stt);
                if (quotient % 2 === 0 && quotient > 0) {
                    resultsP1.push({stt: stt, quotient: quotient, time: item.time});
                    
                    // Phép tính 3: thương chẵn của P1 chia cho số thứ tự
                    const quotient2 = Math.floor(quotient / stt);
                    resultsP3.push({stt: stt, quotient: quotient, quotient2: quotient2, time: item.time});
                    
                    // Kiểm tra số đặc biệt trong P3
                    if (specialNumbersP3.includes(quotient2)) {
                        specialFoundP3.push({
                            number: quotient2,
                            stt: stt,
                            time: item.time,
                            originalQuotient: quotient
                        });
                    }
                }
                
                // Phép tính 2: số dư
                const remainder = dayDiff % stt;
                resultsP2.push({stt: stt, remainder: remainder, time: item.time});
                
                // Kiểm tra số đặc biệt trong P2 (sử dụng allSpecialNumbers)
                if (specialNumbersP2.includes(remainder)) {
                    specialFoundP2.push({
                        number: remainder,
                        stt: stt,
                        time: item.time
                    });
                }
            });
            
            // Hiển thị kết quả
            displaySingleResult(personName, birthDate, targetDate, dayDiff, 
                              resultsP1, resultsP2, resultsP3,
                              specialFoundP2, specialFoundP3);
            
            // Hiển thị khoảng cách thời gian
            const intervals = calculateTimeIntervals([...specialFoundP2, ...specialFoundP3]);
            displayIntervalsResult(personName, intervals);
            
            switchTab('single');
        }
        
        // Hàm tính khoảng cách thời gian
        function calculateTimeIntervals(specialNumbers) {
            if (specialNumbers.length < 2) {
                return [];
            }
            
            specialNumbers.sort((a, b) => {
                return timeToMinutes(a.time) - timeToMinutes(b.time);
            });
            
            const intervals = [];
            const targetIntervals = [30, 60, 90, 120, 180, 240];
            
            for(let i = 0; i < specialNumbers.length; i++) {
                for(let j = i + 1; j < specialNumbers.length; j++) {
                    const time1 = timeToMinutes(specialNumbers[i].time);
                    const time2 = timeToMinutes(specialNumbers[j].time);
                    let interval = Math.abs(time2 - time1);
                    
                    if (interval > 720) {
                        interval = 1440 - interval;
                    }
                    
                    for(const target of targetIntervals) {
                        if (Math.abs(interval - target) <= 5) {
                            intervals.push({
                                time1: specialNumbers[i].time,
                                time2: specialNumbers[j].time,
                                number1: specialNumbers[i].number,
                                number2: specialNumbers[j].number,
                                interval: interval,
                                exactInterval: target
                            });
                            break;
                        }
                    }
                }
            }
            
            return intervals;
        }
        
        function timeToMinutes(timeStr) {
            const parts = timeStr.split(':');
            return parseInt(parts[0]) * 60 + parseInt(parts[1]);
        }
        
        function minutesToTimeString(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            
            if (hours === 0) {
                return `${mins} phút`;
            } else if (mins === 0) {
                return `${hours} giờ`;
            } else {
                return `${hours} giờ ${mins} phút`;
            }
        }
        
        function displayIntervalsResult(personName, intervals) {
            let html = `<h3>KHOẢNG CÁCH THỜI GIAN: ${personName}</h3>`;
            
            if (intervals.length === 0) {
                html += `<div class="summary">Không tìm thấy khoảng cách đặc biệt</div>`;
            } else {
                const intervalsByType = {30:[], 60:[], 90:[], 120:[], 180:[], 240:[]};
                intervals.forEach(interval => {
                    intervalsByType[interval.exactInterval].push(interval);
                });
                
                Object.entries(intervalsByType).forEach(([intervalType, intervalList]) => {
                    if (intervalList.length > 0) {
                        const minutes = parseInt(intervalType);
                        let intervalClass = "interval-30min";
                        if (minutes === 60) intervalClass = "interval-1hour";
                        else if (minutes === 90) intervalClass = "interval-1hour30";
                        else if (minutes === 120) intervalClass = "interval-2hour";
                        else if (minutes === 180) intervalClass = "interval-3hour";
                        else if (minutes === 240) intervalClass = "interval-4hour";
                        
                        html += `<div class="${intervalClass}">`;
                        html += `<h4>KHOẢNG CÁCH ${minutesToTimeString(minutes).toUpperCase()}:</h4>`;
                        intervalList.forEach(interval => {
                            html += `<div>${interval.time1} → ${interval.time2} (${minutesToTimeString(interval.interval)})</div>`;
                        });
                        html += `</div>`;
                    }
                });
            }
            
            document.getElementById('intervalsResult').innerHTML = html;
        }
        
        function displaySingleResult(personName, birthDate, targetDate, dayDiff, 
                                    resultsP1, resultsP2, resultsP3,
                                    specialP2, specialP3) {
            const resultDiv = document.getElementById('singleResult');
            
            let html = `
                <div class="result-item">
                    <div class="person-name">${personName}</div>
                    <div>Ngày sinh: ${birthDate}</div>
                    <div>Ngày xem: ${targetDate}</div>
                    <div class="day-diff">Số ngày chênh lệch: ${dayDiff.toLocaleString()}</div>
                </div>
            `;
            
            if (specialP2.length > 0) {
                html += `<div class="danger-item">
                    <strong>TÌM THẤY ${specialP2.length} SỐ ĐẶC BIỆT:</strong><br>`;
                
                specialP2.forEach(item => {
                    // Xác định loại số
                    let numberType = "BỆNH NẶNG";
                    let numberClass = "warning-number";
                    
                    if (item.number === 307) {
                        numberType = "TỤT HUYẾT ÁP";
                        numberClass = "danger-number";
                    } else if ([111, 222, 333, 444, 555, 666, 777, 888, 999].includes(item.number)) {
                        numberType = "SỐ LẶP NGUY HIỂM";
                        numberClass = "critical-number";
                    } else if ([123, 234, 345, 456, 567, 678, 789].includes(item.number)) {
                        numberType = "ĐAU TIM";
                        numberClass = "danger-number";
                    }
                    
                    // Tìm hoán vị của số này
                    const perms = allPermutations[item.number] || [];
                    const permHours = allSpecialHours[item.number] || [];
                    
                    html += `<div class="special-numbers">
                        <span class="${numberClass}">${item.number} (${numberType})</span>
                        tại ${item.time} (STT: ${item.stt})`;
                    
                    if (perms.length > 0) {
                        html += `<br>Hoán vị: ${perms.slice(0, 3).join(', ')}${perms.length > 3 ? '...' : ''}`;
                    }
                    
                    if (permHours.length > 0) {
                        html += `<br>Giờ tương ứng: ${permHours.slice(0, 3).join(', ')}${permHours.length > 3 ? '...' : ''}`;
                    }
                    
                    html += `</div>`;
                });
                
                html += `</div>`;
            }
            
            if (specialP2.length === 0 && specialP3.length === 0) {
                html += `<div class="summary">
                    <h3>KHÔNG TÌM THẤY SỐ ĐẶC BIỆT</h3>
                    <p>Không tìm thấy số đặc biệt nào trong các phép tính.</p>
                </div>`;
            } else {
                html += `<div class="summary">
                    <h3>TỔNG KẾT</h3>
                    <p>Tìm thấy ${specialP2.length} số đặc biệt trong Phép tính 2 (số dư).</p>
                </div>`;
            }
            
            resultDiv.innerHTML = html;
        }
        
        // Hàm chuyển tab
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            if (tabName === 'single') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('singleResult').classList.add('active');
            } else if (tabName === 'all') {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('allResult').classList.add('active');
            } else if (tabName === 'symptoms') {
                document.querySelectorAll('.tab')[2].classList.add('active');
                document.getElementById('symptomsResult').classList.add('active');
            } else if (tabName === 'analysis') {
                document.querySelectorAll('.tab')[3].classList.add('active');
                document.getElementById('analysisResult').classList.add('active');
            } else if (tabName === 'intervals') {
                document.querySelectorAll('.tab')[4].classList.add('active');
                document.getElementById('intervalsResult').classList.add('active');
            } else if (tabName === 'permutations') {
                document.querySelectorAll('.tab')[5].classList.add('active');
                document.getElementById('permutationsResult').classList.add('active');
            } else if (tabName === 'allhours') {
                showAllHoursTable();
                document.querySelectorAll('.tab')[6].classList.add('active');
                document.getElementById('allhoursResult').classList.add('active');
            }
        }
        
        // Khởi tạo
        window.onload = function() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            document.getElementById('targetDate').value = todayStr;
            document.getElementById('allTargetDate').value = todayStr;
        };
    </script>
</body>
</html>