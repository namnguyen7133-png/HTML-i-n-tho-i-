<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tra Số Bảng Chữ Cái 25 Xuôi Ngược</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .logo i {
            font-size: 2.8rem;
            color: #FFD700;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .app-card {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.18);
            margin-bottom: 30px;
            width: 100%;
        }
        
        .input-section {
            margin-bottom: 25px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .input-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        #textInput {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: none;
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            outline: none;
            transition: all 0.3s ease;
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }
        
        #textInput:focus {
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.5);
            background: white;
        }
        
        .input-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .char-count {
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .search-btn {
            padding: 15px 25px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(to right, #FFD700, #FFA500);
            color: #333;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 200px;
            justify-content: center;
        }
        
        .search-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(255, 215, 0, 0.4);
        }
        
        .search-btn:active {
            transform: translateY(0);
        }
        
        .clear-btn {
            padding: 15px 25px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 150px;
            justify-content: center;
        }
        
        .clear-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .mode-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .mode-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-width: 150px;
        }
        
        .mode-btn.active {
            background: rgba(255, 215, 0, 0.2);
            border-color: #FFD700;
        }
        
        .result-section {
            margin-top: 20px;
            transition: all 0.5s ease;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .result-title {
            font-size: 1.4rem;
            font-weight: bold;
        }
        
        .result-summary {
            display: flex;
            gap: 15px;
            font-size: 1.1rem;
        }
        
        .summary-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 10px;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .result-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .result-item:hover {
            transform: translateY(-5px);
            background: rgba(0, 0, 0, 0.3);
        }
        
        .result-char {
            font-size: 2rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            margin-bottom: 5px;
            min-height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .space-char {
            color: #aaa;
            font-size: 1.5rem;
        }
        
        .result-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4DFF4D;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            margin-bottom: 5px;
        }
        
        .result-mod {
            font-size: 1.1rem;
            color: #FF9966;
            opacity: 0.9;
        }
        
        .history-section {
            margin-top: 30px;
        }
        
        .history-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .history-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-text {
            max-width: 60%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .history-info {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .history-number {
            font-weight: bold;
            color: #4DFF4D;
        }
        
        .history-mode {
            opacity: 0.7;
            font-size: 0.9rem;
        }
        
        footer {
            margin-top: 20px;
            text-align: center;
            opacity: 0.8;
            font-size: 0.9rem;
            width: 100%;
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.95rem;
        }
        
        .instructions h3 {
            margin-bottom: 10px;
            color: #FFD700;
        }
        
        .instructions ul {
            padding-left: 20px;
            opacity: 0.9;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .app-card {
                padding: 20px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .search-btn, .clear-btn {
                width: 100%;
                min-width: unset;
            }
            
            .result-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
            
            .result-char {
                font-size: 1.5rem;
                min-height: 35px;
            }
            
            .result-number {
                font-size: 1.5rem;
            }
            
            .result-summary {
                flex-direction: column;
                gap: 8px;
            }
            
            .mode-selector {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            .result-grid {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-magic"></i>
                <h1>Tra Số Bảng Chữ Cái 25 Xuôi Ngược</h1>
            </div>
            <p class="subtitle">Nhập chữ cái, từ, câu hoặc đoạn văn để tra số tương ứng theo bảng 25 xuôi ngược. Các số lớn hơn 9 sẽ được tính thêm số dư khi chia cho 9.</p>
        </header>
        
        <main class="app-card">
            <div class="input-section">
                <label class="input-label" for="textInput">Nhập văn bản (tối đa 500 ký tự):</label>
                <div class="input-container">
                    <textarea id="textInput" placeholder="Ví dụ: Tình yêu, Hạnh phúc, hoặc cả một đoạn văn dài..."></textarea>
                    <div class="input-info">
                        <span>Nhập chữ cái, từ, câu hoặc đoạn văn</span>
                        <span class="char-count">Số ký tự: <span id="charCount">0</span>/500</span>
                    </div>
                </div>
                
                <div class="mode-selector">
                    <button class="mode-btn active" data-mode="xuoi">Bảng Xuôi (1-25)</button>
                    <button class="mode-btn" data-mode="nguoc">Bảng Ngược (25-1)</button>
                </div>
                
                <div class="controls">
                    <button class="search-btn" id="searchBtn">
                        <i class="fas fa-calculator"></i> Tính Toán
                    </button>
                    <button class="clear-btn" id="clearBtn">
                        <i class="fas fa-eraser"></i> Xóa
                    </button>
                </div>
            </div>
            
            <div class="result-section" id="resultSection" style="display: none;">
                <div class="result-header">
                    <div class="result-title">Kết Quả Tính Toán</div>
                    <div class="result-summary">
                        <div class="summary-item">Tổng số: <span id="totalSum">0</span></div>
                        <div class="summary-item">Số dư /9: <span id="totalMod">0</span></div>
                        <div class="summary-item">Ký tự: <span id="totalChars">0</span></div>
                    </div>
                </div>
                <div class="result-grid" id="resultGrid">
                    <!-- Kết quả sẽ được thêm vào đây -->
                </div>
            </div>
            
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> Hướng dẫn sử dụng:</h3>
                <ul>
                    <li>Nhập bất kỳ chữ cái, từ, câu hoặc đoạn văn nào</li>
                    <li>Mỗi chữ cái sẽ được tra theo bảng xuôi (1-25) hoặc ngược (25-1)</li>
                    <li>Các số lớn hơn 9 sẽ được tính thêm số dư khi chia cho 9 (ghi trong ngoặc)</li>
                    <li>Khoảng trắng và ký tự đặc biệt sẽ được bỏ qua</li>
                    <li><strong>Bảng 25:</strong> A=1, B=2, ..., Y=25; Ngược: A=25, B=24, ..., Y=1</li>
                </ul>
            </div>
            
            <div class="history-section">
                <div class="history-title">
                    <span>Lịch sử tra cứu</span>
                    <button id="clearHistory" style="background: none; border: none; color: #FFD700; cursor: pointer;">
                        <i class="fas fa-trash-alt"></i> Xóa lịch sử
                    </button>
                </div>
                <div class="history-list" id="historyList">
                    <!-- Lịch sử sẽ được thêm vào đây -->
                </div>
            </div>
        </main>
        
        <footer>
            <p>Ứng dụng tra số theo Bảng 25 Xuôi Ngược - Hỗ trợ nhập đoạn văn dài</p>
            <p>© 2023 - Thiết kế cho thiết bị di động</p>
        </footer>
    </div>

    <script>
        // Bảng dữ liệu chữ cái 25 XUÔI
        const bảngXuôi = {
            // Chữ hoa cơ bản
            'A': 1, 'B': 2, 'C': 3, 'D': 4, 'Đ': 4, 'E': 5, 'Ê': 5,
            'G': 7, 'H': 8, 'I': 9, 'K': 11, 'L': 12, 'M': 13, 'N': 14,
            'O': 15, 'Ô': 15, 'Ơ': 15, 'P': 16, 'Q': 17, 'R': 18, 'S': 19,
            'T': 20, 'U': 21, 'Ư': 21, 'V': 22, 'X': 24, 'Y': 25,
            
            // Chữ A với dấu
            'À': 1, 'Á': 1, 'Ả': 1, 'Ã': 1, 'Ạ': 1,
            'Ă': 1, 'Ằ': 1, 'Ắ': 1, 'Ẳ': 1, 'Ẵ': 1, 'Ặ': 1,
            'Â': 1, 'Ầ': 1, 'Ấ': 1, 'Ẩ': 1, 'Ẫ': 1, 'Ậ': 1,
            
            // Chữ E với dấu
            'È': 5, 'É': 5, 'Ẻ': 5, 'Ẽ': 5, 'Ẹ': 5,
            'Ê': 5, 'Ề': 5, 'Ế': 5, 'Ể': 5, 'Ễ': 5, 'Ệ': 5,
            
            // Chữ I với dấu
            'Ì': 9, 'Í': 9, 'Ỉ': 9, 'Ĩ': 9, 'Ị': 9,
            
            // Chữ O với dấu
            'Ò': 15, 'Ó': 15, 'Ỏ': 15, 'Õ': 15, 'Ọ': 15,
            'Ô': 15, 'Ồ': 15, 'Ố': 15, 'Ổ': 15, 'Ỗ': 15, 'Ộ': 15,
            'Ơ': 15, 'Ờ': 15, 'Ớ': 15, 'Ở': 15, 'Ỡ': 15, 'Ợ': 15,
            
            // Chữ U với dấu
            'Ù': 21, 'Ú': 21, 'Ủ': 21, 'Ũ': 21, 'Ụ': 21,
            'Ư': 21, 'Ừ': 21, 'Ứ': 21, 'Ử': 21, 'Ữ': 21, 'Ự': 21,
            
            // Chữ Y với dấu
            'Ỳ': 25, 'Ý': 25, 'Ỷ': 25, 'Ỹ': 25, 'Ỵ': 25,
            
            // Chữ thường cơ bản
            'a': 1, 'b': 2, 'c': 3, 'd': 4, 'đ': 4, 'e': 5, 'ê': 5,
            'g': 7, 'h': 8, 'i': 9, 'k': 11, 'l': 12, 'm': 13, 'n': 14,
            'o': 15, 'ô': 15, 'ơ': 15, 'p': 16, 'q': 17, 'r': 18, 's': 19,
            't': 20, 'u': 21, 'ư': 21, 'v': 22, 'x': 24, 'y': 25,
            
            // Chữ a thường với dấu
            'à': 1, 'á': 1, 'ả': 1, 'ã': 1, 'ạ': 1,
            'ă': 1, 'ằ': 1, 'ắ': 1, 'ẳ': 1, 'ẵ': 1, 'ặ': 1,
            'â': 1, 'ầ': 1, 'ấ': 1, 'ẩ': 1, 'ẫ': 1, 'ậ': 1,
            
            // Chữ e thường với dấu
            'è': 5, 'é': 5, 'ẻ': 5, 'ẽ': 5, 'ẹ': 5,
            'ê': 5, 'ề': 5, 'ế': 5, 'ể': 5, 'ễ': 5, 'ệ': 5,
            
            // Chữ i thường với dấu
            'ì': 9, 'í': 9, 'ỉ': 9, 'ĩ': 9, 'ị': 9,
            
            // Chữ o thường với dấu
            'ò': 15, 'ó': 15, 'ỏ': 15, 'õ': 15, 'ọ': 15,
            'ô': 15, 'ồ': 15, 'ố': 15, 'ổ': 15, 'ỗ': 15, 'ộ': 15,
            'ơ': 15, 'ờ': 15, 'ớ': 15, 'ở': 15, 'ỡ': 15, 'ợ': 15,
            
            // Chữ u thường với dấu
            'ù': 21, 'ú': 21, 'ủ': 21, 'ũ': 21, 'ụ': 21,
            'ư': 21, 'ừ': 21, 'ứ': 21, 'ử': 21, 'ữ': 21, 'ự': 21,
            
            // Chữ y thường với dấu
            'ỳ': 25, 'ý': 25, 'ỷ': 25, 'ỹ': 25, 'ỵ': 25
        };

        // Bảng dữ liệu chữ cái 25 NGƯỢC
        const bảngNgược = {
            // Chữ hoa cơ bản
            'A': 25, 'B': 24, 'C': 23, 'D': 22, 'Đ': 23, 'E': 21, 'Ê': 22,
            'G': 19, 'H': 18, 'I': 17, 'K': 15, 'L': 14, 'M': 13, 'N': 12,
            'O': 11, 'Ô': 12, 'Ơ': 12, 'P': 10, 'Q': 9, 'R': 8, 'S': 7,
            'T': 6, 'U': 5, 'Ư': 6, 'V': 4, 'X': 2, 'Y': 1,
            
            // Chữ A với dấu
            'À': 26, 'Á': 26, 'Ả': 26, 'Ã': 26, 'Ạ': 26,
            'Ă': 26, 'Ằ': 26, 'Ắ': 26, 'Ẳ': 26, 'Ẵ': 26, 'Ặ': 26,
            'Â': 26, 'Ầ': 26, 'Ấ': 26, 'Ẩ': 26, 'Ẫ': 26, 'Ậ': 26,
            
            // Chữ E với dấu
            'È': 22, 'É': 22, 'Ẻ': 22, 'Ẽ': 22, 'Ẹ': 22,
            'Ê': 22, 'Ề': 22, 'Ế': 22, 'Ể': 22, 'Ễ': 22, 'Ệ': 22,
            
            // Chữ I với dấu
            'Ì': 18, 'Í': 18, 'Ỉ': 18, 'Ĩ': 18, 'Ị': 18,
            
            // Chữ O với dấu
            'Ò': 12, 'Ó': 12, 'Ỏ': 12, 'Õ': 12, 'Ọ': 12,
            'Ô': 12, 'Ồ': 12, 'Ố': 12, 'Ổ': 12, 'Ỗ': 12, 'Ộ': 12,
            'Ơ': 12, 'Ờ': 12, 'Ớ': 12, 'Ở': 12, 'Ỡ': 12, 'Ợ': 12,
            
            // Chữ U với dấu
            'Ù': 6, 'Ú': 6, 'Ủ': 6, 'Ũ': 6, 'Ụ': 6,
            'Ư': 6, 'Ừ': 6, 'Ứ': 6, 'Ử': 6, 'Ữ': 6, 'Ự': 6,
            
            // Chữ Y với dấu
            'Ỳ': 2, 'Ý': 2, 'Ỷ': 2, 'Ỹ': 2, 'Ỵ': 2,
            
            // Chữ thường cơ bản
            'a': 25, 'b': 24, 'c': 23, 'd': 22, 'đ': 23, 'e': 21, 'ê': 22,
            'g': 19, 'h': 18, 'i': 17, 'k': 15, 'l': 14, 'm': 13, 'n': 12,
            'o': 11, 'ô': 12, 'ơ': 12, 'p': 10, 'q': 9, 'r': 8, 's': 7,
            't': 6, 'u': 5, 'ư': 6, 'v': 4, 'x': 2, 'y': 1,
            
            // Chữ a thường với dấu
            'à': 26, 'á': 26, 'ả': 26, 'ã': 26, 'ạ': 26,
            'ă': 26, 'ằ': 26, 'ắ': 26, 'ẳ': 26, 'ẵ': 26, 'ặ': 26,
            'â': 26, 'ầ': 26, 'ấ': 26, 'ẩ': 26, 'ẫ': 26, 'ậ': 26,
            
            // Chữ e thường với dấu
            'è': 22, 'é': 22, 'ẻ': 22, 'ẽ': 22, 'ẹ': 22,
            'ê': 22, 'ề': 22, 'ế': 22, 'ể': 22, 'ễ': 22, 'ệ': 22,
            
            // Chữ i thường với dấu
            'ì': 18, 'í': 18, 'ỉ': 18, 'ĩ': 18, 'ị': 18,
            
            // Chữ o thường với dấu
            'ò': 12, 'ó': 12, 'ỏ': 12, 'õ': 12, 'ọ': 12,
            'ô': 12, 'ồ': 12, 'ố': 12, 'ổ': 12, 'ỗ': 12, 'ộ': 12,
            'ơ': 12, 'ờ': 12, 'ớ': 12, 'ở': 12, 'ỡ': 12, 'ợ': 12,
            
            // Chữ u thường với dấu
            'ù': 6, 'ú': 6, 'ủ': 6, 'ũ': 6, 'ụ': 6,
            'ư': 6, 'ừ': 6, 'ứ': 6, 'ử': 6, 'ữ': 6, 'ự': 6,
            
            // Chữ y thường với dấu
            'ỳ': 2, 'ý': 2, 'ỷ': 2, 'ỹ': 2, 'ỵ': 2
        };

        // Biến lưu trữ
        let currentMode = 'xuoi';
        let searchHistory = JSON.parse(localStorage.getItem('bảng25History')) || [];

        // DOM Elements
        const textInput = document.getElementById('textInput');
        const charCount = document.getElementById('charCount');
        const searchBtn = document.getElementById('searchBtn');
        const clearBtn = document.getElementById('clearBtn');
        const modeBtns = document.querySelectorAll('.mode-btn');
        const resultSection = document.getElementById('resultSection');
        const resultGrid = document.getElementById('resultGrid');
        const totalSum = document.getElementById('totalSum');
        const totalMod = document.getElementById('totalMod');
        const totalChars = document.getElementById('totalChars');
        const historyList = document.getElementById('historyList');
        const clearHistoryBtn = document.getElementById('clearHistory');

        // Tính số dư khi chia 9
        function calculateMod9(number) {
            if (number > 9) {
                return number % 9 === 0 ? 9 : number % 9;
            }
            return 0; // Không hiển thị cho số <= 9
        }

        // Xử lý văn bản và tính toán
        function processText(text) {
            const data = currentMode === 'xuoi' ? bảngXuôi : bảngNgược;
            const results = [];
            let sum = 0;
            let charCount = 0;
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                
                // Bỏ qua khoảng trắng và ký tự không có trong bảng
                if (char === ' ' || char === '\n' || char === '\t') {
                    results.push({
                        char: '␣',
                        number: 0,
                        mod9: 0,
                        isSpace: true
                    });
                    continue;
                }
                
                if (data.hasOwnProperty(char)) {
                    const number = data[char];
                    const mod9 = calculateMod9(number);
                    
                    results.push({
                        char: char,
                        number: number,
                        mod9: mod9
                    });
                    
                    sum += number;
                    charCount++;
                } else {
                    // Ký tự không có trong bảng (dấu câu, số, ký tự đặc biệt)
                    results.push({
                        char: char,
                        number: 0,
                        mod9: 0,
                        isSpecial: true
                    });
                }
            }
            
            return {
                results: results,
                sum: sum,
                charCount: charCount,
                mod9: calculateMod9(sum)
            };
        }

        // Hiển thị kết quả
        function displayResults(processed) {
            resultGrid.innerHTML = '';
            
            if (processed.charCount === 0) {
                resultGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; opacity: 0.7;">Không có chữ cái hợp lệ để tính toán</div>';
                return;
            }
            
            processed.results.forEach((item, index) => {
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                
                let charDisplay = item.char;
                let charClass = 'result-char';
                
                if (item.isSpace) {
                    charClass += ' space-char';
                } else if (item.isSpecial) {
                    charClass += ' space-char';
                }
                
                let numberDisplay = item.number > 0 ? item.number : '—';
                let modDisplay = item.mod9 > 0 ? `(${item.mod9})` : '';
                
                resultItem.innerHTML = `
                    <div class="${charClass}">${charDisplay}</div>
                    <div class="result-number">${numberDisplay}</div>
                    ${item.mod9 > 0 ? `<div class="result-mod">${modDisplay}</div>` : ''}
                `;
                
                resultGrid.appendChild(resultItem);
            });
            
            // Cập nhật tổng kết
            totalSum.textContent = processed.sum;
            totalMod.textContent = processed.mod9;
            totalChars.textContent = processed.charCount;
            
            // Hiển thị phần kết quả
            resultSection.style.display = 'block';
        }

        // Thêm vào lịch sử
        function addToHistory(text, result, mode) {
            const historyItem = {
                text: text.substring(0, 50) + (text.length > 50 ? '...' : ''),
                sum: result.sum,
                mod9: result.mod9,
                charCount: result.charCount,
                mode: mode,
                timestamp: new Date().toLocaleTimeString('vi-VN')
            };
            
            searchHistory.push(historyItem);
            
            // Giới hạn lịch sử tối đa 20 mục
            if (searchHistory.length > 20) {
                searchHistory = searchHistory.slice(-20);
            }
            
            localStorage.setItem('bảng25History', JSON.stringify(searchHistory));
            updateHistoryDisplay();
        }

        // Cập nhật hiển thị lịch sử
        function updateHistoryDisplay() {
            historyList.innerHTML = '';
            
            if (searchHistory.length === 0) {
                historyList.innerHTML = '<div style="padding: 20px; text-align: center; opacity: 0.7;">Chưa có lịch sử tra cứu</div>';
                return;
            }
            
            // Hiển thị từ mới nhất đến cũ nhất
            const reversedHistory = [...searchHistory].reverse();
            
            reversedHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-text" title="${item.text}">${item.text}</div>
                    <div class="history-info">
                        <span class="history-number">${item.sum}</span>
                        ${item.mod9 > 0 ? `<span>(${item.mod9})</span>` : ''}
                        <span class="history-mode">${item.mode === 'xuoi' ? 'Xuôi' : 'Ngược'}</span>
                    </div>
                `;
                
                // Thêm sự kiện click để tải lại kết quả
                historyItem.addEventListener('click', function() {
                    textInput.value = item.text;
                    updateCharCount();
                    changeMode(item.mode);
                    handleCalculate();
                });
                
                historyList.appendChild(historyItem);
            });
        }

        // Xóa lịch sử
        function clearHistory() {
            if (confirm('Bạn có chắc muốn xóa toàn bộ lịch sử tra cứu?')) {
                searchHistory = [];
                localStorage.removeItem('bảng25History');
                updateHistoryDisplay();
            }
        }

        // Xử lý tính toán
        function handleCalculate() {
            const text = textInput.value.trim();
            
            if (!text) {
                alert('Vui lòng nhập văn bản để tính toán!');
                textInput.focus();
                return;
            }
            
            // Xử lý văn bản
            const processed = processText(text);
            
            // Hiển thị kết quả
            displayResults(processed);
            
            // Thêm vào lịch sử
            addToHistory(text, processed, currentMode);
            
            // Cuộn đến kết quả
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Xóa nội dung
        function handleClear() {
            textInput.value = '';
            charCount.textContent = '0';
            resultSection.style.display = 'none';
            textInput.focus();
        }

        // Thay đổi chế độ
        function changeMode(mode) {
            currentMode = mode;
            
            // Cập nhật nút chế độ
            modeBtns.forEach(btn => {
                if (btn.dataset.mode === mode) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Nếu có kết quả đang hiển thị, tính toán lại
            if (resultSection.style.display === 'block' && textInput.value.trim()) {
                const text = textInput.value.trim();
                const processed = processText(text);
                displayResults(processed);
            }
        }

        // Cập nhật số ký tự
        function updateCharCount() {
            const count = textInput.value.length;
            charCount.textContent = count;
            
            // Giới hạn 500 ký tự
            if (count > 500) {
                textInput.value = textInput.value.substring(0, 500);
                charCount.textContent = '500';
                charCount.style.color = '#ff6b6b';
            } else if (count > 450) {
                charCount.style.color = '#ff9966';
            } else {
                charCount.style.color = 'white';
            }
        }

        // Thêm ví dụ mẫu
        function addExamples() {
            const examples = [
                {text: "Tình yêu", desc: "Cụm từ phổ biến"},
                {text: "Hạnh phúc", desc: "Từ có dấu đầy đủ"},
                {text: "Việt Nam", desc: "Tên đất nước"},
                {text: "Thành công", desc: "Từ có dấu hỏi, huyền"}
            ];
            
            const examplesDiv = document.createElement('div');
            examplesDiv.style.marginTop = '15px';
            examplesDiv.style.padding = '10px';
            examplesDiv.style.background = 'rgba(255,255,255,0.1)';
            examplesDiv.style.borderRadius = '8px';
            
            let examplesHtml = '<div style="font-weight: bold; margin-bottom: 8px; color: #FFD700;">Ví dụ nhanh:</div>';
            examples.forEach(example => {
                examplesHtml += `
                    <div style="margin: 5px 0; padding: 5px; background: rgba(255,255,255,0.1); border-radius: 4px; cursor: pointer;" 
                         onclick="textInput.value='${example.text}'; updateCharCount(); handleCalculate();">
                        <strong>${example.text}</strong> - ${example.desc}
                    </div>
                `;
            });
            
            examplesDiv.innerHTML = examplesHtml;
            document.querySelector('.input-section').appendChild(examplesDiv);
        }

        // Khởi tạo sự kiện
        function initEvents() {
            searchBtn.addEventListener('click', handleCalculate);
            clearBtn.addEventListener('click', handleClear);
            
            textInput.addEventListener('input', updateCharCount);
            
            textInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.ctrlKey) {
                    handleCalculate();
                }
            });
            
            modeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    changeMode(this.dataset.mode);
                });
            });
            
            clearHistoryBtn.addEventListener('click', clearHistory);
            
            // Tự động tính toán khi thay đổi chế độ nếu có văn bản
            modeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (textInput.value.trim() && resultSection.style.display === 'block') {
                        setTimeout(handleCalculate, 100);
                    }
                });
            });
        }

        // Khởi tạo ứng dụng
        function initApp() {
            initEvents();
            updateHistoryDisplay();
            addExamples();
            textInput.focus();
            
            // Thêm ví dụ mẫu vào lịch sử nếu chưa có
            if (searchHistory.length === 0) {
                const exampleText = "Tình yêu";
                const processed = processText(exampleText);
                addToHistory(exampleText, processed, 'xuoi');
            }
        }

        // Chạy ứng dụng khi trang đã tải xong
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>