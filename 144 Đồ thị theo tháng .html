<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tính Toán Can Chi và Vận Mệnh</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        
        h1, h2, h3 {
            color: #2c3e50;
            text-align: center;
        }
        
        h1 {
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .input-section {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 200px;
        }
        
        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        input, select, button {
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            font-size: 16px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: bold;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .tables-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .table-wrapper {
            overflow-x: auto;
            margin-bottom: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        th, td {
            border: 1px solid #bdc3c7;
            padding: 6px;
            text-align: center;
            min-width: 40px;
        }
        
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .result-section {
            background-color: #d5f4e6;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .result-card {
            background-color: #fff;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .chart-container {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        
        .chart {
            height: 300px;
            position: relative;
            border-bottom: 2px solid #333;
            border-left: 2px solid #333;
            margin: 30px 0 20px 40px;
            background-color: #fff;
        }
        
        .chart-point {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: #e74c3c;
            border-radius: 50%;
            transform: translate(-50%, 50%);
            z-index: 10;
            border: 2px solid #fff;
            box-shadow: 0 0 3px rgba(0,0,0,0.5);
        }
        
        .chart-line {
            position: absolute;
            height: 3px;
            background-color: #3498db;
            transform-origin: 0 0;
            z-index: 5;
        }
        
        .chart-label {
            position: absolute;
            font-size: 12px;
            font-weight: bold;
        }
        
        .people-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            padding: 5px;
            margin-top: 10px;
        }
        
        .people-item {
            padding: 8px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        
        .people-item:hover {
            background-color: #e3f2fd;
        }
        
        .highlight {
            background-color: #ffeb3b !important;
            font-weight: bold;
        }
        
        .number-1 {
            background-color: #ffeb3b !important;
            font-weight: bold;
        }
        
        .age-column {
            background-color: #e8f4f8 !important;
        }
        
        @media (max-width: 768px) {
            .tables-container {
                grid-template-columns: 1fr;
            }
            
            .input-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .chart {
                margin-left: 30px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Tính Toán Can Chi và Vận Mệnh</h1>
        
        <div class="input-section">
            <div class="input-group">
                <label for="birthdate">Ngày tháng năm sinh:</label>
                <input type="date" id="birthdate" value="1971-03-03">
            </div>
            
            <div class="input-group">
                <label for="fullname">Họ và tên:</label>
                <input type="text" id="fullname" placeholder="Nhập họ tên đầy đủ" value="NGUYENMINHNAM">
            </div>
            
            <div class="input-group">
                <label>Danh sách người nhà:</label>
                <select id="people-select">
                    <option value="">Chọn từ danh sách</option>
                    <!-- Danh sách sẽ được thêm bằng JavaScript -->
                </select>
                <div class="people-list" id="people-list">
                    <!-- Danh sách sẽ được thêm bằng JavaScript -->
                </div>
            </div>
            
            <div class="input-group">
                <button id="calculate-btn">Tính Toán</button>
            </div>
        </div>
        
        <div class="result-section" id="result-section" style="display: none;">
            <h3>Kết Quả Tính Toán</h3>
            <div class="result-grid">
                <div class="result-card">
                    <h4>Thông Tin Cá Nhân</h4>
                    <p id="personal-info"></p>
                </div>
                <div class="result-card">
                    <h4>Can Chi Năm Sinh</h4>
                    <p id="canchi-result"></p>
                </div>
                <div class="result-card">
                    <h4>Số Từ Tên</h4>
                    <p id="name-number"></p>
                </div>
            </div>
            
            <div class="result-grid">
                <div class="result-card">
                    <h4>Tiền Vận</h4>
                    <p id="tien-van"></p>
                </div>
                <div class="result-card">
                    <h4>Trung Vận</h4>
                    <p id="trung-van"></p>
                </div>
                <div class="result-card">
                    <h4>Hậu Vận</h4>
                    <p id="hau-van"></p>
                </div>
            </div>
        </div>
        
        <h2>Bảng Tra Cứu</h2>
        
        <div class="tables-container">
            <div class="table-wrapper">
                <h3>Bảng 1: Can Chi</h3>
                <table id="table1">
                    <thead>
                        <tr>
                            <th>Số</th>
                            <th>Can Chi</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <div class="table-wrapper">
                <h3>Bảng 2: Số Can Chi</h3>
                <table id="table2">
                    <thead>
                        <tr>
                            <th>Can Chi</th>
                            <th>Số</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <div class="table-wrapper">
                <h3>Bảng 3: Tính Toán Chi Tiết</h3>
                <table id="table3">
                    <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
                </table>
            </div>
        </div>
        
        <div class="table-wrapper">
            <h3>Bảng 4: Tổng Hợp Vận Mệnh</h3>
            <table id="table4">
                <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
            </table>
        </div>
        
        <div class="table-wrapper">
            <h3>Bảng 5: Đồ Thị Vận Mệnh</h3>
            <div class="chart-container">
                <div class="chart" id="chart"></div>
            </div>
            <table id="table5">
                <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
            </table>
        </div>
        
        <div class="tables-container">
            <div class="table-wrapper">
                <h3>Bảng 6: Giải Nghĩa Số</h3>
                <table id="table6">
                    <thead>
                        <tr>
                            <th>Số</th>
                            <th>Ý Nghĩa</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <div class="table-wrapper">
                <h3>Bảng 7: Sinh</h3>
                <table id="table7">
                    <thead>
                        <tr>
                            <th>Số</th>
                            <th>Ý Nghĩa</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <div class="table-wrapper">
                <h3>Bảng 8: Sinh - Lão - Bệnh - Tử</h3>
                <table id="table8">
                    <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
                </table>
            </div>
            
            <div class="table-wrapper">
                <h3>Bảng 9: Đối Số</h3>
                <table id="table9">
                    <thead>
                        <tr>
                            <th>Số</th>
                            <th>Đối Số</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Dữ liệu mẫu
        const peopleData = [
            { name: "NGUYENKHACNANG", dob: "1944-06-04" },
            { name: "TOTHIHA", dob: "1948-08-29" },
            { name: "NGUYENMINHNAM", dob: "1971-03-03" },
            { name: "THANTHIKIMANH", dob: "1981-09-23" },
            { name: "NGUYENTONGANAN", dob: "2014-09-28" },
            { name: "NGUYENTOMINHCHAU", dob: "2016-07-25" },
            { name: "NGUYENTOBICHNGOC", dob: "2020-02-05" },
            { name: "NGUYENTHIMINHHANG", dob: "1974-01-07" },
            { name: "NGOQUYCUONG", dob: "1973-05-23" },
            { name: "NGOGIABACH", dob: "2000-10-12" },
            { name: "NGOGIALINH", dob: "2005-04-05" },
            { name: "NGUYENTHIMINHPHUONG", dob: "1978-11-06" },
            { name: "HOANGANHDUNG", dob: "1978-09-21" },
            { name: "HOANGHAIVINH", dob: "2010-06-03" },
            { name: "HOANGTHIENBACHANH", dob: "2015-11-14" },
            { name: "NGUYỄN THỊ CHI", dob: "1945-04-29" },
            { name: "TÔ KIM HUỆ", dob: "1960-08-09" },
            { name: "NGUYỄN TUẤN ANH", dob: "1993-10-23" },
            { name: "NGUYỄN THẾ ANH", dob: "2001-03-24" },
            { name: "VŨ VĂN HIỆP", dob: "1974-04-24" },
            { name: "NGÔ THỊ MAI", dob: "1948-12-12" },
            { name: "TÔ VIỆT HƯNG", dob: "1996-06-17" },
            { name: "TÔ THỊ HỒNG", dob: "1964-10-10" },
            { name: "NGUYỄN TẤN BẮC", dob: "1957-02-18" },
            { name: "NGUYỄN THỊ TÂM", dob: "1953-10-27" }
        ];

        // Bảng dữ liệu
        const table1Data = [
            { number: 4, canchi: "TÝ" },
            { number: 10, canchi: "NGỌ" },
            { number: 5, canchi: "SỬU" },
            { number: 11, canchi: "MÙI" },
            { number: 6, canchi: "DẦN" },
            { number: 12, canchi: "THÂN" },
            { number: 7, canchi: "MÃO" },
            { number: 1, canchi: "DẬU" },
            { number: 8, canchi: "THÌN" },
            { number: 2, canchi: "TUẤT" },
            { number: 9, canchi: "TỴ" },
            { number: 3, canchi: "HỢI" }
        ];

        const table2Data = [
            { canchi: "TÝ", number: 1 },
            { canchi: "NGỌ", number: 1 },
            { canchi: "SỬU", number: 2 },
            { canchi: "MÙI", number: 2 },
            { canchi: "DẦN", number: 3 },
            { canchi: "THÂN", number: 3 },
            { canchi: "MÃO", number: 4 },
            { canchi: "DẬU", number: 4 },
            { canchi: "THÌN", number: 5 },
            { canchi: "TUẤT", number: 5 },
            { canchi: "TỴ", number: 6 },
            { canchi: "HỢI", number: 6 }
        ];

        const table6Data = [
            { number: 1, meaning: "May mắn XO SO" },
            { number: 2, meaning: "Thăng chức" },
            { number: 3, meaning: "Tài sản" },
            { number: 4, meaning: "Bất động sản" },
            { number: 5, meaning: "Vui sướng" },
            { number: 6, meaning: "Chết, Hóa thân" },
            { number: 7, meaning: "Làm ăn, sản xuất" },
            { number: 8, meaning: "Mua bán nhỏ" },
            { number: 9, meaning: "Bằng cấp" },
            { number: 10, meaning: "Xa nhà" },
            { number: 11, meaning: "Day dứt" },
            { number: 12, meaning: "Đau bại" }
        ];

        // Bảng 5: Các ý nghĩa cho Tiền vận, Trung vận, Hậu vận
        const table5MeaningData = [
            { number: 1, meaning: "Đại phát tài" },
            { number: 2, meaning: "Quyền lực" },
            { number: 3, meaning: "Giàu có" },
            { number: 4, meaning: "Của cải" },
            { number: 5, meaning: "Hạnh phúc" },
            { number: 6, meaning: "Tai nạn" },
            { number: 7, meaning: "Hợp tác, LD" },
            { number: 8, meaning: "Tiểu thương" },
            { number: 9, meaning: "Học vấn" },
            { number: 10, meaning: "Xuất ngoại" },
            { number: 11, meaning: "Khổ tâm" },
            { number: 12, meaning: "Bệnh tật" }
        ];

        const table7Data = [
            { number: 1, meaning: "Sinh - Lãnh đạo, Quản lý - Đứng đầu, Tổ chức" }
        ];

        const table8Data = [
            { number: 1, sinh: "Sinh", pho: "Lãnh đạo, Quản lý", troly: "Đứng đầu, Tổ chức" },
            { number: 2, sinh: "Lão", pho: "Phó, Quân sư", troly: "Trợ lý" },
            { number: 3, sinh: "Bệnh", pho: "Ốm đau", troly: "CNV" },
            { number: 4, sinh: "Tử", pho: "Rất có tài, Chết bất đắc kỳ tử, Không đứng đầu", troly: "Đòi nợ, phá sản - Ko gom vốn" }
        ];

        const table9Data = [
            { number: 12, opposite: 1 },
            { number: 11, opposite: 2 },
            { number: 10, opposite: 3 },
            { number: 9, opposite: 4 },
            { number: 8, opposite: 5 },
            { number: 7, opposite: 6 },
            { number: 6, opposite: 7 },
            { number: 5, opposite: 8 },
            { number: 4, opposite: 9 },
            { number: 3, opposite: 10 },
            { number: 2, opposite: 11 },
            { number: 1, opposite: 12 }
        ];

        // Khởi tạo dữ liệu
        document.addEventListener('DOMContentLoaded', function() {
            // Khởi tạo danh sách người
            initializePeopleList();
            
            // Khởi tạo các bảng
            initializeTable1();
            initializeTable2();
            initializeTable6();
            initializeTable7();
            initializeTable8();
            initializeTable9();
            
            // Gắn sự kiện
            document.getElementById('calculate-btn').addEventListener('click', calculate);
            document.getElementById('people-select').addEventListener('change', selectPerson);
            
            // Tính toán ngay khi tải trang
            setTimeout(calculate, 100);
        });

        function initializePeopleList() {
            const select = document.getElementById('people-select');
            const list = document.getElementById('people-list');
            
            peopleData.forEach(person => {
                // Thêm vào select
                const option = document.createElement('option');
                option.value = person.dob;
                option.textContent = `${person.name} (${formatDate(person.dob)})`;
                select.appendChild(option);
                
                // Thêm vào danh sách cuộn
                const item = document.createElement('div');
                item.className = 'people-item';
                item.textContent = `${person.name} (${formatDate(person.dob)})`;
                item.addEventListener('click', () => {
                    document.getElementById('birthdate').value = person.dob;
                    document.getElementById('fullname').value = person.name;
                    select.value = person.dob;
                    calculate();
                });
                list.appendChild(item);
            });
        }

        function selectPerson() {
            const selectedValue = document.getElementById('people-select').value;
            if (selectedValue) {
                const person = peopleData.find(p => p.dob === selectedValue);
                if (person) {
                    document.getElementById('birthdate').value = person.dob;
                    document.getElementById('fullname').value = person.name;
                    calculate();
                }
            }
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
        }

        function initializeTable1() {
            const tbody = document.querySelector('#table1 tbody');
            table1Data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${item.number}</td><td>${item.canchi}</td>`;
                tbody.appendChild(row);
            });
        }

        function initializeTable2() {
            const tbody = document.querySelector('#table2 tbody');
            table2Data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${item.canchi}</td><td>${item.number}</td>`;
                tbody.appendChild(row);
            });
        }

        function initializeTable6() {
            const tbody = document.querySelector('#table6 tbody');
            table6Data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${item.number}</td><td>${item.meaning}</td>`;
                tbody.appendChild(row);
            });
        }

        function initializeTable7() {
            const tbody = document.querySelector('#table7 tbody');
            table7Data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${item.number}</td><td>${item.meaning}</td>`;
                tbody.appendChild(row);
            });
        }

        function initializeTable8() {
            const table = document.getElementById('table8');
            // Tạo tiêu đề
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr>
                    <th>Số</th>
                    <th>Sinh</th>
                    <th>Phó</th>
                    <th>Trợ lý</th>
                </tr>
            `;
            table.appendChild(thead);
            
            // Tạo thân bảng
            const tbody = document.createElement('tbody');
            table8Data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.number}</td>
                    <td>${item.sinh}</td>
                    <td>${item.pho}</td>
                    <td>${item.troly}</td>
                `;
                tbody.appendChild(row);
            });
            table.appendChild(tbody);
        }

        function initializeTable9() {
            const tbody = document.querySelector('#table9 tbody');
            table9Data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${item.number}</td><td>${item.opposite}</td>`;
                tbody.appendChild(row);
            });
        }

        function calculate() {
            const birthdate = document.getElementById('birthdate').value;
            const fullname = document.getElementById('fullname').value.trim();
            
            if (!birthdate) {
                alert('Vui lòng nhập ngày tháng năm sinh');
                return;
            }
            
            // Hiển thị kết quả
            document.getElementById('result-section').style.display = 'block';
            
            // Lấy thông tin từ ngày sinh
            const date = new Date(birthdate);
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            
            // Tính Can Chi năm
            let yearMod = year % 12;
            if (yearMod === 0) yearMod = 12;
            
            // Tìm Can Chi từ bảng 1
            const canchiItem = table1Data.find(item => item.number === yearMod);
            const canchi = canchiItem ? canchiItem.canchi : "Không xác định";
            
            // Tìm số từ bảng 2
            const numberItem = table2Data.find(item => item.canchi === canchi);
            const canchiNumber = numberItem ? numberItem.number : 1;
            
            // Tính toán bảng 3
            calculateTable3(year, month, day, canchiNumber);
            
            // Tính toán bảng 4
            calculateTable4();
            
            // Tính toán bảng 5 - SỬA: bắt đầu từ 12 tuổi, năm đầu tiên là năm sinh + 12
            calculateTable5(year);
            
            // Hiển thị thông tin cá nhân
            document.getElementById('personal-info').textContent = 
                `Ngày sinh: ${formatDate(birthdate)} (${day}/${month}/${year})`;
            
            document.getElementById('canchi-result').textContent = 
                `Năm ${year} mod 12 = ${yearMod} → ${canchi} (Số ${canchiNumber})`;
            
            // Tính số từ tên
            if (fullname) {
                // Đếm số chữ cái (không tính khoảng trắng)
                const letterCount = fullname.replace(/\s+/g, '').length;
                const nameMod = letterCount % 4 || 4;
                
                document.getElementById('name-number').textContent = 
                    `Tên: ${fullname} - Số chữ: ${letterCount} - mod 4 = ${nameMod}`;
                
                // Hiển thị thông tin từ bảng 8
                const table8Item = table8Data.find(item => item.number === nameMod);
                if (table8Item) {
                    document.getElementById('name-number').textContent += 
                        ` → ${table8Item.sinh} - ${table8Item.pho}`;
                }
            } else {
                document.getElementById('name-number').textContent = "Chưa nhập tên";
            }
            
            // Tính toán và hiển thị các vận
            calculateVanMenh();
            
            // Vẽ biểu đồ
            drawChart();
        }

        function calculateTable3(year, month, day, canchiNumber) {
            const table3 = document.getElementById('table3');
            table3.innerHTML = '';
            
            // Tạo tiêu đề
            const headerRow = document.createElement('tr');
            headerRow.innerHTML = '<th></th>';
            for (let i = 1; i <= 12; i++) {
                headerRow.innerHTML += `<th>${i}</th>`;
            }
            table3.appendChild(headerRow);
            
            // Dòng 1: Năm can chi - CHỈ CÓ 6 CỘT ĐẦU, 6 CỘT SAU BỎ TRỐNG
            const row1 = document.createElement('tr');
            row1.innerHTML = '<td>1. Năm can chi</td>';
            let yearValues = [];
            for (let i = 0; i < 12; i++) {
                if (i < 6) {
                    const value = canchiNumber + i;
                    yearValues.push(value <= 12 ? value : value - 12);
                } else {
                    yearValues.push('');
                }
                row1.innerHTML += `<td>${yearValues[i]}</td>`;
            }
            table3.appendChild(row1);
            
            // Dòng 2: Tháng sinh
            const row2 = document.createElement('tr');
            row2.innerHTML = '<td>2. Tháng sinh</td>';
            let monthValues = [];
            for (let i = 0; i < 12; i++) {
                let value = month + i;
                if (value > 12) value -= 12;
                monthValues.push(value);
                row2.innerHTML += `<td>${value}</td>`;
            }
            table3.appendChild(row2);
            
            // Dòng 3: Ngày sinh
            const row3 = document.createElement('tr');
            row3.innerHTML = '<td>3. Ngày sinh</td>';
            let dayValues = [];
            for (let i = 0; i < 12; i++) {
                let value = day % 12 + i;
                if (value > 12) value -= 12;
                if (value === 0) value = 12;
                dayValues.push(value);
                row3.innerHTML += `<td>${value}</td>`;
            }
            table3.appendChild(row3);
            
            // Dòng 4: Cộng
            const row4 = document.createElement('tr');
            row4.innerHTML = '<td>4. Cộng</td>';
            let sumValues = [];
            for (let i = 0; i < 12; i++) {
                // Nếu yearValues[i] là rỗng thì coi như 0
                const yearVal = yearValues[i] === '' ? 0 : yearValues[i];
                const sum = yearVal + monthValues[i] + dayValues[i];
                sumValues.push(sum);
                row4.innerHTML += `<td>${sum}</td>`;
            }
            table3.appendChild(row4);
            
            // Dòng 5: Chia số dư
            const row5 = document.createElement('tr');
            row5.innerHTML = '<td>5. Chia số dư</td>';
            let modValues = [];
            for (let i = 0; i < 12; i++) {
                const mod = sumValues[i] % 12 || 12;
                modValues.push(mod);
                row5.innerHTML += `<td>${mod}</td>`;
            }
            table3.appendChild(row5);
            
            // Dòng 6: Tổng (đối số từ bảng 9)
            const row6 = document.createElement('tr');
            row6.innerHTML = '<td>6. Tổng</td>';
            let totalValues = [];
            for (let i = 0; i < 12; i++) {
                const mod = modValues[i];
                const oppositeItem = table9Data.find(item => item.number === mod);
                const opposite = oppositeItem ? oppositeItem.opposite : mod;
                totalValues.push(opposite);
                row6.innerHTML += `<td>${opposite}</td>`;
            }
            table3.appendChild(row6);
            
            // Lưu giá trị để sử dụng sau
            window.table3Data = {
                yearValues,
                monthValues,
                dayValues,
                sumValues,
                modValues,
                totalValues
            };
        }

        function calculateTable4() {
            const table4 = document.getElementById('table4');
            table4.innerHTML = '';
            
            if (!window.table3Data) return;
            
            const { modValues } = window.table3Data;
            
            // Tính tổng cho các nhóm
            const sumGroup1 = modValues.slice(0, 4).reduce((a, b) => a + b, 0);
            const sumGroup2 = modValues.slice(4, 8).reduce((a, b) => a + b, 0);
            const sumGroup3 = modValues.slice(8, 12).reduce((a, b) => a + b, 0);
            
            // Tính số dư (lấy mod 12, nếu 0 thì = 12)
            const modGroup1 = sumGroup1 % 12 || 12;
            const modGroup2 = sumGroup2 % 12 || 12;
            const modGroup3 = sumGroup3 % 12 || 12;
            
            // Tra bảng 5 để lấy ý nghĩa
            const meaningItem1 = table5MeaningData.find(item => item.number === modGroup1);
            const meaningItem2 = table5MeaningData.find(item => item.number === modGroup2);
            const meaningItem3 = table5MeaningData.find(item => item.number === modGroup3);
            
            // Tạo bảng 4
            const headerRow = document.createElement('tr');
            headerRow.innerHTML = `
                <th></th>
                <th>TIỀN VẬN</th>
                <th>TRUNG VẬN</th>
                <th>HẬU VẬN</th>
            `;
            table4.appendChild(headerRow);
            
            // Dòng 1: Tổng số
            const row1 = document.createElement('tr');
            row1.innerHTML = `
                <td>Tổng số</td>
                <td>${sumGroup1}</td>
                <td>${sumGroup2}</td>
                <td>${sumGroup3}</td>
            `;
            table4.appendChild(row1);
            
            // Dòng 2: Số dư
            const row2 = document.createElement('tr');
            row2.innerHTML = `
                <td>Số dư</td>
                <td>${modGroup1}</td>
                <td>${modGroup2}</td>
                <td>${modGroup3}</td>
            `;
            table4.appendChild(row2);
            
            // Dòng 3: Ý nghĩa (tra bảng 5)
            const row3 = document.createElement('tr');
            row3.innerHTML = `
                <td>Ý nghĩa (Bảng 5)</td>
                <td>${meaningItem1 ? meaningItem1.meaning : ''}</td>
                <td>${meaningItem2 ? meaningItem2.meaning : ''}</td>
                <td>${meaningItem3 ? meaningItem3.meaning : ''}</td>
            `;
            table4.appendChild(row3);
            
            // Dòng 4: Số nhà, số tầng, số phòng (theo ví dụ)
            const row4 = document.createElement('tr');
            row4.innerHTML = `
                <td>Số nhà/Số tầng/Số phòng</td>
                <td>${modGroup1}</td>
                <td>${modGroup2}</td>
                <td>${modGroup3}</td>
            `;
            table4.appendChild(row4);
            
            // Dòng 5: Ý nghĩa từ bảng 5 (theo ví dụ)
            const row5 = document.createElement('tr');
            row5.innerHTML = `
                <td></td>
                <td>${meaningItem1 ? meaningItem1.meaning : ''}</td>
                <td>${meaningItem2 ? meaningItem2.meaning : ''}</td>
                <td>${meaningItem3 ? meaningItem3.meaning : ''}</td>
            `;
            table4.appendChild(row5);
            
            // Lưu kết quả để hiển thị
            window.vanMenhData = {
                tienVan: { sum: sumGroup1, mod: modGroup1, meaning: meaningItem1 ? meaningItem1.meaning : '' },
                trungVan: { sum: sumGroup2, mod: modGroup2, meaning: meaningItem2 ? meaningItem2.meaning : '' },
                hauVan: { sum: sumGroup3, mod: modGroup3, meaning: meaningItem3 ? meaningItem3.meaning : '' }
            };
        }

        function calculateTable5(birthYear) {
            const table5 = document.getElementById('table5');
            table5.innerHTML = '';
            
            // Tạo tiêu đề - SỬA THEO YÊU CẦU: bắt đầu từ 12 tuổi
            const headerRow1 = document.createElement('tr');
            headerRow1.innerHTML = '<th>STT</th>';
            // Tạo 14 cột bắt đầu từ 12 tuổi: 12, 18, 24, 30, 36, 42, 48, 54, 60, 66, 72, 78, 84, 90
            const ageColumns = [12, 18, 24, 30, 36, 42, 48, 54, 60, 66, 72, 78, 84, 90];
            ageColumns.forEach(age => {
                headerRow1.innerHTML += `<th class="age-column">${age}</th>`;
            });
            table5.appendChild(headerRow1);
            
            // Dòng 2: Năm tương ứng - SỬA THEO YÊU CẦU: bắt đầu từ 1983 (1971 + 12)
            const headerRow2 = document.createElement('tr');
            headerRow2.innerHTML = '<td>Năm</td>';
            // Tính năm tương ứng: bắt đầu từ birthYear + 12, sau đó mỗi cột thêm 6 năm
            ageColumns.forEach(age => {
                const year = birthYear + age;
                headerRow2.innerHTML += `<td>${year}</td>`;
            });
            table5.appendChild(headerRow2);
            
            // Tạo các dòng cho 12 số (theo bảng 5 mẫu)
            const meanings = table5MeaningData;
            
            if (!window.table3Data) return;
            
            const { totalValues } = window.table3Data;
            
            // Lưu vị trí các số 1 để vẽ biểu đồ
            window.chartPoints = [];
            
            // Tạo 12 dòng tương ứng với 12 ý nghĩa
            for (let i = 0; i < 12; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${i+1}. ${meanings[i].meaning}</td>`;
                
                // Hiển thị giá trị tại các cột tương ứng
                for (let j = 0; j < 14; j++) {
                    let display = '';
                    // Logic hiển thị: nếu totalValues có giá trị tại vị trí j và giá trị đó = i+1
                    if (j < totalValues.length && totalValues[j] === i+1) {
                        display = i+1;
                        
                        // Lưu vị trí các điểm có giá trị 1 (chỉ lưu cho dòng 1 - Đại phát tài)
                        if (i === 0) { // Dòng 1: Đại phát tài
                            window.chartPoints.push({
                                x: j,
                                value: i+1,
                                year: birthYear + ageColumns[j], // Tính năm tương ứng
                                age: ageColumns[j] // Tính tuổi tương ứng
                            });
                        }
                    }
                    
                    // Nếu là số 1 thì tô màu nền
                    if (display === 1) {
                        row.innerHTML += `<td class="number-1">${display}</td>`;
                    } else {
                        row.innerHTML += `<td>${display}</td>`;
                    }
                }
                
                table5.appendChild(row);
            }
            
            // Dòng cuối: Năm tương ứng cho giai đoạn sau
            const footerRow1 = document.createElement('tr');
            footerRow1.innerHTML = '<td>Năm</td>';
            const extendedAges = [96, 102, 108, 114, 120, 126, 132, 138, 144, 150, 156, 162, 168];
            extendedAges.forEach(age => {
                const year = birthYear + age;
                footerRow1.innerHTML += `<td>${year}</td>`;
            });
            table5.appendChild(footerRow1);
            
            const footerRow2 = document.createElement('tr');
            footerRow2.innerHTML = '<td>Tuổi</td>';
            extendedAges.forEach(age => {
                footerRow2.innerHTML += `<td>${age}</td>`;
            });
            table5.appendChild(footerRow2);
        }

        function calculateVanMenh() {
            if (!window.vanMenhData) return;
            
            const { tienVan, trungVan, hauVan } = window.vanMenhData;
            
            document.getElementById('tien-van').innerHTML = `
                Tổng: ${tienVan.sum} → Số dư: ${tienVan.mod}<br>
                <strong>${tienVan.meaning}</strong>
            `;
            
            document.getElementById('trung-van').innerHTML = `
                Tổng: ${trungVan.sum} → Số dư: ${trungVan.mod}<br>
                <strong>${trungVan.meaning}</strong>
            `;
            
            document.getElementById('hau-van').innerHTML = `
                Tổng: ${hauVan.sum} → Số dư: ${hauVan.mod}<br>
                <strong>${hauVan.meaning}</strong>
            `;
        }

        function drawChart() {
            const chart = document.getElementById('chart');
            chart.innerHTML = '';
            
            if (!window.chartPoints || window.chartPoints.length === 0) {
                chart.innerHTML = '<div style="text-align:center; padding:50px;">Không có dữ liệu số 1 để vẽ biểu đồ</div>';
                return;
            }
            
            const points = window.chartPoints;
            const chartWidth = chart.offsetWidth - 50;
            const chartHeight = chart.offsetHeight - 20;
            
            // Tính tỷ lệ cho trục Y (giá trị từ 1-12)
            const yScale = chartHeight / 12;
            
            // Tính tỷ lệ cho trục X (14 cột)
            const xScale = chartWidth / 14;
            
            // Vẽ trục Y (giá trị)
            for (let i = 1; i <= 12; i++) {
                const y = chartHeight - (i * yScale);
                const label = document.createElement('div');
                label.className = 'chart-label';
                label.textContent = i;
                label.style.left = '-25px';
                label.style.top = `${y}px`;
                chart.appendChild(label);
                
                // Đường kẻ ngang
                const line = document.createElement('div');
                line.style.position = 'absolute';
                line.style.left = '0';
                line.style.top = `${y}px`;
                line.style.width = '100%';
                line.style.height = '1px';
                line.style.backgroundColor = '#ddd';
                line.style.zIndex = '1';
                chart.appendChild(line);
            }
            
            // Vẽ trục X (tuổi/năm)
            const ageColumns = [12, 18, 24, 30, 36, 42, 48, 54, 60, 66, 72, 78, 84, 90];
            for (let i = 0; i < ageColumns.length; i++) {
                const x = i * xScale;
                const label = document.createElement('div');
                label.className = 'chart-label';
                label.textContent = ageColumns[i];
                label.style.left = `${x}px`;
                label.style.top = `${chartHeight + 10}px`;
                label.style.transform = 'translateX(-50%)';
                chart.appendChild(label);
                
                // Đường kẻ dọc
                const line = document.createElement('div');
                line.style.position = 'absolute';
                line.style.left = `${x}px`;
                line.style.top = '0';
                line.style.width = '1px';
                line.style.height = '100%';
                line.style.backgroundColor = '#ddd';
                line.style.zIndex = '1';
                chart.appendChild(line);
            }
            
            // Vẽ các điểm
            const pointElements = [];
            
            points.forEach(point => {
                const x = point.x * xScale;
                const y = chartHeight - (point.value * yScale);
                
                const pointEl = document.createElement('div');
                pointEl.className = 'chart-point';
                pointEl.style.left = `${x}px`;
                pointEl.style.top = `${y}px`;
                pointEl.title = `Tuổi ${point.age} (năm ${point.year}): Đại phát tài`;
                
                const label = document.createElement('div');
                label.className = 'chart-label';
                label.textContent = point.value;
                label.style.left = `${x}px`;
                label.style.top = `${y - 20}px`;
                label.style.transform = 'translateX(-50%)';
                label.style.backgroundColor = '#fff';
                label.style.padding = '2px 5px';
                label.style.borderRadius = '3px';
                label.style.border = '1px solid #ccc';
                
                chart.appendChild(pointEl);
                chart.appendChild(label);
                
                pointElements.push({ x, y, point });
            });
            
            // Vẽ đường nối các điểm - CHỈ nối các điểm có số 1
            for (let i = 0; i < pointElements.length - 1; i++) {
                const p1 = pointElements[i];
                const p2 = pointElements[i + 1];
                
                const line = document.createElement('div');
                line.className = 'chart-line';
                line.style.left = `${p1.x}px`;
                line.style.top = `${p1.y}px`;
                
                const dx = p2.x - p1.x;
                const dy = p2.y - p1.y;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                
                line.style.width = `${length}px`;
                line.style.transform = `rotate(${angle}deg)`;
                
                chart.appendChild(line);
            }
            
            // Thêm tiêu đề cho biểu đồ
            const title = document.createElement('div');
            title.className = 'chart-label';
            title.textContent = 'Biểu đồ Đại phát tài (số 1)';
            title.style.left = '50%';
            title.style.top = '-30px';
            title.style.transform = 'translateX(-50%)';
            title.style.fontSize = '14px';
            title.style.fontWeight = 'bold';
            chart.appendChild(title);
        }
    </script>
</body>
</html>