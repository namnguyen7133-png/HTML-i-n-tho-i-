<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MealMatch ‚Äî 2 ng√†y/m√πa (Mobile) ‚Äî ƒê·ªãnh l∆∞·ª£ng & √Çm/D∆∞∆°ng</title>
  <style>
    :root{--bg:#071028;--card:#0b1220;--muted:#9fb0c8;--accent:#06b6d4;--accent2:#10b981}
    *{box-sizing:border-box;font-family:Inter,system-ui,Arial,sans-serif}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#031026 0%, #05223a 70%);color:#e6eef6}
    .phone{width:360px;margin:20px auto;border-radius:28px;overflow:hidden;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 20px 60px rgba(2,6,23,0.7);border:1px solid rgba(255,255,255,0.03)}
    header{padding:14px 16px;border-bottom:1px solid rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:space-between}
    h1{font-size:16px;margin:0}
    .sub{font-size:12px;color:var(--muted)}
    .content{padding:12px}
    .row{display:flex;gap:10px;align-items:center}
    select,input,button{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px;border-radius:10px}
    button.primary{background:linear-gradient(90deg,var(--accent2),var(--accent));color:#012;font-weight:700;border:none}
    .panel{background:rgba(255,255,255,0.02);padding:10px;border-radius:12px;margin-top:12px}
    .meal{display:flex;align-items:flex-start;gap:10px;padding:10px;border-radius:10px;background:rgba(255,255,255,0.01);margin-bottom:8px}
    .time{min-width:52px;font-weight:700}
    .meal-list{flex:1}
    .food{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed rgba(255,255,255,0.02);font-size:14px}
    .muted{color:var(--muted);font-size:12px}
    .summary{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    .shop-list{margin-top:8px}
    .shop-item{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.02)}
    .yin{color:#60a5fa} .yang{color:#fb7185} .neutral{color:#f59e0b}
    footer{padding:10px;text-align:center;color:var(--muted);font-size:12px}
    .tabs{display:flex;gap:8px;margin-top:8px}
    .tab{flex:1;text-align:center;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);cursor:pointer}
    .tab.active{background:linear-gradient(90deg,var(--accent2),var(--accent));color:#012;font-weight:700}
    .small{font-size:12px;color:var(--muted)}
    .controls-row{display:flex;gap:8px;align-items:center;margin-top:8px}
    .badge{padding:4px 8px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:12px}
    .totals{margin-top:8px;border-top:1px dashed rgba(255,255,255,0.03);padding-top:8px}
    @media (min-width:900px){.phone{width:420px}}
  </style>
</head>
<body>
  <div class="phone" role="application" aria-label="K·∫ø ho·∫°ch ƒÉn theo m√πa 2 ng√†y">
    <header>
      <div>
        <h1>MealMatch ‚Äî 2 ng√†y/m√πa</h1>
        <div class="sub">M·ªói m√πa c√≥ 2 ng√†y kh√°c nhau ‚Äî 3 b·ªØa/ng√†y: 08:00 ‚Ä¢ 12:00 ‚Ä¢ 16:00</div>
      </div>
      <div>
        <select id="season">
          <option value="spring">üå∏ Xu√¢n</option>
          <option value="summer">‚òÄÔ∏è H√®</option>
          <option value="autumn">üçÇ Thu</option>
          <option value="winter">‚ùÑÔ∏è ƒê√¥ng</option>
          <option value="all">üåä Quanh nƒÉm</option>
        </select>
      </div>
    </header>

    <div class="content">
      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Ch·ªçn ng√†y trong m√πa</strong>
          <div class="small">Ch·ªçn "C·∫£ 2 ng√†y" khi mu·ªën t√≠nh mua c·∫£ hai ng√†y</div>
        </div>
        <div class="tabs" role="tablist" aria-label="Ch·ªçn ng√†y">
          <div class="tab active" data-day="A">Ng√†y A</div>
          <div class="tab" data-day="B">Ng√†y B</div>
          <div style="flex:0 0 8px"></div>
          <select id="mode" aria-label="Ch·∫ø ƒë·ªô t√≠nh">
            <option value="single">Ch·ªâ ng√†y ƒë√£ ch·ªçn</option>
            <option value="both">T√≠nh c·∫£ 2 ng√†y</option>
          </select>
        </div>
      </div>

      <div class="panel" id="mealsPanel">
        <!-- meals for selected day(s) rendered here -->
      </div>

      <div class="panel" id="shoppingPanel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Danh s√°ch mua & T·ªïng n·∫•u</strong>
          <button id="calc" class="primary">T√≠nh to√°n</button>
        </div>
        <div id="shopList" class="shop-list small"></div>
        <div id="shopTotal" class="summary small" style="margin-top:8px;display:none"><div>T·ªïng ∆∞·ªõc l∆∞·ª£ng:</div><div id="totalPrice">0 ‚Ç´</div></div>
        <div id="cookTotals" class="totals small" style="display:none"></div>
      </div>

      <div class="panel">
        <div><strong>Ghi ch√∫:</strong></div>
        <div class="small" style="margin-top:6px">M·ªói m√≥n s·∫Ω hi·ªÉn th·ªã <strong>ƒë·ªãnh l∆∞·ª£ng tr√™n m·ªói b·ªØa</strong> (gram), c√πng nh√£n <em>√Çm/D∆∞∆°ng/Trung t√≠nh</em>. Ph·∫ßn "T·ªïng n·∫•u" cho bi·∫øt t·ªïng l∆∞·ª£ng n·∫•u cho c·∫£ ng√†y (ho·∫∑c c·∫£ 2 ng√†y n·∫øu ch·ªçn), v√† khuy·∫øn ngh·ªã s·ªë kg ƒë·ªÉ mua.</div>
      </div>
    </div>

    <footer>Mu·ªën xu·∫•t CSV/PDF danh s√°ch mua hay ƒëi·ªÅu ch·ªânh ƒë·ªãnh l∆∞·ª£ng t·ª´ng b·ªØa (v√≠ d·ª• s√°ng 120g c∆°m, tr∆∞a 200g...) kh√¥ng? Ch·ªâ m√¨nh bi·∫øt.</footer>
  </div>

  <script>
    // D·ªØ li·ªáu: rau theo m√πa
    const seasonVeg = {
      spring: ['C·∫£i ch√≠p','Rau c·∫£i ng·ªçt','Su h√†o','C·ªß c·∫£i','C·∫£i xoƒÉn','Rau bina'],
      summer: ['M∆∞·ªõp ƒë·∫Øng','M·ªìng t∆°i','ƒêu ƒë·ªß','ƒê·∫≠u b·∫Øp','B√≠ xanh'],
      autumn: ['B√≠ ƒë·ªè','B√≠ xanh','Khoai lang'],
      winter: ['S√∫p l∆°','C√† r·ªët','Su h√†o','C·ªß c·∫£i','C·∫£i xoƒÉn','Rau bina'],
      all: ['Rong bi·ªÉn','T·∫£o bi·ªÉn']
    };

    // ƒê·ªãnh l∆∞·ª£ng g·ª£i √Ω (gram) m·ªói m√≥n khi xu·∫•t hi·ªán trong 1 b·ªØa ‚Äî c√≥ th·ªÉ tinh ch·ªânh
    const portionDefaults = { rau:150, ngugcoc:180, dau:80, thit:100, giavi:5 };

    // Gi√° ∆∞·ªõc t√≠nh (VND) trung b√¨nh m·ªói kg (khi ph√π h·ª£p)
    const priceMap = {
      'C·∫£i ch√≠p':20000,'Rau c·∫£i ng·ªçt':18000,'Su h√†o':16000,'C·ªß c·∫£i':15000,'C·∫£i xoƒÉn':35000,'Rau bina':30000,
      'M∆∞·ªõp ƒë·∫Øng':18000,'M·ªìng t∆°i':15000,'ƒêu ƒë·ªß':14000,'ƒê·∫≠u b·∫Øp':16000,'B√≠ xanh':12000,
      'B√≠ ƒë·ªè':20000,'Khoai lang':18000,'S√∫p l∆°':35000,'C√† r·ªët':22000,'Rong bi·ªÉn':50000,'T·∫£o bi·ªÉn':60000,
      'G·∫°o (c∆°m)':20000,'B√°nh m√¨':15000,'M√¨ (noodle)':18000,'Y·∫øn m·∫°ch':40000,
      'ƒê·∫≠u xanh':30000,'ƒê·∫≠u n√†nh':25000,'ƒê·∫≠u H√† Lan':35000,'ƒê·∫≠u ph·ª• (tofu)':20000,
      'Th·ªãt g√†':80000,'Th·ªãt l·ª£n':140000,'C√° h·ªìi':300000,'T√¥m':220000,
      'N∆∞·ªõc m·∫Øm (gia v·ªã)':40000,'Mu·ªëi & Ti√™u':20000,'T·ªèi':30000,'D·∫ßu √¥liu (gia v·ªã)':80000
    };

    // √Çm/D∆∞∆°ng
    const yinYang = { 'C·∫£i ch√≠p':'yin','Rau c·∫£i ng·ªçt':'yin','Su h√†o':'yang','C·ªß c·∫£i':'yang','C·∫£i xoƒÉn':'yin','Rau bina':'yin',
      'M∆∞·ªõp ƒë·∫Øng':'yin','M·ªìng t∆°i':'yin','ƒêu ƒë·ªß':'yin','ƒê·∫≠u b·∫Øp':'neutral','B√≠ xanh':'neutral',
      'B√≠ ƒë·ªè':'yang','Khoai lang':'yang','S√∫p l∆°':'yin','C√† r·ªët':'yang','Rong bi·ªÉn':'yin','T·∫£o bi·ªÉn':'yin',
      'G·∫°o (c∆°m)':'neutral','B√°nh m√¨':'neutral','M√¨ (noodle)':'neutral','Y·∫øn m·∫°ch':'neutral',
      'ƒê·∫≠u xanh':'neutral','ƒê·∫≠u n√†nh':'neutral','ƒê·∫≠u H√† Lan':'neutral','ƒê·∫≠u ph·ª• (tofu)':'yin',
      'Th·ªãt g√†':'yang','Th·ªãt l·ª£n':'yang','C√° h·ªìi':'neutral','T√¥m':'neutral','N∆∞·ªõc m·∫Øm (gia v·ªã)':'yang','Mu·ªëi & Ti√™u':'yang','T·ªèi':'yang','D·∫ßu √¥liu (gia v·ªã)':'yang' };

    const cereals = ['G·∫°o (c∆°m)','B√°nh m√¨','M√¨ (noodle)'];
    const beans = ['ƒê·∫≠u ph·ª• (tofu)','ƒê·∫≠u xanh','ƒê·∫≠u n√†nh'];
    const meats = ['Th·ªãt g√†','Th·ªãt l·ª£n','C√° h·ªìi','T√¥m'];
    const spices = ['N∆∞·ªõc m·∫Øm (gia v·ªã)','Mu·ªëi & Ti√™u','T·ªèi','D·∫ßu √¥liu (gia v·ªã)'];
    const mealTimes = ['08:00','12:00','16:00'];

    const seasonSel = document.getElementById('season');
    const tabs = document.querySelectorAll('.tab');
    const modeSel = document.getElementById('mode');
    const mealsPanel = document.getElementById('mealsPanel');
    const calcBtn = document.getElementById('calc');
    const shopList = document.getElementById('shopList');
    const shopTotal = document.getElementById('shopTotal');
    const totalPriceEl = document.getElementById('totalPrice');
    const cookTotalsEl = document.getElementById('cookTotals');

    function generateSeasonPlans(season){
      const vegs = (seasonVeg[season]||[]).slice();
      const extras = seasonVeg['all']||[];
      while(vegs.length < 4) vegs.push(...extras);

      const dayA = [];
      for(let i=0;i<3;i++){
        dayA.push({time:mealTimes[i], veg: vegs[i%vegs.length], cereal: cereals[i%cereals.length], bean: beans[i%beans.length], meat: meats[i%meats.length], spice: spices[i%spices.length]});
      }

      const dayB = [];
      for(let i=0;i<3;i++){
        const v = vegs[(i+2)%vegs.length];
        dayB.push({time:mealTimes[i], veg: v, cereal: cereals[(i+1)%cereals.length], bean: beans[(i+1)%beans.length], meat: meats[(i+1)%meats.length], spice: spices[(i+1)%spices.length]});
      }

      return {A:dayA, B:dayB};
    }

    function renderMeals(){
      const season = seasonSel.value;
      const plans = generateSeasonPlans(season);
      const activeDay = document.querySelector('.tab.active').dataset.day;
      const mode = modeSel.value;
      mealsPanel.innerHTML='';

      if(mode === 'single'){
        const dayPlan = plans[activeDay];
        const title = document.createElement('div'); title.className='small'; title.textContent = `Ph∆∞∆°ng √°n: Ng√†y ${activeDay} ‚Äî M√πa ${seasonName(season)}`;
        mealsPanel.appendChild(title);
        dayPlan.forEach(m => mealsPanel.appendChild(mealNode(m)));
      } else {
        const title = document.createElement('div'); title.className='small'; title.textContent = `Ph∆∞∆°ng √°n: C·∫£ 2 ng√†y (A + B) ‚Äî M√πa ${seasonName(season)}`;
        mealsPanel.appendChild(title);
        const hA = document.createElement('div'); hA.className='small'; hA.style.marginTop='8px'; hA.textContent='Ng√†y A:'; mealsPanel.appendChild(hA);
        plans.A.forEach(m => mealsPanel.appendChild(mealNode(m)));
        const hB = document.createElement('div'); hB.className='small'; hB.style.marginTop='8px'; hB.textContent='Ng√†y B:'; mealsPanel.appendChild(hB);
        plans.B.forEach(m => mealsPanel.appendChild(mealNode(m)));
      }
      shopList.innerHTML=''; shopTotal.style.display='none'; cookTotalsEl.style.display='none';
    }

    function mealNode(m){
      // attach per-item portion information
      const vegPort = portionDefaults.rau;
      const cerealPort = portionDefaults.ngugcoc;
      const beanPort = portionDefaults.dau;
      const meatPort = portionDefaults.thit;
      const spicePort = portionDefaults.giavi;

      const div = document.createElement('div'); div.className='meal';
      div.innerHTML = `<div class="time">${m.time}</div><div class="meal-list">
          <div class="food"><div>${m.veg} <span class="muted">(rau)</span><div class="muted">${vegPort} g</div></div><div class="${yinYang[m.veg]||'neutral'}">${labelYY(yinYang[m.veg])}</div></div>
          <div class="food"><div>${m.cereal} <span class="muted">(ng≈© c·ªëc)</span><div class="muted">${cerealPort} g</div></div><div class="${yinYang[m.cereal]||'neutral'}">${labelYY(yinYang[m.cereal])}</div></div>
          <div class="food"><div>${m.bean} <span class="muted">(ƒë·∫≠u)</span><div class="muted">${beanPort} g</div></div><div class="${yinYang[m.bean]||'neutral'}">${labelYY(yinYang[m.bean])}</div></div>
          <div class="food"><div>${m.meat} <span class="muted">(th·ªãt/h·∫£i s·∫£n)</span><div class="muted">${meatPort} g</div></div><div class="${yinYang[m.meat]||'neutral'}">${labelYY(yinYang[m.meat])}</div></div>
          <div class="food"><div>${m.spice} <span class="muted">(gia v·ªã)</span><div class="muted">~${spicePort} g</div></div><div class="${yinYang[m.spice]||'neutral'}">${labelYY(yinYang[m.spice])}</div></div>
        </div>`;
      return div;
    }

    function labelYY(v){ if(!v) return 'Trung t√≠nh'; return v==='yin' ? '√Çm' : (v==='yang' ? 'D∆∞∆°ng' : 'Trung') }
    function seasonName(k){ return {'spring':'Xu√¢n','summer':'H√®','autumn':'Thu','winter':'ƒê√¥ng','all':'Quanh nƒÉm'}[k]||k }

    tabs.forEach(t => t.addEventListener('click', ()=>{ tabs.forEach(x=>x.classList.remove('active')); t.classList.add('active'); renderMeals(); }));
    seasonSel.addEventListener('change', renderMeals);
    modeSel.addEventListener('change', renderMeals);

    // calculate shopping list and cooking totals
    calcBtn.addEventListener('click', ()=>{
      const season = seasonSel.value; const plans = generateSeasonPlans(season);
      const activeDay = document.querySelector('.tab.active').dataset.day; const mode = modeSel.value;
      const totals = {}; // name -> grams

      function add(name, g){ if(!totals[name]) totals[name]=0; totals[name]+=g; }

      if(mode==='single'){
        plans[activeDay].forEach(m => {
          add(m.veg, portionDefaults.rau);
          add(m.cereal, portionDefaults.ngugcoc);
          add(m.bean, portionDefaults.dau);
          add(m.meat, portionDefaults.thit);
          add(m.spice, portionDefaults.giavi);
        });
      } else {
        ['A','B'].forEach(d => plans[d].forEach(m => {
          add(m.veg, portionDefaults.rau);
          add(m.cereal, portionDefaults.ngugcoc);
          add(m.bean, portionDefaults.dau);
          add(m.meat, portionDefaults.thit);
          add(m.spice, portionDefaults.giavi);
        }));
      }

      // render shop list
      shopList.innerHTML=''; let grandTotal=0;
      Object.keys(totals).forEach(name=>{
        const grams = totals[name];
        const pricePerKg = priceMap[name] || 30000; // fallback
        const qtyKg = Math.ceil((grams/1000)*100)/100; // 0.01kg
        const cost = Math.round(qtyKg * pricePerKg);
        grandTotal += cost;
        const el = document.createElement('div'); el.className='shop-item';
        el.innerHTML = `<div>${name} ‚Äî <span class="muted">T·ªïng n·∫•u:</span> ${grams} g ‚Äî <span class="muted">Mua</span> ${qtyKg} kg</div><div>${formatVnd(cost)}</div>`;
        shopList.appendChild(el);
      });

      // cooking totals (grouped)
      const grouped = groupByCategory(totals);
      cookTotalsEl.style.display='block'; cookTotalsEl.innerHTML = '';
      const heading = document.createElement('div'); heading.innerHTML = '<strong>T·ªïng n·∫•u / ng√†y (theo nh√≥m)</strong>'; cookTotalsEl.appendChild(heading);
      Object.keys(grouped).forEach(k=>{
        const v = grouped[k];
        const row = document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.style.marginTop='6px';
        row.innerHTML = `<div>${k}</div><div>${v} g</div>`;
        cookTotalsEl.appendChild(row);
      });

      shopTotal.style.display='flex'; totalPriceEl.textContent = formatVnd(grandTotal);
    });

    function groupByCategory(totals){
      const groups = { rau:0, ngugcoc:0, dau:0, thit:0, giavi:0 };
      Object.keys(totals).forEach(name=>{
        // determine category by membership
        if(Object.keys(yinYang).includes(name)){
          // map known names to groups (heuristic)
          if(['C·∫£i ch√≠p','Rau c·∫£i ng·ªçt','Su h√†o','C·ªß c·∫£i','C·∫£i xoƒÉn','Rau bina','M∆∞·ªõp ƒë·∫Øng','M·ªìng t∆°i','ƒêu ƒë·ªß','ƒê·∫≠u b·∫Øp','B√≠ xanh','B√≠ ƒë·ªè','Khoai lang','S√∫p l∆°','C√† r·ªët','Rong bi·ªÉn','T·∫£o bi·ªÉn'].includes(name)) groups.rau += totals[name];
          else if(['G·∫°o (c∆°m)','B√°nh m√¨','M√¨ (noodle)','Y·∫øn m·∫°ch'].includes(name)) groups.ngugcoc += totals[name];
          else if(['ƒê·∫≠u ph·ª• (tofu)','ƒê·∫≠u xanh','ƒê·∫≠u n√†nh','ƒê·∫≠u H√† Lan'].includes(name)) groups.dau += totals[name];
          else if(['Th·ªãt g√†','Th·ªãt l·ª£n','C√° h·ªìi','T√¥m'].includes(name)) groups.thit += totals[name];
          else if(['N∆∞·ªõc m·∫Øm (gia v·ªã)','Mu·ªëi & Ti√™u','T·ªèi','D·∫ßu √¥liu (gia v·ªã)','Rong bi·ªÉn','T·∫£o bi·ªÉn'].includes(name)) groups.giavi += totals[name];
          else groups.rau += totals[name];
        } else {
          groups.rau += totals[name];
        }
      });
      // round
      Object.keys(groups).forEach(k=> groups[k] = Math.round(groups[k]));
      return groups;
    }

    function formatVnd(n){ return n.toLocaleString('vi-VN') + ' ‚Ç´'; }

    // init
    renderMeals();
  </script>
</body>
</html>
