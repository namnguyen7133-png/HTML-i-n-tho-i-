<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tính Toán Chu Kỳ Sinh Học</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 25px;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input:focus, select:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }
        
        .col {
            flex: 1;
            padding: 0 10px;
            min-width: 300px;
        }
        
        .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            margin-bottom: 30px;
        }
        
        button {
            padding: 12px 25px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        #calculateBtn {
            background-color: #2ecc71;
        }
        
        #calculateBtn:hover {
            background-color: #27ae60;
        }
        
        #resetBtn {
            background-color: #e74c3c;
        }
        
        #resetBtn:hover {
            background-color: #c0392b;
        }
        
        .results {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 20px;
            border-radius: 5px;
            margin-top: 30px;
            display: none;
        }
        
        .results h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .result-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #ddd;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .warning {
            background-color: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .special-number {
            background-color: #e8f4fc;
            border: 1px solid #a8d4ff;
            padding: 8px 12px;
            border-radius: 4px;
            margin: 5px;
            display: inline-block;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #ddd;
        }
        
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        .number-badge {
            display: inline-block;
            background-color: #6c757d;
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin: 2px;
        }
        
        @media (max-width: 768px) {
            .row {
                flex-direction: column;
            }
            
            .col {
                margin-bottom: 15px;
            }
            
            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Tính Toán Chu Kỳ Sinh Học</h1>
        
        <div class="row">
            <div class="col">
                <div class="form-group">
                    <label for="currentDate">Ô 1: Ngày tháng năm hiện tại</label>
                    <input type="date" id="currentDate">
                </div>
            </div>
            
            <div class="col">
                <div class="form-group">
                    <label for="personSelect">Ô 2: Chọn tên từ danh sách</label>
                    <select id="personSelect">
                        <option value="">-- Chọn một người --</option>
                        <!-- Danh sách sẽ được thêm bằng JavaScript -->
                    </select>
                </div>
            </div>
            
            <div class="col">
                <div class="form-group">
                    <label for="birthDate">Ô 3: Ngày tháng năm sinh</label>
                    <input type="date" id="birthDate">
                </div>
            </div>
        </div>
        
        <div class="button-group">
            <button id="calculateBtn">Tính toán kết quả</button>
            <button id="resetBtn">Đặt lại form</button>
        </div>
        
        <div class="results" id="resultsSection">
            <h3>Kết quả tính toán</h3>
            <div id="resultsContent">
                <!-- Kết quả sẽ được hiển thị ở đây -->
            </div>
        </div>
        
        <div class="info">
            <p><strong>Hướng dẫn:</strong> Chọn ngày hiện tại, chọn tên từ danh sách (ngày sinh sẽ tự động điền), sau đó nhấn "Tính toán kết quả".</p>
            <p><strong>Bảng 2 gồm 38 số:</strong> 23, 28, 33, 38, 43, 53, 644, 759, 874, 989, 1219, 924, 1064, 1204, 1484, 1254, 1419, 1749, 1634, 2014, 2279, 108, 285, 298, 318, 1690, 1911, 4850, 21252, 24472, 27692, 34132, 35112, 39732, 48972, 53922, 66462, 86602</p>
        </div>
    </div>

    <script>
        // Dữ liệu người (STT, Tên, Ngày sinh)
        const peopleData = [
            { id: 1, name: "NGUYENKHACNANG", birthDate: "1944-06-04" },
            { id: 2, name: "TOTHIHA", birthDate: "1948-08-29" },
            { id: 3, name: "NGUYENMINHNAM", birthDate: "1971-03-03" },
            { id: 4, name: "THANTHIKIMANH", birthDate: "1981-09-23" },
            { id: 5, name: "NGUYENTONGANAN", birthDate: "2014-09-28" },
            { id: 6, name: "NGUYENTOMINHCHAU", birthDate: "2016-07-25" },
            { id: 7, name: "NGUYENTOBICHNGOC", birthDate: "2020-02-05" },
            { id: 8, name: "NGUYENTHIMINHHANG", birthDate: "1974-01-07" },
            { id: 9, name: "NGOQUYCUONG", birthDate: "1973-05-23" },
            { id: 10, name: "NGOGIABACH", birthDate: "2000-10-12" },
            { id: 11, name: "NGOGIALINH", birthDate: "2005-04-05" },
            { id: 12, name: "NGUYENTHIMINHPHUONG", birthDate: "1978-11-06" },
            { id: 13, name: "HOANGANHDUNG", birthDate: "1978-09-21" },
            { id: 14, name: "HOANGHAIVINH", birthDate: "2010-06-03" },
            { id: 15, name: "HOANGTHIENBACHANH", birthDate: "2015-11-14" },
            { id: 16, name: "TÔ KIM HUỆ", birthDate: "1960-08-09" },
            { id: 17, name: "NGUYỄN TUẤN ANH", birthDate: "1983-10-23" },
            { id: 18, name: "NGUYỄN THẾ ANH", birthDate: "2001-03-24" },
            { id: 19, name: "NGÔ THỊ MAI", birthDate: "1948-12-12" },
            { id: 20, name: "TÔ VIỆT HƯNG", birthDate: "1996-06-17" },
            { id: 21, name: "TÔ THỊ HỒNG", birthDate: "1964-10-10" },
            { id: 22, name: "VŨ VĂN HIỆP", birthDate: "1974-04-24" },
            { id: 23, name: "NGUYỄN THỊ CHI", birthDate: "1946-02-08" },
            { id: 24, name: "NGUYỄN TẤN BẮC", birthDate: "1957-11-30" },
            { id: 25, name: "NGUYỄN THỊ TÂM", birthDate: "1954-08-08" }
        ];

        // Bảng 2 - 38 số
        const table2 = [23, 28, 33, 38, 43, 53, 644, 759, 874, 989, 1219, 924, 1064, 1204, 1484, 1254, 1419, 1749, 1634, 2014, 2279, 108, 285, 298, 318, 1690, 1911, 4850, 21252, 24472, 27692, 34132, 35112, 39732, 48972, 53922, 66462, 86602];

        // Số đặc biệt để so sánh
        const specialNumbers = [
            111,222,333,444,555,666,777,888,999,
            123,234,345,456,567,678,789,
            159, 195, 168,186,258,285,268,276,249,294,348,384,357,375, 438,483,429,492,519,591,537,573,582,528,627,672,618,681,726,762,735,753,825,852,816,861,834,843,915,951,924,942
        ];

        // DOM Elements
        const currentDateInput = document.getElementById('currentDate');
        const personSelect = document.getElementById('personSelect');
        const birthDateInput = document.getElementById('birthDate');
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const resultsSection = document.getElementById('resultsSection');
        const resultsContent = document.getElementById('resultsContent');

        // Khởi tạo
        document.addEventListener('DOMContentLoaded', function() {
            // Đặt ngày hiện tại mặc định
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            currentDateInput.value = formattedDate;
            
            // Điền danh sách người vào dropdown
            populatePersonSelect();
            
            // Thiết lập sự kiện
            setupEventListeners();
        });

        // Điền danh sách người vào dropdown
        function populatePersonSelect() {
            peopleData.forEach(person => {
                const option = document.createElement('option');
                option.value = person.id;
                option.textContent = `${person.id}. ${person.name}`;
                personSelect.appendChild(option);
            });
        }

        // Thiết lập các sự kiện
        function setupEventListeners() {
            // Khi chọn người từ danh sách
            personSelect.addEventListener('change', function() {
                const selectedId = parseInt(this.value);
                if (selectedId) {
                    const selectedPerson = peopleData.find(p => p.id === selectedId);
                    if (selectedPerson) {
                        birthDateInput.value = selectedPerson.birthDate;
                    }
                } else {
                    birthDateInput.value = '';
                }
            });

            // Nút tính toán
            calculateBtn.addEventListener('click', calculateResults);

            // Nút đặt lại
            resetBtn.addEventListener('click', function() {
                currentDateInput.value = new Date().toISOString().split('T')[0];
                personSelect.value = '';
                birthDateInput.value = '';
                resultsSection.style.display = 'none';
            });
        }

        // Hàm tính toán kết quả chính
        function calculateResults() {
            // Kiểm tra dữ liệu đầu vào
            if (!currentDateInput.value || !birthDateInput.value) {
                alert("Vui lòng chọn ngày hiện tại và chọn một người từ danh sách!");
                return;
            }

            // Lấy giá trị từ form
            const currentDate = new Date(currentDateInput.value);
            const birthDate = new Date(birthDateInput.value);
            
            // Tính số ngày chênh lệch
            const timeDiff = currentDate.getTime() - birthDate.getTime();
            const dayDiff = Math.floor(timeDiff / (1000 * 3600 * 24));
            
            // Tìm thông tin người được chọn
            const selectedPerson = peopleData.find(p => p.birthDate === birthDateInput.value);
            const personName = selectedPerson ? selectedPerson.name : "Người không xác định";
            
            // Hiển thị kết quả
            showResults(dayDiff, currentDate, birthDate, personName);
        }

        // Hiển thị kết quả
        function showResults(dayDiff, currentDate, birthDate, personName) {
            resultsContent.innerHTML = '';
            
            // Thông tin cơ bản
            const basicInfo = document.createElement('div');
            basicInfo.className = 'result-item';
            basicInfo.innerHTML = `
                <h4>Thông tin cơ bản</h4>
                <p><strong>Tên:</strong> ${personName}</p>
                <p><strong>Ngày sinh:</strong> ${formatDate(birthDate)}</p>
                <p><strong>Ngày hiện tại:</strong> ${formatDate(currentDate)}</p>
                <p><strong>Số ngày chênh lệch:</strong> ${dayDiff} ngày</p>
            `;
            resultsContent.appendChild(basicInfo);
            
            // Phép tính 1: Chia cho TẤT CẢ các số trong bảng 2
            const calc1Results = performCalculation1(dayDiff);
            const calc1Div = document.createElement('div');
            calc1Div.className = 'result-item';
            calc1Div.innerHTML = `
                <h4>Phép tính 1: Kết quả chia cho TẤT CẢ các số trong bảng 2</h4>
                ${calc1Results}
            `;
            resultsContent.appendChild(calc1Div);
            
            // Phép tính 2: Tính ngày bắt đầu và kết thúc cho TẤT CẢ các số trong bảng 2
            const calc2Results = performCalculation2(dayDiff, currentDate, birthDate);
            const calc2Div = document.createElement('div');
            calc2Div.className = 'result-item';
            calc2Div.innerHTML = `
                <h4>Phép tính 2: Chu kỳ và ngày đặc biệt cho TẤT CẢ các số trong bảng 2</h4>
                ${calc2Results}
            `;
            resultsContent.appendChild(calc2Div);
            
            // So sánh với số đặc biệt
            const specialResults = checkSpecialNumbers(dayDiff);
            const specialDiv = document.createElement('div');
            specialDiv.className = 'result-item';
            specialDiv.innerHTML = `
                <h4>So sánh với các số đặc biệt</h4>
                ${specialResults}
            `;
            resultsContent.appendChild(specialDiv);
            
            // Hiển thị khu vực kết quả
            resultsSection.style.display = 'block';
            
            // Tự động cuộn đến kết quả
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Thực hiện phép tính 1 - Chia cho TẤT CẢ các số trong bảng 2
        function performCalculation1(dayDiff) {
            let resultsHTML = '';
            const zeroResults = [];
            const remainderLessThan7 = [];
            
            // Hiển thị tất cả các số trong bảng 2
            resultsHTML += `<p><strong>Bảng 2 gồm 38 số:</strong> `;
            table2.forEach((num, index) => {
                resultsHTML += `<span class="number-badge">${num}</span>`;
                if ((index + 1) % 10 === 0) resultsHTML += '<br>';
            });
            resultsHTML += `</p>`;
            
            // Tạo bảng kết quả
            resultsHTML += `<div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Số chia</th>
                            <th>Kết quả chia</th>
                            <th>Số dư</th>
                            <th>Thông báo</th>
                        </tr>
                    </thead>
                    <tbody>`;
            
            // Duyệt qua TẤT CẢ các số trong bảng 2
            table2.forEach(num => {
                const quotient = Math.floor(dayDiff / num);
                const remainder = dayDiff % num;
                
                let message = '';
                let rowClass = '';
                
                // Kiểm tra nếu chia hết (dư = 0)
                if (remainder === 0) {
                    zeroResults.push(num);
                    rowClass = 'warning';
                    
                    // Thông báo đặc biệt cho một số số cụ thể
                    switch(num) {
                        case 23:
                            message = "Cần nghỉ ngơi, không leo trèo, làm nặng 6 giờ tiếp theo";
                            break;
                        case 28:
                            message = "Hãy nghe nhạc, xem phim Tâm Lý, đi dạo ngoài trời, không nghe ai than phiền 6 giờ tiếp theo";
                            break;
                        case 33:
                            message = "Không học hành nghiên cứu sâu 6 giờ tiếp theo";
                            break;
                        case 43:
                            message = "Không bình luận, chỉ xem trình diễn hoa hậu thời trang, 6 giờ tiếp theo";
                            break;
                        case 53:
                            message = "Không đến nơi ầm ĩ vào chùa, thờ... tĩnh lặng 6 giờ tiếp theo";
                            break;
                        default:
                            message = `Chia hết cho ${num}`;
                    }
                } 
                // Kiểm tra nếu số dư nhỏ hơn 7
                else if (remainder < 7) {
                    remainderLessThan7.push({num, remainder});
                    rowClass = 'info';
                    message = `Còn ${remainder} lần nữa`;
                } else {
                    message = `Dư ${remainder}`;
                }
                
                resultsHTML += `<tr class="${rowClass}">
                    <td>${num}</td>
                    <td>${dayDiff} ÷ ${num} = ${quotient}</td>
                    <td>${remainder}</td>
                    <td>${message}</td>
                </tr>`;
            });
            
            resultsHTML += `</tbody></table></div>`;
            
            // Tóm tắt kết quả đặc biệt
            if (zeroResults.length > 0) {
                resultsHTML += `<div class="warning"><strong>Các số chia hết (dư = 0):</strong> ${zeroResults.join(', ')}</div>`;
                
                // Kiểm tra trùng số 0
                if (zeroResults.length >= 2) {
                    resultsHTML += `<div class="warning"><strong>CÓ ${zeroResults.length} VÒNG TRÙNG NHAU:</strong> ${zeroResults.join(', ')}. Tránh rủi ro tai nạn nghỉ ${zeroResults.length} ngày.</div>`;
                }
            }
            
            if (remainderLessThan7.length > 0) {
                resultsHTML += `<div class="info"><strong>Các số có dư nhỏ hơn 7:</strong> `;
                remainderLessThan7.forEach(item => {
                    resultsHTML += `${item.num} (dư ${item.remainder}), `;
                });
                resultsHTML = resultsHTML.slice(0, -2); // Xóa dấu ", " cuối cùng
                resultsHTML += `</div>`;
            }
            
            return resultsHTML;
        }

        // Thực hiện phép tính 2 - Tính toán với TẤT CẢ các số trong bảng 2
        function performCalculation2(dayDiff, currentDate, birthDate) {
            let resultsHTML = '';
            
            // Lấy số chẵn (phần nguyên khi chia cho 23)
            const soChan = Math.floor(dayDiff / 23);
            
            resultsHTML += `<div class="info"><strong>Số chẵn (chia 23):</strong> ${soChan}</div>`;
            
            // Tạo bảng kết quả
            resultsHTML += `<div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Số trong bảng 2</th>
                            <th>Ngày đầu kỳ</th>
                            <th>Ngày cuối kỳ</th>
                            <th>Số dư</th>
                            <th>Ngày kết thúc chu kỳ</th>
                        </tr>
                    </thead>
                    <tbody>`;
            
            // Duyệt qua TẤT CẢ các số trong bảng 2
            table2.forEach(num => {
                // Tính số dư
                const remainder = dayDiff % num;
                
                // Tính ngày bắt đầu: soChan * num + ngày sinh
                const startDays = soChan * num;
                const startDate = new Date(birthDate);
                startDate.setDate(startDate.getDate() + startDays);
                
                // Tính ngày kết thúc: (soChan + 1) * num + ngày sinh
                const endDays = (soChan + 1) * num;
                const endDate = new Date(birthDate);
                endDate.setDate(endDate.getDate() + endDays);
                
                // Tính ngày kết thúc chu kỳ: currentDate + (num - remainder)
                const cycleEndDays = num - remainder;
                const cycleEndDate = new Date(currentDate);
                cycleEndDate.setDate(cycleEndDate.getDate() + cycleEndDays);
                
                // Xác định class cho hàng dựa trên số dư
                let rowClass = '';
                if (remainder === 0) {
                    rowClass = 'warning';
                } else if (remainder < 7) {
                    rowClass = 'info';
                }
                
                resultsHTML += `<tr class="${rowClass}">
                    <td>${num}</td>
                    <td>${formatDate(startDate)}<br><small>(${soChan} × ${num} + ngày sinh)</small></td>
                    <td>${formatDate(endDate)}<br><small>((${soChan} + 1) × ${num} + ngày sinh)</small></td>
                    <td>${remainder}</td>
                    <td>${formatDate(cycleEndDate)}<br><small>(+${cycleEndDays} ngày từ hôm nay)</small></td>
                </tr>`;
            });
            
            resultsHTML += `</tbody></table></div>`;
            
            return resultsHTML;
        }

        // Kiểm tra số đặc biệt
        function checkSpecialNumbers(dayDiff) {
            let resultsHTML = '';
            
            // Kiểm tra xem số chênh lệch có bằng số đặc biệt nào không
            const exactMatch = specialNumbers.find(num => num === dayDiff);
            if (exactMatch) {
                resultsHTML += `<div class="success"><strong>Số chênh lệch (${dayDiff}) TRÙNG VỚI SỐ ĐẶC BIỆT:</strong> ${exactMatch}</div>`;
            }
            
            // Kiểm tra các số gần với số đặc biệt (trong khoảng ±10)
            const nearMatches = specialNumbers.filter(num => Math.abs(num - dayDiff) <= 10 && num !== dayDiff);
            
            if (nearMatches.length > 0) {
                resultsHTML += `<p><strong>Số chênh lệch gần với các số đặc biệt:</strong></p>`;
                nearMatches.forEach(num => {
                    const diff = num - dayDiff;
                    const direction = diff > 0 ? "còn" : "đã qua";
                    resultsHTML += `<span class="special-number">${num} (${direction} ${Math.abs(diff)} ngày)</span>`;
                });
            }
            
            // Kiểm tra số chẵn (chia cho 23)
            const soChan = Math.floor(dayDiff / 23);
            const soChanMatch = specialNumbers.find(num => num === soChan);
            if (soChanMatch) {
                resultsHTML += `<div class="info"><strong>Số chẵn (${soChan}) trùng với số đặc biệt:</strong> ${soChanMatch}</div>`;
            }
            
            // Kiểm tra số dư khi chia cho 23
            const remainder23 = dayDiff % 23;
            const remainderMatch = specialNumbers.find(num => num === remainder23);
            if (remainderMatch) {
                resultsHTML += `<div class="info"><strong>Số dư khi chia cho 23 (${remainder23}) trùng với số đặc biệt:</strong> ${remainderMatch}</div>`;
            }
            
            // Kiểm tra số dư khi chia cho các số trong bảng 2
            const specialRemainders = [];
            table2.forEach(num => {
                const remainder = dayDiff % num;
                if (specialNumbers.includes(remainder)) {
                    specialRemainders.push({num, remainder});
                }
            });
            
            if (specialRemainders.length > 0) {
                resultsHTML += `<p><strong>Số dư khi chia cho các số trong bảng 2 trùng với số đặc biệt:</strong></p>`;
                specialRemainders.forEach(item => {
                    resultsHTML += `<span class="special-number">Chia ${dayDiff} cho ${item.num} dư ${item.remainder}</span>`;
                });
            }
            
            if (!exactMatch && nearMatches.length === 0 && !soChanMatch && !remainderMatch && specialRemainders.length === 0) {
                resultsHTML += `<p>Không tìm thấy số chênh lệch hoặc số liên quan trùng với các số đặc biệt.</p>`;
            }
            
            return resultsHTML;
        }

        // Định dạng ngày tháng
        function formatDate(date) {
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }
    </script>
</body>
</html>