<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tính toán Ngày Sinh - An Toàn Thời Gian</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        .header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 16px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #e1e8ed;
        }
        
        .card h2 {
            color: #2980b9;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ecf0f1;
            font-size: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #34495e;
        }
        
        select, input[type="date"], input[type="text"] {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #2980b9, #1f639e);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn-calculate-all {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .btn-calculate-all:hover {
            background: linear-gradient(135deg, #27ae60, #219653);
        }
        
        .results-section {
            grid-column: 1 / -1;
            margin-top: 20px;
        }
        
        .results-container {
            display: none;
            margin-top: 20px;
        }
        
        .results-container.active {
            display: block;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            background: #f8f9fa;
            border: 1px solid transparent;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 6px 6px 0 0;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: white;
            color: #3498db;
            border-color: #ddd #ddd white #ddd;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 0 6px 6px 6px;
            border: 1px solid #ddd;
            border-top: none;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .result-item {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
            margin-bottom: 8px;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .person-name {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .day-diff {
            color: #e74c3c;
            font-weight: 600;
            font-size: 18px;
        }
        
        .calculation-result {
            margin-top: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .special-numbers {
            margin-top: 10px;
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .danger-number {
            color: #e74c3c;
            font-weight: 700;
        }
        
        .warning-number {
            color: #e67e22;
            font-weight: 700;
        }
        
        .critical-number {
            color: #8e44ad;
            font-weight: 700;
        }
        
        .time-info {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 5px;
        }
        
        .danger-item {
            background: #ffeaea;
            border-left: 4px solid #e74c3c;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 4px 4px 0;
        }
        
        .warning-item {
            background: #fff4e6;
            border-left: 4px solid #e67e22;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 4px 4px 0;
        }
        
        .critical-item {
            background: #f4e6ff;
            border-left: 4px solid #8e44ad;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 4px 4px 0;
        }
        
        .info-note {
            background: #e8f4fc;
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 14px;
            color: #2c3e50;
            border-left: 4px solid #3498db;
        }
        
        .hidden {
            display: none;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 15px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f2f6fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .summary {
            margin-top: 20px;
            padding: 15px;
            background: #e8f6f3;
            border-radius: 6px;
            border-left: 4px solid #1abc9c;
        }
        
        .summary h3 {
            color: #16a085;
            margin-bottom: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .alert-message {
            background: #ffebee;
            border: 2px solid #e74c3c;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-weight: bold;
            color: #c0392b;
            text-align: center;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }
        
        .pharmacy-message {
            background: #e8f5e9;
            border: 2px solid #27ae60;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-weight: bold;
            color: #1e8449;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TÍNH TOÁN AN TOÀN THỜI GIAN</h1>
            <p>Kiểm tra các mốc thời gian quan trọng dựa trên ngày sinh và thời điểm hiện tại</p>
        </div>
        
        <div class="card">
            <h2>PHẦN 1: TÍNH CHO MỘT NGƯỜI</h2>
            <div class="form-group">
                <label for="personSelect">Chọn người:</label>
                <select id="personSelect" onchange="updateBirthDate()">
                    <option value="">-- Chọn một người --</option>
                    <option value="NGUYENKHACNANG|04/06/1944">NGUYENKHACNANG (04/06/1944)</option>
                    <option value="TOTHIHA|29/08/1948">TOTHIHA (29/08/1948)</option>
                    <option value="NGUYENMINHNAM|03/03/1971">NGUYENMINHNAM (03/03/1971)</option>
                    <option value="THANTHIKIMANH|23/09/1981">THANTHIKIMANH (23/09/1981)</option>
                    <option value="NGUYENTONGANAN|28/09/2014">NGUYENTONGANAN (28/09/2014)</option>
                    <option value="NGUYENTOMINHCHAU|25/07/2016">NGUYENTOMINHCHAU (25/07/2016)</option>
                    <option value="NGUYENTOBICHNGOC|05/02/2020">NGUYENTOBICHNGOC (05/02/2020)</option>
                    <option value="NGUYENTHIMINHHANG|07/01/1974">NGUYENTHIMINHHANG (07/01/1974)</option>
                    <option value="NGOQUYCUONG|23/05/1973">NGOQUYCUONG (23/05/1973)</option>
                    <option value="NGOGIABACH|12/10/2000">NGOGIABACH (12/10/2000)</option>
                    <option value="NGOGIALINH|05/04/2005">NGOGIALINH (05/04/2005)</option>
                    <option value="NGUYENTHIMINHPHUONG|06/11/1978">NGUYENTHIMINHPHUONG (06/11/1978)</option>
                    <option value="HOANGANHDUNG|21/09/1978">HOANGANHDUNG (21/09/1978)</option>
                    <option value="HOANGHAIVINH|03/06/2010">HOANGHAIVINH (03/06/2010)</option>
                    <option value="HOANGTHIENBACHANH|14/11/2015">HOANGTHIENBACHANH (14/11/2015)</option>
                    <option value="TOKIMHUE|09/08/1960">TÔ KIM HUỆ (09/08/1960)</option>
                    <option value="NGUYENTUANANH|23/10/1983">NGUYỄN TUẤN ANH (23/10/1983)</option>
                    <option value="NGUYENTHEANH|24/03/2001">NGUYỄN THẾ ANH (24/03/2001)</option>
                    <option value="NGOTHIMAI|12/12/1948">NGÔ THỊ MAI (12/12/1948)</option>
                    <option value="TOVIETHUNG|17/06/1996">TÔ VIỆT HƯNG (17/06/1996)</option>
                    <option value="TOTHIHONG|10/10/1964">TÔ THỊ HỒNG (10/10/1964)</option>
                    <option value="VUVANHIEP|24/04/1974">VŨ VĂN HIỆP (24/04/1974)</option>
                    <option value="NGUYENTHICHI|08/02/1946">NGUYỄN THỊ CHI (08/02/1946)</option>
                    <option value="NGUYENTANBAC|30/11/1957">NGUYỄN TẤN BẮC (30/11/1957)</option>
                    <option value="NGUYENTHITAM|08/08/1954">NGUYỄN THỊ TÂM (08/08/1954)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="birthDate">Ngày tháng năm sinh:</label>
                <input type="text" id="birthDate" placeholder="DD/MM/YYYY" value="">
            </div>
            
            <div class="form-group">
                <label for="targetDate">Ngày tháng năm muốn xem:</label>
                <input type="date" id="targetDate" value="">
            </div>
            
            <button class="btn" onclick="calculateForOne()">TÍNH TOÁN CHO 1 NGƯỜI</button>
        </div>
        
        <div class="card">
            <h2>PHẦN 2: TÍNH CHO TẤT CẢ NGƯỜI</h2>
            <p style="margin-bottom: 15px; color: #7f8c8d;">Tính toán cho tất cả 25 người trong danh sách</p>
            
            <div class="form-group">
                <label for="allTargetDate">Ngày tháng năm muốn xem:</label>
                <input type="date" id="allTargetDate" value="">
            </div>
            
            <button class="btn btn-calculate-all" onclick="calculateForAll()">TÍNH TOÁN CHO TẤT CẢ</button>
            
            <div class="loading" id="loadingAll">
                <div class="spinner"></div>
                <p>Đang tính toán cho 25 người...</p>
            </div>
        </div>
        
        <div class="results-section">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('single')">KẾT QUẢ 1 NGƯỜI</div>
                <div class="tab" onclick="switchTab('all')">KẾT QUẢ TẤT CẢ</div>
            </div>
            
            <div class="tab-content active" id="singleResult">
                <!-- Kết quả phần 1 sẽ được hiển thị ở đây -->
            </div>
            
            <div class="tab-content" id="allResult">
                <!-- Kết quả phần 2 sẽ được hiển thị ở đây -->
            </div>
        </div>
        
        <div class="card">
            <h2>BẢNG GIỜ VÀ SỐ THỨ TỰ</h2>
            <div class="table-container">
                <table id="timeTable">
                    <thead>
                        <tr>
                            <th>Giờ</th>
                            <th>Số thứ tự</th>
                            <th>Giờ</th>
                            <th>Số thứ tự</th>
                            <th>Giờ</th>
                            <th>Số thứ tự</th>
                        </tr>
                    </thead>
                    <tbody id="timeTableBody">
                        <!-- Bảng giờ sẽ được tạo động bằng JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="info-note">
        <strong>Lưu ý:</strong> Các số đặc biệt tìm được nên gắn kèm với giờ trong bảng trên để biết mà tránh rủi ro, tai nạn. Số 307 là (tụt huyết áp), các số khác là bệnh nặng. Các số 14, 41, 27, 72 trong phép tính 3 là các giờ tim đau mỏi.
    </div>
    
    <div class="footer">
        <p>© 2023 - Tính toán An toàn Thời gian | Dữ liệu chỉ mang tính chất tham khảo</p>
    </div>

    <script>
        // Tạo bảng giờ và số thứ tự theo yêu cầu (1381-1740)
        const timeTableData = [];
        
        // Tạo dữ liệu từ 23:01 (1381) đến 5:00 (1740)
        let currentNumber = 1381;
        
        // 23:01 - 23:59
        for (let hour = 23; hour <= 23; hour++) {
            for (let minute = 1; minute <= 59; minute++) {
                const timeStr = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                timeTableData.push({ time: timeStr, number: currentNumber });
                currentNumber++;
            }
        }
        
        // 0:00 - 4:59
        for (let hour = 0; hour <= 4; hour++) {
            for (let minute = 0; minute <= 59; minute++) {
                const timeStr = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                timeTableData.push({ time: timeStr, number: currentNumber });
                currentNumber++;
            }
        }
        
        // 5:00
        timeTableData.push({ time: "05:00", number: 1740 });
        
        // Hiển thị bảng giờ
        const timeTableBody = document.getElementById('timeTableBody');
        let row;
        timeTableData.forEach((item, index) => {
            if (index % 3 === 0) {
                row = document.createElement('tr');
                timeTableBody.appendChild(row);
            }
            
            const cell1 = document.createElement('td');
            cell1.textContent = item.time;
            
            const cell2 = document.createElement('td');
            cell2.textContent = item.number;
            
            row.appendChild(cell1);
            row.appendChild(cell2);
        });
        
        // Đặt ngày mặc định là hôm nay
        const today = new Date();
        const todayStr = today.toISOString().split('T')[0];
        document.getElementById('targetDate').value = todayStr;
        document.getElementById('allTargetDate').value = todayStr;
        
        // Các số đặc biệt cần tìm
        const specialNumbersP3 = [14, 41, 27, 72]; // Các giờ tim đau mỏi
        const specialNumbersP2 = [
            307, 111, 222, 333, 444, 555, 666, 777, 888, 999,
            159, 195, 168, 186, 267, 276, 249, 294, 285, 258,
            357, 375, 384, 348, 438, 483, 429, 492, 528, 582,
            537, 573, 519, 591, 627, 672, 618, 681, 726, 762,
            735, 753, 825, 852, 816, 861, 843, 834, 915, 951,
            924, 942
        ];
        
        // Danh sách người
        const people = [
            {name: "NGUYENKHACNANG", birthDate: "04/06/1944"},
            {name: "TOTHIHA", birthDate: "29/08/1948"},
            {name: "NGUYENMINHNAM", birthDate: "03/03/1971"},
            {name: "THANTHIKIMANH", birthDate: "23/09/1981"},
            {name: "NGUYENTONGANAN", birthDate: "28/09/2014"},
            {name: "NGUYENTOMINHCHAU", birthDate: "25/07/2016"},
            {name: "NGUYENTOBICHNGOC", birthDate: "05/02/2020"},
            {name: "NGUYENTHIMINHHANG", birthDate: "07/01/1974"},
            {name: "NGOQUYCUONG", birthDate: "23/05/1973"},
            {name: "NGOGIABACH", birthDate: "12/10/2000"},
            {name: "NGOGIALINH", birthDate: "05/04/2005"},
            {name: "NGUYENTHIMINHPHUONG", birthDate: "06/11/1978"},
            {name: "HOANGANHDUNG", birthDate: "21/09/1978"},
            {name: "HOANGHAIVINH", birthDate: "03/06/2010"},
            {name: "HOANGTHIENBACHANH", birthDate: "14/11/2015"},
            {name: "TÔ KIM HUỆ", birthDate: "09/08/1960"},
            {name: "NGUYỄN TUẤN ANH", birthDate: "23/10/1983"},
            {name: "NGUYỄN THẾ ANH", birthDate: "24/03/2001"},
            {name: "NGÔ THỊ MAI", birthDate: "12/12/1948"},
            {name: "TÔ VIỆT HƯNG", birthDate: "17/06/1996"},
            {name: "TÔ THỊ HỒNG", birthDate: "10/10/1964"},
            {name: "VŨ VĂN HIỆP", birthDate: "24/04/1974"},
            {name: "NGUYỄN THỊ CHI", birthDate: "08/02/1946"},
            {name: "NGUYỄN TẤN BẮC", birthDate: "30/11/1957"},
            {name: "NGUYỄN THỊ TÂM", birthDate: "08/08/1954"}
        ];
        
        // Hàm chuyển đổi ngày từ DD/MM/YYYY sang đối tượng Date
        function parseDate(dateStr) {
            const parts = dateStr.split('/');
            return new Date(parts[2], parts[1] - 1, parts[0]);
        }
        
        // Hàm tính số ngày chênh lệch
        function calculateDayDiff(birthDateStr, targetDateStr) {
            const birthDate = parseDate(birthDateStr);
            const targetDate = new Date(targetDateStr);
            
            // Tính số mili giây chênh lệch
            const diffTime = Math.abs(targetDate - birthDate);
            
            // Chuyển đổi sang ngày
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            return diffDays;
        }
        
        // Hàm cập nhật ngày sinh khi chọn người
        function updateBirthDate() {
            const select = document.getElementById('personSelect');
            if (select.value) {
                const parts = select.value.split('|');
                document.getElementById('birthDate').value = parts[1];
            }
        }
        
        // Hàm tính toán cho 1 người
        function calculateForOne() {
            const personSelect = document.getElementById('personSelect');
            const birthDateInput = document.getElementById('birthDate');
            const targetDateInput = document.getElementById('targetDate');
            
            if (!personSelect.value) {
                alert('Vui lòng chọn một người!');
                return;
            }
            
            if (!birthDateInput.value) {
                alert('Vui lòng nhập ngày sinh!');
                return;
            }
            
            if (!targetDateInput.value) {
                alert('Vui lòng chọn ngày muốn xem!');
                return;
            }
            
            // Lấy thông tin người
            const parts = personSelect.value.split('|');
            const personName = parts[0];
            const birthDate = birthDateInput.value;
            const targetDate = targetDateInput.value;
            
            // Tính toán
            const dayDiff = calculateDayDiff(birthDate, targetDate);
            
            // Thực hiện các phép tính
            const specialFoundP2 = [];
            const specialFoundP3 = [];
            
            timeTableData.forEach(item => {
                const stt = item.number;
                
                // Phép tính 1: thương chẵn
                const quotient = Math.floor(dayDiff / stt);
                
                // Phép tính 3: thương chẵn của P1 chia cho số thứ tự
                if (quotient % 2 === 0 && quotient > 0) {
                    const quotient2 = Math.floor(quotient / stt);
                    
                    // Kiểm tra số đặc biệt trong P3 (giờ tim đau mỏi)
                    if (specialNumbersP3.includes(quotient2)) {
                        specialFoundP3.push({
                            number: quotient2,
                            stt: stt,
                            time: item.time,
                            originalQuotient: quotient
                        });
                    }
                }
                
                // Phép tính 2: số dư
                const remainder = dayDiff % stt;
                
                // Kiểm tra số đặc biệt trong P2
                if (specialNumbersP2.includes(remainder)) {
                    specialFoundP2.push({
                        number: remainder,
                        stt: stt,
                        time: item.time
                    });
                }
            });
            
            // Hiển thị kết quả
            displaySingleResult(personName, birthDate, targetDate, dayDiff, specialFoundP2, specialFoundP3);
            switchTab('single');
        }
        
        // Hàm hiển thị kết quả cho 1 người
        function displaySingleResult(personName, birthDate, targetDate, dayDiff, specialP2, specialP3) {
            const resultDiv = document.getElementById('singleResult');
            let html = `
                <div class="result-item">
                    <div class="person-name">${personName}</div>
                    <div>Ngày sinh: ${birthDate}</div>
                    <div>Ngày xem: ${targetDate}</div>
                    <div class="day-diff">Số ngày chênh lệch: ${dayDiff.toLocaleString()}</div>
                </div>
            `;
            
            // Hiển thị số đặc biệt tìm được trong P3 (giờ tim đau mỏi)
            if (specialP3.length > 0) {
                html += `<div class="warning-item">
                    <strong>TÌM THẤY SỐ ĐẶC BIỆT TRONG PHÉP TÍNH 3 (Các giờ tim đau mỏi):</strong><br>`;
                
                specialP3.forEach(item => {
                    html += `<div class="special-numbers">
                        Số <span class="warning-number">${item.number}</span> 
                        tại giờ <span class="time-info">${item.time}</span> 
                        (số thứ tự: ${item.stt}, thương: ${item.originalQuotient})
                    </div>`;
                });
                
                html += `</div>`;
            }
            
            // Hiển thị số đặc biệt tìm được trong P2
            if (specialP2.length > 0) {
                html += `<div class="danger-item">
                    <strong>TÌM THẤY SỐ ĐẶC BIỆT TRONG PHÉP TÍNH 2:</strong><br>`;
                
                specialP2.forEach(item => {
                    const is307 = item.number === 307;
                    html += `<div class="special-numbers">
                        Số <span class="${is307 ? 'danger-number' : 'warning-number'}">${item.number}</span> 
                        (${is307 ? 'TỤT HUYẾT ÁP' : 'BỆNH NẶNG'}) 
                        tại giờ <span class="time-info">${item.time}</span> 
                        (số thứ tự: ${item.stt})
                    </div>`;
                });
                
                html += `</div>`;
            }
            
            if (specialP2.length === 0 && specialP3.length === 0) {
                html += `<div class="summary">
                    <h3>KHÔNG TÌM THẤY SỐ ĐẶC BIỆT</h3>
                    <p>Không tìm thấy số đặc biệt nào trong các phép tính.</p>
                </div>`;
            } else {
                html += `<div class="summary">
                    <h3>TỔNG KẾT</h3>
                    <p>Tìm thấy ${specialP2.length} số đặc biệt trong Phép tính 2 và 
                    ${specialP3.length} số đặc biệt trong Phép tính 3.</p>
                    <p><strong>Lưu ý:</strong> Cần thận trọng vào các khung giờ đã tìm thấy số đặc biệt.</p>
                </div>`;
            }
            
            resultDiv.innerHTML = html;
        }
        
        // Hàm tính toán cho tất cả mọi người
        function calculateForAll() {
            const targetDateInput = document.getElementById('allTargetDate');
            const targetDate = targetDateInput.value;
            
            if (!targetDate) {
                alert('Vui lòng chọn ngày muốn xem!');
                return;
            }
            
            // Hiển thị loading
            document.getElementById('loadingAll').classList.add('active');
            
            // Sử dụng setTimeout để tránh block UI
            setTimeout(() => {
                const allResults = [];
                
                people.forEach(person => {
                    const dayDiff = calculateDayDiff(person.birthDate, targetDate);
                    
                    const specialFoundP2 = [];
                    const specialFoundP3 = [];
                    
                    // Tính toán các phép tính
                    timeTableData.forEach(item => {
                        const stt = item.number;
                        
                        // Phép tính 1 và 3
                        const quotient = Math.floor(dayDiff / stt);
                        
                        // Phép tính 3
                        if (quotient % 2 === 0 && quotient > 0) {
                            const quotient2 = Math.floor(quotient / stt);
                            
                            // Kiểm tra số đặc biệt trong P3
                            if (specialNumbersP3.includes(quotient2)) {
                                specialFoundP3.push({
                                    number: quotient2,
                                    stt: stt,
                                    time: item.time,
                                    originalQuotient: quotient
                                });
                            }
                        }
                        
                        // Phép tính 2
                        const remainder = dayDiff % stt;
                        
                        // Kiểm tra số đặc biệt trong P2
                        if (specialNumbersP2.includes(remainder)) {
                            specialFoundP2.push({
                                number: remainder,
                                stt: stt,
                                time: item.time
                            });
                        }
                    });
                    
                    allResults.push({
                        name: person.name,
                        birthDate: person.birthDate,
                        dayDiff: dayDiff,
                        specialP2: specialFoundP2,
                        specialP3: specialFoundP3
                    });
                });
                
                // Hiển thị kết quả
                displayAllResults(allResults, targetDate);
                document.getElementById('loadingAll').classList.remove('active');
                switchTab('all');
            }, 100);
        }
        
        // Hàm hiển thị kết quả cho tất cả mọi người
        function displayAllResults(results, targetDate) {
            const resultDiv = document.getElementById('allResult');
            let html = `<h3>KẾT QUẢ TÍNH TOÁN CHO ${results.length} NGƯỜI</h3>
                       <p>Ngày xem: ${targetDate}</p>`;
            
            let hasSpecialResults = false;
            
            results.forEach(person => {
                if (person.specialP2.length > 0 || person.specialP3.length > 0) {
                    hasSpecialResults = true;
                    
                    // Xác định loại cảnh báo
                    let itemClass = 'result-item';
                    if (person.specialP2.length > 0) itemClass = 'danger-item';
                    if (person.specialP3.length > 0 && person.specialP2.length === 0) itemClass = 'warning-item';
                    
                    html += `<div class="${itemClass}">`;
                    html += `<div class="person-name">${person.name}</div>`;
                    html += `<div>Ngày sinh: ${person.birthDate}</div>`;
                    html += `<div class="day-diff">Số ngày chênh lệch: ${person.dayDiff.toLocaleString()}</div>`;
                    
                    if (person.specialP3.length > 0) {
                        html += `<div style="margin-top: 8px;"><strong>Số đặc biệt Phép tính 3 (giờ tim đau mỏi):</strong></div>`;
                        person.specialP3.forEach(item => {
                            html += `<div class="special-numbers" style="margin: 4px 0; padding: 6px;">
                                Số <span class="warning-number">${item.number}</span> 
                                tại giờ <span class="time-info">${item.time}</span>
                            </div>`;
                        });
                    }
                    
                    if (person.specialP2.length > 0) {
                        html += `<div style="margin-top: 8px;"><strong>Số đặc biệt Phép tính 2:</strong></div>`;
                        person.specialP2.forEach(item => {
                            const is307 = item.number === 307;
                            html += `<div class="special-numbers" style="margin: 4px 0; padding: 6px;">
                                Số <span class="${is307 ? 'danger-number' : 'warning-number'}">${item.number}</span> 
                                (${is307 ? 'TỤT HUYẾT ÁP' : 'BỆNH NẶNG'}) 
                                tại giờ <span class="time-info">${item.time}</span>
                            </div>`;
                        });
                    }
                    
                    html += `</div>`;
                }
            });
            
            if (!hasSpecialResults) {
                html += `<div class="summary">
                    <h3>KHÔNG TÌM THẤY SỐ ĐẶC BIỆT</h3>
                    <p>Không tìm thấy số đặc biệt nào trong các phép tính cho tất cả ${results.length} người.</p>
                </div>`;
            } else {
                // Đếm tổng số người có số đặc biệt
                const peopleWithSpecial = results.filter(p => 
                    p.specialP2.length > 0 || p.specialP3.length > 0
                ).length;
                
                html += `<div class="summary">
                    <h3>TỔNG KẾT</h3>
                    <p>Có ${peopleWithSpecial} người có số đặc biệt trong tổng số ${results.length} người.</p>
                    <p><strong>Lưu ý:</strong> Những người này cần thận trọng vào các khung giờ đã tìm thấy số đặc biệt.</p>
                </div>`;
            }
            
            resultDiv.innerHTML = html;
        }
        
        // Hàm chuyển tab
        function switchTab(tabName) {
            // Ẩn tất cả các tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Hiển thị tab được chọn
            if (tabName === 'single') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('singleResult').classList.add('active');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('allResult').classList.add('active');
            }
        }
        
        // Khởi tạo: đặt ngày mặc định
        window.onload = function() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            document.getElementById('targetDate').value = todayStr;
            document.getElementById('allTargetDate').value = todayStr;
        };
    </script>
</body>
</html>