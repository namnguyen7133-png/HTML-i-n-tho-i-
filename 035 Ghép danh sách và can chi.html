<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Tính Can Chi và Ghép Phần Tử Tùy Chỉnh</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, button, textarea {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 16px;
        }
        input, textarea {
            width: 100%;
            box-sizing: border-box;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .result {
            margin-top: 30px;
            padding: 20px;
            background-color: #ecf0f1;
            border-radius: 5px;
            display: none;
        }
        .result h2 {
            margin-top: 0;
            color: #2c3e50;
        }
        .can-chi {
            font-size: 24px;
            font-weight: bold;
            color: #e74c3c;
            text-align: center;
            margin: 20px 0;
        }
        .explanation {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .step {
            margin-bottom: 10px;
        }
        .highlight {
            background-color: #fffacd;
            padding: 2px 5px;
            border-radius: 3px;
        }
        .elements-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .element-item {
            background-color: #e0f7fa;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
        }
        .element-item.selected {
            background-color: #4caf50;
            color: white;
            font-weight: bold;
        }
        .instructions {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .calculation {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        .rule-example {
            background-color: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Game Tính Can Chi và Ghép Phần Tử Tùy Chỉnh</h1>
        
        <div class="input-group">
            <label for="date">Nhập ngày cần tính (dd/mm/yyyy):</label>
            <input type="text" id="date" placeholder="Ví dụ: 15/05/2023" value="15/05/2023">
        </div>
        
        <div class="input-group">
            <label for="elements">Nhập các phần tử muốn ghép (mỗi phần tử trên một dòng):</label>
            <textarea id="elements" rows="6" placeholder="Ví dụ:
A
B
C
D
E
Kim
Mộc
Thủy
Hỏa
Thổ">A
B
C</textarea>
            <div class="instructions">Nhập các phần tử (tối thiểu 1 phần tử). Hệ thống sẽ tính: số dư % số phần tử = 0 → phần tử cuối, = 1 → phần tử đầu, = 2 → phần tử thứ 2, v.v.</div>
        </div>
        
        <button id="calculate">Tính Can Chi và Ghép Phần Tử</button>
        
        <div class="result" id="result">
            <h2>Kết Quả</h2>
            <div class="can-chi" id="canChiResult"></div>
            
            <div class="explanation">
                <h3>Cách tính:</h3>
                <div class="step">1. Mốc tính: Ngày 1/1/1900 là <span class="highlight">Giáp Tuất, Đinh Sửu, Ất Hợi</span></div>
                <div class="step">2. Tính số ngày từ mốc đến ngày cần xem: <span class="highlight" id="daysCount"></span> ngày</div>
                <div class="step">3. Chia số ngày cho 60 (chu kỳ Can Chi): <span class="highlight" id="divisionResult"></span></div>
                <div class="step">4. Số dư để tra bảng Can Chi: <span class="highlight" id="remainderResult"></span></div>
                <div class="step">5. Kết quả Can Chi: <span class="highlight" id="canChiStep"></span></div>
                
                <div class="calculation">
                    <div class="step"><strong>Ghép phần tử:</strong></div>
                    <div class="step">- Lấy số dư <span id="remainderValue"></span> chia cho số phần tử (<span id="elementCount"></span>)</div>
                    <div class="step">- Kết quả: <span id="elementCalculation"></span></div>
                    <div class="step">- Quy tắc: 
                        <ul>
                            <li>Nếu số dư = 0 → lấy phần tử cuối cùng (thứ <span id="lastElementIndex"></span>)</li>
                            <li>Nếu số dư = 1 → lấy phần tử đầu tiên (thứ 1)</li>
                            <li>Nếu số dư = 2 → lấy phần tử thứ 2</li>
                            <li>Nếu số dư = 3 → lấy phần tử thứ 3</li>
                            <li>...</li>
                        </ul>
                    </div>
                    <div class="step">- Kết quả ghép phần tử: <span class="highlight" id="elementStep"></span></div>
                    
                    <div class="rule-example">
                        <strong>Ví dụ:</strong><br>
                        - Với 3 phần tử: số dư % 3 = 0 → phần tử 3, = 1 → phần tử 1, = 2 → phần tử 2<br>
                        - Với 5 phần tử: số dư % 5 = 0 → phần tử 5, = 1 → phần tử 1, = 2 → phần tử 2, = 3 → phần tử 3, = 4 → phần tử 4
                    </div>
                </div>
                
                <div class="step">6. Kết quả cuối cùng: <span class="highlight" id="finalResult"></span></div>
                
                <div class="step" style="margin-top: 15px;">
                    <strong>Danh sách phần tử (<span id="totalElements"></span> phần tử):</strong>
                    <div class="elements-list" id="elementsList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('calculate').addEventListener('click', function() {
            const dateInput = document.getElementById('date').value;
            const elementsInput = document.getElementById('elements').value;
            
            const dateParts = dateInput.split('/');
            
            if (dateParts.length !== 3) {
                alert('Vui lòng nhập ngày theo định dạng dd/mm/yyyy');
                return;
            }
            
            // Xử lý danh sách phần tử
            const elements = elementsInput.split('\n')
                .map(el => el.trim())
                .filter(el => el.length > 0);
            
            if (elements.length === 0) {
                alert('Vui lòng nhập ít nhất một phần tử');
                return;
            }
            
            const day = parseInt(dateParts[0]);
            const month = parseInt(dateParts[1]);
            const year = parseInt(dateParts[2]);
            
            if (isNaN(day) || isNaN(month) || isNaN(year)) {
                alert('Vui lòng nhập ngày hợp lệ');
                return;
            }
            
            // Tính số ngày từ 1/1/1900 đến ngày nhập
            const baseDate = new Date(1900, 0, 1); // 1/1/1900
            const inputDate = new Date(year, month - 1, day);
            
            if (inputDate < baseDate) {
                alert('Ngày nhập phải từ 1/1/1900 trở đi');
                return;
            }
            
            // Tính số ngày chênh lệch
            const timeDiff = inputDate.getTime() - baseDate.getTime();
            const daysDiff = Math.floor(timeDiff / (1000 * 3600 * 24));
            
            // Tính Can Chi
            const remainder = (daysDiff % 60) + 1;
            
            // Bảng Can Chi
            const canChiList = [
                "Giáp Tuất", "Ất Hợi", "Bính Tý", "Đinh Sửu", "Mậu Dần", "Kỷ Mão", 
                "Canh Thìn", "Tân Tỵ", "Nhâm Ngọ", "Quý Mùi", "Giáp Thân", "Ất Dậu", 
                "Bính Tuất", "Đinh Hợi", "Mậu Tý", "Kỷ Sửu", "Canh Dần", "Tân Mão", 
                "Nhâm Thìn", "Quý Tỵ", "Giáp Ngọ", "Ất Mùi", "Bính Thân", "Đinh Dậu", 
                "Mậu Tuất", "Kỷ Hợi", "Canh Tý", "Tân Sửu", "Nhâm Dần", "Quý Mão", 
                "Giáp Thìn", "Ất Tỵ", "Bính Ngọ", "Đinh Mùi", "Mậu Thân", "Kỷ Dậu", 
                "Canh Tuất", "Tân Hợi", "Nhâm Tý", "Quý Sửu", "Giáp Dần", "Ất Mão", 
                "Bính Thìn", "Đinh Tỵ", "Mậu Ngọ", "Kỷ Mùi", "Canh Thân", "Tân Dậu", 
                "Nhâm Tuất", "Quý Hợi", "Giáp Tý", "Ất Sửu", "Bính Dần", "Đinh Mão", 
                "Mậu Thìn", "Kỷ Tỵ", "Canh Ngọ", "Tân Mùi", "Nhâm Thân", "Quý Dậu"
            ];
            
            const canChi = canChiList[remainder - 1];
            
            // Tính phần tử theo quy tắc mới
            const elementRemainder = remainder % elements.length;
            let elementIndex;
            let element;
            
            if (elementRemainder === 0) {
                elementIndex = elements.length - 1; // Phần tử cuối cùng
                element = elements[elementIndex];
            } else {
                elementIndex = elementRemainder - 1; // Phần tử thứ (số dư)
                element = elements[elementIndex];
            }
            
            // Hiển thị kết quả
            document.getElementById('daysCount').textContent = daysDiff;
            document.getElementById('divisionResult').textContent = `${daysDiff} / 60 = ${Math.floor(daysDiff / 60)} dư ${daysDiff % 60}`;
            document.getElementById('remainderResult').textContent = remainder;
            document.getElementById('canChiStep').textContent = canChi;
            
            document.getElementById('remainderValue').textContent = remainder;
            document.getElementById('elementCount').textContent = elements.length;
            document.getElementById('elementCalculation').textContent = `${remainder} % ${elements.length} = ${elementRemainder}`;
            document.getElementById('lastElementIndex').textContent = elements.length;
            document.getElementById('elementStep').textContent = `${element} (phần tử thứ ${elementIndex + 1})`;
            document.getElementById('finalResult').textContent = `${canChi} ${element}`;
            document.getElementById('canChiResult').textContent = `${canChi} ${element}`;
            document.getElementById('totalElements').textContent = elements.length;
            
            // Hiển thị danh sách phần tử với phần tử được chọn
            const elementsList = document.getElementById('elementsList');
            elementsList.innerHTML = '';
            elements.forEach((el, index) => {
                const elementItem = document.createElement('div');
                elementItem.className = 'element-item';
                if (index === elementIndex) {
                    elementItem.classList.add('selected');
                }
                elementItem.textContent = `${index + 1}: ${el}`;
                elementsList.appendChild(elementItem);
            });
            
            document.getElementById('result').style.display = 'block';
        });
    </script>
</body>
</html>