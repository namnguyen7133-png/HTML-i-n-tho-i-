<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tính Toán Can Chi và Vận Mệnh</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 10px;
            margin: 0;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        h1, h2, h3 {
            color: #2c3e50;
            text-align: center;
            word-wrap: break-word;
        }
        
        h1 {
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .input-section {
            background-color: #ecf0f1;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            width: 100%;
        }
        
        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
            font-size: 14px;
        }
        
        input, select, button {
            padding: 8px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 14px;
            width: 100%;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: bold;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .tables-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .table-wrapper {
            overflow-x: auto;
            margin-bottom: 15px;
            -webkit-overflow-scrolling: touch;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            font-size: 12px;
            min-width: 300px;
        }
        
        th, td {
            border: 1px solid #bdc3c7;
            padding: 4px;
            text-align: center;
            min-width: 30px;
            word-break: break-word;
        }
        
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .result-section {
            background-color: #d5f4e6;
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            display: none;
        }
        
        .result-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        
        .result-card {
            background-color: #fff;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 3px rgba(0,0,0,0.1);
        }
        
        .people-list {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            padding: 5px;
            margin-top: 5px;
        }
        
        .people-item {
            padding: 6px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            font-size: 12px;
        }
        
        .people-item:hover {
            background-color: #e3f2fd;
        }
        
        .number-1 {
            background-color: #ffeb3b !important;
            font-weight: bold;
        }
        
        .age-column {
            background-color: #e8f4f8 !important;
        }
        
        .yellow-point {
            background-color: #ffeb3b !important;
            font-weight: bold;
            color: #333;
        }
        
        .year-row {
            background-color: #e8f4f8 !important;
            font-weight: bold;
        }
        
        .age-row {
            background-color: #f0f8ff !important;
            font-weight: bold;
        }
        
        .table-scroll {
            overflow-x: auto;
            width: 100%;
        }
        
        @media (min-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .input-section {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .input-group {
                flex: 1;
                min-width: 200px;
            }
            
            .result-grid {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .result-card {
                flex: 1;
                min-width: 200px;
            }
            
            table {
                font-size: 13px;
            }
            
            th, td {
                padding: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Tính Toán Can Chi và Vận Mệnh</h1>
        
        <div class="input-section">
            <div class="input-group">
                <label for="birthdate">Ngày tháng năm sinh:</label>
                <input type="date" id="birthdate" value="1971-03-03">
            </div>
            
            <div class="input-group">
                <label for="fullname">Họ và tên:</label>
                <input type="text" id="fullname" placeholder="Nhập họ tên đầy đủ" value="NGUYENMINHNAM">
            </div>
            
            <div class="input-group">
                <label>Danh sách người nhà:</label>
                <select id="people-select">
                    <option value="">Chọn từ danh sách</option>
                </select>
                <div class="people-list" id="people-list">
                </div>
            </div>
            
            <div class="input-group">
                <button id="calculate-btn">Tính Toán</button>
            </div>
        </div>
        
        <div class="result-section" id="result-section">
          
  
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tính theo ngày 1900</title>
</head>
<body>

<!-- Ô 1: nhập ngày sinh -->
<label>Ô 1 - Ngày sinh:</label>
<input type="date" id="o1">
<button onclick="tinhToan()">Tính</button>

<hr>

<p>Kết quả theo ngày sinh: <b id="ketQuaSinh"></b></p>
<p>Kết quả theo ngày hiện tại: <b id="ketQuaHienTai"></b></p>

<script>
    // ===== BẢNG 2 =====
    const bang2_12 = [
        "KQ 0", "KQ 1", "KQ 2", "KQ 3",
        "KQ 4", "KQ 5", "KQ 6", "KQ 7",
        "KQ 8", "KQ 9", "KQ 10", "KQ 11"
    ];

    const bang2_13 = [
        "KQ 0", "KQ 1", "KQ 2", "KQ 3",
        "KQ 4", "KQ 5", "KQ 6", "KQ 7",
        "KQ 8", "KQ 9", "KQ 10", "KQ 11",
        "KQ 12"
    ];

    // ===== HÀM TÍNH SỐ NGÀY TỪ 01/01/1900 =====
    function soNgayTu1900(date) {
        const moc = new Date(1900, 0, 1);
        const msPerDay = 24 * 60 * 60 * 1000;
        return Math.floor((date - moc) / msPerDay);
    }

    function tinhToan() {
        // LẤY NGÀY SINH TỪ Ô 1
        const giaTriO1 = document.getElementById("o1").value;
        if (!giaTriO1) {
            alert("Vui lòng nhập ngày sinh ở ô 1");
            return;
        }

        const ngaySinh = new Date(giaTriO1);
        const ngayHienTai = new Date();

        // ---- TÍNH NGÀY SINH ----
        const soNgaySinh = soNgayTu1900(ngaySinh);
        const chiSoSinh = Math.floor(soNgaySinh / 90) % 12;
        const ketQuaSinh = bang2_12[chiSoSinh];

        // ---- TÍNH NGÀY HIỆN TẠI ----
        const soNgayHT = soNgayTu1900(ngayHienTai);
        const chiSoHT = Math.floor(soNgayHT / 90) % 13;
        const ketQuaHT = bang2_13[chiSoHT];

        // ---- HIỂN THỊ ----
        document.getElementById("ketQuaSinh").innerText = ketQuaSinh;
        document.getElementById("ketQuaHienTai").innerText = ketQuaHT;
    }
</script>

</body>
</html>


<h3>Kết Quả Tính Toán</h3>
            <div class="result-grid">
                <div class="result-card">
                    <h4>Thông Tin Cá Nhân</h4>
                    <p id="personal-info"></p>
                </div>
                <div class="result-card">
                    <h4>Can Chi Năm Sinh</h4>
                    <p id="canchi-result"></p>
                </div>
                <div class="result-card">
                    <h4>Số Từ Tên</h4>
                    <p id="name-number"></p>
                </div>
            </div>
            
            <div class="result-grid">
                <div class="result-card">
                    <h4>Tiền Vận</h4>
                    <p id="tien-van"></p>
                </div>
                <div class="result-card">
                    <h4>Trung Vận</h4>
                    <p id="trung-van"></p>
                </div>
                <div class="result-card">
                    <h4>Hậu Vận</h4>
                    <p id="hau-van"></p>
                </div>
            </div>
        </div>
        
        <h2>Bảng Tra Cứu</h2>
        
        <div class="tables-container">
            <div class="table-wrapper">
                <h3>Bảng 1: Can Chi</h3>
                <div class="table-scroll">
                    <table id="table1">
                        <thead>
                            <tr>
                                <th>Số</th>
                                <th>Can Chi</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="table-wrapper">
                <h3>Bảng 2: Số Can Chi</h3>
                <div class="table-scroll">
                    <table id="table2">
                        <thead>
                            <tr>
                                <th>Can Chi</th>
                                <th>Số</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="table-wrapper">
                <h3>Bảng 3: Tính Toán Chi Tiết</h3>
                <div class="table-scroll">
                    <table id="table3">
                    </table>
                </div>
            </div>
        </div>
        
        <div class="table-wrapper">
            <h3>Bảng 4: Tổng Hợp Vận Mệnh</h3>
            <div class="table-scroll">
                <table id="table4">
                </table>
            </div>
        </div>
        
        <div class="table-wrapper">
            <h3>Bảng 5: Biểu Đồ Vận Mệnh</h3>
            <div class="table-scroll">
                <table id="table5">
                </table>
            </div>
        </div>
        
        <div class="tables-container">
            <div class="table-wrapper">
                <h3>Bảng 6: Giải Nghĩa Số</h3>
                <div class="table-scroll">
                    <table id="table6">
                        <thead>
                            <tr>
                                <th>Số</th>
                                <th>Ý Nghĩa</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="table-wrapper">
                <h3>Bảng 7: Sinh</h3>
                <div class="table-scroll">
                    <table id="table7">
                        <thead>
                            <tr>
                                <th>Số</th>
                                <th>Ý Nghĩa</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="table-wrapper">
                <h3>Bảng 8: Sinh - Lão - Bệnh - Tử</h3>
                <div class="table-scroll">
                    <table id="table8">
                    </table>
                </div>
            </div>
            
            <div class="table-wrapper">
                <h3>Bảng 9: Đối Số</h3>
                <div class="table-scroll">
                    <table id="table9">
                        <thead>
                            <tr>
                                <th>Số</th>
                                <th>Đối Số</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DANH SÁCH TÊN MỚI - ĐÃ THAY ĐỔI
        const peopleData = [
            { name: "NGUYỄN KHẮC NĂNG", dob: "1944-06-04" },
            { name: "TÔ THỊ HÀ", dob: "1948-08-29" },
            { name: "NGUYỄN MINH NAM", dob: "1971-03-03" },
            { name: "THÂN THỊ KIM ANH", dob: "1981-09-23" },
            { name: "NGUYỄN TÔ NGÂN AN", dob: "2014-09-28" },
            { name: "NGUYỄN TÔ MINH CHÂU", dob: "2016-07-25" },
            { name: "NGUYỄN TÔ BÍCH NGỌC", dob: "2020-02-05" },
            { name: "NGUYỄN THỊ MINH HẰNG", dob: "1974-01-07" },
            { name: "NGÔ QUÝ CƯỜNG", dob: "1973-05-23" },
            { name: "NGÔ GIA BÁCH", dob: "2000-10-12" },
            { name: "NGÔ GIA LINH", dob: "2005-04-05" },
            { name: "NGUYỄN THỊ MINH PHƯƠNG", dob: "1978-11-06" },
            { name: "HOÀNG ANH DŨNG", dob: "1978-09-21" },
            { name: "HOÀNG HẢI VINH", dob: "2010-06-03" },
            { name: "HOÀNG THIÊN BẠCH ANH", dob: "2015-11-14" },
            { name: "TÔ KIM HUỆ", dob: "1960-08-09" },
            { name: "NGUYỄN TUẤN ANH", dob: "1983-10-23" },
            { name: "NGUYỄN THẾ ANH", dob: "2001-03-24" },
            { name: "NGÔ THỊ MAI", dob: "1948-12-12" },
            { name: "TÔ VIỆT HƯNG", dob: "1996-06-17" },
            { name: "TÔ THỊ HỒNG", dob: "1964-10-10" },
            { name: "VŨ VĂN HIỆP", dob: "1974-04-24" },
            { name: "NGUYỄN THỊ CHI", dob: "1946-02-08" },
            { name: "NGUYỄN TẤN BẮC", dob: "1957-11-30" },
            { name: "NGUYỄN THỊ TÂM", dob: "1954-08-08" },
            { name: "THÂN VĂN GIỮ", dob: "1955-04-18" },
            { name: "NGUYỄN THỊ BÌNH", dob: "1958-05-21" },
            { name: "THÂN THỊ BÍCH NGUYỆT", dob: "1980-05-21" },
            { name: "THÂN VĂN TUẤN", dob: "1983-05-21" },
            { name: "THÂN YẾN NHI", dob: "2010-03-26" },
            { name: "LÊ THỊ PHƯƠNG", dob: "1990-06-26" },
            { name: "NGUYỄN HOÀI NAM", dob: "2004-06-02" }
        ];

        // Bảng dữ liệu
        const table1Data = [
            { number: 4, canchi: "TÝ" },
            { number: 10, canchi: "NGỌ" },
            { number: 5, canchi: "SỬU" },
            { number: 11, canchi: "MÙI" },
            { number: 6, canchi: "DẦN" },
            { number: 12, canchi: "THÂN" },
            { number: 7, canchi: "MÃO" },
            { number: 1, canchi: "DẬU" },
            { number: 8, canchi: "THÌN" },
            { number: 2, canchi: "TUẤT" },
            { number: 9, canchi: "TỴ" },
            { number: 3, canchi: "HỢI" }
        ];

        const table2Data = [
            { canchi: "TÝ", number: 1 },
            { canchi: "NGỌ", number: 1 },
            { canchi: "SỬU", number: 2 },
            { canchi: "MÙI", number: 2 },
            { canchi: "DẦN", number: 3 },
            { canchi: "THÂN", number: 3 },
            { canchi: "MÃO", number: 4 },
            { canchi: "DẬU", number: 4 },
            { canchi: "THÌN", number: 5 },
            { canchi: "TUẤT", number: 5 },
            { canchi: "TỴ", number: 6 },
            { canchi: "HỢI", number: 6 }
        ];

        const table6Data = [
            { number: 1, meaning: "May mắn XO SO" },
            { number: 2, meaning: "Thăng chức" },
            { number: 3, meaning: "Tài sản" },
            { number: 4, meaning: "Bất động sản" },
            { number: 5, meaning: "Vui sướng" },
            { number: 6, meaning: "Chết, Hóa thân" },
            { number: 7, meaning: "Làm ăn, sản xuất" },
            { number: 8, meaning: "Mua bán nhỏ" },
            { number: 9, meaning: "Bằng cấp" },
            { number: 10, meaning: "Xa nhà" },
            { number: 11, meaning: "Day dứt" },
            { number: 12, meaning: "Đau bại" }
        ];

        // Bảng 5: Các ý nghĩa cho Biểu Đồ Vận Mệnh
        const table5MeaningData = [
            { number: 1, meaning: "May mắn" },
            { number: 2, meaning: "Quyền lực" },
            { number: 3, meaning: "Giàu có" },
            { number: 4, meaning: "Của cải" },
            { number: 5, meaning: "Hạnh phúc" },
            { number: 6, meaning: "Tai nạn" },
            { number: 7, meaning: "Hợp tác, LD" },
            { number: 8, meaning: "Tiểu thương" },
            { number: 9, meaning: "Học vấn" },
            { number: 10, meaning: "Xuất ngoại" },
            { number: 11, meaning: "Khổ tâm" },
            { number: 12, meaning: "Bệnh tật" }
        ];

        const table7Data = [
            { number: 1, meaning: "Sinh - Lãnh đạo, Quản lý - Đứng đầu, Tổ chức" }
        ];

        const table8Data = [
            { number: 1, sinh: "Sinh", pho: "Lãnh đạo, Quản lý", troly: "Đứng đầu, Tổ chức" },
            { number: 2, sinh: "Lão", pho: "Phó, Quân sư", troly: "Trợ lý" },
            { number: 3, sinh: "Bệnh", pho: "Ốm đau", troly: "CNV" },
            { number: 4, sinh: "Tử", pho: "Rất có tài, Chết bất đắc kỳ tử, Không đứng đầu", troly: "Đòi nợ, phá sản - Ko gom vốn" }
        ];

        const table9Data = [
            { number: 12, opposite: 1 },
            { number: 11, opposite: 2 },
            { number: 10, opposite: 3 },
            { number: 9, opposite: 4 },
            { number: 8, opposite: 5 },
            { number: 7, opposite: 6 },
            { number: 6, opposite: 7 },
            { number: 5, opposite: 8 },
            { number: 4, opposite: 9 },
            { number: 3, opposite: 10 },
            { number: 2, opposite: 11 },
            { number: 1, opposite: 12 }
        ];

        // Khởi tạo dữ liệu
        document.addEventListener('DOMContentLoaded', function() {
            // Khởi tạo danh sách người
            initializePeopleList();
            
            // Khởi tạo các bảng
            initializeTable1();
            initializeTable2();
            initializeTable6();
            initializeTable7();
            initializeTable8();
            initializeTable9();
            
            // Gắn sự kiện
            document.getElementById('calculate-btn').addEventListener('click', calculate);
            document.getElementById('people-select').addEventListener('change', selectPerson);
            
            // Tính toán ngay khi tải trang
            setTimeout(calculate, 100);
        });

        function initializePeopleList() {
            const select = document.getElementById('people-select');
            const list = document.getElementById('people-list');
            
            // Xóa các mục cũ
            select.innerHTML = '<option value="">Chọn từ danh sách</option>';
            list.innerHTML = '';
            
            // Sắp xếp theo tên để dễ tìm
            const sortedPeople = [...peopleData].sort((a, b) => a.name.localeCompare(b.name));
            
            sortedPeople.forEach(person => {
                // Thêm vào select
                const option = document.createElement('option');
                option.value = person.dob;
                option.textContent = `${person.name} (${formatDate(person.dob)})`;
                select.appendChild(option);
                
                // Thêm vào danh sách cuộn
                const item = document.createElement('div');
                item.className = 'people-item';
                item.textContent = `${person.name} (${formatDate(person.dob)})`;
                item.addEventListener('click', () => {
                    document.getElementById('birthdate').value = person.dob;
                    document.getElementById('fullname').value = person.name;
                    select.value = person.dob;
                    calculate();
                });
                list.appendChild(item);
            });
        }

        function selectPerson() {
            const selectedValue = document.getElementById('people-select').value;
            if (selectedValue) {
                const person = peopleData.find(p => p.dob === selectedValue);
                if (person) {
                    document.getElementById('birthdate').value = person.dob;
                    document.getElementById('fullname').value = person.name;
                    calculate();
                }
            }
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
        }

        function initializeTable1() {
            const tbody = document.querySelector('#table1 tbody');
            table1Data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${item.number}</td><td>${item.canchi}</td>`;
                tbody.appendChild(row);
            });
        }

        function initializeTable2() {
            const tbody = document.querySelector('#table2 tbody');
            table2Data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${item.canchi}</td><td>${item.number}</td>`;
                tbody.appendChild(row);
            });
        }

        function initializeTable6() {
            const tbody = document.querySelector('#table6 tbody');
            table6Data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${item.number}</td><td>${item.meaning}</td>`;
                tbody.appendChild(row);
            });
        }

        function initializeTable7() {
            const tbody = document.querySelector('#table7 tbody');
            table7Data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${item.number}</td><td>${item.meaning}</td>`;
                tbody.appendChild(row);
            });
        }

        function initializeTable8() {
            const table = document.getElementById('table8');
            table.innerHTML = '';
            
            // Tạo tiêu đề
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr>
                    <th>Số</th>
                    <th>Sinh</th>
                    <th>Phó</th>
                    <th>Trợ lý</th>
                </tr>
            `;
            table.appendChild(thead);
            
            // Tạo thân bảng
            const tbody = document.createElement('tbody');
            table8Data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.number}</td>
                    <td>${item.sinh}</td>
                    <td>${item.pho}</td>
                    <td>${item.troly}</td>
                `;
                tbody.appendChild(row);
            });
            table.appendChild(tbody);
        }

        function initializeTable9() {
            const tbody = document.querySelector('#table9 tbody');
            table9Data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${item.number}</td><td>${item.opposite}</td>`;
                tbody.appendChild(row);
            });
        }

        function calculate() {
            const birthdate = document.getElementById('birthdate').value;
            const fullname = document.getElementById('fullname').value.trim();
            
            if (!birthdate) {
                alert('Vui lòng nhập ngày tháng năm sinh');
                return;
            }
            
            // Hiển thị kết quả
            document.getElementById('result-section').style.display = 'block';
            
            // Lấy thông tin từ ngày sinh
            const date = new Date(birthdate);
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            
            // Tính Can Chi năm
            let yearMod = year % 12;
            if (yearMod === 0) yearMod = 12;
            
            // Tìm Can Chi từ bảng 1
            const canchiItem = table1Data.find(item => item.number === yearMod);
            const canchi = canchiItem ? canchiItem.canchi : "Không xác định";
            
            // Tìm số từ bảng 2
            const numberItem = table2Data.find(item => item.canchi === canchi);
            const canchiNumber = numberItem ? numberItem.number : 1;
            
            // Tính toán bảng 3 (THEO YÊU CẦU MỚI)
            calculateTable3(year, month, day);
            
            // Tính toán bảng 4
            calculateTable4();
            
            // Tính toán bảng 5 (THEO YÊU CẦU MỚI)
            calculateTable5(year, month, day);
            
            // Hiển thị thông tin cá nhân
            document.getElementById('personal-info').textContent = 
                `Ngày sinh: ${formatDate(birthdate)} (${day}/${month}/${year})`;
            
            document.getElementById('canchi-result').textContent = 
                `Năm ${year} mod 12 = ${yearMod} → ${canchi} (Số ${canchiNumber})`;
            
            // Tính số từ tên
            if (fullname) {
                // Đếm số chữ cái (không tính khoảng trắng)
                const letterCount = fullname.replace(/\s+/g, '').length;
                const nameMod = letterCount % 4 || 4;
                
                document.getElementById('name-number').textContent = 
                    `Tên: ${fullname} - Số chữ: ${letterCount} - mod 4 = ${nameMod}`;
                
                // Hiển thị thông tin từ bảng 8
                const table8Item = table8Data.find(item => item.number === nameMod);
                if (table8Item) {
                    document.getElementById('name-number').textContent += 
                        ` → ${table8Item.sinh} - ${table8Item.pho}`;
                }
            } else {
                document.getElementById('name-number').textContent = "Chưa nhập tên";
            }
            
            // Tính toán và hiển thị các vận
            calculateVanMenh();
        }

        function calculateTable3(year, month, day) {
            const table3 = document.getElementById('table3');
            table3.innerHTML = '';
            
            // Tạo tiêu đề
            const headerRow = document.createElement('tr');
            headerRow.innerHTML = '<th></th>';
            for (let i = 1; i <= 12; i++) {
                headerRow.innerHTML += `<th>${i}</th>`;
            }
            table3.appendChild(headerRow);
            
            // Dòng 1: Quý - THEO YÊU CẦU MỚI
            const row1 = document.createElement('tr');
            row1.innerHTML = '<td>1. Quý</td>';
            let quyValues = [];
            
            // Tính quý theo yêu cầu mới: (ngày sinh - 1/1/1900) / 90 lấy chẵn, Mod 12 nếu = 0 lấy 12
            const startDate = new Date('1900-01-01');
            const birthDate = new Date(year, month - 1, day);
            const diffTime = Math.abs(birthDate - startDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            // Tính: (ngày sinh - ngày 1/1/1900) / 90 lấy chẵn, Mod 12 nếu = 0 lấy 12
            const temp1 = Math.floor(diffDays / 90);
            const temp2 = temp1 % 12;
            const quyValue = temp2 === 0 ? 12 : temp2;
            
            // Tra bảng 2 cột 2 lấy kết quả tương ứng cột 1
            const table2Item = table2Data.find(item => item.number === quyValue);
            const canChiFromTable2 = table2Item ? table2Item.canchi : "TÝ";
            
            // Tra bảng 1, cột 2 lấy kết quả cột 1 tương ứng trừ 1 làm điểm bắt đầu
            const table1Item = table1Data.find(item => item.canchi === canChiFromTable2);
            let startValue = table1Item ? table1Item.number - 1 : 0;
            if (startValue === 0) startValue = 12;
            
            // Điền giá trị cho cột 1-6
            for (let i = 0; i < 12; i++) {
                if (i < 6) {
                    // Cột 1-6: Mỗi cột tăng dần thêm 1 so với cột trước
                    let value = startValue + i;
                    if (value > 12) value -= 12;
                    if (value === 0) value = 12;
                    quyValues.push(value);
                } else {
                    // Cột 7-12: Để trống không có giá trị
                    quyValues.push('');
                }
                row1.innerHTML += `<td>${quyValues[i]}</td>`;
            }
            table3.appendChild(row1);
            
            // Dòng 2: Tháng sinh - GIỮ NGUYÊN
            const row2 = document.createElement('tr');
            row2.innerHTML = '<td>2. Tháng sinh</td>';
            let monthValues = [];
            
            // Lấy tháng sinh trừ 1 làm điểm bắt đầu
            // Nếu bằng 0 thì lấy 12
            let monthStart = month - 1;
            if (monthStart === 0) monthStart = 12;
            
            for (let i = 0; i < 12; i++) {
                let value = monthStart + i;
                if (value > 12) value -= 12;
                if (value === 0) value = 12;
                monthValues.push(value);
                row2.innerHTML += `<td>${value}</td>`;
            }
            table3.appendChild(row2);
            
            // Dòng 3: Ngày sinh - GIỮ NGUYÊN
            const row3 = document.createElement('tr');
            row3.innerHTML = '<td>3. Ngày sinh</td>';
            let dayValues = [];
            
            // Lấy ngày sinh trừ 1 làm điểm bắt đầu
            // Nếu bằng 0 thì lấy 12
            let dayStart = day - 1;
            if (dayStart === 0) dayStart = 12;
            
            // Bắt đầu từ dayStart và tăng dần mỗi cột thêm 1
            for (let i = 0; i < 12; i++) {
                let value = dayStart + i;
                if (value > 12) value -= 12;
                if (value === 0) value = 12;
                dayValues.push(value);
                row3.innerHTML += `<td>${value}</td>`;
            }
            table3.appendChild(row3);
            
            // Dòng 4: Cộng
            const row4 = document.createElement('tr');
            row4.innerHTML = '<td>4. Cộng</td>';
            let sumValues = [];
            for (let i = 0; i < 12; i++) {
                if (i < 6) {
                    // Cột 1-6: Cộng cả 3 giá trị
                    const quyVal = quyValues[i] === '' ? 0 : quyValues[i];
                    const sum = quyVal + monthValues[i] + dayValues[i];
                    sumValues.push(sum);
                } else {
                    // Cột 7-12: Chỉ cộng tháng và ngày (vì quý để trống)
                    const sum = monthValues[i] + dayValues[i];
                    sumValues.push(sum);
                }
                row4.innerHTML += `<td>${sumValues[i]}</td>`;
            }
            table3.appendChild(row4);
            
            // Dòng 5: Chia số dư
            const row5 = document.createElement('tr');
            row5.innerHTML = '<td>5. Chia số dư</td>';
            let modValues = [];
            for (let i = 0; i < 12; i++) {
                const mod = sumValues[i] % 12 || 12;
                modValues.push(mod);
                row5.innerHTML += `<td>${mod}</td>`;
            }
            table3.appendChild(row5);
            
            // Dòng 6: Tổng (đối số từ bảng 9)
            const row6 = document.createElement('tr');
            row6.innerHTML = '<td>6. Tổng</td>';
            let totalValues = [];
            for (let i = 0; i < 12; i++) {
                const mod = modValues[i];
                const oppositeItem = table9Data.find(item => item.number === mod);
                const opposite = oppositeItem ? oppositeItem.opposite : mod;
                totalValues.push(opposite);
                row6.innerHTML += `<td>${opposite}</td>`;
            }
            table3.appendChild(row6);
            
            // Lưu giá trị để sử dụng sau
            window.table3Data = {
                quyValues,
                monthValues,
                dayValues,
                sumValues,
                modValues,
                totalValues,
                quyStart: quyValues[0] // Lưu giá trị quý đầu tiên cho bảng 5
            };
        }

        function calculateTable4() {
            const table4 = document.getElementById('table4');
            table4.innerHTML = '';
            
            if (!window.table3Data) return;
            
            const { modValues } = window.table3Data;
            
            // Tính tổng cho các nhóm (cột 1-4, 5-8, 9-12)
            const sumGroup1 = modValues.slice(0, 4).reduce((a, b) => a + b, 0);
            const sumGroup2 = modValues.slice(4, 8).reduce((a, b) => a + b, 0);
            const sumGroup3 = modValues.slice(8, 12).reduce((a, b) => a + b, 0);
            
            // Tính số dư (lấy mod 12, nếu 0 thì = 12)
            const modGroup1 = sumGroup1 % 12 || 12;
            const modGroup2 = sumGroup2 % 12 || 12;
            const modGroup3 = sumGroup3 % 12 || 12;
            
            // Tra bảng 5 để lấy ý nghĩa
            const meaningItem1 = table5MeaningData.find(item => item.number === modGroup1);
            const meaningItem2 = table5MeaningData.find(item => item.number === modGroup2);
            const meaningItem3 = table5MeaningData.find(item => item.number === modGroup3);
            
            // Tạo bảng 4
            const headerRow = document.createElement('tr');
            headerRow.innerHTML = `
                <th></th>
                <th>TIỀN VẬN</th>
                <th>TRUNG VẬN</th>
                <th>HẬU VẬN</th>
            `;
            table4.appendChild(headerRow);
            
            // Dòng 1: Tổng các cột
            const row1 = document.createElement('tr');
            row1.innerHTML = `
                <td>Tổng các cột</td>
                <td>${sumGroup1}</td>
                <td>${sumGroup2}</td>
                <td>${sumGroup3}</td>
            `;
            table4.appendChild(row1);
            
            // Dòng 2: Số dư mod 12
            const row2 = document.createElement('tr');
            row2.innerHTML = `
                <td>Số dư mod 12</td>
                <td>${modGroup1}</td>
                <td>${modGroup2}</td>
                <td>${modGroup3}</td>
            `;
            table4.appendChild(row2);
            
            // Dòng 3: Ý nghĩa (tra bảng 5)
            const row3 = document.createElement('tr');
            row3.innerHTML = `
                <td>Ý nghĩa (Bảng 5)</td>
                <td>${meaningItem1 ? meaningItem1.meaning : ''}</td>
                <td>${meaningItem2 ? meaningItem2.meaning : ''}</td>
                <td>${meaningItem3 ? meaningItem3.meaning : ''}</td>
            `;
            table4.appendChild(row3);
            
            // Lưu kết quả để hiển thị
            window.vanMenhData = {
                tienVan: { sum: sumGroup1, mod: modGroup1, meaning: meaningItem1 ? meaningItem1.meaning : '' },
                trungVan: { sum: sumGroup2, mod: modGroup2, meaning: meaningItem2 ? meaningItem2.meaning : '' },
                hauVan: { sum: sumGroup3, mod: modGroup3, meaning: meaningItem3 ? meaningItem3.meaning : '' }
            };
        }

        function calculateTable5(birthYear, birthMonth, birthDay) {
            const table5 = document.getElementById('table5');
            table5.innerHTML = '';
            
            if (!window.table3Data) return;
            
            const { totalValues, quyStart, monthValues } = window.table3Data;
            
            // Tạo bảng với 15 dòng và 13 cột (1 cột tiêu đề + 12 cột số)
            // Dòng 1-2: Tiêu đề bảng
            const headerRow1 = document.createElement('tr');
            headerRow1.innerHTML = '<th>Ý nghĩa</th>';
            
            // Dòng 1: Tiêu đề cột - ghi tháng lấy kết quả của dòng 6 cột 1 từ bảng 3
            // Thực tế là lấy quý từ bảng 3 dòng 1 cột 1
            const monthFromTable3 = quyStart;
            
            for (let i = 1; i <= 12; i++) {
                let monthValue = monthFromTable3 + (i - 1);
                if (monthValue > 12) monthValue -= 12;
                if (monthValue === 0) monthValue = 12;
                headerRow1.innerHTML += `<th>${monthValue}</th>`;
            }
            table5.appendChild(headerRow1);
            
            // Dòng 2: Năm - cột 1 là năm sinh, các cột sau tính theo cách riêng
            const headerRow2 = document.createElement('tr');
            headerRow2.innerHTML = '<td>Năm</td>';
            
            let yearValues = [];
            // Cột 1: Năm sinh
            yearValues[0] = birthYear;
            
            // Các cột sau: (tiêu đề cột trên dòng 1 chia 12 lấy chẵn) + năm sinh
            for (let i = 1; i <= 12; i++) {
                const monthHeader = parseInt(headerRow1.cells[i].textContent);
                const yearValue = Math.floor(monthHeader / 12) + birthYear;
                yearValues.push(yearValue);
                headerRow2.innerHTML += `<td>${yearValue}</td>`;
            }
            table5.appendChild(headerRow2);
            
            // 12 dòng ý nghĩa (dòng 3-14)
            for (let i = 0; i < table5MeaningData.length; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${table5MeaningData[i].meaning}</td>`;
                
                for (let j = 0; j < 12; j++) {
                    let display = '';
                    // Kiểm tra: nếu giá trị ở cột j trong bảng 3 (dòng 6) trùng với số thứ tự của dòng ý nghĩa
                    if (j < totalValues.length && totalValues[j] === table5MeaningData[i].number) {
                        display = table5MeaningData[i].number;
                        row.innerHTML += `<td class="yellow-point">${display}</td>`;
                    } else {
                        row.innerHTML += `<td>${display}</td>`;
                    }
                }
                table5.appendChild(row);
            }
            
            // Dòng 15: Tuổi
            const row15 = document.createElement('tr');
            row15.className = 'age-row';
            row15.innerHTML = '<td>Tuổi</td>';
            
            // Cột 1: Ghi tháng số tháng cột 12, dòng 1 + 6 
            const monthCol12 = parseInt(headerRow1.cells[12].textContent);
            let ageCol1 = monthCol12 + 6;
            if (ageCol1 > 12) ageCol1 -= 12;
            if (ageCol1 === 0) ageCol1 = 12;
            
            for (let i = 0; i < 12; i++) {
                if (i === 0) {
                    row15.innerHTML += `<td>${ageCol1}</td>`;
                } else {
                    // Các cột sau: mỗi cột sau cộng thêm 6 so với cột trước
                    let ageValue = ageCol1 + (i * 6);
                    while (ageValue > 12) {
                        ageValue -= 12;
                    }
                    if (ageValue === 0) ageValue = 12;
                    row15.innerHTML += `<td>${ageValue}</td>`;
                }
            }
            table5.appendChild(row15);
            
            // Dòng 16: Năm (thực tế là dòng 16 theo mô tả)
            const row16 = document.createElement('tr');
            row16.className = 'year-row';
            row16.innerHTML = '<td>Năm</td>';
            
            // Cột 1: lấy kết quả cột 1 dòng 15 chia 12 lấy chẵn
            const ageCol1Value = parseInt(row15.cells[1].textContent);
            const yearCalc = Math.floor(ageCol1Value / 12);
            
            // Cột 1: Ghi số năm cột 12 (từ dòng 2) cộng với kết quả trên
            const yearCol12 = parseInt(headerRow2.cells[12].textContent);
            let yearCol1 = yearCol12 + yearCalc;
            
            for (let i = 0; i < 12; i++) {
                if (i === 0) {
                    row16.innerHTML += `<td>${yearCol1}</td>`;
                } else {
                    // Các cột sau: số năm sinh cộng thêm với kết quả cột trên dòng 16
                    // Thực tế là mỗi cột sau tăng dần theo công thức riêng
                    // Ở đây tôi sẽ làm đơn giản: mỗi cột sau + 1 năm
                    row16.innerHTML += `<td>${yearCol1 + i}</td>`;
                }
            }
            table5.appendChild(row16);
        }

        function calculateVanMenh() {
            if (!window.vanMenhData) return;
            
            const { tienVan, trungVan, hauVan } = window.vanMenhData;
            
            // Tính toán thông tin chi tiết cho các vận
            const birthYear = new Date(document.getElementById('birthdate').value).getFullYear();
            
            // Tiền vận: cột 1-4
            // Tuổi: 6, 12, 18, 24 (cột 1-4)
            // Năm tương ứng: birthYear + tuổi
            const tienVanAges = [6, 12, 18, 24];
            const tienVanYears = tienVanAges.map(age => birthYear + age);
            
            // Trung vận: cột 5-8
            // Tuổi: 30, 36, 42, 48 (cột 5-8)
            const trungVanAges = [30, 36, 42, 48];
            const trungVanYears = trungVanAges.map(age => birthYear + age);
            
            // Hậu vận: cột 9-12
            // Tuổi: 54, 60, 66, 72 (cột 9-12)
            const hauVanAges = [54, 60, 66, 72];
            const hauVanYears = hauVanAges.map(age => birthYear + age);
            
            // Hiển thị với thông tin mới: tổng các cột và mod 12
            document.getElementById('tien-van').innerHTML = `
                <strong>TIỀN VẬN</strong><br>
                Tổng cột 1-4: ${tienVan.sum}<br>
                Số dư mod 12: ${tienVan.mod}<br>
                Ý nghĩa: <strong>${tienVan.meaning}</strong><br>
                <br>
                <strong>Giai đoạn:</strong><br>
                Tuổi: ${tienVanAges[0]} - ${tienVanAges[3]} (${tienVanAges.length} năm)<br>
                Năm: ${tienVanYears[0]} - ${tienVanYears[3]}<br>
            `;
            
            document.getElementById('trung-van').innerHTML = `
                <strong>TRUNG VẬN</strong><br>
                Tổng cột 5-8: ${trungVan.sum}<br>
                Số dư mod 12: ${trungVan.mod}<br>
                Ý nghĩa: <strong>${trungVan.meaning}</strong><br>
                <br>
                <strong>Giai đoạn:</strong><br>
                Tuổi: ${trungVanAges[0]} - ${trungVanAges[3]} (${trungVanAges.length} năm)<br>
                Năm: ${trungVanYears[0]} - ${trungVanYears[3]}<br>
            `;
            
            document.getElementById('hau-van').innerHTML = `
                <strong>HẬU VẬN</strong><br>
                Tổng cột 9-12: ${hauVan.sum}<br>
                Số dư mod 12: ${hauVan.mod}<br>
                Ý nghĩa: <strong>${hauVan.meaning}</strong><br>
                <br>
                <strong>Giai đoạn:</strong><br>
                Tuổi: ${hauVanAges[0]} - ${hauVanAges[3]} (${hauVanAges.length} năm)<br>
                Năm: ${hauVanYears[0]} - ${hauVanYears[3]}<br>
            `;
        }
    </script>
</body>
</html>
