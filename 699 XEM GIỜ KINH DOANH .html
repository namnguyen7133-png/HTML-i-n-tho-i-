<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phân Tích Mệnh Lý & Định Hướng Kinh Doanh - Theo Giờ Can Chi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            font-size: 16px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            border-left: 5px solid var(--secondary-color);
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .subtitle {
            color: var(--secondary-color);
            font-size: 1.2rem;
            margin-bottom: 15px;
        }
        
        .date-info {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 15px;
            font-size: 1.1rem;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        
        .date-info span {
            font-weight: bold;
            color: var(--accent-color);
        }
        
        .time-item {
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .input-section, .result-section, .canchi-calculator {
            background-color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .canchi-calculator {
            margin-bottom: 30px;
        }
        
        .section-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-color);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 25px;
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: #7f8c8d;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: var(--secondary-color);
            border-bottom: 3px solid var(--secondary-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .input-field {
            display: flex;
            flex-direction: column;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
            font-size: 1.1rem;
        }
        
        input, select, button {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            border-color: var(--secondary-color);
            outline: none;
        }
        
        .btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: background-color 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn-calculate {
            background-color: var(--success-color);
            width: 100%;
            margin-top: 10px;
        }
        
        .btn-calculate:hover {
            background-color: #27ae60;
        }
        
        .btn-secondary {
            background-color: var(--warning-color);
        }
        
        .btn-secondary:hover {
            background-color: #e67e22;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .person-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            padding: 10px;
            margin-top: 15px;
        }
        
        .person-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 1.05rem;
        }
        
        .person-item:hover {
            background-color: #f9f9f9;
        }
        
        .person-item.selected {
            background-color: #e3f2fd;
            border-left: 4px solid var(--secondary-color);
        }
        
        .result-item {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: var(--border-radius);
            background-color: #f8f9fa;
        }
        
        .person-name {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .person-details {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .detail-item {
            background-color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.95rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .group-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }
        
        .group-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .group-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            border-top: 5px solid;
        }
        
        .group-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .group-leader {
            background-color: #fff8e1;
            padding: 10px;
            border-radius: var(--border-radius);
            margin: 10px 0;
            font-weight: bold;
            color: #ff8f00;
        }
        
        .business-suggestion {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 15px;
            font-style: italic;
        }
        
        .members-list {
            list-style-type: none;
            margin-top: 10px;
        }
        
        .members-list li {
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
        }
        
        .color-wood { border-top-color: #4CAF50; }
        .color-fire { border-top-color: #f44336; }
        .color-earth { border-top-color: #795548; }
        .color-metal { border-top-color: #607D8B; }
        .color-water { border-top-color: #2196F3; }
        
        .element-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            color: white;
            margin-right: 5px;
        }
        
        .badge-wood { background-color: #4CAF50; }
        .badge-fire { background-color: #f44336; }
        .badge-earth { background-color: #795548; }
        .badge-metal { background-color: #607D8B; }
        .badge-water { background-color: #2196F3; }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.95rem;
        }
        
        .instructions {
            background-color: #fffde7;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            font-size: 1.05rem;
            border-left: 4px solid #ffd600;
        }
        
        .result-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        .result-detail {
            background: white;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        
        .detail-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .detail-value {
            font-weight: 600;
            color: var(--dark-color);
            margin-top: 5px;
        }
        
        .highlight {
            background: #fffde7 !important;
            border-left: 4px solid #ffeb3b;
        }
        
        .canchi-result {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 20px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }
        
        @media (max-width: 768px) {
            .input-group {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .input-tabs {
                flex-direction: column;
            }
            
            .tab {
                width: 100%;
                text-align: center;
            }
        }
        
        .duplicate-warning {
            color: #e74c3c;
            font-weight: bold;
            margin-top: 5px;
            font-size: 0.9rem;
        }
        
        .canchi-input-group {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        @media (max-width: 992px) {
            .canchi-input-group {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 576px) {
            .canchi-input-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-chart-line"></i> Phân Tích Mệnh Lý & Định Hướng Kinh Doanh</h1>
            <div class="subtitle">Dựa trên Can Chi - Ngũ Hành theo giờ sinh (tính theo giờ Can Chi từng người)</div>
            <div class="date-info">
                <div class="time-item">Ngày chuẩn: <span>18/12/2025</span></div>
                <div class="time-item">10 giờ <span>Quý Tỵ</span></div>
                <div class="time-item">29 Ngày <span>Tân Dậu</span></div>
                <div class="time-item">10 Tháng <span>Đinh Hợi</span></div>
                <div class="time-item">2025 Năm <span>Ất Tỵ</span></div>
            </div>
        </header>
        
        <div class="instructions">
            <p><i class="fas fa-info-circle"></i> <strong>Hướng dẫn sử dụng:</strong> Nhập tên và giờ Can Chi (hoặc ngày sinh dương lịch để tính Can Chi) để phân tích mệnh lý theo giờ sinh. Sử dụng công cụ tính Can Chi để tính toán chi tiết. Sau đó nhấn "Phân Tích & Phân Nhóm" để xem kết quả phân nhóm kinh doanh.</p>
        </div>
        
        <div class="canchi-calculator">
            <h2 class="section-title"><i class="fas fa-calculator"></i> Công Cụ Tính Can Chi</h2>
            
            <div class="input-tabs">
                <button class="tab active" data-tab="canchi">Nhập Can Chi</button>
                <button class="tab" data-tab="solar">Nhập Dương Lịch</button>
            </div>
            
            <div id="canchi-tab" class="tab-content active">
                <div class="input-group">
                    <div class="input-field">
                        <label for="hour"><i class="far fa-clock"></i> Giờ (Can Chi):</label>
                        <select id="hour">
                            <option value="">Chọn giờ</option>
                            <!-- Giờ sẽ được thêm bằng JavaScript -->
                        </select>
                    </div>
                    
                    <div class="input-field">
                        <label for="day"><i class="far fa-calendar-alt"></i> Ngày (Can Chi):</label>
                        <select id="day">
                            <option value="">Chọn ngày</option>
                            <!-- Ngày sẽ được thêm bằng JavaScript -->
                        </select>
                    </div>
                    
                    <div class="input-field">
                        <label for="month"><i class="fas fa-calendar"></i> Tháng (Can Chi):</label>
                        <select id="month">
                            <option value="">Chọn tháng</option>
                            <!-- Tháng sẽ được thêm bằng JavaScript -->
                        </select>
                    </div>
                    
                    <div class="input-field">
                        <label for="year"><i class="fas fa-calendar-check"></i> Năm (Can Chi):</label>
                        <select id="year">
                            <option value="">Chọn năm</option>
                            <!-- Năm sẽ được thêm bằng JavaScript -->
                        </select>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn" id="calculateForward">
                        <i class="fas fa-forward"></i> Tính Xuôi
                    </button>
                    <button class="btn btn-secondary" id="calculateBackward">
                        <i class="fas fa-backward"></i> Tính Ngược
                    </button>
                    <button class="btn" id="resetCanChi">
                        <i class="fas fa-redo"></i> Đặt Lại
                    </button>
                    <button class="btn btn-secondary" id="calculateToSolar">
                        <i class="fas fa-sun"></i> Tính Dương Lịch
                    </button>
                    <button class="btn" id="applyToPersonFromCanChi">
                        <i class="fas fa-user-plus"></i> Áp dụng Can Chi vào Người
                    </button>
                </div>
            </div>
            
            <div id="solar-tab" class="tab-content">
                <div class="input-group">
                    <div class="input-field">
                        <label for="solarHour"><i class="far fa-clock"></i> Giờ (0-23):</label>
                        <input type="number" id="solarHour" min="0" max="23" value="10">
                    </div>
                    
                    <div class="input-field">
                        <label for="solarDay"><i class="far fa-calendar-alt"></i> Ngày:</label>
                        <input type="number" id="solarDay" min="1" max="31" value="18">
                    </div>
                    
                    <div class="input-field">
                        <label for="solarMonth"><i class="fas fa-calendar"></i> Tháng:</label>
                        <input type="number" id="solarMonth" min="1" max="12" value="12">
                    </div>
                    
                    <div class="input-field">
                        <label for="solarYear"><i class="fas fa-calendar-check"></i> Năm:</label>
                        <input type="number" id="solarYear" min="1900" max="2100" value="2025">
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn" id="calculateFromSolar">
                        <i class="fas fa-moon"></i> Tính Can Chi
                    </button>
                    <button class="btn" id="applyToPerson">
                        <i class="fas fa-user-plus"></i> Áp dụng vào Người
                    </button>
                </div>
            </div>
            
            <div id="canchiResult" class="canchi-result" style="display: none;">
                <h3><i class="fas fa-chart-pie"></i> Kết Quả Tính Can Chi</h3>
                <div id="canchiResultContent"></div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title"><i class="fas fa-user-edit"></i> Nhập thông tin cá nhân (Theo Giờ Can Chi)</h2>
                
                <div class="input-group">
                    <div class="input-field">
                        <label for="nameInput"><i class="fas fa-user"></i> Họ và tên:</label>
                        <input type="text" id="nameInput" placeholder="Nhập họ và tên đầy đủ">
                    </div>
                    
                    <div class="input-field">
                        <label for="genderInput"><i class="fas fa-venus-mars"></i> Giới tính:</label>
                        <select id="genderInput">
                            <option value="male">Nam</option>
                            <option value="female">Nữ</option>
                        </select>
                    </div>
                </div>
                
                <div class="canchi-input-group">
                    <div class="input-field">
                        <label for="personHour"><i class="far fa-clock"></i> Giờ sinh (Can Chi):</label>
                        <select id="personHour">
                            <option value="">Chọn giờ</option>
                            <!-- Giờ sẽ được thêm bằng JavaScript -->
                        </select>
                    </div>
                    
                    <div class="input-field">
                        <label for="personDay"><i class="far fa-calendar-alt"></i> Ngày sinh (Can Chi):</label>
                        <select id="personDay">
                            <option value="">Chọn ngày</option>
                            <!-- Ngày sẽ được thêm bằng JavaScript -->
                        </select>
                    </div>
                    
                    <div class="input-field">
                        <label for="personMonth"><i class="fas fa-calendar"></i> Tháng sinh (Can Chi):</label>
                        <select id="personMonth">
                            <option value="">Chọn tháng</option>
                            <!-- Tháng sẽ được thêm bằng JavaScript -->
                        </select>
                    </div>
                    
                    <div class="input-field">
                        <label for="personYear"><i class="fas fa-calendar-check"></i> Năm sinh (Can Chi):</label>
                        <select id="personYear">
                            <option value="">Chọn năm</option>
                            <!-- Năm sẽ được thêm bằng JavaScript -->
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-field">
                        <label><i class="fas fa-list-ul"></i> Hoặc chọn từ danh sách có sẵn:</label>
                        <div class="person-list" id="personList">
                            <!-- Danh sách người sẽ được thêm bằng JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div id="duplicateWarning" class="duplicate-warning" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i> Người này đã có trong danh sách!
                </div>
                
                <div class="controls">
                    <button class="btn" id="addPersonBtn">
                        <i class="fas fa-plus"></i> Thêm người vào danh sách
                    </button>
                    <button class="btn btn-secondary" id="clearListBtn">
                        <i class="fas fa-trash"></i> Xóa danh sách
                    </button>
                    <button class="btn btn-secondary" id="removeSelectedBtn">
                        <i class="fas fa-user-minus"></i> Xóa người đang chọn
                    </button>
                </div>
                
                <button class="btn btn-calculate" id="calculateBtn">
                    <i class="fas fa-calculator"></i> Phân Tích & Phân Nhóm
                </button>
            </div>
            
            <div class="result-section">
                <h2 class="section-title"><i class="fas fa-chart-pie"></i> Kết quả phân tích (Theo Giờ Can Chi)</h2>
                <div id="individualResults">
                    <p class="no-results">Chưa có dữ liệu. Vui lòng nhập thông tin và nhấn "Phân Tích & Phân Nhóm".</p>
                </div>
                
                <div class="group-section" id="groupSection" style="display: none;">
                    <h2 class="section-title"><i class="fas fa-users"></i> Phân nhóm kinh doanh</h2>
                    <div id="groupResults"></div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Ứng dụng phân tích mệnh lý theo Can Chi - Ngũ Hành theo giờ sinh | Thiết kế dành cho người cận thị độ 2</p>
            <p>Dữ liệu tham khảo từ bảng tra cứu Can Chi truyền thống</p>
        </footer>
    </div>

    <script>
        // ==============================
        // DỮ LIỆU CƠ BẢN
        // ==============================
        
        // Bảng tra cứu Can Chi (60 Hoa Giáp)
        const canChiData = [
            {id: 1, canChi: "Giáp Tý", yNghia: "Ốc Thượng Chi Thử (Chuột ở nóc nhà)", amDuong: "Kim +", menh: "Hải Trung Kim (Vàng trong biển)", que1: "Đoài Kim", que2: "Cấn Thổ", element: "Kim"},
            {id: 2, canChi: "Ất Sửu", yNghia: "Hải Nội Chi Ngưu (Trâu trong biển)", amDuong: "Kim -", menh: "Hải Trung Kim (Vàng trong biển)", que1: "Càn Kim", que2: "Ly Hoả", element: "Kim"},
            {id: 3, canChi: "Bính Dần", yNghia: "Sơn Lâm Chi Hổ (Hổ trong rừng)", amDuong: "Hỏa +", menh: "Lư Trung Hỏa (Lửa trong lò)", que1: "Khôn Thổ", que2: "Khảm Thuỷ", element: "Hoả"},
            {id: 4, canChi: "Đinh Mão", yNghia: "Vọng Nguyệt Chi Thố (Thỏ ngắm trăng)", amDuong: "Hỏa -", menh: "Lư Trung Hỏa (Lửa trong lò)", que1: "Tốn Mộc", que2: "Khôn Thổ", element: "Hoả"},
            {id: 5, canChi: "Mậu Thìn", yNghia: "Thanh Ôn Chi Long (Rồng ôn hoà)", amDuong: "Mộc +", menh: "Đại Lâm Mộc (Gỗ rừng già)", que1: "Chấn Mộc", que2: "Chấn Mộc", element: "Mộc"},
            {id: 6, canChi: "Kỷ Tỵ", yNghia: "Phúc Khí Chi Xà (Rắn có phúc)", amDuong: "Mộc -", menh: "Đại Lâm Mộc (Gỗ rừng già)", que1: "Khôn Thổ", que2: "Tốn Mộc", element: "Mộc"},
            {id: 7, canChi: "Canh Ngọ", yNghia: "Thất Lý Chi Mã (Ngựa trong nhà)", amDuong: "Thổ +", menh: "Lộ Bàng Thổ (Đất đường đi)", que1: "Đoài Kim", que2: "Cấn Thổ", element: "Thổ"},
            {id: 8, canChi: "Tân Mùi", yNghia: "Đắc Lộc Chi Dương (Dê có lộc)", amDuong: "Thổ -", menh: "Lộ Bàng Thổ (Đất đường đi)", que1: "Càn Kim", que2: "Ly Hoả", element: "Thổ"},
            {id: 9, canChi: "Nhâm Thân", yNghia: "Thanh Tú Chi Hầu (Khỉ thanh tú)", amDuong: "Kim +", menh: "Kiếm Phong Kim (Vàng mũi kiếm)", que1: "Khôn Thổ", que2: "Khảm Thuỷ", element: "Kim"},
            {id: 10, canChi: "Quý Dậu", yNghia: "Lâu Túc Kê (Gà nhà gác)", amDuong: "Kim -", menh: "Kiếm Phong Kim (Vàng mũi kiếm)", que1: "Tốn Mộc", que2: "Khôn Thổ", element: "Kim"},
            {id: 11, canChi: "Giáp Tuất", yNghia: "Thủ Thân Chi Cẩu (Chó giữ mình)", amDuong: "Hỏa +", menh: "Sơn Đầu Hỏa (Lửa trên núi)", que1: "Chấn Mộc", que2: "Chấn Mộc", element: "Hoả"},
            {id: 12, canChi: "Ất Hợi", yNghia: "Quá Vãng Chi Trư (Lợn hay đi)", amDuong: "Hỏa -", menh: "Sơn Đầu Hỏa (Lửa trên núi)", que1: "Khôn Thổ", que2: "Tốn Mộc", element: "Hoả"},
            {id: 13, canChi: "Bính Tý", yNghia: "Điền Nội Chi Thử (Chuột trong ruộng)", amDuong: "Thủy +", menh: "Giản Hạ Thủy (Nước khe suối)", que1: "Khảm Thuỷ", que2: "Khôn Thổ", element: "Thuỷ"},
            {id: 14, canChi: "Đinh Sửu", yNghia: "Hồ Nội Chi Ngưu (Trâu trong hồ nước)", amDuong: "Thủy -", menh: "Giản Hạ Thủy (Nước khe suối)", que1: "Ly Hoả", que2: "Càn Kim", element: "Thuỷ"},
            {id: 15, canChi: "Mậu Dần", yNghia: "Quá Sơn Chi Hổ (Hổ qua rừng)", amDuong: "Thổ +", menh: "Thành Đầu Thổ (Đất trên thành)", que1: "Cấn Thổ", que2: "Đoài Kim", element: "Thổ"},
            {id: 16, canChi: "Kỷ Mão", yNghia: "Sơn Lâm Chi Thố (Thỏ ở rừng)", amDuong: "Thổ -", menh: "Thành Đầu Thổ (Đất trên thành)", que1: "Đoài Kim", que2: "Cấn Thổ", element: "Thổ"},
            {id: 17, canChi: "Canh Thìn", yNghia: "Thứ Tính Chi Long (Rồng khoan dung)", amDuong: "Kim +", menh: "Bạch Lạp Kim (Vàng sáp ong)", que1: "Càn Kim", que2: "Ly Hoả", element: "Kim"},
            {id: 18, canChi: "Tân Tỵ", yNghia: "Đông Tàng Chi Xà (Rắn ngủ đông)", amDuong: "Kim -", menh: "Bạch Lạp Kim (Vàng sáp ong)", que1: "Khôn Thổ", que2: "Khảm Thuỷ", element: "Kim"},
            {id: 19, canChi: "Nhâm Ngọ", yNghia: "Quân Trung Chi Mã (Ngựa chiến)", amDuong: "Mộc +", menh: "Dương Liễu Mộc (Gỗ cây dương)", que1: "Tốn Mộc", que2: "Khôn Thổ", element: "Mộc"},
            {id: 20, canChi: "Quý Mùi", yNghia: "Quần Nội Chi Dương (Dê trong đàn)", amDuong: "Mộc -", menh: "Dương Liễu Mộc (Gỗ cây dương)", que1: "Chấn Mộc", que2: "Chấn Mộc", element: "Mộc"},
            {id: 21, canChi: "Giáp Thân", yNghia: "Quá Thụ Chi Hầu (Khỉ leo cây)", amDuong: "Thủy +", menh: "Tuyền Trung Thủy (Nước trong suối)", que1: "Khôn Thổ", que2: "Tốn Mộc", element: "Thuỷ"},
            {id: 22, canChi: "Ất Dậu", yNghia: "Xướng Ngọ Chi Kê (Gà gáy trưa)", amDuong: "Thủy -", menh: "Tuyền Trung Thủy (Nước trong suối)", que1: "Khảm Thuỷ", que2: "Khôn Thổ", element: "Thuỷ"},
            {id: 23, canChi: "Bính Tuất", yNghia: "Tự Miên Chi Cẩu (Chó đang ngủ)", amDuong: "Thổ +", menh: "Ốc Thượng Thổ (Đất nóc nhà)", que1: "Ly Hoả", que2: "Càn Kim", element: "Thổ"},
            {id: 24, canChi: "Đinh Hợi", yNghia: "Quá Sơn Chi Trư (Lợn qua núi)", amDuong: "Thổ -", menh: "Ốc Thượng Thổ (Đất nóc nhà)", que1: "Cấn Thổ", que2: "Đoài Kim", element: "Thổ"},
            {id: 25, canChi: "Mậu Tý", yNghia: "Thương Nội Chi Trư (Chuột trong kho)", amDuong: "Hỏa +", menh: "Thích Lịch Hỏa (Lửa sấm sét)", que1: "Đoài Kim", que2: "Cấn Thổ", element: "Hoả"},
            {id: 26, canChi: "Kỷ Sửu", yNghia: "Lâm Nội Chi Ngưu (Trâu trong chuồng)", amDuong: "Hỏa -", menh: "Thích Lịch Hỏa (Lửa sấm sét)", que1: "Càn Kim", que2: "Ly Hoả", element: "Hoả"},
            {id: 27, canChi: "Canh Dần", yNghia: "Xuất Sơn Chi Hổ (Hổ xuống núi)", amDuong: "Mộc +", menh: "Tùng Bách Mộc (Gỗ tùng bách)", que1: "Khôn Thổ", que2: "Khảm Thuỷ", element: "Mộc"},
            {id: 28, canChi: "Tân Mão", yNghia: "Ẩn Huyệt Chi Thố (Thỏ trong hang)", amDuong: "Mộc -", menh: "Tùng Bách Mộc (Gỗ tùng bách)", que1: "Tốn Mộc", que2: "Khôn Thổ", element: "Mộc"},
            {id: 29, canChi: "Nhâm Thìn", yNghia: "Hành Vũ Chi Long (Rồng phun mưa)", amDuong: "Thủy +", menh: "Trường Lưu Thủy (Nước chảy mạnh)", que1: "Chấn Mộc", que2: "Chấn Mộc", element: "Thuỷ"},
            {id: 30, canChi: "Quý Tỵ", yNghia: "Thảo Trung Chi Xà (Rắn trong cỏ)", amDuong: "Thủy -", menh: "Trường Lưu Thủy (Nước chảy mạnh)", que1: "Khôn Thổ", que2: "Tốn Mộc", element: "Thuỷ"},
            {id: 31, canChi: "Giáp Ngọ", yNghia: "Vân Trung Chi Mã (Ngựa trong mây)", amDuong: "Kim +", menh: "Sa Trung Kim (Vàng trong cát)", que1: "Khảm Thuỷ", que2: "Khôn Thổ", element: "Kim"},
            {id: 32, canChi: "Ất Mùi", yNghia: "Kính Trọng Chi Dương (Dê được quý mến)", amDuong: "Kim -", menh: "Sa Trung Kim (Vàng trong cát)", que1: "Ly Hoả", que2: "Càn Kim", element: "Kim"},
            {id: 33, canChi: "Bính Thân", yNghia: "Sơn Thượng Chi Hầu (Khỉ trên núi)", amDuong: "Hỏa +", menh: "Sơn Hạ Hỏa (Lửa trên núi)", que1: "Cấn Thổ", que2: "Đoài Kim", element: "Hoả"},
            {id: 34, canChi: "Đinh Dậu", yNghia: "Độc Lập Chi Kê (Gà độc thân)", amDuong: "Hỏa -", menh: "Sơn Hạ Hỏa (Lửa trên núi)", que1: "Đoài Kim", que2: "Cấn Thổ", element: "Hoả"},
            {id: 35, canChi: "Mậu Tuất", yNghia: "Tiến Sơn Chi Cẩu (Chó vào núi)", amDuong: "Mộc +", menh: "Bình Địa Mộc (Gỗ đồng bằng)", que1: "Càn Kim", que2: "Ly Hoả", element: "Mộc"},
            {id: 36, canChi: "Kỷ Hợi", yNghia: "Đạo Viện Chi Trư (Lợn trong tu viện)", amDuong: "Mộc -", menh: "Bình Địa Mộc (Gỗ đồng bằng)", que1: "Khôn Thổ", que2: "Khảm Thuỷ", element: "Mộc"},
            {id: 37, canChi: "Canh Tý", yNghia: "Lương Thượng Chi Thử (Chuột trên xà)", amDuong: "Thổ +", menh: "Bích Thượng Thổ (Đất tò vò)", que1: "Tốn Mộc", que2: "Khôn Thổ", element: "Thổ"},
            {id: 38, canChi: "Tân Sửu", yNghia: "Lộ Đồ Chi Ngưu (Trâu trên đường)", amDuong: "Thổ -", menh: "Bích Thượng Thổ (Đất tò vò)", que1: "Chấn Mộc", que2: "Chấn Mộc", element: "Thổ"},
            {id: 39, canChi: "Nhâm Dần", yNghia: "Quá Lâm Chi Hổ (Hổ qua rừng)", amDuong: "Kim +", menh: "Kim Bạch Kim (Vàng pha bạc)", que1: "Khôn Thổ", que2: "Tốn Mộc", element: "Kim"},
            {id: 40, canChi: "Quý Mão", yNghia: "Quá Lâm Chi Thố (Thỏ qua rừng)", amDuong: "Kim -", menh: "Kim Bạch Kim (Vàng pha bạc)", que1: "Khảm Thuỷ", que2: "Khôn Thổ", element: "Kim"},
            {id: 41, canChi: "Giáp Thìn", yNghia: "Phục Đầm Chi Lâm (Rồng ẩn ở đầm)", amDuong: "Hỏa +", menh: "Phú Đăng Hỏa (Lửa đèn to)", que1: "Ly Hoả", que2: "Càn Kim", element: "Hoả"},
            {id: 42, canChi: "Ất Tỵ", yNghia: "Xuất Huyệt Chi Xà (Rắn rời hang)", amDuong: "Hỏa -", menh: "Phú Đăng Hỏa (Lửa đèn to)", que1: "Cấn Thổ", que2: "Đoài Kim", element: "Hoả"},
            {id: 43, canChi: "Bính Ngọ", yNghia: "Hành Lộ Chi Mã (Ngựa chạy trên đường)", amDuong: "Thủy +", menh: "Thiên Hà Thủy (Nước trên trời)", que1: "Đoài Kim", que2: "Cấn Thổ", element: "Thuỷ"},
            {id: 44, canChi: "Đinh Mùi", yNghia: "Thất Quần Chi Dương (Dê lạc đàn)", amDuong: "Thủy -", menh: "Thiên Hà Thủy (Nước trên trời)", que1: "Càn Kim", que2: "Ly Hoả", element: "Thuỷ"},
            {id: 45, canChi: "Mậu Thân", yNghia: "Độc Lập Chi Hầu (Khỉ độc thân)", amDuong: "Thổ +", menh: "Đại Trạch Thổ (Đất nền nhà)", que1: "Khôn Thổ", que2: "Khảm Thuỷ", element: "Thổ"},
            {id: 46, canChi: "Kỷ Dậu", yNghia: "Báo Hiệu Chi Kê (Gà gáy)", amDuong: "Thổ -", menh: "Đại Trạch Thổ (Đất nền nhà)", que1: "Tốn Mộc", que2: "Khôn Thổ", element: "Thổ"},
            {id: 47, canChi: "Canh Tuất", yNghia: "Tự Quan Chi Cẩu (Chó nhà chùa)", amDuong: "Kim +", menh: "Thoa Xuyến Kim (Vàng trang sức)", que1: "Chấn Mộc", que2: "Chấn Mộc", element: "Kim"},
            {id: 48, canChi: "Tân Hợi", yNghia: "Khuyên Dưỡng Chi Trư (Lợn nuôi nhốt)", amDuong: "Kim -", menh: "Thoa Xuyến Kim (Vàng trang sức)", que1: "Khôn Thổ", que2: "Tốn Mộc", element: "Kim"},
            {id: 49, canChi: "Nhâm Tý", yNghia: "Sơn Thượng Chi Thử (Chuột trên núi)", amDuong: "Mộc +", menh: "Tang Đố Mộc (Gỗ cây dâu)", que1: "Khảm Thuỷ", que2: "Khôn Thổ", element: "Mộc"},
            {id: 50, canChi: "Quý Sửu", yNghia: "Lan Ngoại Chi Ngưu (Trâu ngoài chuồng)", amDuong: "Mộc -", menh: "Tang Đố Mộc (Gỗ cây dâu)", que1: "Ly Hoả", que2: "Càn Kim", element: "Mộc"},
            {id: 51, canChi: "Giáp Dần", yNghia: "Lập Định Chi Hổ (Hổ tự lập)", amDuong: "Thủy +", menh: "Đại Khe Thủy (Nước khe lớn)", que1: "Cấn Thổ", que2: "Đoài Kim", element: "Thuỷ"},
            {id: 52, canChi: "Ất Mão", yNghia: "Đắc Đạo Chi Thố (Thỏ đắc đạo)", amDuong: "Thủy -", menh: "Đại Khe Thủy (Nước khe lớn)", que1: "Đoài Kim", que2: "Cấn Thổ", element: "Thuỷ"},
            {id: 53, canChi: "Bính Thìn", yNghia: "Thiên Thượng Chi Long (Rồng trên trời)", amDuong: "Thổ +", menh: "Sa Trung Thổ (Đất pha cát)", que1: "Càn Kim", que2: "Ly Hoả", element: "Thổ"},
            {id: 54, canChi: "Đinh Tỵ", yNghia: "Đầm Nội Chi Xà (Rắn trong đầm)", amDuong: "Thổ -", menh: "Sa Trung Thổ (Đất pha cát)", que1: "Khôn Thổ", que2: "Khảm Thuỷ", element: "Thổ"},
            {id: 55, canChi: "Mậu Ngọ", yNghia: "Cứu Nội Chi Mã (Ngựa trong chuồng)", amDuong: "Hỏa +", menh: "Thiên Thượng Hỏa (Lửa trên trời)", que1: "Tốn Mộc", que2: "Khôn Thổ", element: "Hoả"},
            {id: 56, canChi: "Kỷ Mùi", yNghia: "Thảo Dã Chi Dương (Dê đồng cỏ)", amDuong: "Hỏa -", menh: "Thiên Thượng Hỏa (Lửa trên trời)", que1: "Chấn Mộc", que2: "Chấn Mộc", element: "Hoả"},
            {id: 57, canChi: "Canh Thân", yNghia: "Thực Quả Chi Hầu (Khỉ ăn hoa quả)", amDuong: "Mộc +", menh: "Thạch Lựu Mộc (Gỗ cây lựu đá)", que1: "Khôn Thổ", que2: "Tốn Mộc", element: "Mộc"},
            {id: 58, canChi: "Tân Dậu", yNghia: "Long Tàng Chi Kê (Gà trong lồng)", amDuong: "Mộc -", menh: "Thạch Lựu Mộc (Gỗ cây lựu đá)", que1: "Khảm Thuỷ", que2: "Khôn Thổ", element: "Mộc"},
            {id: 59, canChi: "Nhâm Tuất", yNghia: "Cố Gia Chi Khuyển (Chó về nhà)", amDuong: "Thủy +", menh: "Đại Hải Thủy (Nước biển lớn)", que1: "Ly Hoả", que2: "Càn Kim", element: "Thuỷ"},
            {id: 60, canChi: "Quý Hợi", yNghia: "Lâm Hạ Chi Trư (Lợn trong rừng)", amDuong: "Thủy -", menh: "Đại Hải Thủy (Nước biển lớn)", que1: "Cấn Thổ", que2: "Đoài Kim", element: "Thuỷ"}
        ];

        // Dữ liệu 25 người mẫu với thông tin Can Chi đầy đủ
        const samplePeople = [
            { id: 1, name: "NGUYEN KHAC NANG", gender: "male", hour: "Canh Dần", day: "Quý Mão", month: "Kỷ Sửu", year: "Giáp Thân" },
            { id: 2, name: "TO THI HA", gender: "female", hour: "Tân Mão", day: "Mậu Thìn", month: "Canh Dần", year: "Mậu Tý" },
            { id: 3, name: "NGUYEN MINH NAM", gender: "male", hour: "Nhâm Ngọ", day: "Ất Mùi", month: "Tân Hợi", year: "Tân Hợi" },
            { id: 4, name: "THAN THI KIM ANH", gender: "female", hour: "Đinh Dậu", day: "Kỷ Dậu", month: "Đinh Dậu", year: "Tân Dậu" },
            { id: 5, name: "NGUYEN TONG AN AN", gender: "female", hour: "Quý Tỵ", day: "Giáp Ngọ", month: "Quý Dậu", year: "Giáp Ngọ" },
            { id: 6, name: "NGUYEN TO MINH CHAU", gender: "female", hour: "Ất Tỵ", day: "Ất Mùi", month: "Ất Mùi", year: "Bính Thân" },
            { id: 7, name: "NGUYEN TO BICH NGOC", gender: "female", hour: "Canh Tý", day: "Tân Sửu", month: "Mậu Dần", year: "Canh Tý" },
            { id: 8, name: "NGUYEN THI MINH HANG", gender: "female", hour: "Tân Hợi", day: "Nhâm Tý", month: "Bính Tý", year: "Giáp Dần" },
            { id: 9, name: "NGO QUY CUONG", gender: "male", hour: "Mậu Thìn", day: "Kỷ Tỵ", month: "Đinh Tỵ", year: "Quý Sửu" },
            { id: 10, name: "NGO GIA BACH", gender: "male", hour: "Bính Thìn", day: "Đinh Tỵ", month: "Bính Thân", year: "Canh Thìn" },
            { id: 11, name: "NGO GIA LINH", gender: "female", hour: "Đinh Mùi", day: "Mậu Thân", month: "Mậu Thìn", year: "Ất Dậu" },
            { id: 12, name: "NGUYEN THI MINH PHUONG", gender: "female", hour: "Kỷ Mùi", day: "Canh Thân", month: "Nhâm Tuất", year: "Mậu Ngọ" },
            { id: 13, name: "HOANG ANH DUNG", gender: "male", hour: "Tân Dậu", day: "Nhâm Tuất", month: "Tân Dậu", year: "Mậu Ngọ" },
            { id: 14, name: "HOANG HAI VINH", gender: "male", hour: "Quý Mão", day: "Giáp Thìn", month: "Tân Mão", year: "Canh Dần" },
            { id: 15, name: "HOANG THIEN BACH ANH", gender: "male", hour: "Ất Tỵ", day: "Bính Ngọ", month: "Đinh Hợi", year: "Ất Mùi" },
            { id: 16, name: "TO KIM HUE", gender: "female", hour: "Nhâm Tý", day: "Quý Sửu", month: "Giáp Thân", year: "Canh Tý" },
            { id: 17, name: "NGUYEN TUAN ANH", gender: "male", hour: "Giáp Dần", day: "Ất Mão", month: "Nhâm Tuất", year: "Quý Hợi" },
            { id: 18, name: "NGUYEN THE ANH", gender: "male", hour: "Bính Thìn", day: "Đinh Tỵ", month: "Tân Mão", year: "Tân Tỵ" },
            { id: 19, name: "NGO THI MAI", gender: "female", hour: "Mậu Ngọ", day: "Kỷ Mùi", month: "Giáp Tý", year: "Mậu Tý" },
            { id: 20, name: "TO VIET HUNG", gender: "male", hour: "Canh Thân", day: "Tân Dậu", month: "Ất Hợi", year: "Bính Tý" },
            { id: 21, name: "TO THI HONG", gender: "female", hour: "Tân Hợi", day: "Nhâm Tý", month: "Giáp Thìn", year: "Giáp Thìn" },
            { id: 22, name: "VU VAN HIEP", gender: "male", hour: "Nhâm Tý", day: "Quý Sửu", month: "Bính Thìn", year: "Giáp Dần" },
            { id: 23, name: "NGUYEN THI CHI", gender: "female", hour: "Ất Sửu", day: "Bính Dần", month: "Canh Tuất", year: "Bính Tuất" },
            { id: 24, name: "NGUYEN TAN BAC", gender: "male", hour: "Bính Dần", day: "Đinh Mão", month: "Tân Hợi", year: "Đinh Dậu" },
            { id: 25, name: "NGUYEN THI TAM", gender: "female", hour: "Đinh Mão", day: "Mậu Thìn", month: "Nhâm Thân", year: "Giáp Ngọ" }
        ];

        // Ngày chuẩn (18/12/2025 10:00)
        const STANDARD_DATE = {
            year: 2025,
            month: 12,
            day: 18,
            hour: 10,
            canChi: {
                hour: "Quý Tỵ",
                day: "Tân Dậu",
                month: "Đinh Hợi",
                year: "Ất Tỵ"
            }
        };

        // Đề xuất công việc kinh doanh theo ngũ hành
        const businessSuggestions = {
            "Kim": ["Công nghệ thông tin", "Kinh doanh vàng bạc, đá quý", "Dịch vụ tài chính ngân hàng", "Cơ khí chế tạo", "Bất động sản cao cấp"],
            "Mộc": ["Nông nghiệp, lâm nghiệp", "Thiết kế nội thất", "Xuất bản, giáo dục", "Thời trang từ chất liệu tự nhiên", "Y tế, dược phẩm"],
            "Thuỷ": ["Du lịch, vận tải biển", "Kinh doanh nước giải khát", "Dịch vụ spa, thẩm mỹ", "Truyền thông, quảng cáo", "Công nghệ nước, môi trường"],
            "Hoả": ["Nhà hàng, khách sạn", "Năng lượng, điện lực", "Giải trí, thể thao", "Mỹ phẩm, làm đẹp", "Công nghệ nhiệt"],
            "Thổ": ["Xây dựng, vật liệu xây dựng", "Bất động sản", "Nông sản thực phẩm", "Tư vấn phong thuỷ", "Khách sạn, khu nghỉ dưỡng"]
        };

        // Danh sách người được thêm
        let peopleList = [];
        let selectedPersonId = null;

        // ==============================
        // HÀM TIỆN ÍCH CHUNG
        // ==============================
        
        // Tìm thông tin theo Can Chi
        function findInfoByCanChi(canChi) {
            return canChiData.find(item => item.canChi === canChi);
        }

        // Lấy class CSS cho ngũ hành
        function getElementClass(element) {
            switch(element) {
                case "Mộc": return "wood";
                case "Hoả": return "fire";
                case "Thổ": return "earth";
                case "Kim": return "metal";
                case "Thuỷ": return "water";
                default: return "wood";
            }
        }

        // Kiểm tra trùng lặp trong danh sách
        function isDuplicate(person) {
            return peopleList.some(p => 
                p.name.toLowerCase() === person.name.toLowerCase() &&
                p.hour === person.hour &&
                p.day === person.day &&
                p.month === person.month &&
                p.year === person.year
            );
        }

        // Tạo ID duy nhất
        function generateUniqueId() {
            return Date.now() + Math.floor(Math.random() * 1000);
        }

        // ==============================
        // TÍNH TOÁN CAN CHI (đơn giản hóa)
        // ==============================
        
        function calculateCanChiFromSolar(solarDate) {
            // Tính toán đơn giản dựa trên ngày chuẩn
            // Trong thực tế, cần thuật toán chính xác hơn
            const daysDiff = Math.floor((new Date(solarDate.year, solarDate.month-1, solarDate.day) - new Date(2025, 11, 18)) / (1000*60*60*24));
            
            // Tìm chỉ số của ngày chuẩn
            const stdDayIndex = canChiData.findIndex(item => item.canChi === "Tân Dậu");
            const stdMonthIndex = canChiData.findIndex(item => item.canChi === "Đinh Hợi");
            const stdYearIndex = canChiData.findIndex(item => item.canChi === "Ất Tỵ");
            const stdHourIndex = canChiData.findIndex(item => item.canChi === "Quý Tỵ");
            
            // Tính chỉ số mới
            const newDayIndex = (stdDayIndex + daysDiff) % 60;
            const newMonthIndex = (stdMonthIndex + Math.floor(daysDiff / 30)) % 60;
            const newYearIndex = (stdYearIndex + Math.floor(daysDiff / 365)) % 60;
            const newHourIndex = (stdHourIndex + solarDate.hour + daysDiff * 24) % 60;
            
            return {
                hour: canChiData[newHourIndex >= 0 ? newHourIndex : newHourIndex + 60].canChi,
                day: canChiData[newDayIndex >= 0 ? newDayIndex : newDayIndex + 60].canChi,
                month: canChiData[newMonthIndex >= 0 ? newMonthIndex : newMonthIndex + 60].canChi,
                year: canChiData[newYearIndex >= 0 ? newYearIndex : newYearIndex + 60].canChi
            };
        }

        // ==============================
        // KHỞI TẠO ỨNG DỤNG
        // ==============================
        
        document.addEventListener('DOMContentLoaded', function() {
            initializePersonList();
            populateSampleList();
            populateCanChiSelectOptions();
            
            // Gán sự kiện
            document.getElementById('addPersonBtn').addEventListener('click', addPersonFromInput);
            document.getElementById('calculateBtn').addEventListener('click', calculateAndGroup);
            document.getElementById('clearListBtn').addEventListener('click', clearPeopleList);
            document.getElementById('removeSelectedBtn').addEventListener('click', removeSelectedPerson);
            
            // Sự kiện cho công cụ tính Can Chi
            document.getElementById('calculateForward').addEventListener('click', () => calculateFromCanChi('forward'));
            document.getElementById('calculateBackward').addEventListener('click', () => calculateFromCanChi('backward'));
            document.getElementById('resetCanChi').addEventListener('click', resetCanChiForm);
            document.getElementById('calculateFromSolar').addEventListener('click', calculateFromSolar);
            document.getElementById('calculateToSolar').addEventListener('click', calculateToSolar);
            document.getElementById('applyToPerson').addEventListener('click', applySolarToPerson);
            document.getElementById('applyToPersonFromCanChi').addEventListener('click', applyCanChiToPerson);
            
            // Sự kiện cho các tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            
            // Tự động chuyển tab khi focus
            document.getElementById('hour').addEventListener('focus', () => switchTab('canchi'));
            document.getElementById('day').addEventListener('focus', () => switchTab('canchi'));
            document.getElementById('month').addEventListener('focus', () => switchTab('canchi'));
            document.getElementById('year').addEventListener('focus', () => switchTab('canchi'));
            document.getElementById('solarHour').addEventListener('focus', () => switchTab('solar'));
            document.getElementById('solarDay').addEventListener('focus', () => switchTab('solar'));
            document.getElementById('solarMonth').addEventListener('focus', () => switchTab('solar'));
            document.getElementById('solarYear').addEventListener('focus', () => switchTab('solar'));
        });

        // ==============================
        // QUẢN LÝ DANH SÁCH NGƯỜI
        // ==============================
        
        function initializePersonList() {
            const savedList = localStorage.getItem('peopleList');
            if (savedList) {
                peopleList = JSON.parse(savedList);
                updatePersonListDisplay();
            }
        }

        function populateSampleList() {
            const personListElement = document.getElementById('personList');
            personListElement.innerHTML = '';
            
            samplePeople.forEach(person => {
                const personElement = document.createElement('div');
                personElement.className = 'person-item';
                personElement.dataset.id = person.id;
                personElement.innerHTML = `
                    <strong>${person.id}. ${person.name}</strong>
                    <div>Giờ: ${person.hour} | Ngày: ${person.day}</div>
                    <div>Tháng: ${person.month} | Năm: ${person.year}</div>
                `;
                
                personElement.addEventListener('click', function() {
                    document.getElementById('nameInput').value = person.name;
                    document.getElementById('genderInput').value = person.gender;
                    document.getElementById('personHour').value = person.hour;
                    document.getElementById('personDay').value = person.day;
                    document.getElementById('personMonth').value = person.month;
                    document.getElementById('personYear').value = person.year;
                    
                    document.querySelectorAll('.person-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    selectedPersonId = person.id;
                });
                
                personListElement.appendChild(personElement);
            });
        }

        function addPersonFromInput() {
            const name = document.getElementById('nameInput').value.trim();
            const gender = document.getElementById('genderInput').value;
            const hour = document.getElementById('personHour').value;
            const day = document.getElementById('personDay').value;
            const month = document.getElementById('personMonth').value;
            const year = document.getElementById('personYear').value;
            
            if (!name || !hour || !day || !month || !year) {
                alert('Vui lòng nhập đầy đủ thông tin!');
                return;
            }
            
            const newPerson = {
                id: generateUniqueId(),
                name: name,
                gender: gender,
                hour: hour,
                day: day,
                month: month,
                year: year
            };
            
            // Kiểm tra trùng lặp
            if (isDuplicate(newPerson)) {
                document.getElementById('duplicateWarning').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('duplicateWarning').style.display = 'none';
                }, 3000);
                return;
            }
            
            peopleList.push(newPerson);
            updatePersonListDisplay();
            saveToLocalStorage();
            
            // Reset form
            document.getElementById('nameInput').value = '';
            document.getElementById('genderInput').value = 'male';
            document.getElementById('personHour').value = '';
            document.getElementById('personDay').value = '';
            document.getElementById('personMonth').value = '';
            document.getElementById('personYear').value = '';
            
            alert(`Đã thêm ${name} vào danh sách phân tích!`);
        }

        function removeSelectedPerson() {
            if (!selectedPersonId) {
                alert('Vui lòng chọn một người từ danh sách để xóa!');
                return;
            }
            
            const personName = document.querySelector(`.person-item.selected strong`).textContent.split('. ')[1];
            if (confirm(`Bạn có chắc chắn muốn xóa ${personName} khỏi danh sách?`)) {
                peopleList = peopleList.filter(person => person.id !== selectedPersonId);
                selectedPersonId = null;
                updatePersonListDisplay();
                saveToLocalStorage();
                document.getElementById('groupSection').style.display = 'none';
            }
        }

        function updatePersonListDisplay() {
            const resultSection = document.getElementById('individualResults');
            
            if (peopleList.length === 0) {
                resultSection.innerHTML = '<p class="no-results">Chưa có dữ liệu. Vui lòng nhập thông tin và nhấn "Phân Tích & Phân Nhóm".</p>';
                return;
            }
            
            let html = '<h3><i class="fas fa-users"></i> Danh sách người đã thêm:</h3>';
            
            peopleList.forEach((person, index) => {
                const hourInfo = findInfoByCanChi(person.hour);
                const dayInfo = findInfoByCanChi(person.day);
                const monthInfo = findInfoByCanChi(person.month);
                const yearInfo = findInfoByCanChi(person.year);
                
                const element = yearInfo ? yearInfo.element : "Không xác định";
                
                html += `
                    <div class="result-item">
                        <div class="person-name">${index + 1}. ${person.name} (${person.gender === 'male' ? 'Nam' : 'Nữ'})</div>
                        <div class="person-details">
                            <div class="detail-item"><i class="far fa-clock"></i> Giờ: ${person.hour}</div>
                            <div class="detail-item"><i class="far fa-calendar"></i> Ngày: ${person.day}</div>
                            <div class="detail-item"><i class="fas fa-calendar"></i> Tháng: ${person.month}</div>
                            <div class="detail-item"><i class="fas fa-calendar-check"></i> Năm: ${person.year}</div>
                            <div class="detail-item element-badge badge-${getElementClass(element)}">${element}</div>
                        </div>
                    </div>
                `;
            });
            
            resultSection.innerHTML = html;
        }

        function clearPeopleList() {
            if (peopleList.length === 0) {
                alert('Danh sách đang trống!');
                return;
            }
            
            if (confirm('Bạn có chắc chắn muốn xóa toàn bộ danh sách người đã thêm?')) {
                peopleList = [];
                selectedPersonId = null;
                updatePersonListDisplay();
                saveToLocalStorage();
                document.getElementById('groupSection').style.display = 'none';
            }
        }

        function saveToLocalStorage() {
            localStorage.setItem('peopleList', JSON.stringify(peopleList));
        }

        // ==============================
        // TÍNH TOÁN VÀ PHÂN NHÓM
        // ==============================
        
        function calculateAndGroup() {
            if (peopleList.length === 0) {
                alert('Vui lòng thêm ít nhất một người vào danh sách trước khi phân tích!');
                return;
            }
            
            // Phân tích từng người
            const analyzedPeople = peopleList.map((person, index) => {
                const hourInfo = findInfoByCanChi(person.hour) || { element: "Không xác định", yNghia: "Không xác định", amDuong: "Không xác định", menh: "Không xác định", que1: "Không xác định", que2: "Không xác định" };
                const dayInfo = findInfoByCanChi(person.day) || { element: "Không xác định", yNghia: "Không xác định", amDuong: "Không xác định", menh: "Không xác định", que1: "Không xác định", que2: "Không xác định" };
                const monthInfo = findInfoByCanChi(person.month) || { element: "Không xác định", yNghia: "Không xác định", amDuong: "Không xác định", menh: "Không xác định", que1: "Không xác định", que2: "Không xác định" };
                const yearInfo = findInfoByCanChi(person.year) || { element: "Không xác định", yNghia: "Không xác định", amDuong: "Không xác định", menh: "Không xác định", que1: "Không xác định", que2: "Không xác định" };
                
                // Xác định mệnh theo năm (chính) và theo giờ (phụ)
                const mainElement = yearInfo.element;
                const hourElement = hourInfo.element;
                
                // Tính quẻ mệnh dựa trên giới tính
                const destiny = person.gender === 'male' ? yearInfo.que2 : yearInfo.que1;
                
                return {
                    ...person,
                    listId: index + 1,
                    hourInfo: hourInfo,
                    dayInfo: dayInfo,
                    monthInfo: monthInfo,
                    yearInfo: yearInfo,
                    mainElement: mainElement,
                    hourElement: hourElement,
                    destiny: destiny,
                    combinedElement: determineCombinedElement(mainElement, hourElement)
                };
            });
            
            // Cập nhật hiển thị chi tiết
            updateDetailedDisplay(analyzedPeople);
            
            // Phân nhóm theo ngũ hành chính (năm)
            groupByElement(analyzedPeople);
            
            // Hiển thị phần nhóm
            document.getElementById('groupSection').style.display = 'block';
        }

        function determineCombinedElement(mainElement, hourElement) {
            // Luật tương sinh trong ngũ hành
            const sinhCycle = {
                "Mộc": "Hoả",
                "Hoả": "Thổ",
                "Thổ": "Kim",
                "Kim": "Thuỷ",
                "Thuỷ": "Mộc"
            };
            
            // Luật tương khắc trong ngũ hành
            const khacCycle = {
                "Mộc": "Thổ",
                "Thổ": "Thuỷ",
                "Thuỷ": "Hoả",
                "Hoả": "Kim",
                "Kim": "Mộc"
            };
            
            // Nếu giờ tương sinh với năm -> tốt
            if (sinhCycle[hourElement] === mainElement) {
                return `${mainElement} (được giờ sinh: ${hourElement} sinh ${mainElement})`;
            }
            // Nếu giờ tương khắc với năm -> xấu
            else if (khacCycle[hourElement] === mainElement) {
                return `${mainElement} (bị giờ khắc: ${hourElement} khắc ${mainElement})`;
            }
            // Nếu giờ trùng với năm -> bình thường
            else if (hourElement === mainElement) {
                return `${mainElement} (trùng với giờ)`;
            }
            // Các trường hợp khác
            else {
                return `${mainElement} (giờ: ${hourElement})`;
            }
        }

        function updateDetailedDisplay(people) {
            let html = '<h3><i class="fas fa-chart-bar"></i> Kết quả phân tích chi tiết:</h3>';
            
            people.forEach(person => {
                html += `
                    <div class="result-item">
                        <div class="person-name">${person.listId}. ${person.name} <span style="font-size: 0.9rem; color: #666;">(${person.gender === 'male' ? 'Nam' : 'Nữ'})</span></div>
                        <div class="person-details">
                            <div class="detail-item"><i class="far fa-clock"></i> Giờ: ${person.hour}</div>
                            <div class="detail-item"><i class="far fa-calendar"></i> Ngày: ${person.day}</div>
                            <div class="detail-item"><i class="fas fa-calendar"></i> Tháng: ${person.month}</div>
                            <div class="detail-item"><i class="fas fa-calendar-check"></i> Năm: ${person.year}</div>
                            <div class="detail-item element-badge badge-${getElementClass(person.mainElement)}">${person.mainElement}</div>
                        </div>
                        <div><strong>Ngũ hành chính (năm):</strong> ${person.mainElement}</div>
                        <div><strong>Ngũ hành giờ:</strong> ${person.hourElement}</div>
                        <div><strong>Tổng hợp ngũ hành:</strong> ${person.combinedElement}</div>
                        <div><strong>Mệnh năm:</strong> ${person.yearInfo.menh}</div>
                        <div><strong>Quẻ mệnh:</strong> ${person.destiny}</div>
                        <div><strong>Ý nghĩa năm:</strong> ${person.yearInfo.yNghia}</div>
                    </div>
                `;
            });
            
            document.getElementById('individualResults').innerHTML = html;
        }

        function groupByElement(people) {
            const groups = {
                "Mộc": [],
                "Hoả": [],
                "Thổ": [],
                "Kim": [],
                "Thuỷ": []
            };
            
            people.forEach(person => {
                if (groups[person.mainElement]) {
                    groups[person.mainElement].push(person);
                }
            });
            
            displayGroups(groups);
        }

        function displayGroups(groups) {
            let html = '';
            const elements = ["Mộc", "Hoả", "Thổ", "Kim", "Thuỷ"];
            
            elements.forEach(element => {
                const group = groups[element];
                if (group.length > 0) {
                    // Xác định đội trưởng (người có giờ tương sinh với năm)
                    let leader = group[0];
                    let bestScore = 0;
                    
                    group.forEach(person => {
                        // Tính điểm: giờ sinh năm +3, cùng hành +2, khác hành 0
                        let score = 0;
                        const sinhCycle = {
                            "Mộc": "Hoả",
                            "Hoả": "Thổ",
                            "Thổ": "Kim",
                            "Kim": "Thuỷ",
                            "Thuỷ": "Mộc"
                        };
                        
                        if (sinhCycle[person.hourElement] === person.mainElement) {
                            score += 3;
                        } else if (person.hourElement === person.mainElement) {
                            score += 2;
                        }
                        
                        if (score > bestScore) {
                            bestScore = score;
                            leader = person;
                        }
                    });
                    
                    html += `
                        <div class="group-card color-${getElementClass(element)}">
                            <div class="group-title">
                                <span class="element-badge badge-${getElementClass(element)}">${element}</span>
                                Nhóm ${element} (${group.length} thành viên)
                            </div>
                            
                            <div class="group-leader">
                                <i class="fas fa-crown"></i> Đội trưởng: ${leader.name} 
                                <br>Giờ: ${leader.hour} | Ngũ hành giờ: ${leader.hourElement}
                            </div>
                            
                            <div><strong>Thành viên:</strong></div>
                            <ul class="members-list">
                                ${group.map(person => `<li>${person.name} - Năm: ${person.year} (${person.mainElement}) - Giờ: ${person.hour} (${person.hourElement})</li>`).join('')}
                            </ul>
                            
                            <div class="business-suggestion">
                                <strong><i class="fas fa-lightbulb"></i> Đề xuất kinh doanh cho nhóm ${element}:</strong><br>
                                ${getBusinessSuggestion(element)}
                            </div>
                        </div>
                    `;
                }
            });
            
            document.getElementById('groupResults').innerHTML = html;
        }

        function getBusinessSuggestion(element) {
            const suggestions = businessSuggestions[element] || ["Chưa có đề xuất cụ thể"];
            // Lấy tất cả đề xuất
            return suggestions.map((suggestion, index) => `${index + 1}. ${suggestion}`).join('<br>');
        }

        // ==============================
        // CÔNG CỤ TÍNH CAN CHI
        // ==============================
        
        function populateCanChiSelectOptions() {
            const hourSelect = document.getElementById('hour');
            const daySelect = document.getElementById('day');
            const monthSelect = document.getElementById('month');
            const yearSelect = document.getElementById('year');
            const personHourSelect = document.getElementById('personHour');
            const personDaySelect = document.getElementById('personDay');
            const personMonthSelect = document.getElementById('personMonth');
            const personYearSelect = document.getElementById('personYear');
            
            canChiData.forEach(item => {
                const option = document.createElement('option');
                option.value = item.canChi;
                option.textContent = item.canChi;
                
                hourSelect.appendChild(option.cloneNode(true));
                daySelect.appendChild(option.cloneNode(true));
                monthSelect.appendChild(option.cloneNode(true));
                yearSelect.appendChild(option.cloneNode(true));
                personHourSelect.appendChild(option.cloneNode(true));
                personDaySelect.appendChild(option.cloneNode(true));
                personMonthSelect.appendChild(option.cloneNode(true));
                personYearSelect.appendChild(option.cloneNode(true));
            });
            
            // Đặt giá trị mặc định theo thời gian chuẩn
            hourSelect.value = STANDARD_DATE.canChi.hour;
            daySelect.value = STANDARD_DATE.canChi.day;
            monthSelect.value = STANDARD_DATE.canChi.month;
            yearSelect.value = STANDARD_DATE.canChi.year;
        }

        function calculateFromCanChi(direction) {
            const hour = document.getElementById('hour').value;
            const day = document.getElementById('day').value;
            const month = document.getElementById('month').value;
            const year = document.getElementById('year').value;
            
            if (!hour || !day || !month || !year) {
                alert("Vui lòng chọn đầy đủ giờ, ngày, tháng, năm!");
                return;
            }
            
            const hourInfo = findInfoByCanChi(hour);
            const dayInfo = findInfoByCanChi(day);
            const monthInfo = findInfoByCanChi(month);
            const yearInfo = findInfoByCanChi(year);
            
            if (!hourInfo || !dayInfo || !monthInfo || !yearInfo) {
                alert("Không tìm thấy thông tin cho một hoặc nhiều giá trị đã chọn!");
                return;
            }
            
            const resultContent = document.getElementById('canchiResultContent');
            
            let items;
            if (direction === 'forward') {
                items = [
                    {label: "Giờ", info: hourInfo},
                    {label: "Ngày", info: dayInfo},
                    {label: "Tháng", info: monthInfo},
                    {label: "Năm", info: yearInfo}
                ];
            } else {
                items = [
                    {label: "Năm", info: yearInfo},
                    {label: "Tháng", info: monthInfo},
                    {label: "Ngày", info: dayInfo},
                    {label: "Giờ", info: hourInfo}
                ];
            }
            
            let html = '';
            items.forEach(item => {
                html += `
                    <div class="result-item">
                        <div class="result-title">${item.label}: ${item.info.canChi}</div>
                        <div class="result-content">
                            <div class="result-detail">
                                <div class="detail-label">Ý Nghĩa:</div>
                                <div class="detail-value">${item.info.yNghia}</div>
                            </div>
                            <div class="result-detail">
                                <div class="detail-label">Âm Dương Ngũ Hành:</div>
                                <div class="detail-value">${item.info.amDuong}</div>
                            </div>
                            <div class="result-detail">
                                <div class="detail-label">Mệnh:</div>
                                <div class="detail-value">${item.info.menh}</div>
                            </div>
                            <div class="result-detail">
                                <div class="detail-label">Quẻ 1 (Nữ):</div>
                                <div class="detail-value">${item.info.que1}</div>
                            </div>
                            <div class="result-detail">
                                <div class="detail-label">Quẻ 2 (Nam):</div>
                                <div class="detail-value">${item.info.que2}</div>
                            </div>
                            <div class="result-detail">
                                <div class="detail-label">Ngũ Hành:</div>
                                <div class="detail-value">${item.info.element}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            resultContent.innerHTML = html;
            document.getElementById('canchiResult').style.display = 'block';
        }

        function calculateFromSolar() {
            const hour = parseInt(document.getElementById('solarHour').value);
            const day = parseInt(document.getElementById('solarDay').value);
            const month = parseInt(document.getElementById('solarMonth').value);
            const year = parseInt(document.getElementById('solarYear').value);
            
            if (isNaN(hour) || isNaN(day) || isNaN(month) || isNaN(year)) {
                alert("Vui lòng nhập đầy đủ thông tin!");
                return;
            }
            
            if (hour < 0 || hour > 23) {
                alert("Giờ phải từ 0 đến 23!");
                return;
            }
            
            if (day < 1 || day > 31) {
                alert("Ngày không hợp lệ!");
                return;
            }
            
            if (month < 1 || month > 12) {
                alert("Tháng không hợp lệ!");
                return;
            }
            
            const solarDate = { year, month, day, hour };
            const canChiResult = calculateCanChiFromSolar(solarDate);
            
            const hourInfo = findInfoByCanChi(canChiResult.hour);
            const dayInfo = findInfoByCanChi(canChiResult.day);
            const monthInfo = findInfoByCanChi(canChiResult.month);
            const yearInfo = findInfoByCanChi(canChiResult.year);
            
            const resultContent = document.getElementById('canchiResultContent');
            
            let html = `
                <div class="result-item">
                    <div class="result-title">Ngày Dương Lịch Nhập: ${day}/${month}/${year} - ${hour} giờ</div>
                </div>
            `;
            
            const items = [
                {label: "Giờ", info: hourInfo},
                {label: "Ngày", info: dayInfo},
                {label: "Tháng", info: monthInfo},
                {label: "Năm", info: yearInfo}
            ];
            
            items.forEach(item => {
                if (item.info) {
                    html += `
                        <div class="result-item">
                            <div class="result-title">${item.label}: ${item.info.canChi}</div>
                            <div class="result-content">
                                <div class="result-detail">
                                    <div class="detail-label">Ý Nghĩa:</div>
                                    <div class="detail-value">${item.info.yNghia}</div>
                                </div>
                                <div class="result-detail">
                                    <div class="detail-label">Âm Dương Ngũ Hành:</div>
                                    <div class="detail-value">${item.info.amDuong}</div>
                                </div>
                                <div class="result-detail">
                                    <div class="detail-label">Mệnh:</div>
                                    <div class="detail-value">${item.info.menh}</div>
                                </div>
                                <div class="result-detail">
                                    <div class="detail-label">Ngũ Hành:</div>
                                    <div class="detail-value">${item.info.element}</div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            });
            
            resultContent.innerHTML = html;
            document.getElementById('canchiResult').style.display = 'block';
        }

        function calculateToSolar() {
            alert("Tính Dương Lịch từ Can Chi cần thuật toán phức tạp hơn. Tính năng này đang được phát triển.");
        }

        function applySolarToPerson() {
            const hour = parseInt(document.getElementById('solarHour').value);
            const day = parseInt(document.getElementById('solarDay').value);
            const month = parseInt(document.getElementById('solarMonth').value);
            const year = parseInt(document.getElementById('solarYear').value);
            
            if (isNaN(hour) || isNaN(day) || isNaN(month) || isNaN(year)) {
                alert("Vui lòng nhập đầy đủ thông tin dương lịch!");
                return;
            }
            
            const solarDate = { year, month, day, hour };
            const canChiResult = calculateCanChiFromSolar(solarDate);
            
            // Đặt giá trị vào form nhập người
            document.getElementById('personHour').value = canChiResult.hour;
            document.getElementById('personDay').value = canChiResult.day;
            document.getElementById('personMonth').value = canChiResult.month;
            document.getElementById('personYear').value = canChiResult.year;
            
            alert(`Đã tính Can Chi từ ngày ${day}/${month}/${year} giờ ${hour} và áp dụng vào form nhập người.`);
        }

        function applyCanChiToPerson() {
            const hour = document.getElementById('hour').value;
            const day = document.getElementById('day').value;
            const month = document.getElementById('month').value;
            const year = document.getElementById('year').value;
            
            if (!hour || !day || !month || !year) {
                alert("Vui lòng chọn đầy đủ giờ, ngày, tháng, năm Can Chi!");
                return;
            }
            
            // Đặt giá trị vào form nhập người
            document.getElementById('personHour').value = hour;
            document.getElementById('personDay').value = day;
            document.getElementById('personMonth').value = month;
            document.getElementById('personYear').value = year;
            
            alert(`Đã áp dụng Can Chi: Giờ ${hour}, Ngày ${day}, Tháng ${month}, Năm ${year} vào form nhập người.`);
        }

        function resetCanChiForm() {
            document.getElementById('hour').value = STANDARD_DATE.canChi.hour;
            document.getElementById('day').value = STANDARD_DATE.canChi.day;
            document.getElementById('month').value = STANDARD_DATE.canChi.month;
            document.getElementById('year').value = STANDARD_DATE.canChi.year;
            
            document.getElementById('solarHour').value = STANDARD_DATE.hour;
            document.getElementById('solarDay').value = STANDARD_DATE.day;
            document.getElementById('solarMonth').value = STANDARD_DATE.month;
            document.getElementById('solarYear').value = STANDARD_DATE.year;
            
            document.getElementById('canchiResult').style.display = 'none';
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
        }
    </script>
</body>
</html>