<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√≠nh to√°n Ng√†y Sinh - An To√†n Th·ªùi Gian</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        .header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 16px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #e1e8ed;
        }
        
        .card h2 {
            color: #2980b9;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ecf0f1;
            font-size: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #34495e;
        }
        
        select, input[type="date"], input[type="text"] {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #2980b9, #1f639e);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn-calculate-all {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .btn-calculate-all:hover {
            background: linear-gradient(135deg, #27ae60, #219653);
        }
        
        .results-section {
            grid-column: 1 / -1;
            margin-top: 20px;
        }
        
        .results-container {
            display: none;
            margin-top: 20px;
        }
        
        .results-container.active {
            display: block;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            background: #f8f9fa;
            border: 1px solid transparent;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 6px 6px 0 0;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: white;
            color: #3498db;
            border-color: #ddd #ddd white #ddd;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 0 6px 6px 6px;
            border: 1px solid #ddd;
            border-top: none;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .result-item {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
            margin-bottom: 8px;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .person-name {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .day-diff {
            color: #e74c3c;
            font-weight: 600;
            font-size: 18px;
        }
        
        .calculation-result {
            margin-top: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .special-numbers {
            margin-top: 10px;
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .danger-number {
            color: #e74c3c;
            font-weight: 700;
        }
        
        .warning-number {
            color: #e67e22;
            font-weight: 700;
        }
        
        .critical-number {
            color: #8e44ad;
            font-weight: 700;
        }
        
        .time-info {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 5px;
        }
        
        .danger-item {
            background: #ffeaea;
            border-left: 4px solid #e74c3c;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 4px 4px 0;
        }
        
        .warning-item {
            background: #fff4e6;
            border-left: 4px solid #e67e22;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 4px 4px 0;
        }
        
        .critical-item {
            background: #f4e6ff;
            border-left: 4px solid #8e44ad;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 4px 4px 0;
        }
        
        .info-note {
            background: #e8f4fc;
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 14px;
            color: #2c3e50;
            border-left: 4px solid #3498db;
        }
        
        .hidden {
            display: none;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 15px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f2f6fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .summary {
            margin-top: 20px;
            padding: 15px;
            background: #e8f6f3;
            border-radius: 6px;
            border-left: 4px solid #1abc9c;
        }
        
        .summary h3 {
            color: #16a085;
            margin-bottom: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .alert-message {
            background: #ffebee;
            border: 2px solid #e74c3c;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-weight: bold;
            color: #c0392b;
            text-align: center;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }
        
        .pharmacy-message {
            background: #e8f5e9;
            border: 2px solid #27ae60;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-weight: bold;
            color: #1e8449;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>T√çNH TO√ÅN AN TO√ÄN TH·ªúI GIAN</h1>
            <p>Ki·ªÉm tra c√°c m·ªëc th·ªùi gian quan tr·ªçng d·ª±a tr√™n ng√†y sinh v√† th·ªùi ƒëi·ªÉm hi·ªán t·∫°i</p>
        </div>
        
        <div class="card">
            <h2>PH·∫¶N 1: T√çNH CHO M·ªòT NG∆Ø·ªúI</h2>
            <div class="form-group">
                <label for="personSelect">1. Ch·ªçn ng∆∞·ªùi:</label>
                <select id="personSelect" onchange="updateBirthDate()">
                    <option value="">-- Ch·ªçn m·ªôt ng∆∞·ªùi --</option>
                    <option value="NGUYENKHACNANG|04/06/1944">1. NGUYENKHACNANG (04/06/1944)</option>
                    <option value="TOTHIHA|29/08/1948">2. TOTHIHA (29/08/1948)</option>
                    <option value="NGUYENMINHNAM|03/03/1971">3. NGUYENMINHNAM (03/03/1971)</option>
                    <option value="THANTHIKIMANH|23/09/1981">4. THANTHIKIMANH (23/09/1981)</option>
                    <option value="NGUYENTONGANAN|28/09/2014">5. NGUYENTONGANAN (28/09/2014)</option>
                    <option value="NGUYENTOMINHCHAU|25/07/2016">6. NGUYENTOMINHCHAU (25/07/2016)</option>
                    <option value="NGUYENTOBICHNGOC|05/02/2020">7. NGUYENTOBICHNGOC (05/02/2020)</option>
                    <option value="NGUYENTHIMINHHANG|07/01/1974">8. NGUYENTHIMINHHANG (07/01/1974)</option>
                    <option value="NGOQUYCUONG|23/05/1973">9. NGOQUYCUONG (23/05/1973)</option>
                    <option value="NGOGIABACH|12/10/2000">10. NGOGIABACH (12/10/2000)</option>
                    <option value="NGOGIALINH|05/04/2005">11. NGOGIALINH (05/04/2005)</option>
                    <option value="NGUYENTHIMINHPHUONG|06/11/1978">12. NGUYENTHIMINHPHUONG (06/11/1978)</option>
                    <option value="HOANGANHDUNG|21/09/1978">13. HOANGANHDUNG (21/09/1978)</option>
                    <option value="HOANGHAIVINH|03/06/2010">14. HOANGHAIVINH (03/06/2010)</option>
                    <option value="HOANGTHIENBACHANH|14/11/2015">15. HOANGTHIENBACHANH (14/11/2015)</option>
                    <option value="TOKIMHUE|09/08/1960">16. T√î KIM HU·ªÜ (09/08/1960)</option>
                    <option value="NGUYENTUANANH|23/10/1983">17. NGUY·ªÑN TU·∫§N ANH (23/10/1983)</option>
                    <option value="NGUYENTHEANH|24/03/2001">18. NGUY·ªÑN TH·∫æ ANH (24/03/2001)</option>
                    <option value="NGOTHIMAI|12/12/1948">19. NG√î TH·ªä MAI (12/12/1948)</option>
                    <option value="TOVIETHUNG|17/06/1996">20. T√î VI·ªÜT H∆ØNG (17/06/1996)</option>
                    <option value="TOTHIHONG|10/10/1964">21. T√î TH·ªä H·ªíNG (10/10/1964)</option>
                    <option value="VUVANHIEP|24/04/1974">22. V≈® VƒÇN HI·ªÜP (24/04/1974)</option>
                    <option value="NGUYENTHICHI|08/02/1946">23. NGUY·ªÑN TH·ªä CHI (08/02/1946)</option>
                    <option value="NGUYENTANBAC|30/11/1957">24. NGUY·ªÑN T·∫§N B·∫ÆC (30/11/1957)</option>
                    <option value="NGUYENTHITAM|08/08/1954">25. NGUY·ªÑN TH·ªä T√ÇM (08/08/1954)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="birthDate">2. Ng√†y th√°ng nƒÉm sinh:</label>
                <input type="text" id="birthDate" placeholder="DD/MM/YYYY" value="">
            </div>
            
            <div class="form-group">
                <label for="targetDate">3. Ng√†y th√°ng nƒÉm mu·ªën xem:</label>
                <input type="date" id="targetDate" value="">
            </div>
            
            <button class="btn" onclick="calculateForOne()">T√çNH TO√ÅN CHO 1 NG∆Ø·ªúI</button>
        </div>
        
        <div class="card">
            <h2>PH·∫¶N 2: T√çNH CHO T·∫§T C·∫¢ NG∆Ø·ªúI</h2>
            <p style="margin-bottom: 15px; color: #7f8c8d;">T√≠nh to√°n cho t·∫•t c·∫£ 25 ng∆∞·ªùi trong danh s√°ch</p>
            
            <div class="form-group">
                <label for="allTargetDate">Ng√†y th√°ng nƒÉm mu·ªën xem:</label>
                <input type="date" id="allTargetDate" value="">
            </div>
            
            <button class="btn btn-calculate-all" onclick="calculateForAll()">T√çNH TO√ÅN CHO T·∫§T C·∫¢</button>
            
            <div class="loading" id="loadingAll">
                <div class="spinner"></div>
                <p>ƒêang t√≠nh to√°n cho 25 ng∆∞·ªùi...</p>
            </div>
        </div>
        
        <div class="results-section">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('single')">K·∫æT QU·∫¢ 1 NG∆Ø·ªúI</div>
                <div class="tab" onclick="switchTab('all')">K·∫æT QU·∫¢ T·∫§T C·∫¢</div>
            </div>
            
            <div class="tab-content active" id="singleResult">
                <!-- K·∫øt qu·∫£ ph·∫ßn 1 s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
            </div>
            
            <div class="tab-content" id="allResult">
                <!-- K·∫øt qu·∫£ ph·∫ßn 2 s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
            </div>
        </div>
        
        <div class="card">
            <h2>B·∫¢NG GI·ªú V√Ä S·ªê TH·ª® T·ª∞</h2>
            <div class="table-container">
                <table id="timeTable">
                    <thead>
                        <tr>
                            <th>Gi·ªù</th>
                            <th>S·ªë th·ª© t·ª±</th>
                            <th>Gi·ªù</th>
                            <th>S·ªë th·ª© t·ª±</th>
                            <th>Gi·ªù</th>
                            <th>S·ªë th·ª© t·ª±</th>
                        </tr>
                    </thead>
                    <tbody id="timeTableBody">
                        <!-- B·∫£ng gi·ªù s·∫Ω ƒë∆∞·ª£c t·∫°o ƒë·ªông b·∫±ng JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="info-note">
        <strong>L∆∞u √Ω:</strong> C√°c s·ªë ƒë·∫∑c bi·ªát t√¨m ƒë∆∞·ª£c n√™n g·∫Øn k√®m v·ªõi gi·ªù trong b·∫£ng 1 ƒë·ªÉ bi·∫øt m√† tr√°nh r·ªßi ro, tai n·∫°n. S·ªë 307 l√† (t·ª•t huy·∫øt √°p), c√°c s·ªë kh√°c l√† b·ªánh n·∫∑ng.
    </div>
    
    <div class="footer">
        <p>¬© 2023 - T√≠nh to√°n An to√†n Th·ªùi gian | D·ªØ li·ªáu ch·ªâ mang t√≠nh ch·∫•t tham kh·∫£o</p>
    </div>

    <script>
        // T·∫°o b·∫£ng gi·ªù v√† s·ªë th·ª© t·ª±
        const timeTableData = [];
        for (let hour = 13; hour <= 18; hour++) {
            for (let minute = 0; minute < 60; minute++) {
                if (hour === 18 && minute > 0) break; // Ch·ªâ ƒë·∫øn 18:00
                const timeStr = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                const number = 780 + (hour - 13) * 60 + minute;
                timeTableData.push({ time: timeStr, number: number });
            }
        }
        
        // Hi·ªÉn th·ªã b·∫£ng gi·ªù
        const timeTableBody = document.getElementById('timeTableBody');
        let row;
        timeTableData.forEach((item, index) => {
            if (index % 3 === 0) {
                row = document.createElement('tr');
                timeTableBody.appendChild(row);
            }
            
            const cell1 = document.createElement('td');
            cell1.textContent = item.time;
            
            const cell2 = document.createElement('td');
            cell2.textContent = item.number;
            
            row.appendChild(cell1);
            row.appendChild(cell2);
        });
        
        // ƒê·∫∑t ng√†y m·∫∑c ƒë·ªãnh l√† h√¥m nay
        const today = new Date();
        const todayStr = today.toISOString().split('T')[0];
        document.getElementById('targetDate').value = todayStr;
        document.getElementById('allTargetDate').value = todayStr;
        
        // C√°c s·ªë ƒë·∫∑c bi·ªát c·∫ßn t√¨m
        const specialNumbersP3 = [14, 41, 27, 72];
        const specialNumbersP2 = [
            307, 111, 222, 333, 444, 555, 666, 777, 888, 999,
            159, 195, 168, 186, 267, 276, 249, 294, 285, 258,
            357, 375, 384, 348, 438, 483, 429, 492, 528, 582,
            537, 573, 519, 591, 627, 672, 618, 681, 726, 762,
            735, 753, 825, 852, 816, 861, 843, 834, 915, 951,
            924, 942
        ];
        
        // Danh s√°ch ng∆∞·ªùi
        const people = [
            {name: "NGUYENKHACNANG", birthDate: "04/06/1944"},
            {name: "TOTHIHA", birthDate: "29/08/1948"},
            {name: "NGUYENMINHNAM", birthDate: "03/03/1971"},
            {name: "THANTHIKIMANH", birthDate: "23/09/1981"},
            {name: "NGUYENTONGANAN", birthDate: "28/09/2014"},
            {name: "NGUYENTOMINHCHAU", birthDate: "25/07/2016"},
            {name: "NGUYENTOBICHNGOC", birthDate: "05/02/2020"},
            {name: "NGUYENTHIMINHHANG", birthDate: "07/01/1974"},
            {name: "NGOQUYCUONG", birthDate: "23/05/1973"},
            {name: "NGOGIABACH", birthDate: "12/10/2000"},
            {name: "NGOGIALINH", birthDate: "05/04/2005"},
            {name: "NGUYENTHIMINHPHUONG", birthDate: "06/11/1978"},
            {name: "HOANGANHDUNG", birthDate: "21/09/1978"},
            {name: "HOANGHAIVINH", birthDate: "03/06/2010"},
            {name: "HOANGTHIENBACHANH", birthDate: "14/11/2015"},
            {name: "T√î KIM HU·ªÜ", birthDate: "09/08/1960"},
            {name: "NGUY·ªÑN TU·∫§N ANH", birthDate: "23/10/1983"},
            {name: "NGUY·ªÑN TH·∫æ ANH", birthDate: "24/03/2001"},
            {name: "NG√î TH·ªä MAI", birthDate: "12/12/1948"},
            {name: "T√î VI·ªÜT H∆ØNG", birthDate: "17/06/1996"},
            {name: "T√î TH·ªä H·ªíNG", birthDate: "10/10/1964"},
            {name: "V≈® VƒÇN HI·ªÜP", birthDate: "24/04/1974"},
            {name: "NGUY·ªÑN TH·ªä CHI", birthDate: "08/02/1946"},
            {name: "NGUY·ªÑN T·∫§N B·∫ÆC", birthDate: "30/11/1957"},
            {name: "NGUY·ªÑN TH·ªä T√ÇM", birthDate: "08/08/1954"}
        ];
        
        // H√†m chuy·ªÉn ƒë·ªïi ng√†y t·ª´ DD/MM/YYYY sang ƒë·ªëi t∆∞·ª£ng Date
        function parseDate(dateStr) {
            const parts = dateStr.split('/');
            return new Date(parts[2], parts[1] - 1, parts[0]);
        }
        
        // H√†m t√≠nh s·ªë ng√†y ch√™nh l·ªách
        function calculateDayDiff(birthDateStr, targetDateStr) {
            const birthDate = parseDate(birthDateStr);
            const targetDate = new Date(targetDateStr);
            
            // T√≠nh s·ªë mili gi√¢y ch√™nh l·ªách
            const diffTime = Math.abs(targetDate - birthDate);
            
            // Chuy·ªÉn ƒë·ªïi sang ng√†y
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            return diffDays;
        }
        
        // H√†m c·∫≠p nh·∫≠t ng√†y sinh khi ch·ªçn ng∆∞·ªùi
        function updateBirthDate() {
            const select = document.getElementById('personSelect');
            if (select.value) {
                const parts = select.value.split('|');
                document.getElementById('birthDate').value = parts[1];
            }
        }
        
        // H√†m gh√©p s·ªë nguy√™n v√† s·ªë d∆∞ th√†nh m·ªôt s·ªë
        function combineIntAndRemainder(integer, remainder) {
            return parseInt(integer.toString() + remainder.toString().padStart(3, '0'));
        }
        
        // H√†m ki·ªÉm tra s·ªë ƒë·∫∑c bi·ªát trong P4
        function checkSpecialP4Number(combinedNumber) {
            // C√°c s·ªë ƒë·∫∑c bi·ªát cho P4
            const specialP4Numbers = [
                1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009,
                1010, 1011, 1012, 1013, 1014, 1015, 1016, 1017, 1018, 1019,
                1020, 1021, 1022, 1023, 1024, 1025, 1026, 1027, 1028, 1029,
                1030, 1031, 1032, 1033, 1034, 1035, 1036, 1037, 1038, 1039,
                1040, 1041, 1042, 1043, 1044, 1045, 1046, 1047, 1048, 1049,
                1050, 1051, 1052, 1053, 1054, 1055, 1056, 1057, 1058, 1059,
                1060, 1061, 1062, 1063, 1064, 1065, 1066, 1067, 1068, 1069,
                1070, 1071, 1072, 1073, 1074, 1075, 1076, 1077, 1078, 1079,
                1080, 1081, 1082, 1083, 1084, 1085, 1086, 1087, 1088, 1089,
                1090, 1091, 1092, 1093, 1094, 1095, 1096, 1097, 1098, 1099,
                1100
            ];
            
            return specialP4Numbers.includes(combinedNumber);
        }
        
        // H√†m hi·ªÉn th·ªã th√¥ng b√°o ƒë·∫∑c bi·ªát
        function displaySpecialAlert(message, isCritical = false) {
            if (isCritical) {
                return `<div class="alert-message">
                    ‚ö†Ô∏è ${message}
                </div>`;
            } else {
                return `<div class="pharmacy-message">
                    üíä ${message}
                </div>`;
            }
        }
        
        // H√†m t√≠nh to√°n cho 1 ng∆∞·ªùi
        function calculateForOne() {
            const personSelect = document.getElementById('personSelect');
            const birthDateInput = document.getElementById('birthDate');
            const targetDateInput = document.getElementById('targetDate');
            
            if (!personSelect.value) {
                alert('Vui l√≤ng ch·ªçn m·ªôt ng∆∞·ªùi!');
                return;
            }
            
            if (!birthDateInput.value) {
                alert('Vui l√≤ng nh·∫≠p ng√†y sinh!');
                return;
            }
            
            if (!targetDateInput.value) {
                alert('Vui l√≤ng ch·ªçn ng√†y mu·ªën xem!');
                return;
            }
            
            // L·∫•y th√¥ng tin ng∆∞·ªùi
            const parts = personSelect.value.split('|');
            const personName = parts[0];
            const birthDate = birthDateInput.value;
            const targetDate = targetDateInput.value;
            
            // T√≠nh to√°n
            const dayDiff = calculateDayDiff(birthDate, targetDate);
            
            // Th·ª±c hi·ªán c√°c ph√©p t√≠nh
            const resultsP1 = []; // Ph√©p t√≠nh 1: th∆∞∆°ng ch·∫µn
            const resultsP2 = []; // Ph√©p t√≠nh 2: s·ªë d∆∞
            const resultsP3 = []; // Ph√©p t√≠nh 3: th∆∞∆°ng ch·∫µn c·ªßa P1 chia cho s·ªë th·ª© t·ª±
            const resultsP4 = []; // Ph√©p t√≠nh 4: ph√©p chia l·∫•y s·ªë nguy√™n gh√©p v·ªõi s·ªë d∆∞
            
            const specialFoundP2 = [];
            const specialFoundP3 = [];
            const specialFoundP4 = [];
            
            let hasCriticalAlert = false;
            let hasPharmacyAlert = false;
            
            timeTableData.forEach(item => {
                const stt = item.number;
                
                // Ph√©p t√≠nh 1: th∆∞∆°ng ch·∫µn
                const quotient = Math.floor(dayDiff / stt);
                if (quotient % 2 === 0 && quotient > 0) {
                    resultsP1.push({stt: stt, quotient: quotient});
                    
                    // Ph√©p t√≠nh 3: th∆∞∆°ng ch·∫µn c·ªßa P1 chia cho s·ªë th·ª© t·ª±
                    const quotient2 = Math.floor(quotient / stt);
                    resultsP3.push({stt: stt, quotient: quotient, quotient2: quotient2});
                    
                    // Ki·ªÉm tra s·ªë ƒë·∫∑c bi·ªát trong P3
                    if (specialNumbersP3.includes(quotient2)) {
                        specialFoundP3.push({
                            number: quotient2,
                            stt: stt,
                            time: item.time,
                            originalQuotient: quotient
                        });
                    }
                }
                
                // Ph√©p t√≠nh 2: s·ªë d∆∞
                const remainder = dayDiff % stt;
                resultsP2.push({stt: stt, remainder: remainder});
                
                // Ki·ªÉm tra s·ªë ƒë·∫∑c bi·ªát trong P2
                if (specialNumbersP2.includes(remainder)) {
                    specialFoundP2.push({
                        number: remainder,
                        stt: stt,
                        time: item.time
                    });
                }
                
                // Ph√©p t√≠nh 4: ph√©p chia l·∫•y s·ªë nguy√™n gh√©p v·ªõi s·ªë d∆∞
                if (quotient > 0) {
                    const combinedNumber = combineIntAndRemainder(quotient, remainder);
                    resultsP4.push({
                        stt: stt,
                        quotient: quotient,
                        remainder: remainder,
                        combinedNumber: combinedNumber,
                        time: item.time
                    });
                    
                    // Ki·ªÉm tra s·ªë ƒë·∫∑c bi·ªát trong P4
                    if (checkSpecialP4Number(combinedNumber)) {
                        specialFoundP4.push({
                            number: combinedNumber,
                            stt: stt,
                            time: item.time,
                            quotient: quotient,
                            remainder: remainder
                        });
                        
                        // Ki·ªÉm tra n·∫øu l√† s·ªë ƒë·∫∑c bi·ªát nguy hi·ªÉm
                        if (combinedNumber >= 1001 && combinedNumber <= 1010) {
                            hasCriticalAlert = true;
                        } else if (combinedNumber >= 1050 && combinedNumber <= 1100) {
                            hasPharmacyAlert = true;
                        }
                    }
                }
            });
            
            // Hi·ªÉn th·ªã k·∫øt qu·∫£
            displaySingleResult(personName, birthDate, targetDate, dayDiff, 
                              specialFoundP2, specialFoundP3, specialFoundP4,
                              hasCriticalAlert, hasPharmacyAlert);
            switchTab('single');
        }
        
        // H√†m hi·ªÉn th·ªã k·∫øt qu·∫£ cho 1 ng∆∞·ªùi
        function displaySingleResult(personName, birthDate, targetDate, dayDiff, 
                                    specialP2, specialP3, specialP4,
                                    hasCriticalAlert, hasPharmacyAlert) {
            const resultDiv = document.getElementById('singleResult');
            let html = `
                <div class="result-item">
                    <div class="person-name">${personName}</div>
                    <div>Ng√†y sinh: ${birthDate}</div>
                    <div>Ng√†y xem: ${targetDate}</div>
                    <div class="day-diff">S·ªë ng√†y ch√™nh l·ªách: ${dayDiff.toLocaleString()}</div>
                </div>
            `;
            
            // Hi·ªÉn th·ªã th√¥ng b√°o ƒë·∫∑c bi·ªát n·∫øu c√≥
            if (hasCriticalAlert) {
                html += displaySpecialAlert("ƒêAU TIM: C·∫ßn ch√∫ √Ω s·ª©c kh·ªèe tim m·∫°ch!", true);
            }
            
            if (hasPharmacyAlert) {
                html += displaySpecialAlert("Mua thu·ªëc ·ªü hi·ªáu thu·ªëc ƒë·ªÉ ph√≤ng ng·ª´a", false);
            }
            
            // Hi·ªÉn th·ªã s·ªë ƒë·∫∑c bi·ªát t√¨m ƒë∆∞·ª£c trong P2
            if (specialP2.length > 0) {
                html += `<div class="danger-item">
                    <strong>T√åM TH·∫§Y S·ªê ƒê·∫∂C BI·ªÜT TRONG PH√âP T√çNH 2:</strong><br>`;
                
                specialP2.forEach(item => {
                    const is307 = item.number === 307;
                    html += `<div class="special-numbers">
                        S·ªë <span class="${is307 ? 'danger-number' : 'warning-number'}">${item.number}</span> 
                        (${is307 ? 'T·ª§T HUY·∫æT √ÅP' : 'B·ªÜNH N·∫∂NG'}) 
                        t·∫°i gi·ªù <span class="time-info">${item.time}</span> 
                        (s·ªë th·ª© t·ª±: ${item.stt})
                    </div>`;
                });
                
                html += `</div>`;
            }
            
            // Hi·ªÉn th·ªã s·ªë ƒë·∫∑c bi·ªát t√¨m ƒë∆∞·ª£c trong P3
            if (specialP3.length > 0) {
                html += `<div class="warning-item">
                    <strong>T√åM TH·∫§Y S·ªê ƒê·∫∂C BI·ªÜT TRONG PH√âP T√çNH 3:</strong><br>`;
                
                specialP3.forEach(item => {
                    html += `<div class="special-numbers">
                        S·ªë <span class="warning-number">${item.number}</span> 
                        t·∫°i gi·ªù <span class="time-info">${item.time}</span> 
                        (s·ªë th·ª© t·ª±: ${item.stt}, th∆∞∆°ng: ${item.originalQuotient})
                    </div>`;
                });
                
                html += `</div>`;
            }
            
            // Hi·ªÉn th·ªã s·ªë ƒë·∫∑c bi·ªát t√¨m ƒë∆∞·ª£c trong P4
            if (specialP4.length > 0) {
                html += `<div class="critical-item">
                    <strong>T√åM TH·∫§Y S·ªê ƒê·∫∂C BI·ªÜT TRONG PH√âP T√çNH 4 (Ph√©p chia gh√©p s·ªë nguy√™n v·ªõi s·ªë d∆∞):</strong><br>`;
                
                specialP4.forEach(item => {
                    const isCritical = item.number >= 1001 && item.number <= 1010;
                    const needsPharmacy = item.number >= 1050 && item.number <= 1100;
                    
                    let alertText = "";
                    if (isCritical) {
                        alertText = " - ƒêAU TIM";
                    } else if (needsPharmacy) {
                        alertText = " - MUA THU·ªêC ·ªû HI·ªÜU THU·ªêC";
                    }
                    
                    html += `<div class="special-numbers">
                        S·ªë <span class="critical-number">${item.number}</span> 
                        ${alertText}
                        t·∫°i gi·ªù <span class="time-info">${item.time}</span> 
                        (s·ªë th·ª© t·ª±: ${item.stt}, th∆∞∆°ng: ${item.quotient}, d∆∞: ${item.remainder})
                    </div>`;
                });
                
                html += `</div>`;
            }
            
            if (specialP2.length === 0 && specialP3.length === 0 && specialP4.length === 0) {
                html += `<div class="summary">
                    <h3>KH√îNG T√åM TH·∫§Y S·ªê ƒê·∫∂C BI·ªÜT</h3>
                    <p>Kh√¥ng t√¨m th·∫•y s·ªë ƒë·∫∑c bi·ªát n√†o trong c√°c ph√©p t√≠nh.</p>
                </div>`;
            } else {
                html += `<div class="summary">
                    <h3>T·ªîNG K·∫æT</h3>
                    <p>T√¨m th·∫•y ${specialP2.length} s·ªë ƒë·∫∑c bi·ªát trong Ph√©p t√≠nh 2, 
                    ${specialP3.length} s·ªë ƒë·∫∑c bi·ªát trong Ph√©p t√≠nh 3, v√† 
                    ${specialP4.length} s·ªë ƒë·∫∑c bi·ªát trong Ph√©p t√≠nh 4.</p>
                    <p><strong>L∆∞u √Ω:</strong> C·∫ßn th·∫≠n tr·ªçng v√†o c√°c khung gi·ªù ƒë√£ t√¨m th·∫•y s·ªë ƒë·∫∑c bi·ªát.</p>
                </div>`;
            }
            
            resultDiv.innerHTML = html;
        }
        
        // H√†m t√≠nh to√°n cho t·∫•t c·∫£ m·ªçi ng∆∞·ªùi
        function calculateForAll() {
            const targetDateInput = document.getElementById('allTargetDate');
            const targetDate = targetDateInput.value;
            
            if (!targetDate) {
                alert('Vui l√≤ng ch·ªçn ng√†y mu·ªën xem!');
                return;
            }
            
            // Hi·ªÉn th·ªã loading
            document.getElementById('loadingAll').classList.add('active');
            
            // S·ª≠ d·ª•ng setTimeout ƒë·ªÉ tr√°nh block UI
            setTimeout(() => {
                const allResults = [];
                
                people.forEach(person => {
                    const dayDiff = calculateDayDiff(person.birthDate, targetDate);
                    
                    const specialFoundP2 = [];
                    const specialFoundP3 = [];
                    const specialFoundP4 = [];
                    
                    let hasCriticalAlert = false;
                    let hasPharmacyAlert = false;
                    
                    // T√≠nh to√°n c√°c ph√©p t√≠nh
                    timeTableData.forEach(item => {
                        const stt = item.number;
                        
                        // Ph√©p t√≠nh 1 v√† 3
                        const quotient = Math.floor(dayDiff / stt);
                        if (quotient % 2 === 0 && quotient > 0) {
                            // Ph√©p t√≠nh 3
                            const quotient2 = Math.floor(quotient / stt);
                            
                            // Ki·ªÉm tra s·ªë ƒë·∫∑c bi·ªát trong P3
                            if (specialNumbersP3.includes(quotient2)) {
                                specialFoundP3.push({
                                    number: quotient2,
                                    stt: stt,
                                    time: item.time,
                                    originalQuotient: quotient
                                });
                            }
                        }
                        
                        // Ph√©p t√≠nh 2
                        const remainder = dayDiff % stt;
                        
                        // Ki·ªÉm tra s·ªë ƒë·∫∑c bi·ªát trong P2
                        if (specialNumbersP2.includes(remainder)) {
                            specialFoundP2.push({
                                number: remainder,
                                stt: stt,
                                time: item.time
                            });
                        }
                        
                        // Ph√©p t√≠nh 4: ph√©p chia l·∫•y s·ªë nguy√™n gh√©p v·ªõi s·ªë d∆∞
                        if (quotient > 0) {
                            const combinedNumber = combineIntAndRemainder(quotient, remainder);
                            
                            // Ki·ªÉm tra s·ªë ƒë·∫∑c bi·ªát trong P4
                            if (checkSpecialP4Number(combinedNumber)) {
                                specialFoundP4.push({
                                    number: combinedNumber,
                                    stt: stt,
                                    time: item.time,
                                    quotient: quotient,
                                    remainder: remainder
                                });
                                
                                // Ki·ªÉm tra n·∫øu l√† s·ªë ƒë·∫∑c bi·ªát nguy hi·ªÉm
                                if (combinedNumber >= 1001 && combinedNumber <= 1010) {
                                    hasCriticalAlert = true;
                                } else if (combinedNumber >= 1050 && combinedNumber <= 1100) {
                                    hasPharmacyAlert = true;
                                }
                            }
                        }
                    });
                    
                    allResults.push({
                        name: person.name,
                        birthDate: person.birthDate,
                        dayDiff: dayDiff,
                        specialP2: specialFoundP2,
                        specialP3: specialFoundP3,
                        specialP4: specialFoundP4,
                        hasCriticalAlert: hasCriticalAlert,
                        hasPharmacyAlert: hasPharmacyAlert
                    });
                });
                
                // Hi·ªÉn th·ªã k·∫øt qu·∫£
                displayAllResults(allResults, targetDate);
                document.getElementById('loadingAll').classList.remove('active');
                switchTab('all');
            }, 100);
        }
        
        // H√†m hi·ªÉn th·ªã k·∫øt qu·∫£ cho t·∫•t c·∫£ m·ªçi ng∆∞·ªùi
        function displayAllResults(results, targetDate) {
            const resultDiv = document.getElementById('allResult');
            let html = `<h3>K·∫æT QU·∫¢ T√çNH TO√ÅN CHO ${results.length} NG∆Ø·ªúI</h3>
                       <p>Ng√†y xem: ${targetDate}</p>`;
            
            let hasSpecialResults = false;
            let totalCriticalAlerts = 0;
            let totalPharmacyAlerts = 0;
            
            results.forEach(person => {
                if (person.specialP2.length > 0 || person.specialP3.length > 0 || person.specialP4.length > 0) {
                    hasSpecialResults = true;
                    
                    if (person.hasCriticalAlert) totalCriticalAlerts++;
                    if (person.hasPharmacyAlert) totalPharmacyAlerts++;
                    
                    // X√°c ƒë·ªãnh lo·∫°i c·∫£nh b√°o
                    let itemClass = 'warning-item';
                    if (person.specialP2.length > 0) itemClass = 'danger-item';
                    if (person.specialP4.length > 0) itemClass = 'critical-item';
                    
                    html += `<div class="result-item ${itemClass}">`;
                    html += `<div class="person-name">${person.name}</div>`;
                    html += `<div>Ng√†y sinh: ${person.birthDate}</div>`;
                    html += `<div class="day-diff">S·ªë ng√†y ch√™nh l·ªách: ${person.dayDiff.toLocaleString()}</div>`;
                    
                    // Hi·ªÉn th·ªã c·∫£nh b√°o ƒë·∫∑c bi·ªát n·∫øu c√≥
                    if (person.hasCriticalAlert) {
                        html += `<div style="margin-top: 8px;">`;
                        html += displaySpecialAlert("ƒêAU TIM: C·∫ßn ch√∫ √Ω s·ª©c kh·ªèe tim m·∫°ch!", true);
                        html += `</div>`;
                    }
                    
                    if (person.hasPharmacyAlert) {
                        html += `<div style="margin-top: 8px;">`;
                        html += displaySpecialAlert("Mua thu·ªëc ·ªü hi·ªáu thu·ªëc ƒë·ªÉ ph√≤ng ng·ª´a", false);
                        html += `</div>`;
                    }
                    
                    if (person.specialP2.length > 0) {
                        html += `<div style="margin-top: 8px;"><strong>S·ªë ƒë·∫∑c bi·ªát Ph√©p t√≠nh 2:</strong></div>`;
                        person.specialP2.forEach(item => {
                            const is307 = item.number === 307;
                            html += `<div class="special-numbers" style="margin: 4px 0; padding: 6px;">
                                S·ªë <span class="${is307 ? 'danger-number' : 'warning-number'}">${item.number}</span> 
                                (${is307 ? 'T·ª§T HUY·∫æT √ÅP' : 'B·ªÜNH N·∫∂NG'}) 
                                t·∫°i gi·ªù <span class="time-info">${item.time}</span>
                            </div>`;
                        });
                    }
                    
                    if (person.specialP3.length > 0) {
                        html += `<div style="margin-top: 8px;"><strong>S·ªë ƒë·∫∑c bi·ªát Ph√©p t√≠nh 3:</strong></div>`;
                        person.specialP3.forEach(item => {
                            html += `<div class="special-numbers" style="margin: 4px 0; padding: 6px;">
                                S·ªë <span class="warning-number">${item.number}</span> 
                                t·∫°i gi·ªù <span class="time-info">${item.time}</span>
                            </div>`;
                        });
                    }
                    
                    if (person.specialP4.length > 0) {
                        html += `<div style="margin-top: 8px;"><strong>S·ªë ƒë·∫∑c bi·ªát Ph√©p t√≠nh 4 (Ph√©p chia gh√©p):</strong></div>`;
                        person.specialP4.forEach(item => {
                            const isCritical = item.number >= 1001 && item.number <= 1010;
                            const needsPharmacy = item.number >= 1050 && item.number <= 1100;
                            
                            let alertText = "";
                            if (isCritical) {
                                alertText = " - ƒêAU TIM";
                            } else if (needsPharmacy) {
                                alertText = " - MUA THU·ªêC ·ªû HI·ªÜU THU·ªêC";
                            }
                            
                            html += `<div class="special-numbers" style="margin: 4px 0; padding: 6px;">
                                S·ªë <span class="critical-number">${item.number}</span> 
                                ${alertText}
                                t·∫°i gi·ªù <span class="time-info">${item.time}</span>
                            </div>`;
                        });
                    }
                    
                    html += `</div>`;
                }
            });
            
            if (!hasSpecialResults) {
                html += `<div class="summary">
                    <h3>KH√îNG T√åM TH·∫§Y S·ªê ƒê·∫∂C BI·ªÜT</h3>
                    <p>Kh√¥ng t√¨m th·∫•y s·ªë ƒë·∫∑c bi·ªát n√†o trong c√°c ph√©p t√≠nh cho t·∫•t c·∫£ ${results.length} ng∆∞·ªùi.</p>
                </div>`;
            } else {
                // ƒê·∫øm t·ªïng s·ªë ng∆∞·ªùi c√≥ s·ªë ƒë·∫∑c bi·ªát
                const peopleWithSpecial = results.filter(p => 
                    p.specialP2.length > 0 || p.specialP3.length > 0 || p.specialP4.length > 0
                ).length;
                
                html += `<div class="summary">
                    <h3>T·ªîNG K·∫æT</h3>
                    <p>C√≥ ${peopleWithSpecial} ng∆∞·ªùi c√≥ s·ªë ƒë·∫∑c bi·ªát trong t·ªïng s·ªë ${results.length} ng∆∞·ªùi.</p>
                    <p>C√≥ ${totalCriticalAlerts} ng∆∞·ªùi c√≥ c·∫£nh b√°o ƒêAU TIM v√† ${totalPharmacyAlerts} ng∆∞·ªùi c·∫ßn MUA THU·ªêC.</p>
                    <p><strong>L∆∞u √Ω:</strong> Nh·ªØng ng∆∞·ªùi n√†y c·∫ßn th·∫≠n tr·ªçng v√†o c√°c khung gi·ªù ƒë√£ t√¨m th·∫•y s·ªë ƒë·∫∑c bi·ªát.</p>
                </div>`;
            }
            
            resultDiv.innerHTML = html;
        }
        
        // H√†m chuy·ªÉn tab
        function switchTab(tabName) {
            // ·∫®n t·∫•t c·∫£ c√°c tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Hi·ªÉn th·ªã tab ƒë∆∞·ª£c ch·ªçn
            if (tabName === 'single') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('singleResult').classList.add('active');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('allResult').classList.add('active');
            }
        }
        
        // Kh·ªüi t·∫°o: ƒë·∫∑t ng√†y m·∫∑c ƒë·ªãnh
        window.onload = function() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            document.getElementById('targetDate').value = todayStr;
            document.getElementById('allTargetDate').value = todayStr;
        };
    </script>
</body>
</html>